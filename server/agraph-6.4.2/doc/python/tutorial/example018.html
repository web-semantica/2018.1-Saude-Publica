
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Example 18: Pandas support &#8212; AllegroGraph Python client 100.2.0.dev0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '100.2.0.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running AG on AWS EC2" href="fedex.html" />
    <link rel="prev" title="Example 17: Triple attributes" href="example017.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
    <div class="nav-links nav-links-header">
        &laquo;<a href="example017.html" title="previous chapter">Example 17: Triple attributes</a>
      <a href="fedex.html" title="next chapter">Running AG on AWS EC2</a> 
      &raquo;
    </div>
  
    
  <div class="section" id="example-18-pandas-support">
<span id="example18"></span><h1>Example 18: Pandas support<a class="headerlink" href="#example-18-pandas-support" title="Permalink to this headline">Â¶</a></h1>
<p>The SPARQL query language has somewhat limited capabilities when it
comes to advanced numerical data analysis, data mining and other
similar tasks. In these cases it is best to only use SPARQL to
extract, filter and normalize data (perhaps coming from diverse
sources - the ability to work with such data is one of the key
advantages of the RDF data model) and rely on other tools to perform
further analysis. One of the more popular tools that can be used in
this context is the <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> framework. The AllegroGraph Python client
contains basic support for processing query results with this
library. Let us see how this support can be leveraged in a simplified
scenario.</p>
<p>As usual, we will start by opening a connection.</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">franz.openrdf.connect</span> <span class="kn">import</span> <span class="n">ag_connect</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">ag_connect</span><span class="p">(</span><span class="s1">&#39;python-tutorial&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we will add some data. The first data set describes per capita
cheese consumption in the United States in years 2000-2009 according to
USDA. The values are expressed in pounds:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">addData</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="w"></span>
<span class="w">    </span><span class="k">prefix</span><span class="w"> </span><span class="nn">ex:</span><span class="w"> </span><span class="nv">&lt;ex://&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2000</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2000</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">29.8</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2001</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2001</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">30.1</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2002</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2002</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">30.5</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2003</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2003</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">30.6</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2004</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2004</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">31.3</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2005</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2005</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">31.7</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2006</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2006</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">32.6</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2007</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2007</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">33.1</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2008</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2008</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">32.7</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">c2009</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2009</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">cheese</span><span class="w"> </span><span class="mf">32.8</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Our second set of samples is derived from NSF data and describes the
number of civil engineering doctorates awarded each year.</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">addData</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="w"></span>
<span class="w">    </span><span class="k">prefix</span><span class="w"> </span><span class="nn">ex:</span><span class="w"> </span><span class="nv">&lt;ex://&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2000</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2000</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">480</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2001</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2001</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">501</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2002</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2002</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">540</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2003</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2003</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">552</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2004</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2004</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">547</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2005</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2005</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">622</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2006</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2006</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">655</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2007</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2007</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">701</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2008</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2008</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">712</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">ex:</span><span class="nt">d2009</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">year</span><span class="w"> </span><span class="mi">2009</span><span class="p">;</span><span class="w"> </span><span class="nn">ex:</span><span class="nt">doctorates</span><span class="w"> </span><span class="mi">708</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can use a SPARQL query to extract all this data and create a Pandas
DataFrame from it:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">prefix ex: &lt;ex://&gt;</span>
<span class="s1">select ?year ?cheese ?doctorates {</span>
<span class="s1">    _:b1 ex:year ?year ; ex:cheese ?cheese .</span>
<span class="s1">    _:b2 ex:year ?year ; ex:doctorates ?doctorates .</span>
<span class="s1">}&#39;&#39;&#39;</span>
<span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">executeTupleQuery</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="k">as</span> <span class="n">result</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>   year cheese  doctorates
0  2000   29.8         480
1  2001   30.1         501
2  2002   30.5         540
3  2003   30.6         552
4  2004   31.3         547
5  2005   31.7         622
6  2006   32.6         655
7  2007   33.1         701
8  2008   32.7         712
9  2009   32.8         708
</pre></div>
</div>
<p>Notice that the DataFrame can be used after the result has been
discarded, since all required data has been copied.</p>
<p>At this point the <a class="reference internal" href="../_gen/franz.openrdf.query.html#franz.openrdf.query.queryresult.TupleQueryResult.toPandas" title="franz.openrdf.query.queryresult.TupleQueryResult.toPandas"><code class="xref py py-meth docutils literal"><span class="pre">toPandas()</span></code></a> method does not allow fine-grained
control over types of the returned columns. The <code class="docutils literal"><span class="pre">'cheese'</span></code> column
contains decimal values, but floats would be more convenient for
further computation. Thus we will modify the dataframe and convert the
data:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cheese&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cheese&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have the data in a form suitable for Pandas, we can
perform some analysis. To keep this tutorial simple we will just
measure the correlation between the number of civil engineering
doctorates awarded and per capita cheese consumption:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">correlation</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s1">&#39;cheese&#39;</span><span class="p">][</span><span class="s1">&#39;doctorates&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Correlation: </span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">correlation</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>Correlation: 0.97433
</pre></div>
</div>
<p>The interpretation of this result is left as an exercise to the
reader.</p>
</div>


  
    <div class="nav-links nav-links-footer">
        &laquo;<a href="example017.html" title="previous chapter">Example 17: Triple attributes</a>
      <a href="fedex.html" title="next chapter">Running AG on AWS EC2</a> 
      &raquo;
    </div>
  

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">AllegroGraph Python client</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=franzinc&repo=agraph-python&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#setting-the-environment-for-the-tutorial">Setting the environment for the tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#terminology">Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#creating-users-with-webview">Creating Users with WebView</a></li>
<li class="toctree-l2"><a class="reference internal" href="example001.html">Example 1: Creating a repository and triple indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="example002.html">Example 2: Asserting and retracting triples</a></li>
<li class="toctree-l2"><a class="reference internal" href="example003.html">Example 3: A SPARQL query</a></li>
<li class="toctree-l2"><a class="reference internal" href="example004.html">Example 4: Statement matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="example005.html">Example 5: Literal values</a></li>
<li class="toctree-l2"><a class="reference internal" href="example006.html">Example 6: Importing triples</a></li>
<li class="toctree-l2"><a class="reference internal" href="example007.html">Example 7: Querying multiple contexts</a></li>
<li class="toctree-l2"><a class="reference internal" href="example008.html">Example 8: Exporting triples</a></li>
<li class="toctree-l2"><a class="reference internal" href="example009.html">Example 9: Exporting query results</a></li>
<li class="toctree-l2"><a class="reference internal" href="example010.html">Example 10: Graphs in SPARQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="example011.html">Example 11: Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="example012.html">Example 12: Free Text indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="example013.html">Example 13: SPARQL query forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="example014.html">Example 14: Parametric queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="example015.html">Example 15: Range queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="example016.html">Example 16: Federated repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="example017.html">Example 17: Triple attributes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Example 18: Pandas support</a></li>
<li class="toctree-l2"><a class="reference internal" href="fedex.html">Running AG on AWS EC2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">AllegroGraph Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Release notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorial.html">Tutorial</a><ul>
      <li>Previous: <a href="example017.html" title="previous chapter">Example 17: Triple attributes</a></li>
      <li>Next: <a href="fedex.html" title="next chapter">Running AG on AWS EC2</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Franz Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/tutorial/example018.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>