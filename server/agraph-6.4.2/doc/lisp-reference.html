<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="author" content="Franz Incorporated"/>
<title>Lisp Reference Guide | AllegroGraph 6.4.2</title>
<link rel='stylesheet' href='jquery-ui.custom.min.css' />
<link rel='stylesheet' href='stylesheet.css' />
<link rel='stylesheet' href='print.css' media='print' />
<body id="reference-guide"> <div id="header"> <p>                 </p>                <p><script src="jquery.min.js" type="text/javascript" charset="utf-8"></script> <script src="jquery-ui.custom.min.js" type="text/javascript" charset="utf-8"></script> <script src="activebookmark.js" type="text/javascript" charset="utf-8"></script> </p> <div id='search-form'>   <form method="GET" action="https://www.google.com/search">     <input type="hidden" name="as_sitesearch" value=""> </input>     <input type="text" size="40" name="as_q" value="" placeholder="Please enable JavaScript to use search!"> </input>&nbsp;     <input type="submit" value="Search" disabled> </input>   </form> </div> <script>    /* Docudown has no support for function calls in HTML attributes. 
<ul>
<li>Thus, we set the as_sitesearch attribute using JavaScript below.    */   (function () { 'use strict'; var properValue = "franz.com/agraph/support/documentation/6.4.2/"; var input = document.querySelector(   '#search-form input[name="as_sitesearch"]'); input.setAttribute('value', properValue); /* The submit button was disabled so that search would be 
<ul>
<li>impossible for users without JavaScript. Enabling now: */ document.querySelector('#search-form input[type="submit"]').   removeAttribute('disabled'); document.querySelector('#search-form input[name="as_q"]').   removeAttribute('placeholder');   })(); </script> <div id="copyright">  Copyright (c) 2005 - 2018 Franz, Incorporated</div> <div id="timestamp">  Last updated 8 June 2018 at 06:55</div> <a href="https://franz.com" alt="Franz Inc Home Page"><div id="hdLogo"> </div></a> </li></ul></li></ul>       <h1>AllegroGraph 6.4.2 Lisp Reference Guide</h1></div> <div id="contents">  <div id="docIndex"> <ul id="agmenu"> <li><a href="index.html">Documentation Index</a> 
<ul>
<li><a href="release-notes.html">Release Notes</a></li>
<li><a href="agraph-quick-start.html">Quick Start</a></li>
<li><a href="agraph-introduction.html" id="agraph-introduction-tab">Introduction</a></li>
<li>Setup and Configuration
<ul>
<li><a href="http://franz.com/agraph/downloads/" target="_blank">Download</a></li>
<li><a href="server-installation.html">Server Installation</a></li>
<li><a href="daemon-config.html">Server Configuration and Control</a></li>
<li><a href="agwebview.html">WebView</a></li>
<li><a href="upgrade-guide.html">Database Upgrading</a></li></ul></li>
<li>Server Management
<ul>
<li><a href="performance-tuning.html">Performance Tuning</a></li>
<li><a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a></li>
<li><a href="purging-deleted-triples.html">Purging Deleted Triples</a></li>
<li><a href="audit.html">Auditing</a></li>
<li><a href="managing-users.html">Managing Users</a></li>
<li><a href="replication.html">Replication</a></li>
<li><a href="point-in-time-recovery.html">Point-in-Time Recovery</a></li>
<li><a href="transaction-log-archiving.html">Transaction Log Archiving</a></li>
<li><a href="security-overview.html">Security Overview</a></li>
<li><a href="security.html">Security Implementation</a></li></ul></li>
<li>Tools
<ul>
<li><a href="agtool.html">agtool</a></li>
<li><a href="agload.html">Data Loading</a></li>
<li><a href="agexport.html">Data Export</a></li>
<li><a href="backup-and-restore.html">Backup and Restore</a></li>
<li><a href="agquery.html">Querying</a></li>
<li><a href="reasoner-tutorial.html" id="reasoner-tutorial-tab">RDFS++</a></li>
<li><a href="materializer.html">Materializer</a></li></ul></li>
<li>Details
<ul>
<li><a href="triple-index.html">AllegroGraph Indices</a></li>
<li><a href="text-index.html">Full-text Indices</a></li>
<li><a href="encoded-ids.html">Encoded IDs</a></li>
<li><a href="connection-pooling.html">Connection Pooling</a></li>
<li><a href="geospatial-nd.html">N-dimensional Geospatial Overview</a></li>
<li><a href="magic-properties.html#sparql-magic-geo-2d">2-D Geospatial</a></li>
<li><a href="magic-properties.html#sparql-magic-temporal">Temporal</a></li>
<li><a href="magic-properties.html#sparql-magic-sna">Social Network</a></li>
<li><a href="javascript.html">JavaScript</a></li>
<li><a href="datatypes.html">Datatypes</a></li>
<li><a href="rapper.html">Data Conversion (Rapper)</a></li>
<li><a href="stored-procedures.html">Stored Procedures</a></li>
<li><a href="triple-attributes.html">Triple Attributes</a></li></ul></li>
<li>Querying
<ul>
<li><a href="sparql-overview.html">SPARQL documentation summary</a></li>
<li><a href="sparql-reference.html">SPARQL Reference</a></li>
<li><a href="spin.html">SPIN</a></li>
<li><a href="magic-properties.html">SPARQL Magic Properties</a></li>
<li><a href="prolog-tutorial.html">Prolog</a></li></ul></li>
<li>3rd-party tools
<ul>
<li><a href="solr-index.html">Solr text Indices</a></li>
<li><a href="mongo-interface.html">MongoDB integration</a></li>
<li><a href="TBCplugin.html">TopBraid Composer Plugin</a></li>
<li><a href="agraph-introduction.html#othertools">Cloudera</a></li></ul></li>
<li>Client APIs
<ul>
<li><a href="http://franz.com/agraph/gruff/" title="Gruff" target="_blank">Gruff</a></li>
<li><a href="http-protocol.html">REST/HTTP interface</a></li>
<li><a href="http-reference.html">HTTP reference</a></li>
<li><a href="javadoc/index.html">Javadocs (Sesame and Jena)</a></li>
<li><a href="python/index.html">Python API</a></li>
<li><a href="lisp-reference.html">Lisp Reference</a></li>
<li><a href="javascript.html">JavaScript</a></li></ul></li>
<li>Tutorials
<ul>
<li><a href="geospatial-nd-tutorial.html">N-dimensional Geospatial</a></li>
<li><a href="sparql-tutorial.html">SPARQL Tutorial</a></li>
<li><a href="java-tutorial/java-tutorial.html">Java Sesame</a></li>
<li><a href="java-tutorial/jena-tutorial.html">Java Jena</a></li>
<li><a href="python/tutorial.html">Python Sesame</a></li>
<li><a href="lisp-quickstart.html">Lisp</a></li>
<li><a href="prolog-tutorial.html">Prolog</a></li>
<li><a href="tutorial-index.html">More...</a></li></ul></li>
<li>Other
<ul>
<li><a href="suggested-reading.html">Suggested Reading</a></li>
<li><a href="http://franz.com/ps/services/conferences_seminars/" title="Conferences and Seminars" target="_blank">Conferences and Seminars</a></li>
<li><a href="http://github.com/franzinc">Source Code on Github</a></li>
<li><a href="http://agraph.franz.com/cresources/index.lhtml" target="_blank">Community Resources</a></li>
<li><a href="http://franz.com/agraph/ec2/">Amazon EC2</a></li>
<li><a href="copyrights.html">Copyrights</a></li>
<li><a href="change-history.html" id="change-history-tab">Change History</a></li></ul></li>
<li><a href="http://franz.com/" target="_blank">Franz, Inc.</a> </li> </ul> </li></ul><p><script> $(function() { $( "#agmenu" ).menu(); }); </script> </p></div>   
<div class='table-of-contents' id='table-of-contents'>

<ul>
<li><a href='#ref-triple-store-structure' title='Conceptual Triple-Store Structure'>Conceptual Triple-Store Structure</a></li>
<li><a href='#header2-13' title='General Information about Symbols Naming Lisp Functionality'>General Information about Symbols Naming Lisp Functionality</a></li>
<li><a href='#header2-25' title='Basic Triple-Store Operations'>Basic Triple-Store Operations</a>
<ul>
<li><a href='#header3-26' title='Managing a triple-store'>Managing a triple-store</a></li>
<li><a href='#adding-triples' title='Adding Triples'>Adding Triples</a>
<ul>
<li><a href='#header4-31' title='Adding Programmatically'>Adding Programmatically</a></li></ul></li>
<li><a href='#header3-38' title='Triple Manipulation'>Triple Manipulation</a></li>
<li><a href='#triple-attributes-ref' title='Triple Attributes'>Triple Attributes</a></li>
<li><a href='#ref-querying-triples' title='Querying Triples'>Querying Triples</a></li>
<li><a href='#header3-46' title='Modifying triples'>Modifying triples</a></li>
<li><a href='#ref-deleting-triples' title='Deleting and purging triples'>Deleting and purging triples</a></li>
<li><a href='#header3-58' title='Serializing Triples'>Serializing Triples</a></li>
<li><a href='#ref-indexing' title='Indexing Triples'>Indexing Triples</a></li></ul></li>
<li><a href='#header2-63' title='Advanced Triple-Store Operations'>Advanced Triple-Store Operations</a>
<ul>
<li><a href='#ref-bang-reader' title='The !-reader macro and future-parts'>The !-reader macro and future-parts</a></li>
<li><a href='#ref-freetext-indexing' title='Freetext Indexing'>Freetext Indexing</a></li>
<li><a href='#ref-type-mapping' title='Data-type and Predicate Mapping'>Data-type and Predicate Mapping</a></li>
<li><a href='#ref-federation' title='Federation'>Federation</a></li>
<li><a href='#ref-simple-reification' title='Simple Reification'>Simple Reification</a></li>
<li><a href='#ref-query-env' title='Query environments'>Query environments</a></li>
<li><a href='#ref-sparql' title='SPARQL Query Language'>SPARQL Query Language</a></li>
<li><a href='#ref-prolog' title='Prolog Select'>Prolog Select</a></li>
<li><a href='#ref-query-planner' title='Select Query Planner'>Select Query Planner</a></li>
<li><a href='#ref-rdfs-reasoning' title='RDFS++ Reasoning'>RDFS++ Reasoning</a></li></ul></li>
<li><a href='#header2-95' title='Specialized Datatypes'>Specialized Datatypes</a>
<ul>
<li><a href='#sna' title='Social Network Analysis'>Social Network Analysis</a></li>
<li><a href='#lisp-nd-geospatial-reference' title='nD Geospatial Primitives'>nD Geospatial Primitives</a></li>
<li><a href='#lisp-temporal-reference' title='Temporal Primitives'>Temporal Primitives</a></li>
<li><a href='#lisp-2d-geospatial-reference' title='2D Geospatial Primitives'>2D Geospatial Primitives</a></li></ul></li>
<li><a href='#header2-110' title='REPL Interface'>REPL Interface</a></li>
<li><a href='#header2-112' title='Miscellaneous Utilities'>Miscellaneous Utilities</a></li>
<li><a href='#header2-114' title='Logging'>Logging</a></li>
<li><a href='#header2-116' title='Indices'>Indices</a>
<ul>
<li><a href='#header3-118' title='Function and Macro index'>Function and Macro index</a></li>
<li><a href='#header3-120' title='Functor index'>Functor index</a></li>
<li><a href='#header3-122' title='Variable index'>Variable index</a></li></ul></li></ul>
<div id='tocLink'><a href='index.html'>Documentation Index</a></div>
</div>
  <div id="main-content"> <p>This is the reference guide for AllegroGraph 6.4.2. See the <a href="server-installation.html">server installation</a> and Lisp <a href="lisp-quickstart.html">Quick Start</a> for an overview. An introduction to AllegroGraph covering all of its many features at a high-level is in the <a href="agraph-introduction.html" id="agraph-introduction-tab">AllegroGraph Introduction</a>. </p><p>Note that Allegro CL has case-sensitive executables (such as <em>mlisp</em>) and case-insensitive executables (such as <em>alisp</em>). The case-insensitive executables are not compatible with AllegroGraph and must not be used. </p><a name='ref-triple-store-structure' id='ref-triple-store-structure'></a> <h2>Conceptual Triple-Store Structure</h2> <p>AllegroGraph is a graph database that makes an excellent RDF triple-store. This is a conceptual diagram of the data AllegroGraph manages: </p><p><img src="logical-structure.png" alt="AllegroGraph's logical structure"></img> </p>
<ul>
<li>The bulk of an AllegroGraph triple-store is composed of    <strong>assertions</strong> called <strong>triples</strong>. For    historical reasons, each triple has five fields: 
<ul>
<li>subject (s)</li>
<li>predicate (p)</li>
<li>object (o)</li>
<li>graph (g)</li>
<li>triple-id (i)</li></ul></li><p>Each assertion can be viewed as an edge <code>p</code> between graph nodes <code>s</code> and <code>o</code> with additional data <code>g</code> <strong>or</strong> as the statement "subject predicate object (in the context of graph)". </p>
<li><p>All of s, p, o, and g are strings of arbitrary size.    String data is associated with Unique Part    Identifiers (UPIs) and managed by the <strong>string    dictionary</strong>. </p></li>
<li><p>To speed queries, AllegroGraph creates <strong>indices</strong> which    contain the assertions plus additional information    (see <a href="#ref-indexing" title="">below</a> for more details). </p></li>
<li><p>AllegroGraph can also perform freetext searching in the    assertions using its <strong>freetext indices</strong> (see the    section on <a href="#ref-freetext-indexing" title="">freetext indexing</a> for    details). </p></li>
<li><p>and Finally, AllegroGraph keeps track of <strong>deleted    triples</strong> </p></li></ul><p>Triple-data generally comes into AllegroGraph as strings either from pure RDF/XML or as the more verbose but simpler N-Triple format. Once the triples are in AllegroGraph, it is possible to manipulate them, perform logical inference, and execute extremely fast queries. </p><a name='define-intern' id='define-intern'></a> <p>The string dictionary manages efficient storage and fast lookup of the strings in the triple-store. We call the process of hashing a string into its UPI and storing it in the string dictionary <em>interning</em>. </p> <a name='header2-13' id='header2-13'></a><h2>General Information about Symbols Naming Lisp Functionality</h2><p>Unless otherwise noted, symbols defined in this document are exported from the <strong>db.agraph</strong> package (nicknamed <strong>triple-store</strong>). The <strong>db.agraph.user</strong> package (nicknamed <strong>triple-store-user</strong>) is intended to be a convenient package in which to write simple AllegroGraph code. The <strong>db.agraph.user</strong> package uses the following packages: </p>
<ul>
<li><strong>db.agraph</strong></li>
<li><strong>sparql</strong></li>
<li><strong>prolog</strong></li>
<li><strong>excl</strong></li>
<li><strong>common-lisp</strong></li></ul><p>When an application creates its own packages, it is recommended that they use the same packages as <strong>db.agraph.user</strong> (unless there is some specific name conflict to be avoided). Such application packages could thus be defined with a <strong>defpackage</strong> form like: </p>
<pre><code>(defpackage :my-agraph-package (:use :db.agraph :sparql :prolog :cl :excl)  
            [other options]) </code></pre><p>or these forms could be evaluated after the package is created: </p>
<pre><code>(use-package :db.agraph (find-package :my-agraph-package))  
(use-package :sparql (find-package :my-agraph-package))  
(use-package :prolog (find-package :my-agraph-package))  
(use-package :cl (find-package :my-agraph-package))  
(use-package :excl(find-package :my-agraph-package)) </code></pre><p>Again, if one or more of the packages used by <strong>db.agraph.user</strong> should be excluded because of actual or potential name conflicts, they should not be used and symbols in them will need to be package qualified in application code.  All this is analogous to the <strong>common-lisp</strong> and <strong>common-lisp-user</strong> packages. Symbols in this document are not, in general, package-qualified. </p><a name='header2-25' id='header2-25'></a><h2>Basic Triple-Store Operations</h2><a name='header3-26' id='header3-26'></a><h3>Managing a triple-store</h3> <p>These functions are used to create, delete, and examine triple-stores. For convenience, many operations act by default on the current triple-store which is kept in a special variable named *db*. The <a href="#with-triple-store" title="description of with-triple-store">with-triple-store</a> macro makes it easy to call other code with a particular store marked <em>current</em>.
<a name="fnr0-2018-06-08" id="fnr0-2018-06-08"></a>
<sup><a href="#fn0-2018-06-08">1</a></sup>  </p><p>Operations on a triple-store take place within a transaction. A transaction is started when a triple store is created or opened. A transaction is finished and a new transaction started with <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> or <a href="#rollback-triple-store" title="description of rollback-triple-store">rollback-triple-store</a>. </p>
<a name="variable.:2Adb:2A" id="variable.:2Adb:2A"></a>
<a name="x:2Adb:2A" id="x:2Adb:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*db*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents"><p>The default triple-store instance. API functions that take a <code>db</code> keyword argument will use this value by default. </p><p><strong>Note</strong> that the <code>*db*</code> value should not be shared among multiple processes because add, rollback and commit events from independent processes will be executed on the same connection with unexpected results. Since <code>*db*</code> is the default value for many functions that have a <code>:db</code> keyword, this problem can easily arise in a multi-process application. To avoid it, each process should make its own connection to the database by using <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a>.  As of v6.4.0, <code>*db*</code> will be bound to nil in each new thread to help avoid accidental sharing. </p>
</div>
</div>
  
<a name="variable.:2Adefault-ag-http-port:2A" id="variable.:2Adefault-ag-http-port:2A"></a>
<a name="x:2Adefault-ag-http-port:2A" id="x:2Adefault-ag-http-port:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*default-ag-http-port*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents"><p>The default port to use when attaching to an AllegroGraph server. </p><p>This is the port where the AllegroGraph server listens for connections from clients. It is used to start a session by triple-store functions like <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a>, <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a>, and so on. The server's port can be set explicitly in the configuration file or found by looking at the file the server creates when it starts. The location of this file is specified using the PortFile directive. For more details see the <a href="daemon-config.html">server configuration</a> guide. </p>
</div>
</div>
  
<a name="function.catalogs" id="function.catalogs"></a>
<a name="catalogs" id="catalogs"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">catalogs</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">port</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>List the catalogs on the local AllegroGraph server running on <code>port</code>. </p><p>This function is deprecated, please refer to <code>catalog-names</code> instead. </p>
</div>
</div>
  
<a name="function.triple-store-names" id="function.triple-store-names"></a>
<a name="triple-store-names" id="triple-store-names"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-store-names</span>
<span class="documentation-arguments"><span class="argument">catalog</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">triple-store-class</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a list of strings, naming triple-stores in a given catalog. </p><p>As in <code>catalog-names</code>, you can use the <code>triple-store-class</code> argument to specify the kind of store that should be listed. Like <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a> and <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a>, <code>triple-store-names</code> takes additional keyword arguments that vary depending on this class name. For example, querying catalogs containing <a href="#remote-triple-store" title="description of remote-triple-store">remote-triple-store</a>s may require specifying a username and password. See <code>open-triple-store</code> or <code>create-triple-store</code> for additional details. </p>
</div>
</div>
  
<a name="function.close-triple-store" id="function.close-triple-store"></a>
<a name="close-triple-store" id="close-triple-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">close-triple-store</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">if-closed</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">ensure-not-lingering</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Close the triple-store <code>db</code>. Returns <code>nil</code>. </p>
<ul>
<li><p><code>:db</code> - the triple-store to close (defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>). If the triple store being closed is <code>eq</code> to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>, then <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a> is set to <code>nil</code>. </p></li>
<li><p><code>:if-closed</code> - controls the behavior when the <code>db</code> provided is closed, or (without <code>:db</code> argument) when <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a> is <code>nil</code>: If <code>if-closed</code> is <code>:error</code> then an error will be signaled in this situation. If it is <code>:ignore</code> (the default) then <code>close-triple-store</code> will return without signaling an error. </p></li>
<li><p>If <code>:commit</code> is true, and the store is open, then <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> will be called before the store is closed. This defaults to <code>nil</code> </p></li>
<li>If <code>:ensure-not-lingering</code> is true, then <a href="#ensure-not-lingering" title="description of ensure-not-lingering">ensure-not-lingering</a> will be called after the store is closed. </li></ul>
</div>
</div>
  
<a name="function.ensure-not-lingering" id="function.ensure-not-lingering"></a>
<a name="ensure-not-lingering" id="ensure-not-lingering"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">ensure-not-lingering</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">triple-store-class</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>To conserve resources, makes the database instance and its child processes exit if the instance is unused (nobody has the corresponding triple store open). This function returns nothing. </p><p>Normally unused database instances linger for InstanceTimeout seconds to speed up subsequent open operations. </p><p>You can use the <code>triple-store-class</code> argument to specify the kind of store you are trying to check. Like <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a> and <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a>, <code>ensure-not-lingering</code> takes additional keyword arguments that vary depending on this class. For example, checking a <a href="#remote-triple-store" title="description of remote-triple-store">remote-triple-store</a> may require specifying a username and password. See <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a> or <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a> for additional details. Also, see the <code>ensure-not-lingering</code> keyword argument to <a href="#close-triple-store" title="description of close-triple-store">close-triple-store</a>. </p>
</div>
</div>
  
<a name="function.commit-triple-store" id="function.commit-triple-store"></a>
<a name="commit-triple-store" id="commit-triple-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">commit-triple-store</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">durability</span> &nbsp;<span class="argument">distributed-transaction-timeout</span> &nbsp;<span class="argument">transaction-latency-count</span> &nbsp;<span class="argument">transaction-latency-timeout</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">This function ensures that all persistent data needed by the triple store is written to disk. commit-triple-store ends the current transaction and begins a new one. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. 
</div>
</div>
  
<a name="function.copy-triples" id="function.copy-triples"></a>
<a name="copy-triples" id="copy-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">copy-triples</span>
<span class="documentation-arguments"><span class="argument">target-db</span> &nbsp;<span class="argument">source</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">source-db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Copy triples from <code>source</code> to <code>target-db</code>. </p><p><code>copy-triples</code> adds each triple in <code>source</code> to the <code>target-db</code> and ensures that any strings in these triples are also interned in the <code>target-db</code>. </p><p><code>source</code> can be a triple-store, a cursor that yields triples, a list or array of triples, or a single triple.  If the <code>source-db</code> can be determined from <code>source</code> (e.g., if <code>source</code> is a triple-store or cursor), then <code>source-db</code> is ignored. Otherwise, the triples are assumed to exist in <code>source-db</code>, which defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p><code>target-db</code> should be an open and writable triple-store. </p>
</div>
</div>
  
<a name="function.create-triple-store" id="function.create-triple-store"></a>
<a name="create-triple-store" id="create-triple-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">create-triple-store</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">if-exists</span> &nbsp;<span class="argument">catalog</span> &nbsp;<span class="argument">scheme</span> &nbsp;<span class="argument">server</span> &nbsp;<span class="argument">port</span> &nbsp;<span class="argument">user</span> &nbsp;<span class="argument">password</span> &nbsp;<span class="argument">triple-store-class</span> &nbsp;<span class="argument">with-indices</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>This function creates a new repository (also called a triple store) with the   given <code>name</code> and begins a new transaction. <code>name</code> must be a string. The following characters   cannot be used in <code>name</code>: </p>
<pre><code>\ / ~ : Space $ { } ( ) &lt; &gt; * + [ ] | </code></pre><p><code>create-triple-store</code> takes numerous keyword arguments (not all of which appear in the argument list, which does have an &amp;allow-other-keys). The allowed arguments vary depending on the class of triple-store being created. For example, a <a href="#remote-triple-store" title="description of remote-triple-store">remote-triple-store</a> requires <code>:server</code>, <code>:port</code>, and  <code>:user</code> and <code>:password</code> (unless anonymous access is allowed) whereas an instance of <a href="#triple-db" title="description of triple-db">triple-db</a> does not. <code>:user</code>, (See <a href="lisp-quickstart.html">Lisp Quick Start</a> for an example of creating a remote triple store and other examples creating and opening triple stores.) </p><p>The possible arguments include (but are not limited to (note some described arguments do not appear in the argument list but are allowed because additional keyword arguments are allowed): </p>
<ul>
<li><p><code>:if-exists</code> - controls what to do if the triple-store already    exists. The default value, <code>:supersede</code>, will cause    <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a> to attempt to delete the old triple store and create a    new one; <code>:error</code> causes <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a> to signal an    error. If the triple-store is opened by another connection, then    :supersede will fail because the store cannot be deleted. </p></li>
<li><p><code>:catalog</code> - the catalog to use in the server's configuration    file. If left unspecified, the root catalog will be used. Users    may not create repositories in the system catalog. </p></li>
<li><p><code>:server</code> - the server for a remote-triple-store. The default is    "127.0.0.1" (which is the local machine). </p></li>
<li><p><code>:port</code> - the port to use to access the AllegroGraph server. The default is    the value of <em>default-ag-http-port</em> </p></li>
<li><p><code>:user</code> - the username to use when accessing the server (anonymous access, if supported, does not require a user value) </p></li>
<li><p><code>:password</code> - the password to use when accessing the server (anonymous access, if supported, does not require a password) </p></li>
<li><p><code>:scheme</code> - the protocol to use to access the server.  May be :http or :https.  The default is :http. </p></li>
<li><p><code>:triple-store-class</code> - the kind of triple-store to create. If left unspecified, then <a href="#triple-db" title="description of triple-db">triple-db</a> will be used. </p></li>
<li><p><code>:params</code> - If supplied, the value must be an alist of catalog configuration directives and values (both represented as strings). The catalog directives are documented in the <a href="daemon-config.html#catalog-directives">Catalog directives</a> section of the <a href="daemon-config.html">Server Configuration and Control</a> document. Any catalog directive can be specified. The catalog defaults will be used for directives that are not specified by this argument. For example, suppose you want the new repository to have a string table size of 128 MB and use <code>lzo</code> string compression (rather than the default no compression), then you would specify the following value </p>
<pre><code>(create-triple-store ...  
  :params '(("StringTableSize" . "128m")  
            ("StringTableCompression"  . "lzo"))) </code></pre></li>
<li><p><code>:with-indices</code> - a list of index flavors that this store will use. If left unspecified, the store will use the standard indices of :gospi, :gposi, :gspoi, :ospgi, :posgi, :spogi, and :i. </p></li>
<li><p><code>:https-verification</code> - the value should be a list of keywords and value pairs, as follows: <strong>:method</strong> allows control over the SSL protocol handshake process; can be: :sslv23 (the default), :sslv2, :sslv3, :sslv3+, :tlsv1; <strong>:certificate</strong> names a file which contains one or more PEM-encoded certificates. <strong>:key</strong> should be a string or pathname naming a file containing the private RSA key corresponding the the public key in the certificate. The file must be in PEM format. <strong>:certificate-password</strong>, if specified, should be a string. <strong>:verify</strong>: nil means that no automatic verification will occur, :optional means that the server's certificate (if supplied) will be automatically verified during SSL handshake, :required means that the server's certificate will be automatically verified during SSL handshake. <strong>:maxdepth</strong> must be an integer (which defaults to 10) which indicates the maximum allowable depth of the certificate verification chain; <strong>:ca-file</strong> specifies the name of a file containing a series of trusted PEM-encoded Intermediate CA or Root CA certificates that will be used during peer certificate verification; <strong>:ca-directory</strong> specifies the name of a directory containing a series of trusted Intermediate CA or Root CA certificate files that will be used during peer certificate verification; <strong>:ciphers</strong> should be a string which specifies an OpenSSL cipher list.  these values are passed as arguments to the function <strong>socket:make-ssl-client-stream</strong>. Here is an example:</p>
<pre><code>(create-triple-store "clienttest"  
	 :triple-store-class 'remote-triple-store  
	 :port 10398 :server "localhost"  
	 :scheme :https  
	 :https-verification  
	 '(;; Server must identify to the client and  
	   ;; must pass certificate  
	   ;; verification. Other sensible option is  
	   ;; :optional; :nil suppresses verification  
	   ;; altogether and should never be used.  
	   :verify :required  
 
	   ;; The CA certificate used to sign the server's  
	   ;; certificate.  
	   :ca-file "/path/to/ca.cert"  
 
	   ;; The certificate and key file to authenticate  
	   ;; this client with.  
	   :certificate "/path/to/test.cert")) </code></pre></li></ul><p>Create-triple-store returns a triple-store object and sets the value of the variable <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a> to that object. </p>
</div>
</div>
  
<a name="function.db-name" id="function.db-name"></a>
<a name="db-name" id="db-name"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">db-name</span>
<span class="documentation-arguments"><span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>The name of the triple-store <code>db</code> (read-only). </p><p>This is set when the triple-store is created or opened. </p>
</div>
</div>
  
<a name="function.default-graph-upi" id="function.default-graph-upi"></a>
<a name="default-graph-upi" id="default-graph-upi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">default-graph-upi</span>
<span class="documentation-arguments"><span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the UPI of the default-graph of <code>db</code>. This is the graph that will be assigned to any triples added to <code>db</code> unless a different graph is specified. 
</div>
</div>
  
<a name="function.delete-triple-store" id="function.delete-triple-store"></a>
<a name="delete-triple-store" id="delete-triple-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">delete-triple-store</span>
<span class="documentation-arguments"><span class="argument">db-or-name</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">if-does-not-exist</span> &nbsp;<span class="argument">triple-store-class</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Delete an existing triple store. Returns <code>t</code> if the deletion was successful and <code>nil</code> if it was not. </p><p>The <code>db-or-name</code> argument can be either a triple store instance or the name of a triple store. If it is an instance, then the triple store associated with the instance will be closed if it is open and then it will be deleted (assuming that it is not open by any other processes). If <code>db-or-name</code> is <code>eq</code> to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>, then <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a> will be set to <code>nil</code> once the triple-store is deleted. </p><p>The <code>:if-does-not-exist</code> keyword argument specifies what to do if the triple-store does not exist. The default value, <code>:error</code>, causes <a href="#delete-triple-store" title="description of delete-triple-store">delete-triple-store</a> to signal an error. The value <code>:ignore</code> will cause <a href="#delete-triple-store" title="description of delete-triple-store">delete-triple-store</a> to do nothing and return <code>nil</code>. </p><p>You can use the <code>triple-store-class</code> argument to specify the kind of store you are trying to delete. Like <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a> and <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a>, <code>delete-triple-store</code> takes additional keyword arguments that vary depending on this class. For example, deleting a <a href="#remote-triple-store" title="description of remote-triple-store">remote-triple-store</a> may require specifying a username and password. See <code>open-triple-store</code> or <code>create-triple-store</code> for additional details. </p>
</div>
</div>
  
<a name="function.make-tutorial-store" id="function.make-tutorial-store"></a>
<a name="make-tutorial-store" id="make-tutorial-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">make-tutorial-store</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">apply-reasoner-p</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Close any current triple-store and create a new empty one. </p>
<ul>
<li><code>:apply-reasoner-p</code> - If true (the default), then the new triple-store will use RDFS++ reasoning. If nil, then the triple-store will have no reasoning enabled. </li></ul><p>The new triple-store will be bound to <code>*db*</code> and is also returned by <code>make-tutorial-store</code>. </p>
</div>
</div>
  
<a name="function.open-triple-store" id="function.open-triple-store"></a>
<a name="open-triple-store" id="open-triple-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">open-triple-store</span>
<span class="documentation-arguments"><span class="argument">designator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">read-only</span> &nbsp;<span class="argument">catalog</span> &nbsp;<span class="argument">server</span> &nbsp;<span class="argument">port</span> &nbsp;<span class="argument">user</span> &nbsp;<span class="argument">password</span> &nbsp;<span class="argument">triple-store-class</span> &nbsp;<span class="marker">&amp;allow-other-keys</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>This function opens an existing triple store with the given <code>designator</code> and begins a new transaction. </p><p>The <code>designator</code> can be a string naming a store, a string naming a catalog and store (separated by colon or slash), an existing triple-store instance, or a triple-store specification. For example: </p>
<pre><code>;; open the store named 'example-store' in the root catalog  
(open-triple-store "example-store")  
 
;; open the store named 'data' in the catalog 'test'  
(open-triple-store "test:data")  
 
;; open the store named 'data' in the catalog 'test'  
(open-triple-store "test/data")  
 
;; the above two forms are is equivalent to using the  
;; :catalog keyword argument:  
(open-triple-store "data" :catalog "test")  
 
;; create a federation of the triple stores named 'a' and 'b'  
(open-triple-store "&lt;a&gt;+&lt;b&gt;") </code></pre><p><code>open-triple-store</code> takes numerous keyword arguments. The allowed arguments vary depending on the class of triple-store being opened. For example, a <a href="#remote-triple-store" title="description of remote-triple-store">remote-triple-store</a> requires a <code>:server</code>, <code>:user</code> and <code>:password</code> (unless anonymous access is allowed) whereas a local <a href="#triple-db" title="description of triple-db">triple-db</a> does not. </p><p>For remote-triple-stores, <code>:user</code>, <code>:password</code>, <code>:port</code>, and <code>:server</code> can be specified with the individual arguments. </p><p>The possible arguments include (but are not limited to): </p>
<ul>
<li><p><code>:catalog</code> - the catalog to use in the server's configuration    file. The catalog may also be specified as part of the required    <code>designator</code> argument, with the catalog name and store name separated    by a slash or a colon. If the catalog is not specified as part of the    <code>designator</code> and this argument is left unspecified, the root catalog    will be used. </p></li>
<li><p><code>:server</code> - the server for a remote-triple-store. The default is    "127.0.0.1" (which is the local machine). </p></li>
<li><p><code>:port</code> - the port to use to find the AllegroGraph server.  The    default is the value of <em>default-ag-http-port</em>. </p></li>
<li><p><code>:user</code> - the username to use when accessing the server (anonymous access, if supported, does not require a user value) </p></li>
<li><p><code>:password</code> - the password to use when accessing the server (anonymous access, if supported, does not require a password) </p></li>
<li><p><code>:scheme</code> - the protocol to use to access the server.  May be :http or :https.  The default is :http. </p></li>
<li><p><code>:triple-store-class</code> - the kind of triple-store to open. If left unspecified, then <code>designator</code> will be treated as a triple-store specification and the triple store class will be determined based on the specification. </p></li>
<li><p><code>:read-only</code> - if true, then the triple-store will be opened    read-only. </p></li>
<li><p><code>:https-verification</code> - See the description of this argument in the    documentation for <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a>. </p></li></ul><p>Returns a triple store object and sets the value of the variable <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a> to that object. If the named triple store is already open, <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a> returns a new object connected to the same store. </p><p>See <a href="lisp-quickstart.html">Lisp Quick Start</a> for an example of creating and opening triple stores. </p>
</div>
</div>
  
<a name="function.rollback-triple-store" id="function.rollback-triple-store"></a>
<a name="rollback-triple-store" id="rollback-triple-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">rollback-triple-store</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>This function undoes any local changes to <code>db</code> and synchronizes with the most up-to-date server version. rollback-triple-store ends the current transaction and begins a new one. </p>
<ul>
<li><code>:db</code> - the triple-store to rollback; defaults to the current value of <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </li></ul>
</div>
</div>
  
<a name="function.triple-count" id="function.triple-count"></a>
<a name="triple-count" id="triple-count"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-count</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the number of triples in a triple store. The <code>:db</code> keyword argument specifies the triple store to use, either by name or a triple store object. It defaults to the value of <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p>Note that reasoning triple-stores do not report accurate triple-counts (doing so might take an inordinate amount of time!). The count returned will be a count of the triples in the ground store. </p>
</div>
</div>
  
<a name="function.triple-store-exists-p" id="function.triple-store-exists-p"></a>
<a name="triple-store-exists-p" id="triple-store-exists-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-store-exists-p</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">triple-store-class</span> &nbsp;<span class="argument">catalog</span> &nbsp;<span class="argument">server</span> &nbsp;<span class="argument">port</span> &nbsp;<span class="argument">scheme</span> &nbsp;<span class="argument">user</span> &nbsp;<span class="argument">password</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns true if the triple-store with the given <code>name</code> exists. </p><p>You can use the <code>triple-store-class</code> argument to specify the kind of store you are trying to check. Like <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a> and <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a>, <code>triple-store-exists-p</code> takes additional keyword arguments that vary depending on this class. For example, checking a <a href="#remote-triple-store" title="description of remote-triple-store">remote-triple-store</a> may require specifying a username and password. See <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a> or <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a> for additional details. </p>
</div>
</div>
  
<a name="function.triple-store-id" id="function.triple-store-id"></a>
<a name="triple-store-id" id="triple-store-id"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-store-id</span>
<span class="documentation-arguments"><span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">This returns the ID of the triple-store. The ID is generated randomly when the triple-store is created. It is an array of four octets. 
</div>
</div>
  
<a name="macro.with-triple-store" id="macro.with-triple-store"></a>
<a name="with-triple-store" id="with-triple-store"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">with-triple-store</span>
<span class="documentation-arguments">(<span class="argument">var</span> &nbsp;<span class="argument">store</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">state</span> &nbsp;<span class="argument">read-only-p</span> &nbsp;<span class="argument">errorp</span> &nbsp;<span class="argument">verifyp</span>) &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Binds both var and *db* to the triple-store designated by   store. The following keyword arguments can also be used: </p>
<ul>
<li><p>errorp - controls whether or not <code>with-triple-store</code> signals an    error if the specified store cannot be found. </p></li>
<li><p>read-only-p - if specified then with-triple-store will signal an    error if the specified triple-store is writable and read-only-p is    nil or if the store is read-only and read-only-p is t. </p></li>
<li>state - can be :open, :closed or nil. If :open or :closed, an error    will be signaled unless the triple-store is in the same state. </li></ul>
</div>
</div>
  
<a name="function.warmup-triple-store" id="function.warmup-triple-store"></a>
<a name="warmup-triple-store" id="warmup-triple-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">warmup-triple-store</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">include-strings</span> &nbsp;<span class="argument">include-triples</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Prepare a store so that subsequent operations will be faster.	 </p><p>For example, bring as much of a disk-based store as possible into RAM. </p>
</div>
</div>
  
<a name="macro.with-open-triple-store" id="macro.with-open-triple-store"></a>
<a name="with-open-triple-store" id="with-open-triple-store"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">with-open-triple-store</span>
<span class="documentation-arguments">(<span class="argument">var</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">store-arguments</span>) &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Evaluate <code>body</code> with <code>var</code> bound to the results of calling open-triple-store on <code>store-arguments</code>. <code>*db*</code> is also bound to the newly opened store. The store will be closed after body executes.  <code>store-arguments</code> can be an expression or a list of arguments that will be passed to <code>open-triple-store</code>. Example uses include: </p>
<pre><code>(with-open-triple-store (xyz (ground-triple-store *db*))  
  ...) </code></pre><p>and </p>
<pre><code>(with-open-triple-store (abc "test" :triple-store-class 'remote-triple-store)  
   ...) </code></pre>
</div>
</div>
 
  <a name='adding-triples' id='adding-triples'></a> <h3>Adding Triples</h3> <p>You can import data into your triple-store using the client API (such as the Lisp functions below) or the command-line program <a href="agload.html"><strong>agload</strong></a>. </p><p>Triples stored in files using the N-Triples
<a name="fnr1-2018-06-08" id="fnr1-2018-06-08"></a>
<sup><a href="#fn1-2018-06-08">2</a></sup> , RDF/XML
<a name="fnr2-2018-06-08" id="fnr2-2018-06-08"></a>
<sup><a href="#fn2-2018-06-08">3</a></sup> , and other formats can be loaded into the triple-store with the following functions. </p><h3>Checking that UPIs are in the string table</h3><p>AllegroGraph ensures that the UPIs in a triple being added are already interned in the triple-store's string table. Unless the UPI is in the string table, associated triples can not be serialized. This check does somewhat slow down adding triples. You can suppress the check by wrapping the code adding the triples in the following macro: </p>
<a name="macro.while-not-validating-that-upis-are-in-string-table" id="macro.while-not-validating-that-upis-are-in-string-table"></a>
<a name="while-not-validating-that-upis-are-in-string-table" id="while-not-validating-that-upis-are-in-string-table"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">while-not-validating-that-upis-are-in-string-table</span>
<span class="documentation-arguments">(<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span>) &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Execute <code>body</code> without validating that hashed UPIs are present in the string table. </p><p>This effects only <code>db</code> which defaults to <code>*db*</code>. </p><p>For example, this code will signal an error: </p>
<pre><code>(add-triple !rdf:x !rdf:y (let ((*db* nil)) (upi !rdf:notHere))) </code></pre><p>because !rdf:notHere is not in the string-table. This code, however, will add the triple regardless: </p>
<pre><code>(while-not-validating-that-upis-are-in-string-table ()  
  (add-triple !rdf:x !rdf:y (let ((*db* nil)) (upi !rdf:notHere)))) </code></pre><p>Note that adds wrapped in this macro are slightly faster but more dangerous since it may be impossible to re-serialize the data if it contains hashed UPIs that are not interned in the string table. </p>
</div>
</div>
  <h3>Bulk loading and commit-triple-store</h3><p>All of AllegroGraph bulk load functions take a <code>:commit</code> parameter that controls when the data being loaded is actually committed. This parameter can be: </p>
<ul>
<li><code>nil</code> - never commit,</li>
<li><code>t</code> - commit once all of the data has been imported,</li>
<li>a whole number - commit whenever more than this number of triples have been added. If <code>commit</code> is a number, then <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> will also be called at the end of the load. </li></ul><p>Note also that if you are loading many small files, you will find that it is more efficient to use the method specialized on <code>lists</code> and not iterate through the the list of files yourself: </p>
<pre><code>;; pathnames is a list of files  
;; let load-ntriples do the work of iterating over them  
(load-ntriples pathnames)  
 
;; Much slower!!  
;; probably _NOT_ what you want to do  
(dolist (pathname pathnames)  
  (load-ntriples pathname)) </code></pre><h3>The Bulk Loading Functions</h3><p>The following subsections list functions which load data from files or from strings. </p><h4>Loading Triples</h4>
<a name="function.load-ntriples" id="function.load-ntriples"></a>
<a name="load-ntriples" id="load-ntriples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-ntriples</span>
<span class="documentation-arguments"><span class="argument">source</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">preserve-strings</span> &nbsp;<span class="argument">external-format</span> &nbsp;<span class="argument">relax-syntax</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">continue-on-errorp</span> &nbsp;<span class="argument">default-attributes</span> &nbsp;(<span class="argument">line-number</span> 1) &nbsp;<span class="marker">&amp;allow-other-keys</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add triples from <code>source</code> (in <a href="http://www.w3.org/TR/n-triples/" class="external" target="_blank">N-Triples format</a>) to the triple store. </p><p>Returns (as multiple values) the count of triples loaded and the UPI of the graph into which the triples were loaded. </p>
<ul>
<li><code>source</code> - can be a stream, a pathname to an N-Triples file, a file URI, an HTTP URI or a string that can be coerced into a pathname. <code>source</code> can also be a list of any of these things. In this case, each item in the list will be imported in turn. When adding statements to a remote-triple-store, a URI source argument will be fetched directly by the server. All other source types are retrieved and delivered to the server via the client interface. <p>In the case where a list of sources is being loaded and the <code>graph</code> argument is <code>:source</code>, each source in the list will be associated with the URI specifying that source, and that will be used as the graph of the triples loaded from that source. In this case, the second return value will be <code>nil</code>. </p></li>
<li><p><code>:db</code> - specifies the triple-store into which triples will be loaded. This defaults to the value of *db*.</p></li>
<li><p><code>:graph</code> - the graph into which the triples from <code>source</code> will be placed. It defaults to <code>nil</code> which is interpreted as <code>db</code>'s default graph. If supplied, it can be: </p>
<ul>
<li><p>a string representing a URIref, or a UPI or future-part   encoding a URIref, which adds the triples in <code>source</code> to a graph   named by that URI </p></li>
<li><p>the keyword <code>:source</code>, in which case the <code>source</code> argument will be added as a URI and the loaded triples added to a graph named by that URI. This has the effect of associating the file or URL of <code>source</code> with the new triples. </p></li></ul></li></ul><p>The following keyword parameters can be used to control the loading process: </p>
<ul>
<li><p><code>:verbose</code> - specifies whether or not progress information is printed as triples are loaded. It defaults to <code>nil</code>. </p>
<li><p><code>:preserve-strings</code> - determine whether or not to save the strings of a triple's object field when the object can be encoded directly into the triple. If true (the default) then the strings will be saved. If false, then only the encoded values will be preserved (this may prevent exact round-trips if data is coerced during the encoding process). </p></li>
<li><p><code>:commit</code> - controls whether and how often <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> is called while loading. This can be <code>nil</code> for no commit, <code>t</code> for commit at the end of the load or a whole number to commit whenever more than that number of triples have been added and again at the end of the load. Default is nil. </p></li>
<li><p><code>:relax-syntax</code> - For N-Triples and N-Quad files, this flag tells AllegroGraph to ignore certain syntax. In particular: </p>
<ul>
<li>Blank node names may use underscore (_) and dash (-) characters.</li>
<li>Literals may be used in the Graph position (for N-Quads).</li>
<li>URIs are not required to include a colon (:).</li></ul></li></li><p>This is a non-standard parser extension and should only be used when necessary. </p>
<li><code>:default-attributes</code> - specifies the attributes that will be associated with every triple being loaded. (Because in this file format attributes cannot be specified for individual triples, all triples loaded will have these attributes.) See the <a href="triple-attributes.html">Triple Attributes</a> document for more information on attributes. </li>
<li><code>:continue-on-error-p</code> - determine how the parser should behave if it encounters an error parsing or adding a triple. It can be one of: 
<ul>
<li><p><code>nil</code> - meaning to raise the error normally,</p></li>
<li><p><code>t</code> - meaning to ignore the error and continue parsing with   the next line in the source, </p></li>
<li><p>a function of four arguments: a parsing helper data structure,   the line in the source where the problem was encountered, the   condition that caused the error and the arguments (if any) to   that condition. </p></li></ul></li></ul><p>You can use <code>continue-on-error-p</code> to print all of the problem lines in a file using something like </p>
<pre><code>    (load-ntriples  
     "source"  
     :continue-on-errorp  
     (lambda (helper source-line condition &amp;rest args)  
       (declare (ignore helper args))  
       (format t "~&amp;Error at line ~:6d - ~a" source-line condition)))  
 
</code></pre>
</div>
</div>
 
 
<a name="function.load-ntriples-from-string" id="function.load-ntriples-from-string"></a>
<a name="load-ntriples-from-string" id="load-ntriples-from-string"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-ntriples-from-string</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">preserve-strings</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">relax-syntax</span> &nbsp;<span class="argument">continue-on-errorp</span> &nbsp;<span class="argument">default-attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add the triples in <code>string</code> (in <a href="http://www.w3.org/TR/n-triples/" class="external" target="_blank">N-Triples format</a>) to the triple store. </p><p>See <a href="#load-ntriples" title="description of load-ntriples">load-ntriples</a> for details on the parameters. </p>
</div>
</div>
  
<a name="function.load-turtle" id="function.load-turtle"></a>
<a name="load-turtle" id="load-turtle"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-turtle</span>
<span class="documentation-arguments"><span class="argument">source</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">base-uri</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">default-attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add triples from the named <a href="http://www.w3.org/TeamSubmission/turtle/">Turtle</a> <code>source</code> to the triple-store. The additional arguments are: </p>
<ul>
<li><p><code>:db</code> - specifies the triple-store into which triples will be loaded; defaults to the value of <em>db</em>. </p></li>
<li><p><code>:base-uri</code> - this defaults to the name of the file from which the triples are loaded. It is used to resolve relative URI references during parsing. To use no base-uri, use the empty string "". </p></li>
<li><p><code>:graph</code> - the graph to which the triples from <code>source</code> will be placed. It defaults to <code>nil</code> which is interpreted as <code>db</code>'s default graph. If supplied, it can be: </p>
<ul>
<li><p>a string representing a URIref, or a UPI or future-part   encoding a URIref, which adds the triples in <code>source</code> to a graph   named by that URI </p></li>
<li><p>the keyword <code>:source</code>, in which case the <code>source</code> argument will be added as a URI and the loaded triples added to a graph named by that URI. This has the effect of associating the file or URL of <code>source</code> with the new triples. </p></li></ul></li>
<li><code>:default-attributes</code> - specifies the attributes that will be associated with   every triple being loaded. (Because in this file format attributes cannot be specified for individual triples, all triples loaded will have these attributes.) See the <a href="triple-attributes.html">Triple Attributes</a> document for more information on attributes. </li></ul>
</div>
</div>
  
<a name="function.load-turtle-from-string" id="function.load-turtle-from-string"></a>
<a name="load-turtle-from-string" id="load-turtle-from-string"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-turtle-from-string</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">base-uri</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">default-attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Treat <code>string</code> as a   <a href="http://www.w3.org/TeamSubmission/turtle/">Turtle</a> data source and   add it to the triple-store. </p><p>See <a href="#load-turtle" title="description of load-turtle">load-turtle</a> for details. </p>
</div>
</div>
  
<a name="function.load-rdf-manifest" id="function.load-rdf-manifest"></a>
<a name="load-rdf-manifest" id="load-rdf-manifest"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-rdf-manifest</span>
<span class="documentation-arguments"><span class="argument">manifest</span> &nbsp;<span class="argument">destination-db</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">verbosep</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Load the file named by manifest, loading the triples from the graphs it    references. 
</div>
</div>
  
<a name="function.load-rdf:2Fxml" id="function.load-rdf:2Fxml"></a>
<a name="load-rdf:2Fxml" id="load-rdf:2Fxml"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-rdf/xml</span>
<span class="documentation-arguments"><span class="argument">source</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">base-uri</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="marker">&amp;allow-other-keys</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add triples from an RDF/XML file to a triple-store. The arguments are (some do not appear in the argument list but are accepted because <code>&amp;allow-other-keys</code> is specified): </p>
<ul>
<li><p><code>source</code>: a string or pathname identifying an RDF/XML file, or a stream.</p></li>
<li><p><code>:db</code> - specifies the triple-store into which triples will be loaded; defaults to the value of *db*. </p></li>
<li><p><code>:base-uri</code> - this defaults to the name of the file from which the triples are loaded. It is used to resolve relative URI references during parsing. To use no base-uri, use the empty string "". </p></li>
<li><p><code>:graph</code> - the graph to which the triples from <code>source</code> will be placed. It defaults to <code>nil</code> which is interpreted as <code>db</code>'s default graph. If supplied, it can be: </p>
<ul>
<li><p>a string representing a URIref, or a UPI or future-part   encoding a URIref, which adds the triples in <code>source</code> to a graph   named by that URI </p></li>
<li><p>the keyword <code>:source</code>, in which case the <code>source</code> argument will be added as a URI and the loaded triples added to a graph named by that URI. This has the effect of associating the file or URL of <code>source</code> with the new triples. </p></li></ul></li>
<li><code>:resolve-external-references</code> - if true, the external references in <code>source</code> will be followed. The default is <code>nil</code>. </li></ul>
</div>
</div>
  
<a name="function.load-rdf:2Fxml-from-string" id="function.load-rdf:2Fxml-from-string"></a>
<a name="load-rdf:2Fxml-from-string" id="load-rdf:2Fxml-from-string"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-rdf/xml-from-string</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">base-uri</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">commit</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Treat <code>string</code> as an RDF/XML data source and add it to the triple-store. For example: </p>
<pre><code>   (load-rdf/xml-from-string  
    "&lt;?xml version=\"1.0\"?&gt;  
&lt;rdf:RDF xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"  
         xmlns:ex=\"http://example.org/stuff/1.0/\"&gt;  
  &lt;rdf:Description rdf:about=\"http://example.org/item01\"&gt;  
    &lt;ex:prop rdf:parseType=\"Literal\"  
             xmlns:a=\"http://example.org/a#\"&gt;&lt;a:Box required=\"true\"&gt;  
         &lt;a:widget size=\"10\" /&gt;  
         &lt;a:grommit id=\"23\" /&gt;&lt;/a:Box&gt;  
    &lt;/ex:prop&gt;  
  &lt;/rdf:Description&gt;  
&lt;/rdf:RDF&gt;  
") </code></pre><p>See <a href="#load-rdf:2Fxml" title="description of load-rdf/xml">load-rdf/xml</a> for details on the parser and the other arguments to this function. </p>
</div>
</div>
  <h4>Loading Quads</h4><p>These functions load quads (triples with a graph optionally specified). Formats which support graphs include <a href="http://www.w3.org/TR/n-quads/" class="external" target="_blank">N-Quad</a>, <a href="http://www.w3.org/2004/03/trix/" class="external" target="_blank">TriX</a>, and <a href="http://www.w3.org/TR/trig/" class="external" target="_blank">TriG</a>. </p>
<a name="function.load-nquads" id="function.load-nquads"></a>
<a name="load-nquads" id="load-nquads"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-nquads</span>
<span class="documentation-arguments"><span class="argument">source</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">preserve-strings</span> &nbsp;<span class="argument">external-format</span> &nbsp;<span class="argument">relax-syntax</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">continue-on-errorp</span> &nbsp;<span class="argument">default-attributes</span> &nbsp;(<span class="argument">line-number</span> 1) &nbsp;<span class="marker">&amp;allow-other-keys</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add triples from <code>source</code> (in <a href="http://www.w3.org/TR/n-quads/" class="external" target="_blank">N-Quads format</a>) to the triple store. </p><p>Returns (as multiple values) the count of triples loaded and the UPI of the graph into which quads missing the graph field were loaded. (<strong>load-nquads</strong> is following <a href="#load-ntriples" title="description of load-ntriples">load-ntriples</a> here). If all nquads have a graph field specified, the second return value has no meaning, but the graph field is optional in nquads so some (or all) may be missing and the second return value is then relevant. See <a href="#load-ntriples" title="description of load-ntriples">load-ntriples</a> for more details on the second return value, particularly when the value of the <code>graph</code> argument is <code>:source</code> and some nquads do not have a graph specified. </p>
<ul>
<li><code>source</code> - can be a stream, a pathname to an N-Quads file, a file URI, an HTTP URI or a string that can be coerced into a pathname. <code>source</code> can also be a list of any of these things. In this case, each item in the list will be imported in turn. When adding statements to a remote-triple-store, a URI source argument will be fetched directly by the server. All other source types are retrieved and delivered to the server via the client interface. <p>In the case where a list of sources is being loaded and the <code>graph</code> argument is <code>:source</code>, each source in the list will be associated with the URI specifying that source, which will be used as the graph for nquads which do not have the graph specified. In this case, the second return value will be <code>nil</code>. </p></li>
<li><p><code>:db</code> - specifies the triple-store into which nquads will be loaded. This defaults to the value of *db*.</p></li>
<li><p><code>:graph</code> - for any nquads which do not have a graph specified (the graph is optional in a nquad), this argument specifies the graph to which they are loaded. The argument defaults to <code>nil</code> which is interpreted as <code>db</code>'s default graph. This argument does not affect nquads which do have a graph specified. If supplied, it can be: </p>
<ul>
<li><p>a string representing a URIref, or a UPI or future-part   encoding a URIref, which adds the triples in <code>source</code> to a graph   named by that URI </p></li>
<li><p>the keyword <code>:source</code>, in which case the <code>source</code> argument will be added as a URI and the loaded nquads which do not have the graph specified will be added to a graph named by that URI. This has the effect of associating the file or URL of <code>source</code> with the incoming graphless nquads. </p></li></ul></li></ul><p>The following keyword parameters can be used to control the loading process: </p>
<ul>
<li><p><code>:verbose</code> - specifies whether or not progress information is printed as triples are loaded. It defaults to <code>nil</code>. </p>
<li><p><code>:preserve-strings</code> - determine whether or not to save the strings of a triple's object field when the object can be encoded directly into the triple. If true (the default) then the strings will be saved. If false, then only the encoded values will be preserved (this may prevent exact round-trips if data is coerced during the encoding process). </p></li>
<li><p><code>:commit</code> - controls whether and how often <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> is called while loading. This can be <code>nil</code> for no commit, <code>t</code> for commit at the end of the load or a whole number to commit whenever more than that number of triples have been added and again at the end of the load. Default is nil. </p></li>
<li><p><code>:relax-syntax</code> - For N-Triples and N-Quad files, this flag tells AllegroGraph to ignore certain syntax. In particular: </p>
<ul>
<li>Blank node names may use underscore (_) and dash (-) characters.</li>
<li>Literals may be used in the Graph position (for N-Quads).</li>
<li>URIs are not required to include a colon (:).</li></ul></li></li><p>This is a non-standard parser extension and should only be used when necessary. </p>
<li><code>:default-attributes</code> - specifies the attributes that will be associated with every triple being loaded. (Because in this file format attributes cannot be specified for individual triples, all triples loaded will have these attributes.) See the <a href="triple-attributes.html">Triple Attributes</a> document for more information on attributes. </li>
<li><code>:continue-on-error-p</code> - determine how the parser should behave if it encounters an error parsing or adding a triple. It can be one of: 
<ul>
<li><p><code>nil</code> - meaning to raise the error normally,</p></li>
<li><p><code>t</code> - meaning to ignore the error and continue parsing with   the next line in the source, </p></li>
<li><p>a function of four arguments: a parsing helper data structure,   the line in the source where the problem was encountered, the   condition that caused the error and the arguments (if any) to   that condition. </p></li></ul></li><p>You can use <code>continue-on-error-p</code> to print all of the problem lines in a file using something like </p>
<pre><code>(load-nquads  
 "source"  
 :continue-on-errorp  
 (lambda (helper source-line condition &amp;rest args)  
   (declare (ignore helper args))  
   (format t "~&amp;Error at line ~:6d - ~a" source-line condition)))  
 
</code></pre></ul>
</div>
</div>
 
 
<a name="function.load-nquads-from-string" id="function.load-nquads-from-string"></a>
<a name="load-nquads-from-string" id="load-nquads-from-string"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-nquads-from-string</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">preserve-strings</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">relax-syntax</span> &nbsp;<span class="argument">continue-on-errorp</span> &nbsp;<span class="argument">default-attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add the triples in <code>string</code> (in <a href="http://www.w3.org/TR/n-quads/" class="external" target="_blank">N-Quads format</a>) to the triple store. </p><p>Returns (as multiple values) the count of nquads loaded and the UPI of the graph into which the quads were loaded (for those quads which do not have the graph specified). </p><p>See <a href="#load-nquads" title="description of load-nquads">load-nquads</a> for details on the parameters. </p>
</div>
</div>
  
<a name="function.load-trix" id="function.load-trix"></a>
<a name="load-trix" id="load-trix"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-trix</span>
<span class="documentation-arguments"><span class="argument">source</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">default-graph</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">default-attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Load a <a href="http://www.w3.org/2004/03/trix/" class="external" target="_blank">TriX</a> document into the triple store named by <code>db</code>. </p>
<ul>
<li><p><code>source</code> - a string or pathname identifying a file, or    a stream. </p>
<li><p><code>:db</code> - specifies the triple-store into  which triples will be loaded; defaults to the value of *db*. </p></li>
<li><p><code>:verbose</code> - if true, information about the load progress    will be printed to <code>*standard-output*</code>. </p></li>
<li><p><code>:default-graph</code> - a <a href="#ref-future-parts" title="">future-part</a> or UPI that    identifies a graph, or <code>nil</code>. If it is non-null, any graphs in    the TriX document that are equal to the given URI will be treated as    the default graph in <code>db</code>. </p></li></li><p>   <code>default-graph</code> can also be the symbol <code>:source</code>, in which    case <code>namestring</code> is called on the source and treated as a URI. </p>
<li><p><code>:commit</code> - controls whether and how often <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> is called while loading. This can be <code>nil</code> for no commit, <code>t</code> for commit at the end of the load or a whole number to commit whenever more than this number of triples have been added. Default is nil. </p></li>
<li><p><code>:default-attributes</code> - specifies the attributes that will be associated with every triple being loaded. (Because in this file format attributes cannot be specified for individual triples, all triples loaded will have these attributes.) See the <a href="triple-attributes.html">Triple Attributes</a> document for more information on attributes. </p></li></ul><p>We have implemented a few extensions to TriX to allow it to represent richer data: </p>
<ul>
<li><p>Graphs can be named by <code>&lt;id&gt;</code>, not just <code>&lt;uri&gt;</code>. (A future revision might also permit literals.) </p></li>
<li><p>The default graph can be denoted in two ways: by providing <code>&lt;default/&gt;</code> as the name for the graph; or by providing a graph URI as an argument to <code>load-trix</code>. </p></li>
<li>In the interest of generality, the predicate position of a triple is not privileged: it can be a literal or blank node (just like the subject and object), not just a URI. </li></ul>
</div>
</div>
  
<a name="function.load-trix-from-string" id="function.load-trix-from-string"></a>
<a name="load-trix-from-string" id="load-trix-from-string"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-trix-from-string</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">default-graph</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">default-attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Load a string containing data in <a href="http://www.w3.org/2004/03/trix/" class="external" target="_blank">TriX</a> format into <code>db</code> </p>
<ul>
<li><p><code>string</code> - a string containing TriX data</p></li>
<li><p><code>:db</code> - specifies the triple-store into  which triples will be loaded; defaults to the value of *db*. </p></li>
<li><p><code>:verbose</code> - if true, information about the load progress    will be printed to <code>*standard-output*</code>. </p></li>
<li><p><code>:default-graph</code> - a <a href="#ref-future-parts" title="">future-part</a> or UPI that    identifies a graph, or <code>nil</code>. If it is non-null, any graphs in    the TriX document that are equal to the given URI will be treated as    the default graph in <code>db</code>. </p></li>
<li><p><code>:commit</code> - controls whether and how often <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> is called while loading. This can be <code>nil</code> for no commit, <code>t</code> for commit at the end of the load or a whole number to commit whenever more than this number of triples have been added. </p></li>
<li><p><code>:default-attributes</code> - specifies the attributes that will be associated with every triple being loaded. (Because in this file format attributes cannot be specified for individual triples, all triples loaded will have these attributes.) See the <a href="triple-attributes.html">Triple Attributes</a> document for more information on attributes. </p></li></ul><p>See <a href="#load-trix" title="description of load-trix">load-trix</a> for more details. </p>
</div>
</div>
  
<a name="function.load-trig" id="function.load-trig"></a>
<a name="load-trig" id="load-trig"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-trig</span>
<span class="documentation-arguments"><span class="argument">source</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">base-uri</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">default-attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add triples from the <a href="http://www.w3.org/TeamSubmission/trig/">Trig</a> <code>source</code> to the triple-store. <code>source</code> can be a filename or a stream. </p><p>The additional arguments are: </p>
<ul>
<li><p><code>:db</code> - specifies the triple-store into which triples will be loaded; defaults to the value of <em>db</em>. </p></li>
<li><p><code>:base-uri</code> - this defaults to the name of the file from which the triples are loaded. It is used to resolve relative URI references during parsing. To use no base-uri, use the empty string "". </p></li>
<li><p><code>:graph</code> - the graph into which the triples from <code>source</code> will be placed. It defaults to <code>nil</code> which is interpreted as <code>db</code>'s default graph. If supplied, it can be: </p>
<ul>
<li><p>a string representing a URIref, or a UPI or future-part   encoding a URIref, which adds the triples in <code>source</code> to a graph   named by that URI </p></li>
<li><p>the keyword <code>:source</code>, in which case the <code>source</code> argument will be added as a URI and the loaded triples added to a graph named by that URI. This has the effect of associating the file or URL of <code>source</code> with the new triples. </p></li></ul></li>
<li><p><code>:commit</code> - controls whether and how often <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> is called while loading. This can be <code>nil</code> for no commit, <code>t</code> for commit at the end of the load or a whole number to commit whenever more than that number of triples have been added and again at the end of the load. </p></li>
<li><code>:default-attributes</code> - specifies the attributes that will be associated with every triple being loaded. (Because in this file format attributes cannot be specified for individual triples, all triples loaded will have these attributes.) See the <a href="triple-attributes.html">Triple Attributes</a> document for more information on attributes. </li></ul>
</div>
</div>
  
<a name="function.load-trig-from-string" id="function.load-trig-from-string"></a>
<a name="load-trig-from-string" id="load-trig-from-string"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-trig-from-string</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">base-uri</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">default-attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Treat <code>string</code> as a   <a href="http://www.w3.org/TeamSubmission/trig/">Trig</a> data source and   add it to the triple-store. </p><p>See <a href="#load-trig" title="description of load-trig">load-trig</a> for details. </p>
</div>
</div>
  <h4>Loading Quads with Attributes</h4><p><a href="triple-attributes.html#nqx-file">NQX</a> format is similar to N-Quad format except each quad may in addition have attributes specified. </p>
<a name="function.load-nqx" id="function.load-nqx"></a>
<a name="load-nqx" id="load-nqx"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-nqx</span>
<span class="documentation-arguments"><span class="argument">source</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">preserve-strings</span> &nbsp;<span class="argument">external-format</span> &nbsp;<span class="argument">relax-syntax</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">continue-on-errorp</span> &nbsp;<span class="argument">default-attributes</span> &nbsp;(<span class="argument">line-number</span> 1) &nbsp;<span class="marker">&amp;allow-other-keys</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add triples from <code>source</code> in NQX format to the repository. NQX format is N-Quad format plus optional attributes for each triple. Returns (as multiple values) the count of triples loaded and the UPI of the graph into which the triples were loaded. </p>
<ul>
<li><code>source</code> - can be a stream, a pathname to an NQX file, a file URI, an HTTP URI or a string that can be coerced into a pathname. <code>source</code> can also be a list of any of these things. In this case, each item in the list will be imported in turn. When adding statements to a remote-triple-store, a URI <code>source</code> argument will be fetched directly by the server. All other <code>source</code> types are retrieved and delivered to the server via the client interface. <p>In the case where a list of sources is being loaded and the <code>graph</code> argument is <code>:source</code>, each source in the list will be associated with the URI specifying that source, and that will be used as the graph of the triples loaded from that source. In this case, the second return value will be <code>nil</code>. </p></li>
<li><p><code>:db</code> - specifies the repository into which triples will be loaded. This defaults to the value of *db*.</p></li>
<li><p><code>:graph</code> - the graph to which the triples from <code>source</code> will be placed. It defaults to <code>nil</code> which is interpreted as <code>db</code>'s default graph. If supplied, it can be: </p>
<ul>
<li><p>a string representing a URIref, or a UPI or future-part   encoding a URIref, which adds the triples in <code>source</code> to a graph   named by that URI </p></li>
<li><p>the keyword <code>:source</code>, in which case the <code>source</code> argument will be added as a URI and the loaded triples added to a graph named by that URI. This has the effect of associating the file or URL of <code>source</code> with the new triples. </p></li></ul></li></ul><p>The following keyword parameters can be used to control the loading process: </p>
<ul>
<li><p><code>:verbose</code> - specifies whether or not progress information is printed as triples are loaded. It defaults to <code>nil</code>. </p>
<li><p><code>:preserve-strings</code> - determine whether or not to save the strings of a triple's object field when the object can be encoded directly into the triple. If true (the default) then the strings will be saved. If false, then only the encoded values will be preserved (this may prevent exact round-trips if data is coerced during the encoding process). </p></li>
<li><p><code>:commit</code> - controls whether and how often <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> is called while loading. This can be <code>nil</code> for no commit, <code>t</code> for commit at the end of the load or a whole number to commit whenever more than that number of triples have been added and again at the end of the load. Default is nil. </p></li>
<li><p><code>:relax-syntax</code> - For N-Triples and N-Quad files, this flag tells AllegroGraph to ignore certain syntax. In particular: </p>
<ul>
<li>Blank node names may use underscore (_) and dash (-) characters.</li>
<li>Literals may be used in the Graph position (for N-Quads).</li>
<li>URIs are not required to include a colon (:).</li></ul></li></li><p>This is a non-standard parser extension and should only be used when necessary. </p>
<li><code>:default-attributes</code> - specifies the attributes that will be associated with every triple that does not have attributes specified in the file. See the <a href="triple-attributes.html">Triple Attributes</a> document for more information on attributes. </li>
<li><code>:continue-on-error-p</code> - determine how the parser should behave if it encounters an error parsing or adding a triple. It can be one of: 
<ul>
<li><p><code>nil</code> - meaning to raise the error normally,</p></li>
<li><p><code>t</code> - meaning to ignore the error and continue parsing with   the next line in the source, </p></li>
<li><p>a function of four arguments: a parsing helper data structure,   the line in the source where the problem was encountered, the   condition that caused the error and the arguments (if any) to   that condition. </p></li></ul></li></ul><p>You can use <code>continue-on-error-p</code> to print all of the problem lines in a file using something like </p>
<pre><code>    (load-nqx  
     "source"  
     :continue-on-errorp  
     (lambda (helper source-line condition &amp;rest args)  
       (declare (ignore helper args))  
       (format t "~&amp;Error at line ~:6d - ~a" source-line condition)))  
 
</code></pre>
</div>
</div>
 
 
<a name="function.load-nqx-from-string" id="function.load-nqx-from-string"></a>
<a name="load-nqx-from-string" id="load-nqx-from-string"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-nqx-from-string</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graph</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">preserve-strings</span> &nbsp;<span class="argument">commit</span> &nbsp;<span class="argument">relax-syntax</span> &nbsp;<span class="argument">continue-on-errorp</span> &nbsp;<span class="argument">default-attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add the triples in <code>string</code> (in NQX format) to the triple store. </p><p>See <a href="#load-nqx" title="description of load-nqx">load-nqx</a> for details on the parameters. </p>
</div>
</div>
  <h3>Loading other data formats</h3><p>If you need to load a format that AllegroGraph does not yet support, we suggest you use the excellent free tool <strong>rapper</strong> from <a href="http://librdf.org/raptor/rapper.html" class="external" target="_blank">http://librdf.org/raptor/rapper.html</a> to create an N-Triples file that AllegroGraph can load. This format is the most efficient for loading large amounts of data. See the <a href="rapper.html">AllegroGraph and rapper</a> page for more information. </p> <a name='header4-31' id='header4-31'></a><h4>Adding Programmatically</h4><p>You can also add triples to a triple-store programatically with the function <a href="#add-triple" title="description of add-triple">add-triple</a>. The three required arguments, representing the subject, predicate, and object of the triple to be added can be expressed either as: </p>
<ul>
<li><p>strings in the N-Triples syntax for URI references  and literals; </p></li>
<li><p>UPIs such as are returned by the functions <a href="#intern-resource" title="description of intern-resource">intern-resource</a>, <a href="#intern-literal" title="description of intern-literal">intern-literal</a>, and <a href="#new-blank-node" title="description of new-blank-node">new-blank-node</a>; </p></li>
<li><p>Encoded-UPIs created with functions like <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a>; or</p></li>
<li><p><a href="#ref-future-parts" title="">future-parts</a> created using the <strong>!</strong>-reader..</p></li></ul>
<a name="function.add-triple" id="function.add-triple"></a>
<a name="add-triple" id="add-triple"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">add-triple</span>
<span class="documentation-arguments"><span class="argument">s</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">g</span> &nbsp;<span class="argument">preserve-strings</span> &nbsp;<span class="argument">attributes</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Add a triple to the <code>db</code> </p><p>The added triple will have the given subject, predicate and object. </p>
<ul>
<li><p><code>:db</code> - the triple-store into which to add the triple; this defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
<li><p><code>:g</code> - the graph for the new triple. If not specified, then the triple will be added to the default-graph (see <a href="#default-graph-upi" title="description of default-graph-upi">default-graph-upi</a>). </p></li>
<li><p><code>:preserve-strings</code> - controls whether typed-literals will have only their encoded value added to the store or whether an additional hashed version of the triple will also be added. The defaults to <code>nil</code>. For example, if I evaluate: </p>
<pre><code>(add-triple !ex:gary !ex:age !"46"^^xsd:byte) </code></pre></li></li><p>then only a single triple will be added to the store. If I instead </p>
<pre><code>(add-triple !ex:gary !ex:age !"46"^^xsd:byte :preserve-strings t) </code></pre><p>then there will be two triples added: one whose object is the encoded value 46 and the other whose object is a hashed UPI which points to the string "46"^^&lt;http://www.w3.org/2001/XMLSchema#byte&gt;. </p>
<li><code>:attributes</code> - if supplied, this must be an alist of name and value pairs.  Each name and value must be a string. Each name must refer to a previously defined attribute.  An error will be signaled if any name refers to an undefined attribute or if any value does not conform to the named attribute's constraints. </li></ul><p><code>add-triple</code> returns the <a href="#function.triple-id" title="description of function triple-id">triple-id</a> of the new triple. </p>
</div>
</div>
  <a name='header3-38' id='header3-38'></a><h3>Triple Manipulation</h3> <h4>Triple parts: Resources, Literals, UPIs and more</h4><p>Each triple has five parts (!), a subject, a predicate, an object, a graph and a (unique, AllegroGraph assigned) ID. In RDF, the subject must be a "resource", i.e., a URI or a blank node. The predicate must be a URI. The object may be a URI, a blank node or a "literal". Literals are represented as strings with an optional type indicated by a URI or with a (human) language tag such as <code>en</code> or <code>jp</code>.
<a name="fnr3-2018-06-08" id="fnr3-2018-06-08"></a>
<sup><a href="#fn3-2018-06-08">4</a></sup>  <em>Blank nodes</em> are anonymous parts whose identity is only meaningful within a given triple-store. </p><p>Resources, literals and blank nodes are represented as strings in RDF/XML or N-Triple syntax. AllegroGraph stores these strings in a string dictionary and hashes them to compute a Unique Part Identifier (UPI) for each string. A UPI is a length 12 octet array. One byte of the array is used to identify its type (e.g., is it a resource, a literal, or a blank node). The other 11-bytes are used to either store a hash of the string or to store an encoding of the UPIs contents (see <a href="#ref-type-mapping" title="">type mapping</a> below for more information about encoded UPIs). </p><h5>From Strings to Parts</h5><p>Resources and literals can be denoted with plain Lisp strings in the syntax used in N-Triples files. However this isn't entirely convenient since the N-Triples syntax for literals requires quotation marks which then need to be escaped when writing a Lisp string. For instance the literal whose value is <code>"foo"</code> must be written in N-Triples syntax as <code>"\"foo\""</code>. Similarly -- though not quite as irksome -- URIs must be written enclosed in angle brackets. The string <code>"http://www.franz.com/simple#lastName"</code>, passed as an argument to <a href="#add-triple" title="description of add-triple">add-triple</a> will be interpreted as a literal, not as the resource indicated by the URI. To refer to the resource in N-Triples syntax you must write <code>"&lt;http://www.franz.com/simple#lastName&gt;"</code>. Literals with datatypes or language codes are even more cumbersome to write as strings, requiring both escaped quotation marks and other syntax. </p><p>To make it easier to produce correctly formatted N-Triple strings we provide two functions <a href="#resource" title="description of resource">resource</a> and <a href="#literal" title="description of literal">literal</a>. (The <a href="#ref-bang-reader" title="">!</a> reader macro, discussed below, can also be used to produce <a href="#ref-future-parts" title="">future-parts</a> and UPIs suitable to use as arguments for most of AllegroGraph's API.): </p>
<a name="function.literal" id="function.literal"></a>
<a name="literal" id="literal"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">literal</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">language</span> &nbsp;<span class="argument">datatype</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Create a new future-part with the provided values. </p>
<ul>
<li><p><code>string</code> - the string out of which to create the part.</p></li>
<li><p><code>:language</code> - If provided, <code>language</code>  should be a valid <a href="http://www.ietf.org/rfc/rfc3066.txt" title="Tags for the Identification of Languages">RDF language tag</a>. </p></li>
<li><p><code>:datatype</code> - If provided, the <code>datatype</code> must be a resource. I.e., it can be a string representation of a URI (e.g., "http://foo.com/") or a future-part specifying a resource (e.g., !&lt;http://foo.com&gt;). If it does not specify a resource, a condition of type invalid-datatype-for-literal-error is signaled. An overview of RDF datatypes can be found in the W3C's <a href="http://www.w3.org/TR/rdf-concepts/" class="external" target="_blank">RDF concepts guide</a>. </p></li></ul><p>Only one of <code>datatype</code> and <code>language</code> can be used at any one time. If both are supplied, a condition of type datatype-and-language-specified-error will be signaled. </p>
</div>
</div>
  
<a name="function.resource" id="function.resource"></a>
<a name="resource" id="resource"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">resource</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">namespace</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return the provided string as a future-part naming a resource. </p><p>If <code>namespace</code> is provided, then <code>string</code> will be treated as a fragment and the future-part returned will be the URIref whose prefix is the string to which <code>namespace</code> maps and whose fragment is <code>string</code>. I.e., if the namespace prefix <code>rdf</code> maps to <code>&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</code>, then the parts created by </p>
<pre><code>(resource "Car" "rdf") </code></pre><p>and </p>
<pre><code>(resource "http://www.w3.org/1999/02/22-rdf-syntax-ns#Car") </code></pre><p>will be the same. </p>
</div>
</div>
  <p>Some examples (we will describe and explain the <strong>!</strong> notation <a href="#ref-future-parts" title="">below</a>): </p>
<pre><code>&gt; (resource "http://www.franz.com/")  
!&lt;http://www.franz.com/&gt;  
 
&gt; (literal "Peter")  
!"Peter"  
 
&gt; (literal "10" :datatype  
  "http://www.example.com/datatypes#Integer")  
!"10"^^&lt;http://www.example.com/datatypes#Integer&gt;  
 
&gt; (literal "Lisp" :language "EN")  
!"Lisp"@en </code></pre><p>Another issue with using Lisp strings to denote literals and resources is that the strings must, at some point, be translated to the UPIs used internally by the triple-store. This means that if you are going to add a large number of triples containing the same resource or literal and you pass the resource or literal value as a string, <a href="#add-triple" title="description of add-triple">add-triple</a> will have to repeatedly convert the string into its UPI. </p><p>To prevent this repeated computation, you can use functions like <a href="#intern-resource" title="description of intern-resource">intern-resource</a> or <a href="#intern-literal" title="description of intern-literal">intern-literal</a> to compute the UPI of a string outside of the <a href="#add-triple" title="description of add-triple">add-triple</a> loop. The function <a href="#new-blank-node" title="description of new-blank-node">new-blank-node</a> (or the macro <a href="#with-blank-nodes" title="description of with-blank-nodes">with-blank-nodes</a>) can be used to produce the UPI of a new anonymous node for use as the subject or object of a triple. You can also use <em>encoded ids</em> in place of blank nodes. See <a href="encoded-ids.html">Encoded ids</a> for more information </p>
<a name="function.blank-node-p" id="function.blank-node-p"></a>
<a name="blank-node-p" id="blank-node-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">blank-node-p</span>
<span class="documentation-arguments"><span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns true if <code>upi</code> is a blank node and nil otherwise. For example: </p>
<pre><code>&gt; (blank-node-p (new-blank-node))  
t  
&gt; (blank-node-p (literal "hello"))  
nil </code></pre>
</div>
</div>
 
 
<a name="function.intern-resource" id="function.intern-resource"></a>
<a name="intern-resource" id="intern-resource"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">intern-resource</span>
<span class="documentation-arguments"><span class="argument">uri</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">namespace</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Compute the UPI of <code>uri</code>, make sure that it is stored in the string dictionary, and return the UPI. </p>
<ul>
<li><p><code>:db</code> - specifies the triple-store into which <code>uri</code> will be interned. This defaults to the value of *db*. </p></li>
<li><p><code>:upi</code> - if supplied, then this <code>upi</code> will be used to store the <code>uri</code>'s UPI; otherwise, a new UPI will be created using <a href="#make-upi" title="description of make-upi">make-upi</a>. </p></li>
<li><p><code>:namespace</code> - If <code>namespace</code> is provided, then <code>uri</code> will be treated as a fragment and the UPI returned will encode the URIref whose prefix is the string to which <code>namespace</code> maps and whose fragment is <code>uri</code>. </p></li></ul><p>Interned strings are guaranteed to be persistent as long as both of the following are true: </p>
<ul>
<li><p><a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> is called</p></li>
<li><p>At least one live triple references the UPI.</p></li></ul><p>See also <a href="#resource" title="description of resource">resource</a>. </p>
</div>
</div>
  
<a name="function.intern-literal" id="function.intern-literal"></a>
<a name="intern-literal" id="intern-literal"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">intern-literal</span>
<span class="documentation-arguments"><span class="argument">value</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">language</span> &nbsp;<span class="argument">datatype</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Compute the UPI of <code>value</code> treating it as an untyped literal, possibly with a language tag. Ensure that the literal is in the store's string dictionary and return the UPI. </p>
<ul>
<li><p><code>:db</code> - specifies the triple-store into which the <code>uri</code> will be interned. This defaults to the value of *db*. </p></li>
<li><p><code>:upi</code> - if supplied, then this <code>upi</code> will be used to store the <code>uri</code>'s UPI; otherwise, a new UPI will be created using <a href="#make-upi" title="description of make-upi">make-upi</a>. </p></li>
<li><p><code>:language</code> - if supplied, then this language will be associated with the literal <code>value</code>. See <a href="http://www.ietf.org/rfc/rfc3066.txt" title="Tags for the Identification of Languages">rfc-3066</a> for details on language tags. </p></li>
<li><p><code>:datatype</code> - If supplied, the <code>datatype</code> must be a resource. I.e., it can be a string representation of a URI (e.g., "http://foo.com/") or a future-part specifying a resource (e.g., !&lt;http://foo.com&gt;). If it does not specify a resource, a condition of type invalid-datatype-for-literal-error is signaled. An overview of RDF datatypes can be found in the W3C's <a href="http://www.w3.org/TR/rdf-concepts/" class="external" target="_blank">RDF concepts guide</a>. </p></li></ul><p>Only one of <code>datatype</code> and <code>language</code> can be used at any one time. If both are supplied, a condition of type datatype-and-language-specified-error will be signaled. </p><p>Interned strings are guaranteed to be persistent as long as both of the following are true: </p>
<ul>
<li><p><a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> is called</p></li>
<li>At least one live triple references the UPI.</li></ul>
</div>
</div>
  
<a name="function.new-blank-node" id="function.new-blank-node"></a>
<a name="new-blank-node" id="new-blank-node"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">new-blank-node</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Create a new blank-node in the triple-store <code>db</code> and return the UPI. If a upi is <em>not</em> passed in with the :upi parameter, then a new UPI structure will be created. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. 
</div>
</div>
  
<a name="macro.with-blank-nodes" id="macro.with-blank-nodes"></a>
<a name="with-blank-nodes" id="with-blank-nodes"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">with-blank-nodes</span>
<span class="documentation-arguments"><span class="argument">blank-nodes</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>This convenience macro binds one or more variables to new blank nodes within the body of the form. For example: </p>
<pre><code>(with-blank-nodes (b1 b2)  
  (add-triple b1 !rdf:type !ex:Person)  
  (add-triple b1 !ex:firstName "Gary")  
  (add-triple b2 !rdf:type !ex:Dog)  
  (add-triple b2 !ex:firstName "Abbey")  
  (add-triple b2 !ex:petOf b1)) </code></pre>
</div>
</div>
 
 <p>The following example demonstrates the use of these functions. We use <a href="#intern-resource" title="description of intern-resource">intern-resource</a> to avoid repeatedly translating the URIs used as predicates into UPIs and then use <a href="#new-blank-node" title="description of new-blank-node">new-blank-node</a> to create a blank node representing each employee and <a href="#intern-literal" title="description of intern-literal">intern-literal</a> to translate the strings in the list <code>employee-data</code> into UPIs. (We could also use <a href="#literal" title="description of literal">literal</a> to convert the strings but using <code>intern-literal</code> is more efficient.) </p>
<pre><code>(defun add-employees (company employee-data)  
  (let ((first-name (intern-resource "http://www.franz.com/simple#firstName"))  
    (last-name (intern-resource "http://www.franz.com/simple#lastName"))  
    (salary (intern-resource "http://www.franz.com/simple#salary"))  
    (employs (intern-resource "http://www.franz.com/simple#employs"))  
    (employed-by (intern-resource "http://www.franz.com/simple#employed-by")))  
    (loop for (first last sal) in employee-data do  
     (let ((employee (new-blank-node)))  
       (add-triple company employs employee)  
       (add-triple employee employed-by company)  
       (add-triple employee first-name (intern-literal first))  
       (add-triple employee last-name (intern-literal last))  
       (add-triple  
        employee salary  
        (intern-literal sal :datatype "http://www.franz.com/types#dollars")))))) </code></pre><p>Note that the difference between <a href="#resource" title="description of resource">resource</a> and <a href="#intern-resource" title="description of intern-resource">intern-resource</a> is that the former only computes the future-part of a string whereas the latter both does this computation <em>and</em> ensures that the string and its UPI are present in the triple-store's string dictionary. <a href="#intern-resource" title="description of intern-resource">intern-resource</a> requires that a database be open while <a href="#resource" title="description of resource">resource</a> does not. </p><h5>Encoded ids</h5><p>Encoded ids, described in detail in <a href="encoded-ids.html">Encoded ids</a>, are analogous to blank nodes but have certain advantages, such as they can be located using their URI rather than through another node that connects to them (you can only get a handle on a blank node by finding another node which points to it). </p>
<a name="function.register-encoded-id-prefix" id="function.register-encoded-id-prefix"></a>
<a name="register-encoded-id-prefix" id="register-encoded-id-prefix"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-encoded-id-prefix</span>
<span class="documentation-arguments"><span class="argument">prefix</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Sets up an encoding for prefix, which must be a string, using format, which should be a template (also a string) indicating with brackets, braces, etc. the allowable suffixes. The characters + and * are not allowed in the template string (so, e.g., the string "[0-9]+" is illegal and will fail). </p><p>Returns two values: the index of this encoding (a positive integer) and t or nil. t is returned if the encoded-id definition is registered or if the template is modified. nil is returned if the prefix is already registered and the template is unchanged. (This allows the same registration form to be evaluated more than once.) You can redefine the template by calling <strong>register-encoded-id-prefix</strong> with the same prefix and the new template. But an error will be signaled if you do that after triples have been created using an encoded-id from that prefix. </p><p>The number of distinct strings that the template may match must be less than or equal to 2^60. If the intention is to use <a href="#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a> in a multimaster replication cluster (see <a href="multi-master.html">Multimaster replication</a>), then the pattern must match 2^60 strings and we recommend using the "plain" format to achieve this goal. The value "plain" will produce integer values between 0 (inclusive) and 2^60 (exclusive), thus fulfilling the requirement. Note that the size of the range may change in later releases. Any such change will be noted in the <a href="release-notes.html">Release Notes</a>. </p><p>When not used for those purposes, templates that generate fewer strings are permitted. </p><p>See <a href="encoded-ids.html">Encoded IDs</a> for further information. </p><p>Examples: </p>
<pre><code>;; These first examples use templates that will cause calls  
;; to next-encoded-upi-for-prefix to fail if the repository is  
;; or becomes a multi-master cluster instance.  
 
(register-encoded-id-prefix    
"http://www.franz.com/managers"      
"[0-9]{3}-[a-z]{3}-[0-9]{2}")  ;; not a suitable value for  
                                   ;; calls to next-encoded-upi-for-prefix  
                                   ;; in a multi-master cluster instance  
RETURNS   
3 ;; you will likely see a different value   
t   
 
;; If you run the same form again:   
 
(register-encoded-id-prefix    
"http://www.franz.com/managers"      
"[0-9]{3}-[a-z]{3}-[0-9]{2}")  ;; not a suitable value for  
                                   ;; calls to next-encoded-upi-for-prefix  
                                   ;; in a multi-master cluster instance  
RETURNS   
3 ;; same value as before   
nil ;; meaning no action was taken   
 
;; If you modify the template (you can only do this when no stored   
;; triple uses en encoded-id from the prefix):   
 
(register-encoded-id-prefix    
"http://www.franz.com/managers"      
"[0-9]{3}-[a-z]{3}-[0-9]{4}") ;; last value is 4 rather than 2   
                                  ;; not a suitable value for  
                                  ;; calls to next-encoded-upi-for-prefix  
                                  ;; in a multi-master cluster instance  
RETURNS   
3 ;; same value as before   
t ;; meaning made the change  
 
;; These examples will allow calls to next-encoded-upi-for-prefix  
;; in multi-master cluster instances since the templates  
;; generate 2^60 distinct strings.  
 
(register-encoded-id-prefix   
    "http://www.franz.com/managers"     
    "plain")         ;; Calls to  next-encoded-upi-for-prefix  
                        ;; will work in multi-master cluster instances  
RETURNS  
3 ;; you will likely see a different value  
t  
 
;; Another example that has the correct range, since the string  
;; has 15 elements and 16 choices for each element resulting in  
;; (2^4)^15 = 2^60 possibilities.  
 
   (register-encoded-id-prefix   
    "http://www.franz.com/managers"     
    "[a-p]{15}")  ;; Calls to  next-encoded-upi-for-prefix  
                        ;; will work in multi-master cluster instances  
RETURNS  
4 ;; you will likely see a different value </code></pre>
</div>
</div>
 
 
<a name="function.unregister-encoded-id-prefix" id="function.unregister-encoded-id-prefix"></a>
<a name="unregister-encoded-id-prefix" id="unregister-encoded-id-prefix"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">unregister-encoded-id-prefix</span>
<span class="documentation-arguments"><span class="argument">prefix</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Unregisters the previously registered encoded id prefix. 
</div>
</div>
  
<a name="function.encoded-id-prefix-registered-p" id="function.encoded-id-prefix-registered-p"></a>
<a name="encoded-id-prefix-registered-p" id="encoded-id-prefix-registered-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">encoded-id-prefix-registered-p</span>
<span class="documentation-arguments"><span class="argument">prefix</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns nil if the prefix is not registered and its ID format if it is. 
</div>
</div>
  
<a name="function.next-encoded-upi-for-prefix" id="function.next-encoded-upi-for-prefix"></a>
<a name="next-encoded-upi-for-prefix" id="next-encoded-upi-for-prefix"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">next-encoded-upi-for-prefix</span>
<span class="documentation-arguments"><span class="argument">prefix</span> &nbsp;<span class="argument">upi</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns upi after modifying it to be the next id for the specified encoded-id prefix. The system maintains an internal order of encoded-ids for a prefix. (This order may not be the obvious one, but it will run over all possible ids for a prefix.) upi should be a upi and will be modified. If you do not want to modify an existing upi, create a new one with (<a href="#function.make-upi" title="description of function make-upi">make-upi</a>). Do not use this function if you have created an id for prefix directly using the @@ encoding as doing so may create duplicate ids (which you may think are distinct). </p><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p>Example: </p>
<pre><code>triple-store-user(59): (register-encoded-id-prefix   
    "http://www.franz.com/department"     
    "[0-9]{4}-[a-z]{3}-[0-9]{2}")  
5  
t  
triple-store-user(60): (setq d1  
                            (next-encoded-upi-for-prefix  
                               "http://www.franz.com/department"  
                               (make-upi)))  
{http://www.franz.com/department@@0000-aaa-00}  
triple-store-user(61): (setq bu (make-upi))  
#(49 2 238 3 16 0 0 0 161 210 ...)  
triple-store-user(62): (setq d2  
                         (next-encoded-upi-for-prefix  
                            "http://www.franz.com/department" bu))  
{http://www.franz.com/department@@0000-aaa-01}  
triple-store-user(63): bu        ;; bu is modified  
{http://www.franz.com/department@@0000-aaa-01}  
triple-store-user(64): d2  
{http://www.franz.com/department@@0000-aaa-01}  
triple-store-user(65): (setq d3  
                          (next-encoded-upi-for-prefix  
                             "http://www.franz.com/department" bu))  
{http://www.franz.com/department@@0000-aaa-02}  
triple-store-user(66): bu  ;; bu is modified  
{http://www.franz.com/department@@0000-aaa-02}  
triple-store-user(67): d2  ;; so is d2.  
{http://www.franz.com/department@@0000-aaa-02} </code></pre>
</div>
</div>
 
 
<a name="function.encoded-id-prefix-in-use-p" id="function.encoded-id-prefix-in-use-p"></a>
<a name="encoded-id-prefix-in-use-p" id="encoded-id-prefix-in-use-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">encoded-id-prefix-in-use-p</span>
<span class="documentation-arguments"><span class="argument">prefix</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns true if there are any triples that use the prefix. 
</div>
</div>
  
<a name="function.collect-encoded-id-prefixes" id="function.collect-encoded-id-prefixes"></a>
<a name="collect-encoded-id-prefixes" id="collect-encoded-id-prefixes"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">collect-encoded-id-prefixes</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns a list of 3-element lists of encoded-id specifications. The list elements are the prefix and the template (both strings) and the internal index of the encoded id. 
</div>
</div>
  
<a name="function.map-encoded-id-prefixes" id="function.map-encoded-id-prefixes"></a>
<a name="map-encoded-id-prefixes" id="map-encoded-id-prefixes"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-encoded-id-prefixes</span>
<span class="documentation-arguments"><span class="argument">fn</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Gets the list of encoded ids (as returned by <a href="#function.collect-encoded-id-prefixes" title="description of function collect-encoded-id-prefixes">collect-encoded-id-prefixes</a>) and applies fn to each element of that list. Since each list element is itself a list of three elements, fn must be or name a function that accepts three arguments. </p><p>Example: </p>
<pre><code>(defun foo (&amp;rest args)  
  (dolist (i args)  
  (print i)))  
 
(map-encoded-id-prefixes 'foo)  
 
"http://www.franz.com/employees"  
"[0-9]{3}-[a-z]{3}-[0-9]{2}"  
2  
"http://www.franz.com/managers"  
"[0-9]{4}-[a-z]{3}-[0-9]{2}"  
3  
nil </code></pre>
</div>
</div>
 
 <h5>Working with Triples</h5><p>The functions <a href="#function.subject" title="description of function subject">subject</a>, <a href="#function.predicate" title="description of function predicate">predicate</a>, <a href="#function.object" title="description of function object">object</a>, <a href="#function.graph" title="description of function graph">graph</a>, and <a href="#function.triple-id" title="description of function triple-id">triple-id</a> provide access to the part UPIs of triples returned by the cursor functions <a href="#cursor-row" title="description of cursor-row">cursor-row</a> and <a href="#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> or collected by <a href="#get-triples-list" title="description of get-triples-list">get-triples-list</a>. </p>
<a name="function.graph" id="function.graph"></a>
<a name="graph" id="graph"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">graph</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Get the graph UPI of a triple. </p><p>Use (setf graph) to change the UPI. If the <code>upi</code> argument is supplied, then the triple's graph will be copied into it. If it is not supplied then a new UPI will be created. </p>
</div>
</div>
  
<a name="function.object" id="function.object"></a>
<a name="object" id="object"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">object</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Get the object UPI of a triple. </p><p>Use (setf object) to change the UPI. If the <code>upi</code> argument is supplied, then the triple's object will be copied into it. If it is not supplied then a new UPI will be created. </p>
</div>
</div>
  
<a name="function.predicate" id="function.predicate"></a>
<a name="predicate" id="predicate"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">predicate</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Get the predicate UPI of a triple. </p><p>Use (setf predicate) to change the UPI. If the <code>upi</code> argument is supplied, then the triple's predicate will be copied into it. If it is not supplied then a new UPI will be created. </p>
</div>
</div>
  
<a name="function.subject" id="function.subject"></a>
<a name="subject" id="subject"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">subject</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Get the subject UPI of a triple. </p><p>Use (setf subject) to change the UPI. If the <code>upi</code> argument is supplied, then the triple's subject will be copied into it. If it is not supplied then a new UPI will be created. </p>
</div>
</div>
  
<a name="function.triple-id" id="function.triple-id"></a>
<a name="triple-id" id="triple-id"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-id</span>
<span class="documentation-arguments"><span class="argument">triple</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the <code>triple-id</code> of <code>triple</code> 
</div>
</div>
  <a name='ref-upi' id='ref-upi'></a> <h5>Working with UPIs</h5><p>You can also create UPIs and triples programmatically; determine the type-code of a UPI, and compare them. You may want to make your own copy of a triple or UPI when using a <a href="#ref-cursors" title="">cursor</a> since AllegroGraph does not save triples automatically (see, e.g., <a href="#iterate-cursor" title="description of iterate-cursor">iterate-cursor</a> for more details). </p><p>If using encoded UPIs, then the functions <a href="#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> and <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> will be essential. <a href="#upi-:3Enumber" title="description of upi->number">upi-&gt;number</a> will return the number associated with UPIs with a numeric component. You can also check the type of a UPI with either <a href="#upi-type-code" title="description of upi-type-code">upi-type-code</a> or <a href="#upi-typep" title="description of upi-typep">upi-typep</a> (see <a href="#type-code-:3Etype-name" title="description of type-code->type-name">type-code-&gt;type-name</a> and its inverse <a href="#type-name-:3Etype-code" title="description of type-name->type-code">type-name-&gt;type-code</a> for additional information.) </p>
<a name="function.copy-triple" id="function.copy-triple"></a>
<a name="copy-triple" id="copy-triple"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">copy-triple</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">new</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Copy a triple. </p>
<ul>
<li><p><code>triple</code> - the triple to copy</p></li>
<li><p><code>new</code> - (optional) If supplied, then this must be a triple and the copy of <code>triple</code> will be placed into it. Otherwise, a new triple will be created. </p></li></ul><p>This function is useful if you want to keep a reference to a triple obtained from a cursor returned by query functions such as <a href="#get-triples" title="description of get-triples">get-triples</a> since the cursor reuses the triple data structure for efficiency reasons. </p>
</div>
</div>
  
<a name="function.copy-upi" id="function.copy-upi"></a>
<a name="copy-upi" id="copy-upi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">copy-upi</span>
<span class="documentation-arguments"><span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Create a copy of a UPI. </p>
<ul>
<li><code>upi</code> - the UPI to copy.</li></ul>
</div>
</div>
  
<a name="function.make-triple" id="function.make-triple"></a>
<a name="make-triple" id="make-triple"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">make-triple</span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Creates and returns a new triple data structure. </p><p>The <a href="#function.subject" title="description of function subject">subject</a>, <a href="#function.predicate" title="description of function predicate">predicate</a>, <a href="#function.object" title="description of function object">object</a> and <a href="#function.graph" title="description of function graph">graph</a> slots will have UPIs whose <a href="#upi-type-code" title="description of upi-type-code">upi-type-code</a> is +unencoded-upi+ and the <a href="#function.triple-id" title="description of function triple-id">triple-id</a> will be zero. </p>
</div>
</div>
  
<a name="function.make-upi" id="function.make-upi"></a>
<a name="make-upi" id="make-upi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">make-upi</span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Creates and returns a new UPI data structure. The initial contents of the UPI returned are unspecified. 
</div>
</div>
  
<a name="function.triple-spog:3D" id="function.triple-spog:3D"></a>
<a name="triple-spog:3D" id="triple-spog:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-spog=</span>
<span class="documentation-arguments"><span class="argument">triple1</span> &nbsp;<span class="argument">triple2</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Compares <code>triple1</code> and <code>triple2</code> and returns true if they have the same contents and false otherwise. Only the <a href="#function.subject" title="description of function subject">subject</a>, <a href="#function.predicate" title="description of function predicate">predicate</a>, <a href="#function.object" title="description of function object">object</a> and <a href="#function.graph" title="description of function graph">graph</a> slots of each triple will be compared. See <a href="#triple:3D" title="description of triple=">triple=</a> if you need to compare triples including their IDs. 
</div>
</div>
  
<a name="function.triple:3D" id="function.triple:3D"></a>
<a name="triple:3D" id="triple:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple=</span>
<span class="documentation-arguments"><span class="argument">triple1</span> &nbsp;<span class="argument">triple2</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Compares <code>triple1</code> and <code>triple2</code> and returns true if they have the same contents <strong>and</strong> <a href="#function.triple-id" title="description of function triple-id">triple-id</a> and false otherwise. See <a href="#triple-spog:3D" title="description of triple-spog=">triple-spog=</a> if you need to compare triples regardless of their IDs. 
</div>
</div>
  
<a name="function.upi-:3Evalue" id="function.upi-:3Evalue"></a>
<a name="upi-:3Evalue" id="upi-:3Evalue"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi-&gt;value</span>
<span class="documentation-arguments"><span class="argument">upi</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">errorp</span> &nbsp;<span class="argument">complete?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Decodes UPI and returns the value, the type-code and any extra information as multiple values. </p>
<ul>
<li><p><code>upi</code> - the UPI to decode</p></li>
<li><p><code>:db</code> - specifies the triple-store from which the UPI originates.</p></li>
<li><p><code>:complete?</code> - controls whether the returned value is required to be a complete representation of the UPI. Currently it only affects dates and date-times for which the non-complete representation is a rational while the complete representation is a cons whose car is the same rational and whose cdr is a generalized boolean that's true if and only if the date or date-time has a timezone specified. Complete representations round-trip in the sense of: <code>(upi= (value-&gt;upi (upi-&gt;value upi :complete? t) (upi-type-code upi)) upi)</code>. </p></li></ul><p>The value, type-code, and extra information are interpreted as follows: </p>
<ul>
<li><p>value - a string, rational, float, symbol, or cons representing the contents of the UPI. UPIs representing numeric types are converted into an object of the appropriate lisp type (integer, rational or float).  Dates and date-times are by default converted into a single integer or rational respectively, standing for the number of seconds since January 1, 1900 GMT. See the <code>:complete?</code> parameter on how to recover the timezone information. For a default graph upi, value is :default-graph.  For a blank node, value is the blank node's integer representation (each unique blank node in a store gets a different number). Everything else is converted to a string. </p>
<li><p>type-code - an integer corresponding to one of the defined UPI types (see <a href="#supported-types" title="description of supported-types">supported-types</a> for more information). You can use <a href="#type-code-:3Etype-name" title="description of type-code->type-name">type-code-&gt;type-name</a> to see the English name of the type. </p></li>
<li><p>extra - There are three disjoint sets of literals in RDF:</p>
<ol>
<li>"simple literals" -- a string. </li>
<li>literals with datatypes </li>
<li>literals with language annotations. </li></ol></li></li><p>A literal cannot have both a language and a datatype; if a literal has <code>type-name</code> :literal-typed (i.e., its <code>type-code</code> is 2), then the <code>extra</code> value is a datatype URI; if its <code>type-code</code> is 3, then <code>extra</code> will be the language code. For some UPIs, including default graphs and blank nodes, the extra is an integer reserved for use by AllegroGraph. </p></ul><p>Examples: </p>
<pre><code>&gt; (upi-&gt;value (value-&gt;upi 22 :byte))  
22  
18  
nil  
 
&gt; (upi-&gt;value (upi (literal "hello" :language "en")))  
"hello"  
3  
"en" </code></pre><p>Note that upi-&gt;value will signal an error if called on geospatial UPIs. Use upi-&gt;values instead. </p><p>See <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> for additional information. </p>
</div>
</div>
  
<a name="function.upi-:3Evalues" id="function.upi-:3Evalues"></a>
<a name="upi-:3Evalues" id="upi-:3Evalues"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi-&gt;values</span>
<span class="documentation-arguments"><span class="argument">upi</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Decodes UPI and returns the multiple values encoded by the upi. This is intended for UPIs that intrinsically carry more than a single value, such as longitude and latitude for a geospatial UPI.  Operates the same as <a href="#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> for hashed UPIs. 
</div>
</div>
  
<a name="function.upi-:3Enumber" id="function.upi-:3Enumber"></a>
<a name="upi-:3Enumber" id="upi-:3Enumber"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi-&gt;number</span>
<span class="documentation-arguments"><span class="argument">upi</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the numeric value encoded by <code>upi</code>. </p><p>The interpretation of this number varies with the UPI's type code. </p>
<ul>
<li>For numeric UPIs, the number is their value.</li>
<li>For date, time, and date-time UPIs, the number is the extended universal time   (time zone information is lost). </li>
<li>For triple ID type UPIs, the number is the triple ID.</li>
<li>For subscript UPIs, the number is the subscript value.</li>
<li>For encoded IDs, the number is the encoded ID value as an integer (note that   you will need the <code>db</code> in order to convert this into the string format for the ID). </li>
<li>For blank nodes and other gensyms, the number is the UPI's value.</li>
<li>For boolean UPIs, true will map to 1 and false will map to 0.</li>
<li>2D Geospatial UPIs break with convention and return the lon. This is   to accomodate the bugbear of backwards compatibility. </li></ul><p>Other UPI types signal an error </p>
</div>
</div>
  
<a name="function.upi-type-code" id="function.upi-type-code"></a>
<a name="upi-type-code" id="upi-type-code"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi-type-code</span>
<span class="documentation-arguments"><span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the <code>type-code</code> of a UPI. This is a one-byte tag that describes how the rest of the bytes in the UPI should be interpreted. Some UPIs are hashed and their representation is stored in a string-table. Other UPIs encode their representation directly (see <a href="#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> and <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> for additional details). 
</div>
</div>
  
<a name="function.upi-typep" id="function.upi-typep"></a>
<a name="upi-typep" id="upi-typep"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi-typep</span>
<span class="documentation-arguments"><span class="argument">upi</span> &nbsp;<span class="argument">type-code</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns true if <code>upi</code> has type-code <code>type-code</code>. </p>
<ul>
<li><p><code>upi</code> - a UPI</p></li>
<li><code>type-code</code> - either a numeric UPI type-code or a keyword representing  a type-code. See <a href="#type-code-:3Etype-name" title="description of type-code->type-name">type-code-&gt;type-name</a> and <a href="#type-name-:3Etype-code" title="description of type-name->type-code">type-name-&gt;type-code</a> for  more information on type-codes and their translations. </li></ul>
</div>
</div>
  
<a name="function.upi:3C" id="function.upi:3C"></a>
<a name="upi:3C" id="upi:3C"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi&lt;</span>
<span class="documentation-arguments"><span class="argument">upi-1</span> &nbsp;<span class="argument">upi-2</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Compare <code>upi-1</code> and <code>upi-2</code> bytewise and return true if <code>upi-1</code> is less than <code>upi-2</code>. 
</div>
</div>
  
<a name="function.upi:3C:3D" id="function.upi:3C:3D"></a>
<a name="upi:3C:3D" id="upi:3C:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi&lt;=</span>
<span class="documentation-arguments"><span class="argument">u1</span> &nbsp;<span class="argument">u2</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Compare <code>upi-1</code> and <code>upi-2</code> bytewise and return true if <code>upi-1</code> is less or equal than <code>upi-2</code>. 
</div>
</div>
  
<a name="function.upi:3D" id="function.upi:3D"></a>
<a name="upi:3D" id="upi:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi=</span>
<span class="documentation-arguments"><span class="argument">upi-1</span> &nbsp;<span class="argument">upi-2</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Test if two UPIs are equal. UPIs are equal if they are eq (i.e., the same object) or if they are equal as octet arrays. 
</div>
</div>
  
<a name="function.upip" id="function.upip"></a>
<a name="upip" id="upip"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upip</span>
<span class="documentation-arguments"><span class="argument">thing</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns true if <code>thing</code> appears to be a UPI. Recall that every UPI is a octet array 12 bytes in length but not every length 12 octet array is a UPI. It is possible, therefore, that <code>upip</code> will return true even if <code>thing</code> is not a UPI. 
</div>
</div>
  
<a name="function.value-:3Eupi" id="function.value-:3Eupi"></a>
<a name="value-:3Eupi" id="value-:3Eupi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">value-&gt;upi</span>
<span class="documentation-arguments"><span class="argument">value</span> &nbsp;<span class="argument">encode-as</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a <code>UPI</code> that encodes <code>value</code> using type <code>encode-as</code>. </p><p><code>encode-as</code> can be a type-code or a type-name (see <a href="#supported-types" title="description of supported-types">supported-types</a> and <a href="#type-name-:3Etype-code" title="description of type-name->type-code">type-name-&gt;type-code</a> for details. If a <code>upi</code> keyword argument is not supplied, then a new UPI will be created. See <a href="#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> for information on retrieving the original value back from an encoded UPI. </p><p>The allowable value for <code>value</code> varies depending on the type into which it is being encoded. If the type is numeric, then value may be either a string representing a number in XSD format or a number.  If the type is a date, time or dateTime, then value may be a string representing an XSD value of the appropriate type, or a number in extended universal time (this number will be assumed to have its timezone in GMT), or a cons whose <code>car</code> is a number representing an extended universal time and whose <code>cdr</code> is either <code>t</code>, <code>nil</code>, or an integer representing the timezone offset in minutes from GMT. If the <code>cdr</code> is nil, then the date or time will have no timezone information; if it is <code>t</code>, then the date or time will be in GMT. Here are some examples: </p>
<pre><code>&gt; (part-&gt;string (value-&gt;upi 2 :byte))  
"2"^^&lt;http://www.w3.org/2001/XMLSchema#byte&gt;  
 
&gt; (part-&gt;string (value-&gt;upi "23.5e2" :double-float))  
"2.35E3"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt;  
 
&gt; (part-&gt;string (value-&gt;upi (get-universal-time) :time))  
"18:36:54"^^&lt;http://www.w3.org/2001/XMLSchema#time&gt;  
 
&gt; (part-&gt;string (value-&gt;upi (cons (get-universal-time) -300) :time))  
"13:37:08-05:00"^^&lt;http://www.w3.org/2001/XMLSchema#time&gt;  
 
&gt; (part-&gt;string (value-&gt;upi (cons (get-universal-time) nil) :date-time))  
"2015-03-31T18:39:08"^^&lt;http://www.w3.org/2001/XMLSchema#dateTime&gt; </code></pre><p>Note the lack of timezone in the final example. </p><p>Note that <code>value-&gt;upi</code> can not create <em>hashed</em> UPIs (i.e., UPIs whose value must be stored in the string dictionary. To create these, use <a href="#intern-resource" title="description of intern-resource">intern-resource</a> and <a href="#intern-literal" title="description of intern-literal">intern-literal</a>. </p>
</div>
</div>
  <h5>Comparing parts of triples</h5>
<a name="function.graph-part:3D" id="function.graph-part:3D"></a>
<a name="graph-part:3D" id="graph-part:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">graph-part=</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="argument">part</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return true if and only if the graph field of <code>triple</code> is the same as <code>part</code> using <a href="#functor.part:3D" title="description of functor part=">part=</a> for comparison. The <code>part</code> may be a UPI, a string (in N-Triples syntax) that can be converted to a UPI, or a <a href="#ref-future-parts" title="">future-part</a>. See <a href="#graph-upi:3D" title="description of graph-upi=">graph-upi=</a> if you know that you will be comparing UPIs. 
</div>
</div>
  
<a name="function.object-part:3D" id="function.object-part:3D"></a>
<a name="object-part:3D" id="object-part:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">object-part=</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="argument">part</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return true if and only if the object field of <code>triple</code> is the same as <code>part</code> using <a href="#functor.part:3D" title="description of functor part=">part=</a> for comparison. The <code>part</code> may be a UPI, a string (in N-Triples syntax) that can be converted to a UPI, or a <a href="#ref-future-parts" title="">future-part</a>. See <a href="#object-upi:3D" title="description of object-upi=">object-upi=</a> if you know that you will be comparing UPIs. 
</div>
</div>
  
<a name="function.predicate-part:3D" id="function.predicate-part:3D"></a>
<a name="predicate-part:3D" id="predicate-part:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">predicate-part=</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="argument">part</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return true if and only if the predicate field of <code>triple</code> is the same as <code>part</code> using <a href="#functor.part:3D" title="description of functor part=">part=</a> for comparison. The <code>part</code> may be a UPI, a string (in N-Triples syntax) that can be converted to a UPI, or a <a href="#ref-future-parts" title="">future-part</a>. See <a href="#predicate-upi:3D" title="description of predicate-upi=">predicate-upi=</a> if you know that you will be comparing UPIs. 
</div>
</div>
  
<a name="function.subject-part:3D" id="function.subject-part:3D"></a>
<a name="subject-part:3D" id="subject-part:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">subject-part=</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="argument">part</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return true if and only if the subject field of <code>triple</code> is the same as <code>part</code> using <a href="#functor.part:3D" title="description of functor part=">part=</a> for comparison. The <code>part</code> may be a UPI, a string (in N-Triples syntax) that can be converted to a UPI, or a <a href="#ref-future-parts" title="">future-part</a>. See <a href="#subject-upi:3D" title="description of subject-upi=">subject-upi=</a> if you know that you will be comparing UPIs. 
</div>
</div>
  
<a name="function.graph-upi:3D" id="function.graph-upi:3D"></a>
<a name="graph-upi:3D" id="graph-upi:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">graph-upi=</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return true if and only if the graph field of <code>triple</code> is the same as <code>upi</code> using <a href="#function.upi:3D" title="description of function upi=">upi=</a> for comparison. The <code>upi</code> must be a UPI. See <a href="#graph-part:3D" title="description of graph-part=">graph-part=</a> if you need to compare future-parts or convert strings into UPIs. 
</div>
</div>
  
<a name="function.object-upi:3D" id="function.object-upi:3D"></a>
<a name="object-upi:3D" id="object-upi:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">object-upi=</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return true if and only if the object field of <code>triple</code> is the same as <code>upi</code> using <a href="#function.upi:3D" title="description of function upi=">upi=</a> for comparison. The <code>upi</code> must be a UPI. See <a href="#object-part:3D" title="description of object-part=">object-part=</a> if you need to compare future-parts or convert strings into UPIs. 
</div>
</div>
  
<a name="function.predicate-upi:3D" id="function.predicate-upi:3D"></a>
<a name="predicate-upi:3D" id="predicate-upi:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">predicate-upi=</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return true if and only if the predicate field of <code>triple</code> is the same as <code>upi</code> using <a href="#function.upi:3D" title="description of function upi=">upi=</a> for comparison. The <code>upi</code> must be a UPI. See <a href="#predicate-part:3D" title="description of predicate-part=">predicate-part=</a> if you need to compare future-parts or convert strings into UPIs. 
</div>
</div>
  
<a name="function.subject-upi:3D" id="function.subject-upi:3D"></a>
<a name="subject-upi:3D" id="subject-upi:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">subject-upi=</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return true if and only if the subject field of <code>triple</code> is the same as <code>upi</code> using <a href="#function.upi:3D" title="description of function upi=">upi=</a> for comparison. The <code>upi</code> must be a UPI. See <a href="#subject-part:3D" title="description of subject-part=">subject-part=</a> if you need to compare future-parts or convert strings into UPIs. 
</div>
</div>
  <h5>Future-Parts and UPIs</h5><p>Future-parts (which are discussed in detail in their <a href="#ref-future-parts" title="">own section</a>) can take the place of UPIs in many of the functions above. For efficiencies sake, functions like <a href="#function.upi:3D" title="description of function upi=">upi=</a> assume that they are called with actual UPIs. AllegroGraph provides more general functions for the UPI only variants when it makes sense to do so. For example, <a href="#future-part:3D" title="description of future-part=">future-part=</a> works only with future-parts whereas <a href="#function.part:3D" title="description of function part=">part=</a> works equally well with any combination of UPIs, future-parts or even strings. </p>
<a name="structure.future-part" id="structure.future-part"></a>
<a name="future-part" id="future-part"></a>
<div class="documentation structure"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">future-part</span>
</div>
<span class="documentation-kind">structure</span>
</div>
<div class="documentation contents">A future-part defers namespace resolution and string <a href="#define-intern" title="">interning</a> until it is required. Along with the <a href="#ref-bang-reader" title="">!-reader</a>, they make writing and using UPIs significantly more readable and easier. 
</div>
</div>
  
<a name="function.future-part-extra" id="function.future-part-extra"></a>
<a name="future-part-extra" id="future-part-extra"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">future-part-extra</span>
<span class="documentation-arguments"><span class="argument">part</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return whatever is <code>extra</code> in the string of the <a href="#ref-future-parts" title="">future-part</a>. The meaning of extra depends on the <a href="#future-part-type" title="description of future-part-type">type</a> of the part: </p>
<ul>
<li>resource - the prefix (if applicable)</li>
<li>literal-typed - the datatype</li>
<li>literal-language - the language</li>
<li>other - the value will always be <code>nil</code></li></ul><p>See <a href="#future-part-type" title="description of future-part-type">future-part-type</a> and <a href="#future-part-value" title="description of future-part-value">future-part-value</a> if you need to access the part's other parts. </p>
</div>
</div>
  
<a name="function.future-part-type" id="function.future-part-type"></a>
<a name="future-part-type" id="future-part-type"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">future-part-type</span>
<span class="documentation-arguments"><span class="argument">part</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the name (a keyword) of the <a href="#ref-future-parts" title="">future-part</a>. See <a href="#type-name-:3Etype-code" title="description of type-name->type-code">type-name-&gt;type-code</a> for  a list of names. 
</div>
</div>
  
<a name="function.future-part-value" id="function.future-part-value"></a>
<a name="future-part-value" id="future-part-value"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">future-part-value</span>
<span class="documentation-arguments"><span class="argument">part</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return the <code>value</code> of the <a href="#ref-future-parts" title="">future-part</a>. The meaning of value depends on the <a href="#future-part-type" title="description of future-part-type">type</a> of the part: </p>
<ul>
<li>resource - the namespace (if any)</li>
<li>literal-typed - the literal without the datatype</li>
<li>literal-language - the literal without the language</li>
<li>other - the value will always be <code>nil</code></li></ul><p>See <a href="#future-part-type" title="description of future-part-type">future-part-type</a> and <a href="#future-part-extra" title="description of future-part-extra">future-part-extra</a> if you need to access the others parts (no pun intended) of the part. </p>
</div>
</div>
  
<a name="function.future-part:3D" id="function.future-part:3D"></a>
<a name="future-part:3D" id="future-part:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">future-part=</span>
<span class="documentation-arguments"><span class="argument">part-1</span> &nbsp;<span class="argument">part-2</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Test if two future-parts are equal. Future-parts are equal if they both resolve to the same UPI or, if they cannot yet be resolved, if their strings are string=. 
</div>
</div>
  
<a name="function.make-future-part" id="function.make-future-part"></a>
<a name="make-future-part" id="make-future-part"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">make-future-part</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">value</span> &nbsp;<span class="argument">type</span> &nbsp;<span class="argument">extra</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Create a 'future' part that will intern itself in new triple stores as necessary. </p>
<ul>
<li><p><code>:type</code> - one of <code>:node</code>, <code>:literal</code>, <code>:literal/lang</code> or <code>:literal-typed</code>.</p></li>
<li><p><code>:value</code> and <code>:extra</code> - the contents of the part. Their meaning changes depending on <code>type</code>. If <code>type</code> is: </p>
<ul>
<li><p><code>:node</code> - <code>value</code> is the string representation of   the URIref and extra must be <code>nil</code>. </p></li>
<li><p><code>:literal</code> - <code>value</code> is the string contents of the literal and <code>extra</code> must be nil.</p></li>
<li><p><code>:literal/lang</code> - <code>value</code> is the string contents of the literal   and <code>extra</code> specifies the language. </p></li>
<li><code>:literal-typed</code> - value is the string contents of the literal   and <code>extra</code> specifies the datatype. </li></ul></li></ul>
</div>
</div>
  
<a name="function.part:3D" id="function.part:3D"></a>
<a name="part:3D" id="part:3D"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">part=</span>
<span class="documentation-arguments"><span class="argument">part-1</span> &nbsp;<span class="argument">part-2</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Compare any two things that can be coerced into UPIs as UPIs. 
</div>
</div>
  
<a name="function.upi" id="function.upi"></a>
<a name="upi" id="upi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">errorp</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the UPI associated with <code>part</code>. </p><p><code>part</code> may be a UPI or a future-part. If <code>part</code> is a future-part that uses namespaces, then calling <code>upi</code> will resolve the namespace mapping. An error will be signaled if <code>upi</code> is called and there is no namespace mapping defined. You can use the <code>errorp</code> keyword parameter to disable the error and return <code>nil</code> instead. </p><p>An error will also be signaled if <code>upi</code> is called on something other than a UPI or a future-part. </p>
</div>
</div>
   <a name='triple-attributes-ref' id='triple-attributes-ref'></a> <h3>Triple Attributes</h3> <p>Triple attributes are name/value pairs of strings that can be attached to triples. They can be used to filter queries so that only triples whose attributes match the filter are returned. Usage examples include only permitting users with the proper clearance to see particular triples. </p><p>Triple attributes are discussed in the document <a href="triple-attributes.html">Triple Attributes</a>. </p><p>Attributes may be added to triples when the triples are loaded from a file (see <a href="agload.html">Data Loading</a>) or added with functions like <a href="#add-triple" title="description of add-triple">add-triple</a>. Attributes must be defined before a triple with that attribute can be loaded. Attributes are defined with the following function: </p>
<a name="function.define-attribute" id="function.define-attribute"></a>
<a name="define-attribute" id="define-attribute"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">define-attribute</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">allowed-values</span> &nbsp;<span class="argument">ordered</span> &nbsp;<span class="argument">minimum-number</span> &nbsp;<span class="argument">maximum-number</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Establishes or updates a triple attribute definition. </p><p>Attributes must be defined before they can be used.  Defining an attribute establishes the name of an attribute and any constraints that should be placed on its use. </p><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>.  <code>name</code> is a string naming the attribute.  <code>allowed-values</code> must be a list of string values that this attribute is allowed to take on.  If the list is empty/nil, then this attribute will allow any string value.  If true, then the specified order of the <code>allowed-values</code> is significant. If 'false' or left unspecified then the order is not significant. Ordered attributes can be compared to one another. See the <a href="triple-attributes.html">triple attributes reference guide</a> for more information.  Specifies the minimum number of attributes of this type that must provided for each added triple. The default is 0.  Optionally specifies the maximum number of attributes of this type that may be provided for each added triple.  The default when <code>ordered</code> is true is 1. When <code>ordered</code> is false, the default is 1,152,921,504,606,846,975. </p>
</div>
</div>
  <p>A <em>static attribute filter</em> (or simply <em>static filter</em>) specifies whether a triple is or is not visible based on its attributes. See the <a href="triple-attributes.html#static-filters">Static Filters</a> section of the <a href="triple-attributes.html">Triple Attributes</a> document. The following function reads and with <strong>setf</strong> sets the static filter. </p>
<a name="function.static-attribute-filter" id="function.static-attribute-filter"></a>
<a name="static-attribute-filter" id="static-attribute-filter"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">static-attribute-filter</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the current static attribute filter for the triple store. </p><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
  <p>Set the static attribute filter with a form like the following: </p>
<pre><code>(setf (static-attribute-filter :db *db*)  
   "(and  
      (attribute&gt;= user.access-level triple.access-level)  
      (attribute-contains-one-of user.department triple.department))")  
</code></pre><h4>Saving and Getting Metadata</h4><p>The following functions allow you to get, set, load and save metadata associated with a database. Metadata includes attribute definitions and static filter definitions. </p>
<a name="function.get-metadata" id="function.get-metadata"></a>
<a name="get-metadata" id="get-metadata"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-metadata</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a subset of the store's metadata. Currently it returns the attribute definitions and static filter definition. The value may be saved or passed later to <a href="#set-metadata" title="description of set-metadata">set-metadata</a>; it must not be modified. </p><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
  
<a name="function.set-metadata" id="function.set-metadata"></a>
<a name="set-metadata" id="set-metadata"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">set-metadata</span>
<span class="documentation-arguments"><span class="argument">metadata</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Merge the metadata in the <code>metadata</code> argument into the current metadata for the database. It is not currently permitted to change an attribute definition and doing so will result in an error. The metadata value must have come from an earlier call to <a href="#get-metadata" title="description of get-metadata">get-metadata</a>. After calling this function a <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> must be done to make the changes persistent. </p><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>.  A string containing the metadata </p>
</div>
</div>
  
<a name="function.load-metadata" id="function.load-metadata"></a>
<a name="load-metadata" id="load-metadata"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">load-metadata</span>
<span class="documentation-arguments"><span class="argument">filename</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Reads the metadata from <code>filename</code> and merges it into the existing metadata by calling <a href="#set-metadata" title="description of set-metadata">set-metadata</a>. An attempt to change the definition of an attribute will signal an error. A <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> needs to be done after this to make the changes persistent. 
</div>
</div>
  
<a name="function.save-metadata" id="function.save-metadata"></a>
<a name="save-metadata" id="save-metadata"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">save-metadata</span>
<span class="documentation-arguments"><span class="argument">filename</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">if-exists</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">This function uses <a href="#get-metadata" title="description of get-metadata">get-metadata</a> to obtain the current metadata and saves it to the file named by <code>filename</code>. The <code>if-exists</code> argument is passed to the <strong>open</strong> function to determine how to handle the case where the file already exists. 
</div>
</div>
   <a name='ref-querying-triples' id='ref-querying-triples'></a> <h3>Querying Triples</h3> <p>You can get triples out of a triple-store as a list or a cursor. The list structure is convenient but unwieldy if your query returns millions of triples (since every triple must be returned before you will see any of them). A cursor is like a <a href="http://en.wikipedia.org/wiki/Cursor_">database cursor</a> from the RDBMS-world. It lets you traverse through the results of your query one step at a time. </p><a name='ref-cursors' id='ref-cursors'></a> <h4>Cursors</h4><p>Cursors supply the functions <a href="#cursor-next" title="description of cursor-next">cursor-next</a> and <a href="#cursor-row" title="description of cursor-row">cursor-row</a> for basic forward iteration. For convenience we include <a href="#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> which advances the cursor and returns the next row immediately. Cursors reuse the <code>triple</code> data-structure as they move through the result set so if you want to accumulate triples, make sure to use the <a href="#copy-triple" title="description of copy-triple">copy-triple</a> function. </p><p>The function <a href="#discard-cursor" title="description of discard-cursor">discard-cursor</a> closes a cursor. You should close cursors when you are done with them so that the resources they use can be released. Code which leaves unneeded cursors open can cause program failure because of resource exhaustion. (Such code is said to <em>leak cursors</em>.) </p><p>Once a cursor has been closed, trying to access it may cause program failures which are difficult to diagnose. Use care not to attempt to access closed cursors. </p><p>The macro <a href="#with-query-environment" title="description of with-query-environment">with-query-environment</a> ensures all cursors opened during the execution of its body are closed when the body completes. </p>
<a name="function.cursor-next" id="function.cursor-next"></a>
<a name="cursor-next" id="cursor-next"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">cursor-next</span>
<span class="documentation-arguments"><span class="argument">cursor</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Moves <code>cursor</code> forward to the next record in the collection. </p><p>Returns <code>t</code> if there was another row on which to move and nil if the cursor is exhausted. I.e., if <code>cursor-next</code> returns <code>t</code>, then <a href="#cursor-row" title="description of cursor-row">cursor-row</a> will return a record. </p><p>Note that <a href="#cursor-row" title="description of cursor-row">cursor-row</a> and <a href="#cursor-next" title="description of cursor-next">cursor-next</a> are lower-level cursor manipulation routines. You may be better served by using <a href="#collect-cursor" title="description of collect-cursor">collect-cursor</a>, <a href="#count-cursor" title="description of count-cursor">count-cursor</a>, <a href="#map-cursor" title="description of map-cursor">map-cursor</a> and <a href="#iterate-cursor" title="description of iterate-cursor">iterate-cursor</a>. </p>
</div>
</div>
  
<a name="function.cursor-next-row" id="function.cursor-next-row"></a>
<a name="cursor-next-row" id="cursor-next-row"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">cursor-next-row</span>
<span class="documentation-arguments"><span class="argument">cursor</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the next record from the cursor. Data structures holding the record might be reused, so if you want to hold onto, for example, a triple for use after you advance the cursor, use the function <a href="#copy-triple" title="description of copy-triple">copy-triple</a> to make a copy of the value returned by <a href="#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> </p><p>Note that <a href="#cursor-row" title="description of cursor-row">cursor-row</a>, <a href="#cursor-next" title="description of cursor-next">cursor-next</a> and <a href="#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> are lower-level cursor manipulation routines. You may be better served by using <a href="#collect-cursor" title="description of collect-cursor">collect-cursor</a>, <a href="#count-cursor" title="description of count-cursor">count-cursor</a>, <a href="#iterate-cursor" title="description of iterate-cursor">iterate-cursor</a> and <a href="#map-cursor" title="description of map-cursor">map-cursor</a>. </p>
</div>
</div>
  
<a name="function.cursor-row" id="function.cursor-row"></a>
<a name="cursor-row" id="cursor-row"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">cursor-row</span>
<span class="documentation-arguments"><span class="argument">cursor</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the record that <code>cursor</code> is currently pointing at. </p><p>If the cursor is exhausted, then <code>cursor-row</code> returns <code>nil</code>. </p><p>Note that <a href="#cursor-row" title="description of cursor-row">cursor-row</a> and <a href="#cursor-next" title="description of cursor-next">cursor-next</a> are lower-level cursor manipulation routines. You may be better served by using <a href="#collect-cursor" title="description of collect-cursor">collect-cursor</a>, <a href="#count-cursor" title="description of count-cursor">count-cursor</a>, <a href="#map-cursor" title="description of map-cursor">map-cursor</a> and <a href="#iterate-cursor" title="description of iterate-cursor">iterate-cursor</a>. </p>
</div>
</div>
  <p>There are several natural cursor idioms, the following functions handle many of them. We suggest building your own functions using these as building blocks since there may be internal optimizations made possible only through these.
<a name="fnr4-2018-06-08" id="fnr4-2018-06-08"></a>
<sup><a href="#fn4-2018-06-08">5</a></sup>  </p>
<a name="function.collect-cursor" id="function.collect-cursor"></a>
<a name="collect-cursor" id="collect-cursor"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">collect-cursor</span>
<span class="documentation-arguments"><span class="argument">cursor</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">transform</span> &nbsp;<span class="argument">retain</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Iterate over <code>cursor</code> and collect a list of its rows. </p><p>The <code>:retain</code> keyword argument controls whether or not <code>cursor</code> will be discarded at the end of iteration. If it is false (which is the default) then the cursor <em>will be</em> discarded. </p><p>The <code>:transform</code> keyword can be used to modify the rows as they are collected. Rows may be re-used so the caller must ensure that copies are made if necessary. As an example, consider the difference between </p>
<pre><code>(collect-cursor (get-triples)) </code></pre><p>and </p>
<pre><code>(collect-cursor (get-triples) :transform #'copy-triple) </code></pre><p>Because the rows are re-used, the former will return a list of the same triple repeated as many times as there are triples in the store. The later will return a list of all of the triples in the store (which is probably what you intend!). </p><p>Note that the idiom above is so common that <a href="#collect-triples" title="description of collect-triples">collect-triples</a> is already defined. </p>
</div>
</div>
  
<a name="function.count-cursor" id="function.count-cursor"></a>
<a name="count-cursor" id="count-cursor"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">count-cursor</span>
<span class="documentation-arguments"><span class="argument">cursor</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">retain</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the number of triples remaining in a cursor <em>and</em> also exhausts cursor in the process. </p><p>The cursor will be discarded unless <code>retain</code> is true. </p>
</div>
</div>
  
<a name="macro.iterate-cursor" id="macro.iterate-cursor"></a>
<a name="iterate-cursor" id="iterate-cursor"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">iterate-cursor</span>
<span class="documentation-arguments">(<span class="argument">var</span> &nbsp;<span class="argument">cursor</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">count</span> &nbsp;<span class="argument">retain</span> &nbsp;<span class="argument">resume-current?</span>) &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Iterate over the triples in <code>cursor</code> binding <code>var</code> to each triple. Use the <code>:count</code> keyword with a fixnum value to limit the maximum number of triples that <code>iterate-cursor</code> visits.  The binding to <code>var</code> is the same <code>eq</code> triple in each iteration.  Make sure to use <a href="#copy-triple" title="description of copy-triple">copy-triple</a> if you are retaining any of the triples that you visit. </p><p>The macro creates a block nil around its expansion.  If iteration finishes normally by satisfying the count or by exhausting the cursor, <code>iterate-cursor</code> returns the number of triples visited. </p><p>Unless <code>retain</code> evaluates to true, <code>iterate-cursor</code> will call discard-cursor before returning <em>if</em> the cursor is exhausted. I.e., if you use <code>count</code> so that not all of the rows in the cursor are processed, then it will not be discarded. </p>
</div>
</div>
  
<a name="function.map-cursor" id="function.map-cursor"></a>
<a name="map-cursor" id="map-cursor"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-cursor</span>
<span class="documentation-arguments"><span class="argument">count</span> &nbsp;<span class="argument">fn</span> &nbsp;<span class="argument">cursor</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Iterate over the triples in <code>cursor</code> while applying the function <code>fn</code> to each one. Use the <code>count</code> keyword to limit the maximum number of triples that <code>map-cursor</code> visits. In each iteration <code>fn</code> is applied to the current triple and to the list of arguments in <code>args</code>. </p><p><code>map-cursor</code> reuses a single triple as it iterates so make sure to use <a href="#copy-triple" title="description of copy-triple">copy-triple</a> if you want to retain any of the triples you visit. </p><p>The function returns the number of triples visited. </p>
</div>
</div>
  
<a name="function.collect-triples" id="function.collect-triples"></a>
<a name="collect-triples" id="collect-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">collect-triples</span>
<span class="documentation-arguments"><span class="argument">cursor</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Collect the triples from <code>cursor</code> into a list. </p><p>Uses <a href="#collect-cursor" title="description of collect-cursor">collect-cursor</a> with a transform of <a href="#copy-triple" title="description of copy-triple">copy-triple</a> to return a fresh list of the triples in <code>cursor</code>. <code>collect-triples</code> assumes that <code>cursor</code> iterates over triples. Returns the list. </p>
</div>
</div>
  
<a name="function.discard-cursor" id="function.discard-cursor"></a>
<a name="discard-cursor" id="discard-cursor"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">discard-cursor</span>
<span class="documentation-arguments"><span class="argument">cursor</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Perform cleanups and free resources associated with <code>cursor</code>. It is illegal to call any function on the cursor after it's discarded, but repeated <code>discard-cursor</code> calls are allowed. 
</div>
</div>
  <p>There are also functions which take a cursor as input and return a new cursor with additional or modified behavior. These include transform cursors and peekable cursors. </p><h4>Transform cursors</h4>
<a name="function.make-transform-cursor" id="function.make-transform-cursor"></a>
<a name="make-transform-cursor" id="make-transform-cursor"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">make-transform-cursor</span>
<span class="documentation-arguments"><span class="argument">inner</span> &nbsp;<span class="argument">transform</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">variables</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a cursor that applies <code>transform</code> to each row of <code>inner</code> before it is returned. </p><p>Transform is a function of one argument (the inner cursor's <code>row</code>) and should return a single value (the transformed <code>row</code>). The transform function can perform arbitrary computation and mutation on the row but cannot assume that it will get the same (<code>eq</code>) row on each call. </p><p>The optional <code>variables</code> argument provides a means to set the new cursor's variables. </p>
</div>
</div>
  <p><a name="peek-cursor"></a> </p><h4>Peekable cursors</h4><p>Peekable cursors allow peeking at the <a href="#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a>. <em>Peeking</em> means seeing the value but not changing the state of the cursor. These functions create and get a value from a peekable cursor: </p>
<a name="function.make-peekable-cursor" id="function.make-peekable-cursor"></a>
<a name="make-peekable-cursor" id="make-peekable-cursor"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">make-peekable-cursor</span>
<span class="documentation-arguments"><span class="argument">cursor</span> &nbsp;<span class="argument">row-creator-function</span> &nbsp;<span class="argument">row-copier-function</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Create a <code>peekable-cursor</code> out of <code>cursor</code>.    <code>row-creator-function</code> is a function of no arguments that creates a new    instance of whatever <code>cursor</code> yields.    <code>row-copier-function</code> is a function of on e argument that returns a copy    of  whatever <code>cursor</code> yields. 
</div>
</div>
  
<a name="function.make-triples-peekable-cursor" id="function.make-triples-peekable-cursor"></a>
<a name="make-triples-peekable-cursor" id="make-triples-peekable-cursor"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">make-triples-peekable-cursor</span>
<span class="documentation-arguments"><span class="argument">thing</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Convert <code>thing</code> (a cursor, a db or a list of triples) into    a peekable-cursor. If <code>thing</code> is a cursor or list then it    must it yield / contain triples. 
</div>
</div>
  
<a name="function.cursor-peek" id="function.cursor-peek"></a>
<a name="cursor-peek" id="cursor-peek"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">cursor-peek</span>
<span class="documentation-arguments"><span class="argument">peekable-cursor</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return what <code>cursor-next-row</code> would return without advancing the cursor. 
</div>
</div>
  <p>There are many other functions that either query a triple-store directly or return information about a triple-store. For example, <a href="#count-query" title="description of count-query">count-query</a> determines the number of matches to a query very quickly (because it doesn't bother to iterate over them) and <a href="#pprint-subject" title="description of pprint-subject">pprint-subject</a> lets you easily explore more about particular resources. </p>
<a name="function.count-query" id="function.count-query"></a>
<a name="count-query" id="count-query"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">count-query</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span> &nbsp;<span class="argument">s-end</span> &nbsp;<span class="argument">p-end</span> &nbsp;<span class="argument">o-end</span> &nbsp;<span class="argument">g-end</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return the number of triples in <code>db</code> matching the query. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p>The keyword arguments <code>s</code>, <code>p</code>, <code>o</code>, <code>g</code>, <code>s-end</code>, <code>p-end</code>, <code>o-end</code> and <code>g-end</code> are used as in <a href="#get-triples" title="description of get-triples">get-triples</a>. </p><p>Note that the count includes deleted triples, encoded triples and unencoded triples. Finally, no filter can be used with a count query. </p>
</div>
</div>
  
<a name="function.estimated-count-query" id="function.estimated-count-query"></a>
<a name="estimated-count-query" id="estimated-count-query"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">estimated-count-query</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span> &nbsp;<span class="argument">s-end</span> &nbsp;<span class="argument">p-end</span> &nbsp;<span class="argument">o-end</span> &nbsp;<span class="argument">g-end</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return an <em>estimated</em> count of the number of triples in <code>db</code> matching the query. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p>The keyword arguments <code>s</code>, <code>p</code>, <code>o</code>, <code>g</code>, <code>s-end</code>, <code>p-end</code>, <code>o-end</code> and <code>g-end</code> are used as in <a href="#get-triples" title="description of get-triples">get-triples</a>. </p><p>Note that the estimated count may include deleted triples. </p>
</div>
</div>
  
<a name="function.get-triple" id="function.get-triple"></a>
<a name="get-triple" id="get-triple"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triple</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">return-encoded-triples</span> &nbsp;<span class="argument">return-non-encoded-triples</span> &nbsp;<span class="argument">filter</span> &nbsp;<span class="argument">triple</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Searches in <code>db</code> for a triple matching the search pattern specified by <code>s</code>, <code>p</code>, <code>o</code> and <code>g</code> (perhaps restricting the search to encoded triples only if <code>return-non-encoded-triples</code> is <code>nil</code>, or to non-encoded triples only if <code>return-encoded-triples</code> is <code>nil</code>). <code>filter</code>, if supplied, should be a predicate of one parameter, a triple. If the filter function returns <code>nil</code> on a possible match, that match is skipped. Searching is stopped when a match (which passes the <code>filter</code>, if supplied) is found. </p><p>If a match is found and <code>triple</code> is supplied (it must be of type triple), the match is copied to <code>triple</code> and <code>triple</code> is returned. If <code>triple</code> is not supplied, a new triple is created (as if with <a href="#make-triple" title="description of make-triple">make-triple</a>), the match is copied onto the new triple and the new triple is returned. </p><p>If no match is found, <code>nil</code> is returned. </p><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
  
<a name="function.get-triple-by-id" id="function.get-triple-by-id"></a>
<a name="get-triple-by-id" id="get-triple-by-id"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triple-by-id</span>
<span class="documentation-arguments"><span class="argument">id</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">triple</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Locate the triple whose <code>triple-id</code> is <code>id</code> and return it. Return nil if there is no triple associated with <code>id</code>. The keyword argument <code>db</code> can be used to specify the triple-store in which to search. It defaults to the current triple-store, <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. <strong>get-triple-by-id</strong> allocates a new triple (using <a href="#make-triple" title="description of make-triple">make-triple</a>). You can prevent this by passing in your own triple using the keyword argument <code>:triple</code>. The data in the triple you pass in will by overwritten. </p><p>Note that this function can return a triple and then later (after you've done a commit or rollback) return nil because another user removed it. These removals are transactional, which means the behavior can change (from returning a triple to returning nil) only after a commit or a rollback. </p>
</div>
</div>
  
<a name="function.get-triples" id="function.get-triples"></a>
<a name="get-triples" id="get-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span> &nbsp;<span class="argument">s-end</span> &nbsp;<span class="argument">p-end</span> &nbsp;<span class="argument">o-end</span> &nbsp;<span class="argument">g-end</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">return-encoded-triples</span> &nbsp;<span class="argument">return-non-encoded-triples</span> &nbsp;<span class="argument">return-extended-triples</span> &nbsp;<span class="argument">attribute-filter</span> &nbsp;<span class="argument">filter</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Query a triple store for triples matching the given subject, predicate, object, and graph. These can be specified either as UPIs, <a href="#ref-future-parts" title="">future-parts</a>, strings in N-Triple format, or the wildcard <code>nil</code>. Returns a cursor object that can be used with <a href="#cursor-row" title="description of cursor-row">cursor-row</a>, <a href="#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> and other cursor functions. </p><p>The following example finds every triple that starts with <code>!ub:Kevin</code>. </p>
<pre><code>&gt; (add-triple !ub:Kevin !ub:isa !"programmer")  
8523645  
&gt; !ub:Kevin  
!&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#Kevin&gt;  
&gt; (get-triples :s !ub:Kevin)  
#&lt;row-cursor #&lt;triple-record-file @ #x13c1a87a&gt; 2019 [1 - 2018] @  
  #x14942bba&gt;  
&gt; (print-triples *)  
&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#Kevin&gt;  
  &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#isa&gt;  
  "programmer" . </code></pre><p>The function <code>get-triples</code> takes the following arguments: </p>
<ul>
<li><p><code>s</code>, <code>p</code>, <code>o</code>, <code>g</code> - specify the query pattern. Use <code>nil</code> as a wildcard. Each of these can be a UPI, a future-part, or a string that can be converted into a part. These can also take on the value :minimum <em>if</em> a corresponding <code>?-end</code> parameter is specified.  If :minimum is used, then the range query will run from the smallest value up to the ending value. </p></li>
<li><p><code>s-end</code>, <code>p-end</code>, <code>o-end</code>, <code>g-end</code> - Allows for range queries over encoded triples (triples whose parts are encoded UPIs). Each <code>?-end</code> parameter may only be used in conjunction with its corresponding starting value parameter. Each of these can be a UPI, a future-part, or a string that can be converted into a part. These can also take on the value :maximum <em>if</em> a corresponding starting parameter is specified.  If :maximum is used, then the range query will run from the starting value up to the maximum value in the triple-store. </p></li>
<li><p>The <code>:db</code> keyword argument specifies the triple store to query and  defaults to the value of <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p></li>
<li><p>filter - if supplied, the <code>filter</code> should be a predicate of one parameter, a triple. If the filter function returns <code>nil</code>, then the triple will not be included in the result set.</p></li>
<li><p>return-encoded-triples - If true, then get-triples returns triples with encoded parts; i.e., triples that use directly encoded UPIs rather than strings stored in the dictionary. The default value is true. </p></li>
<li><p>return-non-encoded-triples - if true, then <code>get-triples</code> will return triples all of whose UPIs are stored as strings. This is set to true unless overridden. </p></li>
<li><p>return-extended-triples - if true, then get-triples will iterate over extended-triples (i.e., triples that contain both SPOG data and attribute data). </p></li></ul><p>The return value is a cursor object. The functions <a href="#collect-cursor" title="description of collect-cursor">collect-cursor</a>, <a href="#count-cursor" title="description of count-cursor">count-cursor</a> and <a href="#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> can be used to step through the cursor. </p><p>If it can be determined that one of the search parameters is not interned in the triple-store, then <code>get-triples</code> will return a <code>null-cursor</code> (i.e., a cursor that has no rows) and a second value of :part-not-found. </p><p>Note on tracing: get-triples can be inlined by the compiler, so if you want to trace get-triples calls, you should declare the function notinline. Alternatively, you can trace db.agraph::get-triples-real, the non-exported internal function, which the compiler macro uses. </p>
</div>
</div>
  
<a name="function.get-triples-list" id="function.get-triples-list"></a>
<a name="get-triples-list" id="get-triples-list"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-list</span>
<span class="documentation-arguments"><span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span> &nbsp;<span class="argument">s-end</span> &nbsp;<span class="argument">p-end</span> &nbsp;<span class="argument">o-end</span> &nbsp;<span class="argument">g-end</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">return-encoded-triples</span> &nbsp;<span class="argument">return-non-encoded-triples</span> &nbsp;<span class="argument">return-extended-triples</span> &nbsp;<span class="argument">cursor</span> &nbsp;<span class="argument">filter</span> &nbsp;<span class="argument">return-cursor</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Query a triple store for triples matching the given subject, predicate, object, and graph, specified either as part IDs (UPIs), <a href="#ref-future-parts" title="">future-parts</a>, strings in N-Triples format, or the wildcard <code>nil</code>. Returns a list of matching triples. The <code>get-triples-list</code> function supports a multitude of options: </p>
<ul>
<li><p><code>db</code> - This keyword argument specifies the triple store to query and defaults to the value of <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
<li><p><code>s</code>, <code>p</code>, <code>o</code>, <code>g</code> - controls the actual query pattern. Use <code>nil</code> as a wildcard.</p></li>
<li><p><code>s-end</code>, <code>p-end</code>, <code>o-end</code>, <code>g-end</code> - Allows for range queries over encoded triples (triples whose parts are encoded UPIs). Each <code>?-end</code> parameter may only be used in conjunction with its corresponding starting value parameter and only one range may be specified per query. </p></li>
<li><p><code>cursor</code> - if <code>cursor</code> is supplied then AllegroGraph will use it to return more triples rather than building a new cursor (i.e. the other query parameters will be ignored). </p></li>
<li><p><code>limit</code> - This keyword argument can be used to place a cap on the maximum number of triples returned. It defaults to the value of the special  variable *get-triples-list-limit*. If supplied, then<br />
<code>get-triples-list</code> will return no more than <code>:limit</code> triples.<br />
 If it is <code>nil</code>, then <code>get-triples-list</code> will return all of the triples found by the query. Warning: setting <code>limit</code> to <code>nil</code> can cause <code>get-triples-list</code> to return every triple in the triple-store;<br />
 this will take a very long time if the triple-store  is large. </p></li>
<li><p><code>return-encoded-triples</code> - If true, then get-triples-list returns triples with encoded parts; i.e., triples that use directly encoded UPIs rather than strings stored in the dictionary. The is set to true unless overridden. </p></li>
<li><p><code>return-non-encoded-triples</code> - if true, then <code>get-triples-list</code> will return triples all of whose UPIs are stored as strings. This is set to true unless overridden. </p></li>
<li><p>return-extended-triples - if true, then <code>get-triples-list</code> will iterate over extended-triples (i.e., triples that contain both SPOG data and attribute data). </p></li>
<li><p><code>return-cursor</code> - if true or if a cursor is passed in using the <code>cursor</code> argument, then the cursor used by get-triples-list is returned as the second value. If nil (which is the default), then the cursor that <code>get-triples-list</code> creates will be discarded. </p></li></li><p>Note that most of the arguments to <code>get-triples-list</code> do not make sense when reasoning is turned on. AllegroGraph will signal an error if you try to combine reasoning with other parameters that it cannot use. </p></ul><p>If it can be determined that one of the search parameters is not interned in the triple-store, then <code>get-triples-list</code> will return immediately return <code>nil</code> and :part-not-found as multiple values. </p><p><code>get-triples-list</code> will return </p>
<ul>
<li><p>a list and a cursor if triples are found.</p></li>
<li><p>nil and t as multiple values if all search parameters are interned and no triples are found. </p></li>
<li><p>nil and :part-not-found as multiple values if one of the search parameters is not interned in the triple-store. </p></li></ul><p>If <code>nil</code> is returned, the second return value allows you to determine why. </p>
</div>
</div>
  
<a name="function.pprint-object" id="function.pprint-object"></a>
<a name="pprint-object" id="pprint-object"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">pprint-object</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Print information about <code>part</code> down to a maximum depth of <code>maximum-depth</code> using the format <code>format</code>. Triples for which part is an object and their <code>children</code> will be printed. See <a href="#part-:3Estring" title="description of part->string">part-&gt;string</a> for information about part printing. See <a href="#pprint-subject" title="description of pprint-subject">pprint-subject</a> to display information based on objects rather than subjects. </p><p>Note that <code>pprint-object</code> is designed to show the actual triples in a store. It uses <a href="#ground-triple-store" title="description of ground-triple-store">ground-triple-store</a> to remove one layer of reasoning from <code>db</code>. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
  
<a name="function.pprint-subject" id="function.pprint-subject"></a>
<a name="pprint-subject" id="pprint-subject"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">pprint-subject</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Print information about <code>part</code> down to a maximum depth of <code>maximum-depth</code> using the format <code>format</code>. Triples for which part is a subject and their <code>children</code> will be printed. See <a href="#part-:3Estring" title="description of part->string">part-&gt;string</a> for information about part printing. See <a href="#pprint-object" title="description of pprint-object">pprint-object</a> to display information based on subjects rather than objects. </p><p>Note that <code>pprint-subject</code> is designed to show the actual triples in a store.  It uses <a href="#ground-triple-store" title="description of ground-triple-store">ground-triple-store</a> to remove one layer of reasoning from <code>db</code>. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
  
<a name="function.triple-exists-p" id="function.triple-exists-p"></a>
<a name="triple-exists-p" id="triple-exists-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-exists-p</span>
<span class="documentation-arguments"><span class="argument">s</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">g</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">filter</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns true if a triple matching <code>s</code>, <code>p</code> and <code>o</code> (and optionally <code>g</code>) can be found in the designated triple-store. If left unspecified, the triple-store designated by <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a> will be searched. This is useful when you care only about the presence of a triple and not its contents. If you want to use the triple, then use <a href="#get-triple" title="description of get-triple">get-triple</a> instead. 
</div>
</div>
  
<a name="variable.:2Aget-triples-list-limit:2A" id="variable.:2Aget-triples-list-limit:2A"></a>
<a name="x:2Aget-triples-list-limit:2A" id="x:2Aget-triples-list-limit:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*get-triples-list-limit*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents"><p>The default number of triples to return from get-triples-list. </p><p>If <code>nil</code>, then all triples will be returned. This defaults to <code>nil</code>. </p>
</div>
</div>
  <a name='ref-range-queries' id='ref-range-queries'></a> <p>When extended triples (which include attributes) are returned by the various functions for getting triples (like <a href="#get-triples" title="description of get-triples">get-triples</a>), the following functions can be used to examine the extended triples. Extended triples are returned when the <code>return-extended-triples</code> keyword argument is true. </p>
<a name="function.extended-triple-triple" id="function.extended-triple-triple"></a>
<a name="extended-triple-triple" id="extended-triple-triple"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">extended-triple-triple</span>
<span class="documentation-arguments"><span class="argument">extended-triple</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the triple from an extended-triple structure. 
</div>
</div>
  
<a name="function.extended-triple-attributes" id="function.extended-triple-attributes"></a>
<a name="extended-triple-attributes" id="extended-triple-attributes"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">extended-triple-attributes</span>
<span class="documentation-arguments"><span class="argument">extended-triple</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">output</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the triple attributes from an extended-triple structure. </p><p>The format can be one of </p>
<ul>
<li><p>:probe - returns true if the extended-triple has any attributes and nil if it does not. </p></li>
<li><p>:json - returns a JSON representation of the attributes. The <code>output</code> parameter controls where the representation is printed. It can be a stream, a filename, <code>t</code> meaning to <code>*standard-output*</code>, or <code>nil</code> meaning to return a string (<code>nil</code> is the default). </p></li>
<li><p>:alist - returns an association list representing the attributes. Each element of the   list will be <code>(name . value)</code>. If a <code>name</code> has multiple values associated with it, then   then <code>value</code> will be a list. </p></li>
<li><p>:attributes-bag - returns the raw data structure representing the attributes. This structure is not documented and is subject to change and therefore its use is discouraged. Note that <code>:attributes-bag</code> is not supported on the remote Lisp client. </p></li></ul><p>Example: </p>
<pre><code>&gt; (setf et (first (get-triples-list :return-extended-triples t :limit 1)))  
(#&lt;extended-triple &lt;a b c G&gt; {"rank": "Low", "label": "test 1"}&gt;)  
 
&gt; (extended-triple-attributes et :json)  
"{\"rank\": \"Low\", \"label\": \"test 1\"}"  
 
&gt; (extended-triple-attributes et :alist)  
(("label" . "test 1") ("rank" . "Low")) </code></pre>
</div>
</div>
 
 <p>And this function will copy an extended triple: </p>
<a name="function.copy-extended-triple" id="function.copy-extended-triple"></a>
<a name="copy-extended-triple" id="copy-extended-triple"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">copy-extended-triple</span>
<span class="documentation-arguments"><span class="argument">extended-triple</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Creates a copy of the <code>extended-triple</code> 
</div>
</div>
  <h4>Range Queries</h4><p>Both <a href="#get-triples" title="description of get-triples">get-triples</a> and <a href="#get-triples-list" title="description of get-triples-list">get-triples-list</a> support fast <em>inclusive</em> range queries using AllegroGraph's <a href="#ref-encoded-data-types" title="">encoded data types</a>. Though RDF requires that subjects be resources or blank nodes and predicates by resources, AllegroGraph allows you to store and query for encoded data types in any of a triple's fields.
<a name="fnr5-2018-06-08" id="fnr5-2018-06-08"></a>
<sup><a href="#fn5-2018-06-08">6</a></sup>  In each case, to execute a range query, you must supply a starting and ending encoded UPI. You can only make a range query on a single field in each query but you can include other fields which act as additional filters. For example: </p>
<pre><code>&gt; (get-triples :o (value-&gt;upi "12:01" :time)  
               :o-end (value-&gt;upi "12:59" :time)  
               :p !ex:startTime) </code></pre><p>will return a <a href="#ref-cursors" title="">cursor</a> that iterates only all of the triples whose <a href="#function.predicate" title="description of function predicate">predicate</a> is <code>!ex:startTime</code> and whose object falls on or between 12:01 and 12:59.
<a name="fnr6-2018-06-08" id="fnr6-2018-06-08"></a>
<sup><a href="#fn6-2018-06-08">7</a></sup>  </p><h4>SPARQL Overview</h4><p>AllegroGraph includes an implementation of the powerful SPARQL query language. SPARQL is covered both in <a href="#ref-sparql" title="">this reference guide</a> and in the <a href="sparql-reference.html">SPARQL reference</a> and <a href="sparql-tutorial.html">tutorial</a>.   </p><h4>Prolog Select Overview</h4><p>With pure Lisp as the retrieval language, you use a combination of functional and procedural approaches to query the database. With Prolog, you can specify queries in a much more declarative manner. <a href="/support/documentation/current/doc/prolog.html" target="_blank">Allegro CL Prolog</a> and AllegroGraph work very well together. The reference guide includes <a href="#ref-prolog" title="">more details</a> and the <a href="prolog-tutorial.html">tutorial</a> provides an introduction to using Prolog and AllegroGraph with many complete examples. </p><h4>Query analysis</h4><p>There are tools for seeing what indices would be best to use when answering a query and what indices are actually used (these may not be the same because the optimal indices may not be available). See <a href="query-analysis.html">Query Analysis</a>. The following function does such analysis: </p>
<a name="function.analyze-query-index-usage" id="function.analyze-query-index-usage"></a>
<a name="analyze-query-index-usage" id="analyze-query-index-usage"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">analyze-query-index-usage</span>
<span class="documentation-arguments"><span class="argument">query</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">language</span> &nbsp;<span class="argument">technique</span> &nbsp;<span class="argument">duration</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Analyze the index usage for <code>query</code> using <code>technique</code>. </p><p>Determine which indices in query language <code>language</code> will access using technique <code>technique</code>. </p><p>Currently supports only SPARQL with one of the following techniques: </p>
<ul>
<li>executed - execute the query and monitor actual index usage; correct    but can be slow. </li>
<li>[unsupported] static - analyze the query algebraically; fast but can be wrong.</li></ul><p>The results are returned as lists of sub-lists where each sub-list looks like: </p>
<pre><code>(:desired (flavor mode) :actual (flavor mode)) </code></pre><p>where </p>
<ul>
<li>flavor - an index flavor</li>
<li>mode - optimal, suboptimal or full</li></ul><p>The first part of the list (:desired) is what AllegroGraph would most like assuming that every index flavor was available. The second part (:actual) is what AllegroGraph actually got given the current triple-store. </p><p>If supplied, <code>duration</code> specifies how long to run the analysis. The standard behavior is to run for as long as necessary. </p><p>The <code>static</code> technique is not supported in this version of AllegroGraph. It may be reinstated in a future version. </p>
</div>
</div>
  <h4>RDFS++ Reasoning Overview</h4><p>See the <a href="reasoner-tutorial.html" id="reasoner-tutorial-tab">Reasoner tutorial</a> for more details on using AllegroGraph's RDFS++ reasoner. It works with <a href="#get-triples" title="description of get-triples">get-triples</a>, <a href="#get-triples-list" title="description of get-triples-list">get-triples-list</a>, <a href="sparql-lisp-tutorial.html">SPARQL</a> and the Prolog <a href="#q" title="description of q">q</a> functor. </p><a name='ref-spogi-caching' id='ref-spogi-caching'></a> <h4>SPOGI Caching</h4><p>If you are running queries that gather a lot of triples about each particular subject, then AllegroGraph's <code>SPOGI</code> cache can help you to achieve significant performance improvements. Once enabled, the cache operates in the background and saves the triples associated with every <code>subject</code> / <code>predicate</code> pair that it encounters. This means that when you first execute a query like: </p>
<pre><code>&gt; (get-triples-list :s !ex:gary :p !ex:telephoneNumbers) </code></pre><p>AllegroGraph will scan all of the triples associated with the subject <code>!ex:gary</code> and cache the list of triples for each predicate. If you then execute another query involving <code>!ex:gary</code>, it will return the results almost instantly. The cache tracks changes to your triple-stores and will recompute its results whenever it changes. </p>
<a name="function.spogi-cache-size" id="function.spogi-cache-size"></a>
<a name="spogi-cache-size" id="spogi-cache-size"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">spogi-cache-size</span>
<span class="documentation-arguments"><span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Gets the size of the <code>spogi</code> cache. . </p><p>The cache size determines the maximum number of subjects that can be help in the cache at once. The value of <a href="#x:2Adefault-spogi-cache-size:2A" title="description of *default-spogi-cache-size*">*default-spogi-cache-size*</a> is used for newly created triple-stores. </p><p>You can use <code>(setf spogi-cache-size)</code> to change the size of the cache. For example: </p>
<pre><code>(setf (spogi-cache-size *db*) 10000) </code></pre>
</div>
</div>
 
 
<a name="function.spogi-cache-enabled-p" id="function.spogi-cache-enabled-p"></a>
<a name="spogi-cache-enabled-p" id="spogi-cache-enabled-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">spogi-cache-enabled-p</span>
<span class="documentation-arguments"><span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns true if the <code>spogi</code> cache is enabled for <code>db</code>. </p><p>You can use <code>(setf spogi-cache-enabled-p)</code> to turn caching on and off. When using the <code>setf</code> method, you can use a boolean or a whole number. If you use a whole number, it has the same effect as turning caching on and setting the <a href="#spogi-cache-size" title="description of spogi-cache-size">spogi-cache-size</a> to that value. For example: </p>
<pre><code>(setf (spogi-cache-enable *db*) t)	;turn the cache on  
(setf (spogi-cache-enable *db*) 5000)	;turn the cache on and set it to 5000 </code></pre>
</div>
</div>
 
 
<a name="variable.:2Adefault-spogi-cache-enabled:2A" id="variable.:2Adefault-spogi-cache-enabled:2A"></a>
<a name="x:2Adefault-spogi-cache-enabled:2A" id="x:2Adefault-spogi-cache-enabled:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*default-spogi-cache-enabled*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents"><p>Determines whether the SPOGI-cache is enabled for newly created triple-stores. </p><p>By default, this variable will be set to nil so that SPOGI-caching will not be in effect for newly created triple-stores. You will need to experiment with your data and queries to  determine whether or not the extra RAM used by the cache is worth the performance improvements. </p>
</div>
</div>
  
<a name="variable.:2Adefault-spogi-cache-size:2A" id="variable.:2Adefault-spogi-cache-size:2A"></a>
<a name="x:2Adefault-spogi-cache-size:2A" id="x:2Adefault-spogi-cache-size:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*default-spogi-cache-size*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents"><p>Sets the default size of the SPOGI-cache for newly created triple-stores. </p><p>By default, the SPOGI-cache-size is 100000. Note that caching will not be enabled for new triple-stores unless <a href="#x:2Adefault-spogi-cache-enabled:2A" title="description of *default-spogi-cache-enabled*">*default-spogi-cache-enabled*</a> is set to true. </p>
</div>
</div>
   <a name='header3-46' id='header3-46'></a><h3>Modifying triples</h3><p>AllegroGraph stores triples in five parts: subject, predicate, object, graph and ID. (<em>Triple</em> refers to the subject, predicate, and object.) RDF operations ignore the ID but it is still there under the hood. Once a triple has been added it cannot be changed (there is no in-place modification of triples). You make modifications by deleting (see <a href="#delete-triple" title="description of delete-triple">delete-triple</a>) and re-adding (see <a href="#add-triple" title="description of add-triple">add-triple</a>) a triple but the new triple will have a different ID from the old one. This is true regardless of the client used to effect the changes. </p><p>Note also that if original triple is committed and you evaluate: </p>
<pre><code>(delete-triple id)      ;; deleting the original triple  
(add-triple s p o :g g) ;; adding the modified triple  
(commit-triple-store) </code></pre><p> or </p>
<pre><code>(add-triple s p o :g g) ;; adding the modified triple  
(delete-triple id)      ;; deleting the original triple  
(commit-triple-store) </code></pre><p>then every other user will see the original triple until the commit is processed and they rollback and then they will see the new triple. Other users will never see neither triple nor both triples. So from the point of view of other users, the triple will simply be modified. </p><p>Note that SPARQL <strong>update</strong> has no notion of IDs (because it is an RDF language). Even though a SPARQL update may not be explicit about implementing triple modification by deleting and adding, that is what is in fact happening so there is no efficiency gain from using update though the code might be easier to understand. </p><p>Again, the new triple will always have a different id regardless of how the "modification" is actually done. </p><a name='ref-deleting-triples' id='ref-deleting-triples'></a> <h3>Deleting and purging triples</h3> <p>Triples can be deleted in AllegroGraph. The function <a href="#delete-triples" title="description of delete-triples">delete-triples</a> deletes triples from the triple store, using the same query syntax as <a href="#get-triples" title="description of get-triples">get-triples</a>. Once a transaction has committed (see <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a>), there is no way to restore a deleted triple. If you have not committed, then you can rollback (see <a href="#rollback-triple-store" title="description of rollback-triple-store">rollback-triple-store</a>) the transaction to restore any deleted triples <strong>and</strong> also undo any other changes made since the last commit (including additions). </p>
<a name="function.delete-triple" id="function.delete-triple"></a>
<a name="delete-triple" id="delete-triple"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">delete-triple</span>
<span class="documentation-arguments"><span class="argument">triple-or-triple-id</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Deletes the given triple from the triple store. <code>triple-or-triple-id</code> can be a triple object, or the id of a triple as returned by <a href="#function.triple-id" title="description of function triple-id">triple-id</a>. </p><p>The <code>:db</code> keyword argument specifies the triple store in which the triple should be deleted. It defaults to  <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p><code>delete-triple</code> returns <code>t</code> if the deletion succeeded, and <code>nil</code> if the triple id was invalid or the triple already deleted. </p><p><strong>Note</strong> <code>delete-triple</code> requires the <code>i</code> index in order to run efficiently. See <a href="#add-index" title="description of add-index">add-index</a> for details on how to manage a triple-store's indices. </p>
</div>
</div>
  
<a name="function.delete-triples" id="function.delete-triples"></a>
<a name="delete-triples" id="delete-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">delete-triples</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span> &nbsp;<span class="argument">s-end</span> &nbsp;<span class="argument">p-end</span> &nbsp;<span class="argument">o-end</span> &nbsp;<span class="argument">g-end</span> &nbsp;<span class="argument">filter</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Delete triples matching the given triple-pattern. </p><p>The triple-pattern is specified as in <a href="#get-triples" title="description of get-triples">get-triples</a> where each of <code>s</code>, <code>p</code>, <code>o</code>, <code>g</code>, <code>s-end</code>, <code>p-end</code>, <code>o-end</code> and <code>g-end</code> may be specified as part IDs, strings in N-Triples format, or the wildcard <code>nil</code>. Returns the number of triples deleted. </p><p>The <code>:db</code> keyword argument specifies the triple store to query and defaults to the value of <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p>The <code>:filter</code> keyword can be used to limit the triples deleted. If specified it should be a function predicate of one argument, a triple, which returns true if and only if the triple should be deleted. </p>
</div>
</div>
  <h4>Deleting Duplicate Triples</h4><p>Duplicate triples take up disk space and cause queries to take longer. Duplicate triples are discussed in <a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a>, which tells how to deal with duplicates using the various clients. To remove duplicates from a store using Lisp, run <a href="#delete-duplicate-triples" title="description of delete-duplicate-triples">delete-duplicate-triples</a> and commit. You can also arrange to have duplicates removed automatically at commit time, as specified by <a href="#duplicate-suppression-strategy" title="description of duplicate-suppression-strategy">duplicate-suppression-strategy</a>. You can get a list of duplicates (which will be deleted by <a href="#delete-duplicate-triples" title="description of delete-duplicate-triples">delete-duplicate-triples</a> with <a href="#get-duplicate-triples" title="description of get-duplicate-triples">get-duplicate-triples</a>. </p><p>If your store uses any triple-id based reification, note that only the triple with the lowest triple-id will be left alive after running this operation. In releases prior to 4.4, duplicate deletion was done in the background. Now it is only done with the explicit call to <a href="#delete-duplicate-triples" title="description of delete-duplicate-triples">delete-duplicate-triples</a>. </p>
<a name="function.delete-duplicate-triples" id="function.delete-duplicate-triples"></a>
<a name="delete-duplicate-triples" id="delete-duplicate-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">delete-duplicate-triples</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">mode</span> &nbsp;<span class="argument">commit</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Deletes duplicated triples from a store inside the current transaction. </p>
<ul>
<li><p><code>:db</code> - defaults to the value of <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a></p></li>
<li><p><code>:mode</code> - specifies  how triple equality is determined. It can be <code>:spog</code> or <code>:spo</code> and defaults to <code>:spog</code>. </p></li>
<li><code>:commit</code> - if true then commit before and after duplicates are deleted. A true value allows this function to process a very large number of deletes efficiently.</li></ul>
</div>
</div>
  
<a name="function.duplicate-suppression-strategy" id="function.duplicate-suppression-strategy"></a>
<a name="duplicate-suppression-strategy" id="duplicate-suppression-strategy"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">duplicate-suppression-strategy</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a keyword (or nil) specifying whether the store suppresses duplicate triples at commit time. <strong>setf</strong> may be used to change the strategy value: </p>
<pre><code>(duplicate-suppression-strategy) =&gt; nil  
(setf (duplicate-suppression-strategy) :spo)  
(duplicate-suppression-strategy) =&gt; :spo </code></pre><p>This setting specifies the way AllegroGraph manages duplicates at commit time: </p>
<ul>
<li><p><code>nil</code> - duplicate triples are not suppressed, they are committed as    usual. </p></li>
<li><p><code>:spo</code> - do not commit any triples whose subject, predicate and    object parts are duplicates of other triples. </p></li>
<li><p><code>:spog</code> - do not commit any triples whose subject, predicate,    object and graph parts are duplicates of other triples. </p></li></ul><p>With a non-nil setting, calling <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> will prevent any additional duplicate triples from being added to the store at commit time. </p><p>Changing this setting does not affect any potential duplicates that may already be present in the store. See <a href="#delete-duplicate-triples" title="description of delete-duplicate-triples">delete-duplicate-triples</a>. </p>
</div>
</div>
  
<a name="function.get-duplicate-triples" id="function.get-duplicate-triples"></a>
<a name="get-duplicate-triples" id="get-duplicate-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-duplicate-triples</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">mode</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a cursor of all duplicate triples visibile in db inside the current transaction. </p>
<ul>
<li><p><code>:db</code> - defaults to the value of <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a></p></li>
<li><code>:mode</code> - specifies how triple equality is determined. It can be <code>:spog</code> or <code>:spo</code> and defaults to <code>:spog</code>. </li></ul>
</div>
</div>
  <p><a name="purging-deleted-triples"></a> </p><h4>Purging Deleted Triples</h4><p>When triples are deleted, they are not immediately removed from indices because there may be transactions that still refer to the triples. Until all such transactions are committed or rolled back, the triples must stay in the indices. However, when all such transactions are committed or rolled back, the deleted triples become inaccessible and simply waste space in the indices. The following functions allow for purging inaccessible deleted triples from indices. See <a href="purging-deleted-triples.html">Purging Deleted Triples</a> for a complete discussion of deleted triple purging. Purging can be resource intensive so there are functions to cancel purging and to control the purge rate. Only Direct Lisp Client users and superusers can purge deleted triples. </p><p><a name="purge-deleted-triples"></a> </p>
<a name="function.purge-deleted-triples" id="function.purge-deleted-triples"></a>
<a name="purge-deleted-triples" id="purge-deleted-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">purge-deleted-triples</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">indices</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Schedules a background operation to purge deleted triples from the specified indices. </p><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>.  <code>indices</code> must be a list of indices to purge, or <code>nil</code> (the default) meaning purge all indices. </p>
</div>
</div>
  <p><a name="cancel-purge-deleted-triples"></a> </p>
<a name="function.cancel-purge-deleted-triples" id="function.cancel-purge-deleted-triples"></a>
<a name="cancel-purge-deleted-triples" id="cancel-purge-deleted-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">cancel-purge-deleted-triples</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">indices</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Cancels purge deleted triple job for the specified indices. </p><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>.  <code>indices</code> must be a list of indices to cancel purge operations on, or <code>nil</code> (the default) meaning stop purge operations on all indices. </p>
</div>
</div>
  <p><a name="purge-rate-limit"></a> </p>
<a name="function.purge-rate-limit" id="function.purge-rate-limit"></a>
<a name="purge-rate-limit" id="purge-rate-limit"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">purge-rate-limit</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the deleted triple purge operation rate limit (read IOs per second). <code>(setf purge-rate-limit)</code> may be used to change the value, with the change affecting ongoing purge operations. 0 means no limit. Note that the value is reset to 0 when the database instance is started (that is, a set value does not stick when a database instance is shut down). The maximum limit is 4,294,967,295. </p><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
   <a name='header3-58' id='header3-58'></a><h3>Serializing Triples</h3> <p>There are several methods by which you can create a textual representation of your triple-store: </p>
<ul>
<li><p>using <a href="#print-triples" title="description of print-triples">print-triples</a>,</p></li>
<li><p>using one of the serialization functions like <a href="#serialize-rdf:2Fxml" title="description of serialize-rdf/xml">serialize-rdf/xml</a> or <a href="#serialize-turtle" title="description of serialize-turtle">serialize-turtle</a> </p></li>
<li><p>using the serialization methods in AllegroGraph's <a href="sparql-reference.html">SPARQL sub-system</a>. </p></li></ul><p>The <a href="#print-triples" title="description of print-triples">print-triples</a> function provides a simple mechanism to output triples to <code>*standard-output*</code> or a stream. It's easy to build an export function on top of it: </p>
<pre><code>(defun export-triples (triples file)  
  (with-open-file (output file  
                          :direction :output  
                          :if-does-not-exist :create  
                          :if-exists :error)  
    (print-triples triples  
                   :limit nil :stream output :format :ntriple))) </code></pre><p>The other techniques provide more control over the output format. </p>
<a name="function.print-triple" id="function.print-triple"></a>
<a name="print-triple" id="print-triple"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">print-triple</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="argument">stream</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">error?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Print a triple returned by <a href="#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> or <a href="#get-triples-list" title="description of get-triples-list">get-triples-list</a>. </p><p>Returns the triple printed unless stream is nil in which case it returns the string representation. </p><p>If <code>stream</code> is not <code>nil</code>, then a newline will also be printed. </p><p>The keyword argument <code>:format</code>, which defaults to <code>:ntriples</code>, specifies the syntax to be used when printing the triple. It can be one of: </p>
<ul>
<li><code>:ntriple</code> or <code>:ntriples</code> - use N-Triples syntax,</li>
<li><code>:nquad</code> or <code>:nquads</code> - use N-Quads syntax (i.e., include the graph),</li>
<li><code>:ntriple-ascii</code> or <code>ntriples-ascii</code> - N-Triples with non-ASCII   and control characters escaped. </li>
<li><code>:nquad-ascii</code> or <code>nquads-ascii</code> - N-Quads with non-ASCII and control   characters escaped. </li>
<li><code>:long</code> - Synonym for <code>:nquads</code>.</li>
<li><code>:concise</code> or <code>:terse</code> - use a short or very short human readable but   possibly ambiguous representation. </li></ul><p>The default for <code>error?</code> is true; if <code>error?</code> is nil, then any UPIs which cannot be printed in humanly readable fashion will instead be printed in hex. </p><p>The <code>stream</code> argument can be used to send output to the stream of your choice. If left unspecified, then output will go to <em>standard-output</em>. It can be <code>nil</code> to indicate a string-stream. </p>
</div>
</div>
  
<a name="function.print-triples" id="function.print-triples"></a>
<a name="print-triples" id="print-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">print-triples</span>
<span class="documentation-arguments"><span class="argument">triple-container</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="argument">stream</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Display the triples in <code>triple-container</code> which can be either a triple store object, a list of triples such as is returned by <a href="#get-triples-list" title="description of get-triples-list">get-triples-list</a>, or a cursor such as is returned by <a href="#get-triples" title="description of get-triples">get-triples</a>. If the keyword argument <code>:limit</code> is supplied, then at most that many triples will be printed. The <code>:format</code> keyword argument controls how the triples will be displayed. The values <code>:ntriple</code> or <code>:ntriples</code> specify that they should be printed in N-Triples syntax. The values <code>:nquad</code> or <code>:nquads</code> specify that they should be printed in N-Quad syntax. The value <code>:long</code> is the same a <code>:ntriples</code>. The value <code>:ntriples-ascii</code> is the same as <code>:ntriples</code>, but all non-ascii characters will be escaped in the output. The value <code>:concise</code> means print the triple id, followed by the  triple values using prefixes when available (like <code>&lt;1986585: user:1076107471 rdf:type tp:User&gt;</code>). The value <code>:terse</code> means print triples with values only, without prefixes (like <code>&lt;1076107471 type User&gt;</code>). The default is <code>:ntriples</code>. The <code>stream</code> argument can be used to send output to the stream of your choice. If left unspecified, then output will go to <em>standard-output</em>. 
</div>
</div>
  
<a name="function.serialize-ntriples" id="function.serialize-ntriples"></a>
<a name="serialize-ntriples" id="serialize-ntriples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">serialize-ntriples</span>
<span class="documentation-arguments"><span class="argument">from</span> &nbsp;<span class="argument">to</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">ascii</span> &nbsp;<span class="argument">nquads</span> &nbsp;<span class="argument">base-uri</span> &nbsp;<span class="argument">if-exists</span> &nbsp;<span class="argument">if-does-not-exist</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Write an N-Triples representation of <code>from</code> to <code>to</code>. <code>from</code> should be a triple store, a list of triples, or a cursor. <code>to</code> should be a stream, a file path to open for writing, <code>t</code> (meaning <code>*standard-output*</code>), or <code>nil</code> (return a string). </p><p><code>if-exists</code> and <code>if-does-not-exist</code> are arguments to the Common Lisp <code>open</code> function which apply when <code>to</code> is a filename. </p><p>If <code>base-uri</code> is provided, it is used to generate a &#8220;baseURI:&#8221; comment at the start of the serialization. This comment is expected by TopBraid Composer. </p><p><code>base-uri</code> can be <code>t</code>, in which case a generated UUID URN is used, or a string, UPI, or <code>future-part</code> naming a URI. It can also be a triple-store instance; in this case, a UUID URN associated with the store is used. For persistent stores this value should remain constant. </p><p>The <code>nquads</code> argument causes this function to emit N-Quads instead of N-Triples. It is used by the function <a href="#serialize-nquads" title="description of serialize-nquads">serialize-nquads</a>. </p><p>In other respects this function behaves like <a href="#print-triples" title="description of print-triples">print-triples</a>. </p>
</div>
</div>
  
<a name="function.serialize-nquads" id="function.serialize-nquads"></a>
<a name="serialize-nquads" id="serialize-nquads"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">serialize-nquads</span>
<span class="documentation-arguments"><span class="argument">from</span> &nbsp;<span class="argument">to</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">base-uri</span> &nbsp;<span class="argument">if-exists</span> &nbsp;<span class="argument">if-does-not-exist</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Just like <a href="#serialize-ntriples" title="description of serialize-ntriples">serialize-ntriples</a> but emits quads in N-Quads format. </p><p>See <code>serialize-ntriples</code> for more information on the arguments to this function. </p>
</div>
</div>
  
<a name="function.serialize-rdf:2Fxml" id="function.serialize-rdf:2Fxml"></a>
<a name="serialize-rdf:2Fxml" id="serialize-rdf:2Fxml"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">serialize-rdf/xml</span>
<span class="documentation-arguments"><span class="argument">from</span> &nbsp;<span class="argument">to</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">memoize-abbrev-lookups-p</span> &nbsp;<span class="argument">prepare-namespaces-p</span> &nbsp;<span class="argument">output-types-p</span> &nbsp;<span class="argument">nestp</span> &nbsp;<span class="argument">error-on-invalid-p</span> &nbsp;<span class="argument">indent</span> &nbsp;<span class="argument">xml-base</span> &nbsp;<span class="argument">if-exists</span> &nbsp;<span class="argument">if-does-not-exist</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Write <code>from</code>, which should be a triple store, a list, or a cursor, to <code>to</code>,  which should be a stream, file path, <code>t</code> (print to <code>*standard-output*</code>), or <code>nil</code> (return a string). </p><p>If <code>from</code> is a <code>triple-store</code> or a list of triples, and <code>prepare-namespaces-p</code> is <code>t</code>, it is first traversed to build a hash of namespaces to prefixes for all properties in the store.  The current set of namespace abbreviations is used as a seed (see <code>display-namespaces</code>). </p><p>If you can ensure that every property used in the triple-store has a defined prefix, you can pass <code>nil</code> for <code>prepare-namespaces-p</code> to gain a speed improvement from omitting this phase. </p><p>If <code>error-on-invalid-p</code> is <code>t</code>, the serializer will throw an error if it encounters a type or predicate that it cannot abbreviate for RDF/XML. Ordinarily a local namespace declaration is included in such a property element instead. </p><p>If <code>from</code> is a cursor, it cannot be traversed multiple times, so <code>prepare-namespaces-p</code> is ignored. If a property is encountered that cannot be abbreviated with the current available prefixes, an error will be signaled or a local namespace declaration generated instead. </p><p>Such local namespace declarations are verbose, and so providing a thorough namespace hash is preferred. </p><p>If a predicate cannot be abbreviated as an XML QName, your graph <em>cannot</em> be serialized in RDF/XML. An error will be raised in this case. </p><p><code>if-exists</code> and <code>if-does-not-exist</code> are arguments to the Common Lisp <code>open</code> function which apply when <code>to</code> is a filename. </p><p><code>xml-base</code> can be <code>t</code>, in which case a generated UUID <code>xml:base</code> attribute is written into the serialized RDF/XML, or a string, UPI, or <code>future-part</code> naming a URI. It can also be a triple-store instance; in this case, a UUID URN associated with the store is used. </p><p>For persistent stores this value should remain constant. </p><p>If <code>xml-base</code> is <code>nil</code>, no xml:base attribute will appear in the output. </p><p>Note that <code>xml-base</code> values will be escaped, but they will not be checked for validity (i.e., you can successfully provide an invalid URI to this function). </p><p>If <code>memoize-abbrev-lookups-p</code> is <code>t</code>, a table is built to store the mappings between resources in the store and string abbreviations. This table will contain as many entries as there are types and properties in the data to be serialized. For some datasets disabling this caching will yield a significant reduction in space usage in exchange for a possible loss of speed. </p><p>If <code>indent</code> is non-<code>nil</code>, then it specifies the initial indentation of elements. </p><p>If <code>nestp</code> is <code>t</code>, then (subject to the order of triples in the triple store) some nesting of RDF/XML elements will be applied. <code>nestp</code> of <code>nil</code> will cause a flat tree to be produced, where each resource is its own top-level element. You should not rely on this alone for the purposes of processing RDF data with XML tools. </p><p>If <code>output-types-p</code> is <code>t</code>, then additional queries will be performed for each resource to decorate the RDF/XML with types. If <code>nil</code>, then <code>rdf:type</code> elements alone will be used. </p><p>Because of rounding errors and other conversion issues, the RDF/XML serializer is not guaranteed to round-trip correctly with value-encoded literals (i.e. literals stored as encoded UPIs.  See the reference guide section on <a href="#ref-type-mapping" title="">type mapping</a> for more information on encoded UPIs). </p>
</div>
</div>
  
<a name="function.serialize-rdf-manifest" id="function.serialize-rdf-manifest"></a>
<a name="serialize-rdf-manifest" id="serialize-rdf-manifest"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">serialize-rdf-manifest</span>
<span class="documentation-arguments"><span class="argument">source</span> &nbsp;<span class="argument">directory</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">verbosep</span> &nbsp;<span class="argument">single-stream-p</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Serialize source according to    <a href="http://www.wasab.dk/morten/blog/archives/2005/01/04/exchange-of-named-rdf-graphs">exchange-of-named-rdf-graphs</a>. Serialization will probably open at least as many files as there are graphs in the source. </p><p>Returns the manifest path and the number of graphs saved. </p><p>If <code>single-stream-p</code> only a single file is open at any one time. This is slower, but guaranteed not to fail with large numbers of graphs. </p>
</div>
</div>
  
<a name="function.serialize-turtle" id="function.serialize-turtle"></a>
<a name="serialize-turtle" id="serialize-turtle"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">serialize-turtle</span>
<span class="documentation-arguments"><span class="argument">from</span> &nbsp;<span class="argument">to</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">indent</span> &nbsp;<span class="argument">memoize-abbrev-lookups-p</span> &nbsp;<span class="argument">prepare-namespaces-p</span> &nbsp;<span class="argument">if-exists</span> &nbsp;<span class="argument">if-does-not-exist</span> &nbsp;<span class="argument">error-on-invalid-p</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Write <code>from</code> to <code>to</code> in Turtle format </p><p><code>From</code> must be a triple-store, a list, or a cursor and <code>to</code> must be a stream, file path, <code>t</code> (print to <code>*standard-output*</code>), or <code>nil</code> (return a string). </p>
<ul>
<li><p><code>:if-exists</code> and <code>:if-does-not-exist</code> - apply when <code>from</code> is a filename. They are passed along to the <code>open</code> function are used there. </p></li>
<li><p><code>:indent</code> - if non-nil, then this specifies the initial indentation of elements.</p></li></ul><p>If <code>memoize-abbrev-lookups-p</code> is <code>t</code>, a table is built to store the mappings between resources in the store and string abbreviations. This table will contain as many entries as there are types and properties in the data to be serialized. For some datasets disabling this caching will yield a significant reduction in space usage in exchange for a possible loss of speed. </p>
</div>
</div>
  
<a name="function.serialize-trix" id="function.serialize-trix"></a>
<a name="serialize-trix" id="serialize-trix"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">serialize-trix</span>
<span class="documentation-arguments"><span class="argument">source</span> &nbsp;<span class="argument">to</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">constraints</span> &nbsp;<span class="argument">default-graph</span> &nbsp;<span class="argument">if-exists</span> &nbsp;<span class="argument">if-does-not-exist</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Write <code>source</code>, which should be a triple store, cursor, or list of triples, to <code>to</code>. <code>to</code> must be <code>t</code> (equivalent to <code>*standard-output*</code>), <code>nil</code> (which returns the serialization as a string), a string or pathname, which will be opened for output respecting the <code>if-exists</code> and <code>if-does-not-exist</code> arguments, or a stream. </p><p>The resulting output is produced according to the value of <code>constraints</code>. This must be one of the following symbols: </p>
<ul>
<li><p><code>:canonical</code>: each graph appears once in the output. All graphs and triples are sorted lexicographically. All graphs are named, even when a name must be generated. </p></li>
<li><p><code>:collated</code>: each graph appears once in the output.</p></li>
<li><p><code>:lenient</code> (or <code>nil</code>, the default): graphs can appear multiple times in the output. No sorting occurs. <a href="#load-trix" title="description of load-trix">load-trix</a> can consume this, but not all other TriX parsers necessarily can. </p></li></ul><p>The value of the <code>default-graph</code> argument applies when the default graph has to be serialized. If it is <code>nil</code>, the default, the AllegroGraph-specific <code>&lt;default/&gt;</code> element is used. If it is non-<code>null</code>, it should be a URI string or a valid part that will be substituted into the output. </p>
</div>
</div>
   <a name='ref-indexing' id='ref-indexing'></a> <h3>Indexing Triples</h3> <p>AllegroGraph automatically manages a set of indices that it uses to speed queries. See <a href="triple-index.html">Triples Indices</a>. </p><p>The standard indices that AllegroGraph uses are <code>spogi</code>, <code>posgi</code>, <code>ospgi</code>, <code>gspoi</code>, <code>gposi</code>, and <code>gospi</code>. Here are the sort of queries where these different indices are applicable: </p>
<pre><code>spogi    get-triples _s_, ---, ---, ---  
         get-triples _s_, _p_, ---, ---  
         get-triples _s_, _p_, _o_, ---  
 
posgi    get-triples ---, _p_, ---, ---  
         get-triples ---, _p_, _o_, ---  
 
ospgi    get-triples ---, ---, _o_, ---  
         get-triples _s_, ---, _o_, ---  
 
gspoi    get-triples _s_, ---, ---, _g_  
         get-triples _s_, _p_, ---, _g_  
         get-triples _s_, _p_, _o_, _g_  
 
gposi    get-triples ---, _p_, ---, _g_  
         get-triples ---, _p_, _o_, _g_  
 
gospi    get-triples ---, ---, _o_, _g_  
         get-triples _s_, ---, _o_, _g_ </code></pre><p>Having the standard set available means that any query can be answered quickly. There are cases, however, when some of these become unnecesary. For example, if you are not using the graph for any of your triples, then none of the <code>g</code> indices will ever by used in a query and maintaining them will use unnecessary CPU cycles and waste disk space. </p><p>You can customize the indices used in a triple-store when it is created (with the <code>with-indices</code> option of <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a>). You can also use the following commands to view and modify the triple-store's indices: </p>
<a name="function.add-index" id="function.add-index"></a>
<a name="add-index" id="add-index"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">add-index</span>
<span class="documentation-arguments"><span class="argument">flavor</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">style</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Ensure that <code>db</code> indexes triples on <code>flavor</code>. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. <code>flavor</code> is a symbol (typically a keyword) naming a type of index, like :psogi or :spogi. Indices are described in <a href="triple-index.html">AllegroGraph Indices</a>. That document describes how to construct the names of index types. </p><p>   Style must be NIL, 0, 1, or 2.<br />
      NIL/0: Use the default chunk style for the index as determined by              the Style2Indices configuration parameter (see <a href="daemon-config.html">Server Configuration and Control</a>).          1: Use style 1 chunks.          2: Use style 2 chunks. </p><p>Note that the new index will not be available until after commit (see <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a>). </p><p>If an index of the specified flavor and style already exists, <strong>add-index</strong> does nothing. If an index of the specified flavor but different style already exists, then the index will be rebuilt using the specified style at commit time. </p>
</div>
</div>
  
<a name="function.drop-index" id="function.drop-index"></a>
<a name="drop-index" id="drop-index"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">drop-index</span>
<span class="documentation-arguments"><span class="argument">flavor</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Ensure that <code>db</code> does not index triples on <code>flavor</code>. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p>Note that the index will not be dropped until after commit (see <a href="#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a>). </p><p>Dropping an index that does not exist has no effect. </p>
</div>
</div>
  
<a name="function.triple-store-indices" id="function.triple-store-indices"></a>
<a name="triple-store-indices" id="triple-store-indices"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-store-indices</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a list of the index flavors currently active for <code>db</code>.    <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p>Use <a href="#add-index" title="description of add-index">add-index</a> and <a href="#drop-index" title="description of drop-index">drop-index</a> to manipuate a store's active indices. </p>
</div>
</div>
  <p>As more triples are added, the index can become less efficient. The system performs index optimization in the background. The <code>optimize-indices</code> function can force this optimization to occur immediately. </p>
<a name="function.optimize-indices" id="function.optimize-indices"></a>
<a name="optimize-indices" id="optimize-indices"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">optimize-indices</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">level</span> &nbsp;<span class="argument">wait-p</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">indices</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Optimize the indices in the <code>db</code> at aggressiveness <code>level</code>. </p><p>The parameters are: </p>
<ul>
<li><code>level</code>: this must be a non-negative integer or <code>nil</code>:
<ul>
<li><p><code>0</code> - Does a single round of optimization with standard parameters.</p></li>
<li><p><code>1</code> - Does a single round of optimization with aggressive parameters.</p></li>
<li><p><code>2</code> or <code>nil</code> - Writes out in-memory triple data and then performs a single very aggressive index optimization of all chunks. </p></li>
<li><p><code>3</code> - Same as <code>2</code>, but will process all chunks regardless of overlap.</p></li></ul></li>
<li><p><code>wait-p</code>: if true, don't return until the operation is finished.</p></li>
<li><p><code>indices</code>: This can be one of</p>
<ul>
<li><p><code>nil</code> or <code>:all</code> to optimize all indices.</p></li>
<li><p>a single index, e.g., <code>:spogi</code>, to optimize just that index.</p></li>
<li><p>a list of index names, to optimize several indices.</p></li></ul></li></ul><p><code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
  <p>Note that the function <strong>delete-duplicates-during-merge-p</strong> is no longer supported (starting in release 4.2.1). The function <strong>duplicate-deletion-strategy</strong> is no longer supported starting in release 4.4. </p> <a name='header2-63' id='header2-63'></a><h2>Advanced Triple-Store Operations</h2><a name='ref-bang-reader' id='ref-bang-reader'></a> <h3>The !-reader macro and future-parts</h3> <a name='ref-future-parts' id='ref-future-parts'></a> <p>When working with the triple-store at the REPL (the lisp listener) it's nice to have a more concise way to refer to resources and literals than with calls to <a href="#resource" title="description of resource">resource</a>, <a href="#literal" title="description of literal">literal</a> or the part interning functions. It's also handy to be able to abbreviate the many long URIs with a common prefix such as <code>http://www.w3.org/2000/01/rdf-schema#</code>. Namespaces and the <code>!</code>-reader macro provide a concise syntax for both resources and literals. (Users of Prolog should note that ! also has meaning in Prolog which conflicts with its use as a reader macro. Using \! in prolog code avoids this problem and works even if the reader macro is not enabled. See <a href="prolog-tutorial.html#bang-problem" title="">Problem with use of ! in Prolog code</a> in the <a href="prolog-tutorial.html">Prolog Tutorial</a>.) </p><p>The first thing the <code>!</code>-reader macro allows you to do is write N-Triples strings without quotation marks (except for those required by the N-Triples syntax itself!). Thus instead of writing: </p>
<pre><code>"&lt;http://franz.com/&gt;"  
"\"foo\""  
"\"foo\"^^&lt;http://www.w3.org/2000/01/rdf-schema#integer&gt;"  
"\"foo\"@en" </code></pre><p>you can simply write: </p>
<pre><code>!&lt;http://franz.com/&gt;  
!"foo"  
!"foo"^^&lt;http://www.w3.org/2000/01/rdf-schema#integer&gt;  
!"foo"@en </code></pre><p>In addition, the <code>!</code>-reader macro uses namespaces to abbreviate long URIs. Use the <a href="#register-namespace" title="description of register-namespace">register-namespace</a> function to assign an abbreviation to any prefix used in URIs. For instance you can register <code>s</code> as an abbreviation for the URI prefix <code>http://franz.com/simple#</code> like this: </p>
<pre><code>(register-namespace "s" "http://franz.com/simple#") </code></pre><p>Then you can use that prefix with the <code>!</code>-reader macro to write URIs starting with that prefix: </p>
<pre><code>!s:jans =&gt; !&lt;http://franz.com/simple#jans&gt; </code></pre><p>You have probably noticed that the <code>!</code>-reader macro does not seem to be doing anything: </p>
<pre><code>!"hello" =&gt; !"hello" </code></pre><p>This is because <code>!</code> is converting the string "hello" into what AllegroGraph calls a <em>future-part</em> and the future-part prints itself using the <code>!</code>-notation. If we <code>describe</code> the future-part, then we will see all of the additional structure: </p>
<pre><code>&gt; (describe !"hello")  
!"hello" is a structure of type future-part.  It has these slots:  
 type               :literal  
 value-prefix       nil  
 value-fragment     "hello"  
 extra-prefix       nil  
 extra-fragment     nil  
 value              "hello"  
 extra              nil  
 extra-done-p       t  
 upi                #(5 0 0 0 0 0 111 108 108 101 104 7)  
 triple-db          nil </code></pre><p>Now it's clear that AllegroGraph has parsed the string and performed the computations to determine the part's UPI. </p><a name='ref-future-parts' id='ref-future-parts'></a> <p>future-parts are called <em>future</em>-parts because they cache some of the information (e.g., the namespace prefix) and wait to resolve until the namespace mappings are available which may be in the future. Before we finish describing resolution, however, here are some examples. First, literals: </p>
<ul>
<li><code>!"hello"</code> : equivalent to (literal "hello")</li>
<li><code>!"hello"@en</code> : equivalent to (literal "hello" :language "en")</li>
<li><code>!"OK"^^&lt;http://www.w3.org/2000/01/rdf-schema#XMLLiteral&gt;</code> : equivalent to (literal "OK" :datatype "http://www.w3.org/2000/01/rdf-schema#XMLLiteral")</li>
<li><code>!"OK"^^rdfs:XMLLiteral</code> : assuming that we have already registered the string "rdfs" with the namespace URI "http://www.w3.org/2000/01/rdf-schema#", then this is the same part as above.</li>
<li><code>!"Careful"^^&lt;rdfs:XMLLiteral&gt;</code> : this would be equivalent to (literal "Careful" :datatype "rdfs:XMLLiteral") and is probably not what you intend.</li>
<li><code>!"-- wrong --"^^XMLLiteral</code> : this is an error since a type must be either a URI or a QName (Qualified name). I.e., it must either be bracketed with '&lt;' and '&gt;' or it must contain a ':'.</li></ul><p>The story for resources is very similar: </p>
<ul>
<li><code>!&lt;http://franz.com/products#allegrograph&gt;</code> : equivalent to (resource "http://franz.com/products#allegrograph")</li>
<li><code>!franz:allegrograph</code> : assuming that we have already registered "franz" to map to "http://www.franz.com/products#", then this is the same part as above.</li>
<li><code>!Wrong</code> : this would be the URI "wrong" resolved using the current base URI. Since AllegroGraph does not support base URIs, such a part name is meaningless and will produce an error.</li>
<li><code>!&lt;smells-fishy:allegrograph&gt;</code> : equivalent to (resource "smells-fishy:allegrograph") and probably not what you intend.</li></ul><p>Future parts are resolved when it is necessary to determine their UPI. If the part uses a namespace (e.g., is something like !a:b), then the namespace will be resolved first. It is an error to try and determine a part's UPI if the necessary namespace mapping has not been registered. Once the namespace of a part is resolved, then it will not be resolved again (during the current Lisp session). After namespace resolution, a future-part is equivalent to a particular string which can be interned into a triple-store (i.e., stored in the store's string dictionary). </p><p>Future-parts make working with AllegroGraph much simpler but they do contain some machinery and can be confusing. Remember that you can always tell what is happening by using the Lisp <code>describe</code> function. </p><p>Note that future-parts are not themselves subject to automatic type mapping because type mappings are properties of individual repositories and a future-part is not tied to a particular repository. A future part is subject to type mapping only when it is passed to a specific database operation such as <a href="#add-triple" title="description of add-triple">add-triple</a>. </p><p>Calling the <a href="#upi" title="description of upi">upi</a> function on a future-part always returns a hashed string literal, which might be a plain literal, a language literal, or a typed literal, but will never be an encoded literal. This is true even if passing that same future-part to <a href="#add-triple" title="description of add-triple">add-triple</a> would result in an encoded literal. </p><p>Consider the following example. We bind the variable <code>o</code> to the future-part !"123.45"^^xsd:double. Then we add two triples, one just using the <code>o</code> and the other using <code>(upi o)</code>. Note the triples are different, as examining them shows: </p>
<pre><code>triple-store-user(115): (let ((o !"123.45"^^xsd:double))  
                          (add-triple !&lt;s&gt; !&lt;p&gt; (upi o))  
                          (add-triple !&lt;s&gt; !&lt;p&gt; o))  
5  
triple-store-user(116): (mapcar 'object (get-triples-list))  
({123.45d0} {123.45})  </code></pre><p>The order is reversed, but we see the triple constructed from <code>(upi o)</code> is not stored as a double-float. </p><a name='ref-namespaces' id='ref-namespaces'></a> <p>The following are the functions used for enabling the <code>!</code> reader macro and for managing namespaces. </p>
<a name="function.clear-namespaces" id="function.clear-namespaces"></a>
<a name="clear-namespaces" id="clear-namespaces"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">clear-namespaces</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">keep-standard-namespaces</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Delete all existing namespace mappings. If <code>:keep-standard-namespaces</code> is true (the default) then the namespace mappings in <em>standard-namespaces</em> will not be removed. 
</div>
</div>
  
<a name="function.collect-namespaces" id="function.collect-namespaces"></a>
<a name="collect-namespaces" id="collect-namespaces"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">collect-namespaces</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">filter</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a list of namespace mappings. </p><p><code>filter</code> can be nil or a string. If it is a string, then only namespaces that contain that string will be returned. </p>
</div>
</div>
  
<a name="function.display-namespaces" id="function.display-namespaces"></a>
<a name="display-namespaces" id="display-namespaces"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">display-namespaces</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">filter</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Print out all namespace mappings in a human-readable format. </p><p><code>filter</code> can be nil or a string. If it is a string, then only namespaces that contain that string will be returned. </p>
</div>
</div>
  
<a name="function.dump-namespaces" id="function.dump-namespaces"></a>
<a name="dump-namespaces" id="dump-namespaces"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">dump-namespaces</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">file</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Dump all registered namespaces as calls to <code>register-namespace</code> that can be used to recreate the original namespaces if needed later. If the optional <code>file</code> argument is provided, output is written to that file. Otherwise the output is sent to <code>*standard-output*</code>. 
</div>
</div>
  
<a name="class.namespace-redefinition-error" id="class.namespace-redefinition-error"></a>
<a name="namespace-redefinition-error" id="namespace-redefinition-error"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">namespace-redefinition-error</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">The error is signaled when an attempt is made to alter the mapping between a namespace prefix and its associated URI reference. 
</div>
</div>
  
<a name="function.lookup-namespace" id="function.lookup-namespace"></a>
<a name="lookup-namespace" id="lookup-namespace"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">lookup-namespace</span>
<span class="documentation-arguments"><span class="argument">namespace-prefix</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the <code>uriref</code> associated with <code>namespace-prefix</code> or nil if there is no association. 
</div>
</div>
  
<a name="function.map-namespaces" id="function.map-namespaces"></a>
<a name="map-namespaces" id="map-namespaces"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-namespaces</span>
<span class="documentation-arguments"><span class="argument">fn</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">filter</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Applies <code>fn</code> to each namespace mapping. <code>Fn</code> must be a function of two arguments: the prefix and the uri. </p><p><code>filter</code> can be <code>nil</code> to map all namespaces; a <code>string</code> to map only namespaces that include that string or a function to map only namespaces for which the function returns true. </p>
</div>
</div>
  
<a name="function.part-to-namespace" id="function.part-to-namespace"></a>
<a name="part-to-namespace" id="part-to-namespace"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">part-to-namespace</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">error</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return (as multiple values) <code>part</code>'s namespace Prefixed Name and Local Part (see <a href="https://en.wikipedia.org/wiki/QName">https://en.wikipedia.org/wiki/QName</a> for details). </p><p>For example, </p>
<pre><code>(part-to-namespace !rdf:type)  
==&gt;  
"rdf"  
"type" </code></pre><p><code>part</code> can be a UPI, a future-part, or string with or without angle-brackets. If no namespace abbreviation can be found for part then <code>part-to-namespace</code> will signal an if <code>error</code> is true or just return the part unchanged if it is<br />
 nil.  </p>
</div>
</div>
  
<a name="function.register-namespace" id="function.register-namespace"></a>
<a name="register-namespace" id="register-namespace"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-namespace</span>
<span class="documentation-arguments"><span class="argument">namespace-prefix</span> &nbsp;<span class="argument">uri-reference</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">errorp</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Create a mapping between <code>namespace-prefix</code> and <code>uri-reference</code>, both of which should be strings. If the <code>errorp</code> keyword argument, which defaults to <code>t</code>, is true, then defining a mapping for an existing prefix will signal a continuable <a href="#namespace-redefinition-error" title="description of namespace-redefinition-error">namespace-redefinition-error</a> condition. 
</div>
</div>
  
<a name="function.register-standard-namespaces" id="function.register-standard-namespaces"></a>
<a name="register-standard-namespaces" id="register-standard-namespaces"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-standard-namespaces</span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Add standard namespaces such as rdf, rdfs and owl. See the variable <em>standard-namespaces</em> for more details. 
</div>
</div>
  
<a name="function.remove-namespace" id="function.remove-namespace"></a>
<a name="remove-namespace" id="remove-namespace"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">remove-namespace</span>
<span class="documentation-arguments"><span class="argument">prefix</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Remove the namespace mapping associated with <code>prefix</code>. 
</div>
</div>
  
<a name="variable.:2Astandard-namespaces:2A" id="variable.:2Astandard-namespaces:2A"></a>
<a name="x:2Astandard-namespaces:2A" id="x:2Astandard-namespaces:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*standard-namespaces*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents"><p>The <em>standard-namespaces</em> is a list of (prefix uri) pairs representing namespace mappings. For example: </p>
<pre><code>'(("rdf" "http://www.w3.org/1999/02/22-rdf-syntax-ns#")  
  ("rdfs" "http://www.w3.org/2000/01/rdf-schema#")  
  ("owl" "http://www.w3.org/2002/07/owl#")) </code></pre><p> It is used by the function <a href="#register-standard-namespaces" title="description of register-standard-namespaces">register-standard-namespaces</a> to create standard mappings. </p>
</div>
</div>
  
<a name="function.enable-:21-reader" id="function.enable-:21-reader"></a>
<a name="enable-:21-reader" id="enable-:21-reader"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">enable-!-reader</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">readtable</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Enables the use of the !-reader macro. </p><p>The !-reader makes it easier to type URIs and literals at the Read-Eval-Print-Loop. </p><p><code>enable-!-reader</code> returns the previous definition of the #! in the current readtable. </p><p>Note: <code>enable-!-reader</code> modifies the readtable specified. If left unspecified, then <code>enable-!-reader</code> modifies the <em>current</em> <code>*readtable*</code>. There is no <code>disable-!-reader</code> command because Common Lisp does not provide a portable mechanism to cleanly compose and operate with multiple readtables. For information on working with readtables, please consult that Allegro Common Lisp <a href="http://franz.com/support/documentation/7.0/doc/eli.htm#packages-and-readtables-2" target="_blank">reference</a>. </p><p>Note: Because of its global effect, if <code>enable-!-reader</code> is called on the default readtable (<code>*readtable*</code>), then use of the exclamation mark character in other Lisp packages and systems may break. Generally speaking, it is possible to work around these issues. Please contact <a href="mailto:allegrograph-support@franz.com">support</a> for additional help. </p>
</div>
</div>
  
<a name="function.enable-print-decoded" id="function.enable-print-decoded"></a>
<a name="enable-print-decoded" id="enable-print-decoded"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">enable-print-decoded</span>
<span class="documentation-arguments"><span class="argument">boolean</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">pprint-dispatch</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Triples and parts are represented by (simple-array (unsigned-byte 8) 56) and (simple-array (unsigned-byte 8) 12) respectively.  By default the Lisp printer prints these as vectors of bytes which is not very informative when using AllegroGraph interactively.  This function modifies a pprint-dispatch table to print triples and parts interpretively if this can be done in the current environment. Specifically, the value of *db* must be an open triple store, and the vector being printed must print without error in the manner of print-triple or upi-&gt;value.  If any of these conditions don't hold the vector is printed normally. </p><p>If the boolean argument is true, the informative printing is enabled, otherwise disabled.  For example: </p>
<pre><code>&gt; (enable-print-decoded t)  
t  
&gt; (upi !"Drst"^^xsd:string)  
{Drst}  
&gt; (enable-print-decoded nil)  
nil  
&gt; (upi !"Drst"^^xsd:string)  
#(48 61 125 164 117 231 137 163 64 100 17 2) </code></pre><p>The :pprint-dispatch argument specifies the dispatch  table to modify, by default the value of <em>print-pprint-dispatch</em>. Once enable-print-decoded has been turned on, you can also use the special-variable <code>*print-decoded*</code> to enable fine-grained control  of triple and UPI printing. See the AllegroGraph tutorial for more information on the <a href="lisp-quickstart.html#ref-agraph-notation" title="">various notations</a> AllegoGraph uses. </p>
</div>
</div>
   <a name='ref-freetext-indexing' id='ref-freetext-indexing'></a> <h3>Freetext Indexing</h3> <div class='sidenote' id='freetext-documentation-note'> Note that freetext indexing is orthogonal to triple indices like <code>spogi</code>. Freetext indices let you quickly map from words and phrases to triples; triple indices let you quickly find triples that match particular patterns. </div> <p>AllegroGraph supports freetext indexing the content of triples. See <a href="text-index.html">Freetext Indices</a> for a general discussion. </p><p>Freetext indexing is done by creating one or more indices, each of which can be configured to determine which triples, and which fields of those triples, it indexes. Indexed triples can be queried using a simple but robust <a href="text-index.html#ref-freetext-query-grammar" title="">query language</a>. </p><p>Indices are managed using the following functions: </p>
<a name="function.create-freetext-index" id="function.create-freetext-index"></a>
<a name="create-freetext-index" id="create-freetext-index"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">create-freetext-index</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">predicates</span> &nbsp;<span class="argument">index-fields</span> &nbsp;<span class="argument">index-resources</span> &nbsp;<span class="argument">index-literals</span> &nbsp;<span class="argument">minimum-word-size</span> &nbsp;<span class="argument">stop-words</span> &nbsp;<span class="argument">border-chars</span> &nbsp;<span class="argument">inner-chars</span> &nbsp;<span class="argument">tokenizer</span> &nbsp;<span class="argument">word-filters</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>This creates a new index with the given name, which should be a string. The arguments have the following meaning: </p>
<dl><dt><code>predicates</code> </dt>
<dd>A list of future-parts or UPIs that determine the predicates this   index indexes. Default is <code>()</code>, which means index all predicates. </dd><dt><code>index-fields</code> </dt>
<dd>A list containing any subset of <code>(:subject :predicate :object   :graph)</code>, which determines which fields of the triples are indexed.   Default is <code>(:object)</code>. </dd><dt><code>index-literals</code> </dt>
<dd>Determines whether literals are indexed. Can be <code>t</code> (yes), <code>nil</code>   (no), or a list of strings, UPIs or future-parts, each of which   specifies either a type for typed-literals or a language   (only indexes those literals whose type or language matches any   of them).  For example: :index-literals <code>(list !&lt;http://www.w3.org/2001/XMLSchema#byte&gt; !"en")</code>   will only index literals with XSD type "http://www.w3.org/2001/XMLSchema#byte" or language   tag "en".  Default is <code>t</code>. </dd><dt><code>index-resources</code> </dt>
<dd>Whether and how resources are indexed. The default is <code>nil</code> (don't   index them). <code>t</code> means index resources fully, and <code>:short</code> means   index only the part after the last <code>#</code> or <code>/</code>. </dd><dt><code>minimum-word-size</code> </dt>
<dd>The minimum size a word must have to be indexed. Default is 3, which   is suitable for European languages using the default tokenizer.   If you use <code>:simple-cjk</code> or <code>:japanese</code> tokenizer, set this to 2 or 1. </dd><dt><code>stop-words</code> </dt>
<dd>A list of strings, which indicates the set of words that should not   be indexed. Defaults to a short list of English stop-words. </dd><dt><code>border-chars</code> </dt>
<dd>If given, a freetext-charset object specifying characters that can   appear at word boundaries.   How this is used depends on the tokenizer;   see <code>tokenizer</code> below. The function <a href="#freetext-charset" title="description of freetext-charset">freetext-charset</a> creates   freetext-charsets. </dd><dt><code>inner-chars</code> </dt>
<dd>If given, a freetext-charset object specifying characters that can   appear within a word (but may not be at its boundaries).   How this is used depends on the tokenizer; see <code>tokenizer</code> below.   The function <a href="#freetext-charset" title="description of freetext-charset">freetext-charset</a> creates   freetext-charsets. </dd><dt><code>word-filters</code> </dt>
<dd>A list of string, naming filters that should be applied to words   before they are indexed and before they are searched for, allowing   terms to be normalized. Currently "stem.english",   "drop-accents" and "soundex" are supported. </dd><dt><code>tokenizer</code> </dt>
<dd>A keyword to name the tokenization scheme.  Currently, <code>:default</code>,   <code>:japanese</code> and <code>:simple-cjk</code> are supported.  If unspecified, the   the default tokenizer is used,  which is sufficient for European   languages.  With the default tokenizer, each word begins with one   of <code>border-chars</code>, followed by zero or more <code>inner-chars</code>, and ends   with one of <code>border-chars</code>.  The <code>:simple-cjk</code> tokenizer can be used   to tokenize Chinese, Japanese or Korean text.  This tokenizer first   separates the text into sequences of CJK characters and sequences of   other characters.  For CJK parts, each bigram of characters is taken as   a word; that is, if you have "XYZ" where X, Y and Z are CJK   characters, then "XY" and "YZ" are indexed as words.  The remaining   non-CJK parts are tokenized with <code>border-chars</code> and <code>inner-chars</code>, as   with the default tokenizer.   Finally, the <code>:japanese</code> tokenizer   uses a Japanese morphological analyzer to tokenize the Japanese   sentences.  Using an internal dictionary, it can extract Japanese   words more precisely than the <code>simple-cjk</code> tokenizer.  The   <code>border-chars</code> and <code>inner-chars</code> are ignored. </dd></dl>
</div>
</div>
  
<a name="function.modify-freetext-index" id="function.modify-freetext-index"></a>
<a name="modify-freetext-index" id="modify-freetext-index"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">modify-freetext-index</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">predicates</span> &nbsp;<span class="argument">index-fields</span> &nbsp;<span class="argument">index-resources</span> &nbsp;<span class="argument">index-literals</span> &nbsp;<span class="argument">minimum-word-size</span> &nbsp;<span class="argument">stop-words</span> &nbsp;<span class="argument">border-chars</span> &nbsp;<span class="argument">inner-chars</span> &nbsp;<span class="argument">tokenizer</span> &nbsp;<span class="argument">word-filters</span> &nbsp;<span class="argument">re-index-p</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Modify an existing freetext index. When not given, the configuration arguments retain their old value for this index. See <a href="#create-freetext-index" title="description of create-freetext-index">create-freetext-index</a> for the meaning of the settings. </p><p>If <code>re-index-p</code> is true, the index will be rebuilt, and existing triples will be re-indexed. If it is <code>nil</code>, the new settings will only be used for triples added afterwards. </p>
</div>
</div>
  
<a name="function.drop-freetext-index" id="function.drop-freetext-index"></a>
<a name="drop-freetext-index" id="drop-freetext-index"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">drop-freetext-index</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Deletes the named freetext index. 
</div>
</div>
  
<a name="function.list-freetext-indices" id="function.list-freetext-indices"></a>
<a name="list-freetext-indices" id="list-freetext-indices"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">list-freetext-indices</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns a list of strings, naming the freetext indices that have been created for this triple-store. 
</div>
</div>
  
<a name="function.freetext-charset" id="function.freetext-charset"></a>
<a name="freetext-charset" id="freetext-charset"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-charset</span>
<span class="documentation-arguments"><span class="argument">chars</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">base</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Creates and returns a freetext-charset that consists of items given to <code>chars</code>.  <code>chars</code> must be a list of the following type of items: </p>
<ul>
<li><em>character</em> - the character itself.</li>
<li>(<em>start-character</em> <em>end-character</em>) - a range of characters (inclusive). The range is calculated based on Unicode codepoints (that is <code>(code-char char)</code>). The code of <em>start-character</em> must be less than or equal to the code of <em>end-character</em> for this choice to have any effect.</li>
<li><code>:alpha</code> - Characters that satisfy <strong>alpha-char-p</strong>.</li>
<li><code>:digit</code> - Characters that satisfy <strong>digit-char-p</strong>.</li>
<li><code>:alphanumeric</code> - Characters that satisfy <strong>alphanumericp</strong>.</li></ul><p> If <code>base</code> is given, it must be a freetext-charset object (such as created by this function).  Characters in <code>base</code> are included in the resulting charset. </p><p>Here are some examples: </p>
<pre><code>(freetext-charset '(#a (#x #z) :digit))  
   ;; (char-code #a) is 97, (char-code #x) is 120, and  
   ;; (char-code #z) is 122. So characters with codes  
   ;; 97, 120, 121, 122, and all that satisfy digit-char-p.  
(freetext-charset '(#a (#z #x) :digit))  
   ;; Because (char-code #z) is greater than (char-code #x),  
   ;; the (#x #z) has no effect, so this is character with  
   ;; code 97 and all that satisfy digit-char-p.  
(freetext-charset (list :alpha :digit))  
(freetext-charset '(:alpha) (freetext-charset '(:digit)))  
   ;; The last two examples result in the same charsets, all  
   ;; characters that satisfy alpha-char-p or digit-char-p. </code></pre>
</div>
</div>
 
 <p>The following functions are index field accessors, which, given the name of an index (as a string), return a configuration setting for that index. </p>
<a name="function.freetext-index-index-fields" id="function.freetext-index-index-fields"></a>
<a name="freetext-index-index-fields" id="freetext-index-index-fields"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-index-index-fields</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Retrieve the index-fields configuration option for a freetext-index. 
</div>
</div>
  
<a name="function.freetext-index-index-literals" id="function.freetext-index-index-literals"></a>
<a name="freetext-index-index-literals" id="freetext-index-index-literals"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-index-index-literals</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Retrieve the index-literals configuration option for a freetext-index. 
</div>
</div>
  
<a name="function.freetext-index-index-resources" id="function.freetext-index-index-resources"></a>
<a name="freetext-index-index-resources" id="freetext-index-index-resources"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-index-index-resources</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Retrieve the index-resources configuration option for a freetext-index. 
</div>
</div>
  
<a name="function.freetext-index-minimum-word-size" id="function.freetext-index-minimum-word-size"></a>
<a name="freetext-index-minimum-word-size" id="freetext-index-minimum-word-size"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-index-minimum-word-size</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Retrieve the minimum-word-size configuration option for a freetext-index. 
</div>
</div>
  
<a name="function.freetext-index-predicates" id="function.freetext-index-predicates"></a>
<a name="freetext-index-predicates" id="freetext-index-predicates"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-index-predicates</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Retrieve the predicates configuration option for a freetext-index. 
</div>
</div>
  
<a name="function.freetext-index-stop-words" id="function.freetext-index-stop-words"></a>
<a name="freetext-index-stop-words" id="freetext-index-stop-words"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-index-stop-words</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Retrieve the stop-words configuration option for a freetext-index. 
</div>
</div>
  
<a name="function.freetext-index-tokenizer" id="function.freetext-index-tokenizer"></a>
<a name="freetext-index-tokenizer" id="freetext-index-tokenizer"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-index-tokenizer</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Retrieve the tokenizer configuration option for a freetext-index. 
</div>
</div>
  
<a name="function.freetext-index-word-filters" id="function.freetext-index-word-filters"></a>
<a name="freetext-index-word-filters" id="freetext-index-word-filters"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-index-word-filters</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Retrieve the word-filters configuration option for a freetext-index. 
</div>
</div>
  <p>These are functions for querying the freetext indices: </p>
<a name="function.freetext-get-triples" id="function.freetext-get-triples"></a>
<a name="freetext-get-triples" id="freetext-get-triples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-get-triples</span>
<span class="documentation-arguments"><span class="argument">expression</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">index</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">sorted-p</span> &nbsp;<span class="argument">attribute-filter</span> &nbsp;<span class="argument">return-extended-triples</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a cursor that iterates over the triples that match the expression. The <code>index</code> argument can be given to search only a single index. When not given, all available indices are used. The <code>sorted-p</code> argument, which defaults to nil, can be given a truth value to cause the results to come back sorted by relevance (most relevant triples first). </p>
<pre><code>(iterate-cursor (triple (freetext-get-triples '(match "amsterd*")))  
    (print triple)) </code></pre><p>If return-extended-triples is true, then the cursor will iterate over extended-triples rather than plain ones. </p>
</div>
</div>
  
<a name="function.freetext-get-unique-subjects" id="function.freetext-get-unique-subjects"></a>
<a name="freetext-get-unique-subjects" id="freetext-get-unique-subjects"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">freetext-get-unique-subjects</span>
<span class="documentation-arguments"><span class="argument">expression</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">index</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns all the <em>unique</em> subjects in triples whose objects contain expression. This is a useful function in prolog queries. </p>
<pre><code>(select (?person)  
  (lisp ?list  
     (freetext-get-unique-subjects '(and "collection" "people")))  
  (member ?person ?list)  
  (q- ?person !rdfs:subClassOf !c:AsianCitizenOrSubject)) </code></pre>
</div>
</div>
 
 <h4>Freetext Error Conditions</h4><p>The following are classes of conditions signaled when an error occurs. </p>
<a name="class.text-index-already-exists-error" id="class.text-index-already-exists-error"></a>
<a name="text-index-already-exists-error" id="text-index-already-exists-error"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">text-index-already-exists-error</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">Signalled when trying to create a freetext-index with a name that is already taken. 
</div>
</div>
  
<a name="class.text-index-not-found-error" id="class.text-index-not-found-error"></a>
<a name="text-index-not-found-error" id="text-index-not-found-error"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">text-index-not-found-error</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">Signalled when trying to access a freetext-index that does not exist. 
</div>
</div>
   <a name='ref-type-mapping' id='ref-type-mapping'></a> <h3>Data-type and Predicate Mapping</h3> <a name='ref-encoded-data-types' id='ref-encoded-data-types'></a> <p>Most triple-stores work internally only with strings. AllegroGraph, however, can store a wide range of datatypes directly in its triples. This ability not only allows for huge reductions in triple-store size but also lets AllegroGraph execute range queries remarkably quickly. Use the <a href="#supported-types" title="description of supported-types">supported-types</a> function to see a list of datatypes that AllegroGraph can encode directly. The datatypes are specified as keywords or integers (with the integers being used internally). You can translate in either direction using <a href="#type-code-:3Etype-name" title="description of type-code->type-name">type-code-&gt;type-name</a> and <a href="#type-name-:3Etype-code" title="description of type-name->type-code">type-name-&gt;type-code</a>. You can add encoded-triples (i.e., triples some of whose parts are encoded UPIs rather than references to strings) directly using <a href="#add-triple" title="description of add-triple">add-triple</a> or by setting up <em>mappings</em> between particular predicates or specific datatypes and then using one of the bulk loading functions. In the former case, you use <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> and in the later, you use <a href="#datatype-mapping" title="description of datatype-mapping">datatype-mapping</a>s and <a href="#predicate-mapping" title="description of predicate-mapping">predicate-mapping</a>s. </p> <p>For example, here is how to specify that the datatype <code>xsd:double</code> maps to an AllegroGraph <code>:double-float</code> and the predicate &lt;http://www.example.com/predicate#age&gt; maps to an <code>:unsigned-byte</code> </p>
<pre><code>&gt; (setf (datatype-mapping  
   "http://www.w3.org/2001/XMSchema#double") :double-float)  
  :double-float  
 
 
&gt; (setf (predicate-mapping  
   "http://www.example.com/predicate#age") :unsigned-byte)  
  :unsigned-byte </code></pre><p>When you add a triple (either via <code>add-triple</code>, SPARQL UPDATE or one of the bulk load functions), AllegroGraph will examine it to see if it satisfies any type mappings.  If it does, then an encoded-triple will be added to the triple-store <em>instead</em> of one using string literals.  If necessary, you can tell AllegroGraph to preserve strings but this is not recommended because of the space and time performance penalties. </p>
<a name="function.automatically-mapped-types" id="function.automatically-mapped-types"></a>
<a name="automatically-mapped-types" id="automatically-mapped-types"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">automatically-mapped-types</span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a list of the automatically mapped datatypes. </p><p>The list is a list of pairs where the first entry in each pair is the short type-name and the second entry is the XSD-type as a future-part. For example: </p>
<pre><code> (:unsigned-int !&lt;http://www.w3.org/2001/XMLSchema#unsignedInt&gt;) </code></pre>
</div>
</div>
 
 <p><div class="documentation docs-group"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">UPI type codes</span>
<span>+geospatial+</span> 
<span>+rdf-blank-node+</span> 
<span>+rdf-byte+</span> 
<span>+rdf-date+</span> 
<span>+rdf-date-time+</span> 
<span>+rdf-default-graph+</span> 
<span>+rdf-double-float+</span> 
<span>+rdf-gyear+</span> 
<span>+rdf-int+</span> 
<span>+rdf-latitude+</span> 
<span>+rdf-literal+</span> 
<span>+rdf-literal-language+</span> 
<span>+rdf-literal-short+</span> 
<span>+rdf-literal-typed+</span> 
<span>+rdf-long+</span> 
<span>+long-88+</span> 
<span>+rdf-longitude+</span> 
<span>+rdf-resource+</span> 
<span>+rdf-short+</span> 
<span>+rdf-single-float+</span> 
<span>+telephone-number+</span> 
<span>+rdf-time+</span> 
<span>+rdf-unsigned-byte+</span> 
<span>+rdf-unsigned-int+</span> 
<span>+rdf-unsigned-long+</span> 
<span>+unsigned-long-88+</span> 
<span>+rdf-unsigned-short+</span> 
<span>+subscript+</span> 
<span>+triple-id-tag+</span> 
</div>
<span class="documentation-kind">group</span>
</div>
<div class="documentation contents"><p>These constants can be used to specify a UPI's type-code. See <a href="#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> and <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> for more details. </p><p>The types <code>+long-88+</code> and <code>+unsigned-long-88+</code> are similar to the standard RDF long integer types but extend the range to 88 bits. </p>
</div>
</div>
  </p>
<a name="function.datatype-mapping" id="function.datatype-mapping"></a>
<a name="datatype-mapping" id="datatype-mapping"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">datatype-mapping</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the type encoding for <code>part</code>, an XML-Schema type designator. This can be a string, a UPI or a future-part. For example: </p>
<pre><code>&gt; (datatype-mapping "&lt;http://www.w3.org/2001/XMLSchema#unsignedByte&gt;")  
!xs:unsignedByte </code></pre><p>The scope of the mapping is the <code>db</code> (which defaults to<br />
<a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>). Use <strong>(setf datatype-mapping)</strong> to  add an association between a datatype and an encoded UPI type </p>
</div>
</div>
  
<a name="function.encoded-types" id="function.encoded-types"></a>
<a name="encoded-types" id="encoded-types"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">encoded-types</span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a list of type names that can be used in <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> to encode a string into an <em>encoded</em> UPI. To see the corresponding type code for a name, use the <a href="#type-name-:3Etype-code" title="description of type-name->type-code">type-name-&gt;type-code</a> function. </p><p>See the section on <a href="#ref-type-mapping" title="">type mapping</a> for more information. </p>
</div>
</div>
  
<a name="function.hashed-upi-p" id="function.hashed-upi-p"></a>
<a name="hashed-upi-p" id="hashed-upi-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">hashed-upi-p</span>
<span class="documentation-arguments"><span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns true if UPI is hashed. I.e., if its associated data is stored in the triple-store's string-table rather than being directly encoded. 
</div>
</div>
  
<a name="function.predicate-mapping" id="function.predicate-mapping"></a>
<a name="predicate-mapping" id="predicate-mapping"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">predicate-mapping</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the type encoding for part.  Part should be the URIref of a   predicate. For example: </p>
<pre><code>&gt; (predicate-mapping !&lt;http://www.example.org/property/height&gt;)  
!xs:double </code></pre><p>The scope of the mapping is the <code>db</code> (which defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>).  Use <code>(setf predicate-mapping)</code> to create a mapping between a URIref of a predicate and one of AllegroGraph's supported-types. </p>
<pre><code>&gt; (setf (predicate-mapping !&lt;http://www.example.org/property/height&gt;)  
        :double-float)  
:double-float </code></pre>
</div>
</div>
 
 
<a name="function.supported-types" id="function.supported-types"></a>
<a name="supported-types" id="supported-types"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">supported-types</span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a list of all available type names. Use <a href="#encoded-types" title="description of encoded-types">encoded-types</a> to restrict the result to only those types that produce encoded UPIs. To see the corresponding type code for a name, use the <a href="#type-name-:3Etype-code" title="description of type-name->type-code">type-name-&gt;type-code</a> function. </p><p>See the section on <a href="#ref-type-mapping" title="">type mapping</a> for more information. </p>
</div>
</div>
  
<a name="function.type-code-:3Etype-name" id="function.type-code-:3Etype-name"></a>
<a name="type-code-:3Etype-name" id="type-code-:3Etype-name"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">type-code-&gt;type-name</span>
<span class="documentation-arguments"><span class="argument">code</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the type name associated with <code>code</code>. See <a href="#type-name-:3Etype-code" title="description of type-name->type-code">type-name-&gt;type-code</a>. 
</div>
</div>
  
<a name="function.type-name-:3Etype-code" id="function.type-name-:3Etype-code"></a>
<a name="type-name-:3Etype-code" id="type-name-:3Etype-code"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">type-name-&gt;type-code</span>
<span class="documentation-arguments"><span class="argument">name</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns the type code associated with the <code>name</code>. See <a href="#type-code-:3Etype-name" title="description of type-code->type-name">type-code-&gt;type-name</a> and <a href="#supported-types" title="description of supported-types">supported-types</a>. The <code>name</code> can be one of the supported-types or one of: </p>
<ul>
<li>:blank-node</li>
<li>:resource</li>
<li>:literal</li>
<li>:literal-language</li>
<li>:literal-short</li>
<li>:literal-typed</li></ul><p>The function returns <code>nil</code> if there is no type-code corresponding to name. </p>
</div>
</div>
  <div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi-&gt;value</span>
<span class="documentation-arguments"><span class="argument">upi</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">errorp</span> &nbsp;<span class="argument">complete?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Decodes UPI and returns the value, the type-code and any extra information as multiple values. </p>
<ul>
<li><p><code>upi</code> - the UPI to decode</p></li>
<li><p><code>:db</code> - specifies the triple-store from which the UPI originates.</p></li>
<li><p><code>:complete?</code> - controls whether the returned value is required to be a complete representation of the UPI. Currently it only affects dates and date-times for which the non-complete representation is a rational while the complete representation is a cons whose car is the same rational and whose cdr is a generalized boolean that's true if and only if the date or date-time has a timezone specified. Complete representations round-trip in the sense of: <code>(upi= (value-&gt;upi (upi-&gt;value upi :complete? t) (upi-type-code upi)) upi)</code>. </p></li></ul><p>The value, type-code, and extra information are interpreted as follows: </p>
<ul>
<li><p>value - a string, rational, float, symbol, or cons representing the contents of the UPI. UPIs representing numeric types are converted into an object of the appropriate lisp type (integer, rational or float).  Dates and date-times are by default converted into a single integer or rational respectively, standing for the number of seconds since January 1, 1900 GMT. See the <code>:complete?</code> parameter on how to recover the timezone information. For a default graph upi, value is :default-graph.  For a blank node, value is the blank node's integer representation (each unique blank node in a store gets a different number). Everything else is converted to a string. </p>
<li><p>type-code - an integer corresponding to one of the defined UPI types (see <a href="#supported-types" title="description of supported-types">supported-types</a> for more information). You can use <a href="#type-code-:3Etype-name" title="description of type-code->type-name">type-code-&gt;type-name</a> to see the English name of the type. </p></li>
<li><p>extra - There are three disjoint sets of literals in RDF:</p>
<ol>
<li>"simple literals" -- a string. </li>
<li>literals with datatypes </li>
<li>literals with language annotations. </li></ol></li></li><p>A literal cannot have both a language and a datatype; if a literal has <code>type-name</code> :literal-typed (i.e., its <code>type-code</code> is 2), then the <code>extra</code> value is a datatype URI; if its <code>type-code</code> is 3, then <code>extra</code> will be the language code. For some UPIs, including default graphs and blank nodes, the extra is an integer reserved for use by AllegroGraph. </p></ul><p>Examples: </p>
<pre><code>&gt; (upi-&gt;value (value-&gt;upi 22 :byte))  
22  
18  
nil  
 
&gt; (upi-&gt;value (upi (literal "hello" :language "en")))  
"hello"  
3  
"en" </code></pre><p>Note that upi-&gt;value will signal an error if called on geospatial UPIs. Use upi-&gt;values instead. </p><p>See <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> for additional information. </p>
</div>
</div>
  <div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">value-&gt;upi</span>
<span class="documentation-arguments"><span class="argument">value</span> &nbsp;<span class="argument">encode-as</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a <code>UPI</code> that encodes <code>value</code> using type <code>encode-as</code>. </p><p><code>encode-as</code> can be a type-code or a type-name (see <a href="#supported-types" title="description of supported-types">supported-types</a> and <a href="#type-name-:3Etype-code" title="description of type-name->type-code">type-name-&gt;type-code</a> for details. If a <code>upi</code> keyword argument is not supplied, then a new UPI will be created. See <a href="#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> for information on retrieving the original value back from an encoded UPI. </p><p>The allowable value for <code>value</code> varies depending on the type into which it is being encoded. If the type is numeric, then value may be either a string representing a number in XSD format or a number.  If the type is a date, time or dateTime, then value may be a string representing an XSD value of the appropriate type, or a number in extended universal time (this number will be assumed to have its timezone in GMT), or a cons whose <code>car</code> is a number representing an extended universal time and whose <code>cdr</code> is either <code>t</code>, <code>nil</code>, or an integer representing the timezone offset in minutes from GMT. If the <code>cdr</code> is nil, then the date or time will have no timezone information; if it is <code>t</code>, then the date or time will be in GMT. Here are some examples: </p>
<pre><code>&gt; (part-&gt;string (value-&gt;upi 2 :byte))  
"2"^^&lt;http://www.w3.org/2001/XMLSchema#byte&gt;  
 
&gt; (part-&gt;string (value-&gt;upi "23.5e2" :double-float))  
"2.35E3"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt;  
 
&gt; (part-&gt;string (value-&gt;upi (get-universal-time) :time))  
"18:36:54"^^&lt;http://www.w3.org/2001/XMLSchema#time&gt;  
 
&gt; (part-&gt;string (value-&gt;upi (cons (get-universal-time) -300) :time))  
"13:37:08-05:00"^^&lt;http://www.w3.org/2001/XMLSchema#time&gt;  
 
&gt; (part-&gt;string (value-&gt;upi (cons (get-universal-time) nil) :date-time))  
"2015-03-31T18:39:08"^^&lt;http://www.w3.org/2001/XMLSchema#dateTime&gt; </code></pre><p>Note the lack of timezone in the final example. </p><p>Note that <code>value-&gt;upi</code> can not create <em>hashed</em> UPIs (i.e., UPIs whose value must be stored in the string dictionary. To create these, use <a href="#intern-resource" title="description of intern-resource">intern-resource</a> and <a href="#intern-literal" title="description of intern-literal">intern-literal</a>. </p>
</div>
</div>
  
<a name="function.clear-type-mappings" id="function.clear-type-mappings"></a>
<a name="clear-type-mappings" id="clear-type-mappings"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">clear-type-mappings</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">keep-automatic-type-mappings</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Remove all type mappings from the triple store <code>db</code>. </p><p>Remove type mappings added with <a href="#datatype-mapping" title="description of datatype-mapping">datatype-mapping</a> and <a href="#predicate-mapping" title="description of predicate-mapping">predicate-mapping</a> from the triple-store <code>db</code>. If <code>db</code> is not specified, it defaults to the value of  <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p><p><code>keep-automatic-type-mappings</code> controls whether or not the automatically mapped types stay mapped or if they are also cleared. This defaults to true. Use <a href="#automatically-mapped-types" title="description of automatically-mapped-types">automatically-mapped-types</a> to see which types are mapped automatically. </p>
</div>
</div>
  
<a name="function.collect-all-type-mappings" id="function.collect-all-type-mappings"></a>
<a name="collect-all-type-mappings" id="collect-all-type-mappings"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">collect-all-type-mappings</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a list of the datatype and predicate mappings of <code>db</code>. </p>
<ul>
<li>:db - defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>.</li></ul><p>Each item in the list returned consists of a list of three elements: </p>
<ol>
<li>the URIref used for the mapping (predicate or datatype) </li>
<li>the type-code of the mapping </li>
<li>a keyword that indicates if the mapping is a <code>:datatype</code> or <code>:predicate</code> mapping. </li></ol>
</div>
</div>
  
<a name="function.map-all-type-mappings" id="function.map-all-type-mappings"></a>
<a name="map-all-type-mappings" id="map-all-type-mappings"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-all-type-mappings</span>
<span class="documentation-arguments"><span class="argument">fn</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Applies <code>fn</code> to each datatype and predicate mapping of <code>db</code>. </p>
<ul>
<li>:db - defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>.</li></ul><p><code>fn</code> should be a function of three arguments. For each mapping, it will called with </p>
<ol>
<li>the URIref used for the mapping (predicate or datatype) </li>
<li>the type-code of the mapping (if simple) or the mapping identifier (if geospatial) </li>
<li>a keyword that indicates if the mapping is a <code>:datatype</code> or <code>:predicate</code> mapping. </li></ol><p>(See <a href="#collect-all-type-mappings" title="description of collect-all-type-mappings">collect-all-type-mappings</a> if you just want a list of the mappings.). </p>
</div>
</div>
  
<a name="function.print-type-mappings" id="function.print-type-mappings"></a>
<a name="print-type-mappings" id="print-type-mappings"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">print-type-mappings</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Print the type mappings of <code>db</code> to <code>*standard-output*</code>. </p><p>If not specified, <code>db</code> defaults to  <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
   <a name='ref-federation' id='ref-federation'></a> <h3>Federation</h3> <h2>Managing Massive Data - Federation</h2><p>The block diagram we <a href="#ref-triple-store-structure" title="">saw above</a> is abstract: it can be implemented in many different ways. AllegroGraph 6.4.2 uses the same programming API to connect to local triple-stores (either on-disk or in-memory), remote-triple-stores and <em>federated triple-store</em>s. A federated store collects multiple triple-stores <em>of any kind</em> into a single virtual store that can be manipulated as if it were a simple local-store. Federation provides three big benefits: </p>
<ol>
<li>it scales well, </li>
<li>it makes triple-stores more manageable, and </li>
<li>it makes data archive extremely simple. </li></ol><p>A <a href="agraph-introduction.html#intro-federation" title="">high-level description</a> of these benefits is provided in the AllegroGraph introduction. This guide focuses on the classes that are used to build a federation.  </p><a name='ref-internal-architecture' id='ref-internal-architecture'></a> <h3>AllegroGraph's internal architecture</h3><p>Internally, an open AllegroGraph triple-store is an instance of one of the classes depicted below. Most of the time, you won't need to be concerned with this class implementation because AllegroGraph will manage it transparently. We're depicting them here because they also serve to illustrate many of AllegroGraph's capabilities. </p><p><img src="triple-store-classes.png" alt="AllegroGraph Triple-store Classes"></img> </p><p>Let's look at each of these in turn. </p><p>An Abstract-triple-store defines the main interfaces a triple-store must implement. This class has four main subclasses: </p>
<ol>
<li><p><a href="#concrete-triple-store" title="description of concrete-triple-store">concrete-triple-store</a>s manage actual triples whereas the other three function as wrappers between <em>real</em> triples and the store. These can be instances of <a href="#triple-db" title="description of triple-db">triple-db</a> or <a href="#in-memory-triple-store" title="description of in-memory-triple-store">in-memory-triple-store</a>. </p></li>
<li><p><a href="#federated-triple-store" title="description of federated-triple-store">federated-triple-store</a>s provide mechanisms to group and structure arbitrary collections of other triple-stores. </p></li>
<li><p><a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">Encapsulated-triple-store</a>s let us add new behaviors to existing stores in a controlled and easily optimized fashion. The best example of an encapsulated-store is a <a href="#reasoning-triple-store" title="description of reasoning-triple-store">reasoning-triple-store</a> which endow triple-stores with RDFS++, rule based or other reasoning engines.  Other  encapsulated-store examples are <a href="#graph-filtered-triple-store" title="description of graph-filtered-triple-store">graph-filtered-triple-store</a> and <a href="#ground-only-triple-store" title="description of ground-only-triple-store">ground-only-triple-store</a>. </p></li>
<li><p>Finally, a <a href="#remote-triple-store" title="description of remote-triple-store">remote-triple-store</a> lets AllegroGraph use triple-stores being served by other processes either locally or anywhere on the network. These triple-stores can be other AllegroGraph stores or connections to Oracle and Sesame ones.
<a name="fnr7-2018-06-08" id="fnr7-2018-06-08"></a>
<sup><a href="#fn7-2018-06-08">8</a></sup>  </p></li></ol><p>By combining these four classes, you can build a triple-store composed of leaf stores from anywhere, implementing differing reasoning rules, from entirely different architectures and treat them as if they comprise a single unified store living on your desktop. </p><h4>Managing triple-stores</h4>
<a name="function.federate-triple-stores" id="function.federate-triple-stores"></a>
<a name="federate-triple-stores" id="federate-triple-stores"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">federate-triple-stores</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="argument">stores</span> &nbsp;<span class="marker">&amp;key</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Create a new federated triple-store named <code>name</code> which federates each of the triple-stores listed in <code>stores</code>. This also sets <code>*db*</code> to the value of the federated store. 
</div>
</div>
  
<a name="function.encapsulate-triple-store" id="function.encapsulate-triple-store"></a>
<a name="encapsulate-triple-store" id="encapsulate-triple-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">encapsulate-triple-store</span>
<span class="documentation-arguments"><span class="argument">db</span> &nbsp;<span class="argument">name</span> &nbsp;<span class="argument">wrapper-class</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">wrapper-initargs</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Create a new <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a> wrapping <code>db</code> and and return it. </p><p>The new store will be named <code>name</code> and will be of type <code>wrapper-class</code> (which must be a subclass of <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a>. The additional <code>wrapper-initargs</code> are passed along to the newly created store. </p>
</div>
</div>
  
<a name="function.make-graph-filtered-store" id="function.make-graph-filtered-store"></a>
<a name="make-graph-filtered-store" id="make-graph-filtered-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">make-graph-filtered-store</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">name</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">graphs</span> &nbsp;<span class="argument">cached-wrapper-key</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Create an encapsulated triple-store that allows only triples in specified graphs to be seen. </p><p>The encapsulated triple-store </p>
<ul>
<li><p><code>db</code> - the store to be encapsulated.  The default is taken from    <code>*db*</code>. </p></li>
<li><p><code>name</code> - a unique name for the new store.  The default is to prefix the name of the inner store with <code>graph-filtered-</code> and add a gensym suffix. </p></li>
<li><p><code>graphs</code> - A non-empty list of triple part specifiers.  Only the triples in the graphs specified by this list are visible in the encapsulated store. </p></li>
<li><code>cached-wrapper-key</code> - If this argument is <code>nil</code>, the call creates a new instance of a filtering wrapper.  If the argument is <code>t</code>, a new key is generated from the list of graphs.  This key will be equalp to any other key generated from the same set of graphs.  If the argument is any other non-nil value, it is used as a key in an equalp hash-table; if a previously created wrapper is found, the previous instance is returned.  If no entry is found, a new wrapper is created and saved in the table.  The default value is taken from the variable <code>*cached-wrapper-key*</code>.  The initial value of this variable is <code>nil</code>. </li></ul>
</div>
</div>
  
<a name="macro.inner-triple-store" id="macro.inner-triple-store"></a>
<a name="inner-triple-store" id="inner-triple-store"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">inner-triple-store</span>
<span class="documentation-arguments"><span class="argument">store</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Removes one layer of encapsulation from an <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a> and returns the triple-store that was encapsulated. </p><p>If <code>store</code> is not encapsulated, then this returns <code>store</code> unchanged. See <a href="#encapsulate-triple-store" title="description of encapsulate-triple-store">encapsulate-triple-store</a> for details. </p>
</div>
</div>
  
<a name="function.ground-triple-store" id="function.ground-triple-store"></a>
<a name="ground-triple-store" id="ground-triple-store"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">ground-triple-store</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>This function returns a triple store that does not contain any inferred triples. </p><p>If the given triple store is not a reasoning store, then it is returned unchanged. </p><p>If the triple store is a reasoning encapsulation, then the inner triple store is returned. </p><p>In some cases, the function returns a new encapsulated store instance that represents the desired intent. </p>
</div>
</div>
  <h4>Triple-store classes</h4>
<a name="class.abstract-triple-store" id="class.abstract-triple-store"></a>
<a name="abstract-triple-store" id="abstract-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">abstract-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">The base class of all AllegroGraph triple-store instances. It is responsible for managing resources local to the store (e.g., threads, files and the like) and for keeping track of the triple-store's ID. 
</div>
</div>
  
<a name="class.concrete-triple-store" id="class.concrete-triple-store"></a>
<a name="concrete-triple-store" id="concrete-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">concrete-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">A concrete-triple-store is a container for real, honest-to-goodness (i.e., <em>concrete</em>) triples. 
</div>
</div>
  
<a name="class.encapsulated-triple-store" id="class.encapsulated-triple-store"></a>
<a name="encapsulated-triple-store" id="encapsulated-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">encapsulated-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">A triple-store that wraps its <a href="#inner-triple-store" title="description of inner-triple-store">inner-triple-store</a> in order to provide additional processing or override the usual processing. A <a href="#reasoning-triple-store" title="description of reasoning-triple-store">reasoning-triple-store</a> is a kind of encapsulated-triple-store. 
</div>
</div>
  
<a name="class.federated-triple-store" id="class.federated-triple-store"></a>
<a name="federated-triple-store" id="federated-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">federated-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">A federated-triple-store composes one or more leaf stores so that they can be treated as a single store. See the <a href="#ref-federation" title="">reference guide</a> for details. 
</div>
</div>
  
<a name="class.reasoning-triple-store" id="class.reasoning-triple-store"></a>
<a name="reasoning-triple-store" id="reasoning-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">reasoning-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">An <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a> that adds reasoning to a triple-store. This store contains a <a href="#reasoner" title="description of reasoner">reasoner</a> slot that controls the sort of reasoning that the triple-store supplies. The <a href="#rdfs:2B:2B-reasoner" title="description of rdfs++-reasoner">rdfs++-reasoner</a> is an example of the sort of reasoning that AllegroGraph provides. 
</div>
</div>
  
<a name="class.filtered-triple-store" id="class.filtered-triple-store"></a>
<a name="filtered-triple-store" id="filtered-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">filtered-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">An <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a> that presents a subset of the triples in the inner store. 
</div>
</div>
  
<a name="class.graph-filtered-triple-store" id="class.graph-filtered-triple-store"></a>
<a name="graph-filtered-triple-store" id="graph-filtered-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">graph-filtered-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">An <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a> that presents a subset of the triples in the inner store based on a fixed set of graph labels. 
</div>
</div>
  
<a name="class.ground-only-triple-store" id="class.ground-only-triple-store"></a>
<a name="ground-only-triple-store" id="ground-only-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">ground-only-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">An <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a> that excludes inferred triples from any search results. 
</div>
</div>
  
<a name="class.in-memory-triple-store" id="class.in-memory-triple-store"></a>
<a name="in-memory-triple-store" id="in-memory-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">in-memory-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents"><p>An <code>in-memory-triple-store</code> implements the AllegroGraph API for a triple-store contained entirely in memory. </p><p>Note that in-memory-triple-stores work well only for small triple-stores, do not implement fast range-queries and may be missing full support for other AllegroGraph features. </p>
</div>
</div>
  
<a name="class.remote-triple-store" id="class.remote-triple-store"></a>
<a name="remote-triple-store" id="remote-triple-store"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">remote-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">A <code>remote-triple-store</code> acts as a local proxy for a triple-store located in another AllegroGraph process. This process can be on the same machine or somewhere out on the network. A connection to a <code>remote-triple-store</code> requires a <code>port</code>, <code>username</code> and <code>password</code> and accepts an optional <code>scheme</code>. 
</div>
</div>
  
<a name="class.triple-db" id="class.triple-db"></a>
<a name="triple-db" id="triple-db"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-db</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents"><p>The default triple-store class used by AllegroGraph in calls to <a href="#create-triple-store" title="description of create-triple-store">create-triple-store</a>, <a href="#open-triple-store" title="description of open-triple-store">open-triple-store</a> and so on. </p><p><code>triple-db</code> implements the full AllegroGraph API and represents a triple-store accessed directly on a server. They should be compared with <a href="#remote-triple-store" title="description of remote-triple-store">remote-triple-store</a>s which function via client API. </p>
</div>
</div>
  <p><em>Note</em> AllegroGraph's federated triple-stores help solve problems associated with the management and understanding of massive datasets -- AllegroGraph does not keep track of where those datasets live or how to access them. You are responsible for finding each leaf triple-store and configuring them as best suits your particular problem space. You are also responsible for ensuring that leaf triple-stores remain open for as long as the federation is in use. Franz will continue to enhance AllegroGraph's federation support and the persistence of complex relationships between triple-stores. Please be sure you are using the most recent release of AllegroGraph and to contact us (support@franz.com) if you have any questions or issues. </p><h3>Modifying data in federated triple-stores</h3><p>With a few exceptions that will be mentioned below, AllegroGraph treats federated triple-stores as if they were <em>read-only</em>. The primary reason for this is that AllegroGraph cannot know which of the leaf triple-stores you wish to modify. You can still make modifications to a federated triple-store, but to do so you must select one of the leaf stores and modify it. </p><h3>Federation, triple-ids, default-graphs and blank nodes </h3><p>Federation adds a new ambiguity to triples, the default-graph and blank node identifiers: from which leaf store did they come? To see the sort of problem that can arise, imagine that we federate two small stores into one as in the figure below: </p><p><img src="federation-blank-nodes.png" alt="Sample Federation" id="federation-blank-nodes"></img> </p><p>Now let's try a simple query: What is the <code>rdf:type</code> of the thing whose <code>ex:isNamed</code> is <code>&lt;Gary&gt;</code>? To answer this, we would first ask for the triples whose predicate is <code>ex:isNamed</code> and whose object is <code>&lt;Gary&gt;</code> and find this: </p>
<pre><code>_:anon1 ex:isNamed "Gary" </code></pre><p>then we would ask for the triples whose subject is <code>_:anon1</code> and whose predicate is <code>rdf:type</code>. If the federation could not tell blank nodes from different stores apart, then it would give us back two answers: </p>
<pre><code>_anon1 rdf:type &lt;Human&gt;  
_anon1 rdf:type &lt;Dog&gt; </code></pre><p>and that would be wrong! </p><p>To prevent this, AllegroGraph keeps track of the originating triple-store for each blank node, triple-id and default-graph UPI. If you look at any of these UPIs or triples in its raw form (i.e., if <a href="#enable-print-decoded" title="description of enable-print-decoded">enable-print-decoded</a> is nil), then you will see that some of the bytes in these data-structures encode the triple-store's ID. </p><p>Franz is still exploring the semantics surrounding some of these issues (for example, sometimes if may make more sense to allow multiple leaf stores to use the same default-graph UPI) and will continue to improve federation support by making it more flexible without giving up its speed or ease of use. </p> <a name='ref-simple-reification' id='ref-simple-reification'></a> <h3>Simple Reification</h3> <p>Suppose I have triple <strong>t</strong> that states <strong>s</strong> <strong>p</strong> <strong>o</strong> and I want to further claim that I believe it. I'd like to say: </p>
<ul>
<li>name:Gary believes <strong>t</strong></li></ul><p>This ability to talk about an assertion is called reification. In RDF, reifying a triple requires creating a new blank node (<code>_:anon</code>) so that we can say </p>
<ul>
<li>name:Gary believes _:anon</li></ul><p>and then making (at least) four assertions: </p>
<ol>
<li>_:anon is rdf:type rdfs:Statement, </li>
<li>_:anon has rdfs:subject <strong>s</strong>, </li>
<li>_:anon has rdfs:predicate <strong>p</strong> , and </li>
<li>_:anon has rdf:object <strong>o</strong> </li></ol><p>This is a lot of work when all we really want is to say something about an assertion. Because AllegroGraph provides both persistent <a href="#function.triple-id" title="description of function triple-id">triple-id</a>s and encoded UPIs, we can reify another triple by saying simply: </p>
<ul>
<li>name:Gary believes [the triple-id of <strong>t</strong>]</li></ul><p>In Java, the code for this would look like: </p>
<pre><code>AllegroGraph ag;  
Triple t;  
 
...  
 
ag.addStatement("&lt;name:Gary&gt;", "&lt;some:believes&gt;",  
                ag.createEncodedLiteral(t.queryAGId(), "triple-id")); </code></pre><p>and in Lisp, we would use <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> with a type-code of +triple-id-tag+.  </p> <a name='ref-query-env' id='ref-query-env'></a> <h3>Query environments</h3> 
<a name="macro.with-query-environment" id="macro.with-query-environment"></a>
<a name="with-query-environment" id="with-query-environment"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">with-query-environment</span>
<span class="documentation-arguments">(<span class="marker">&amp;key</span> &nbsp;<span class="argument">use-upi-maps-p</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">default-base</span> &nbsp;<span class="argument">check-cursors-discarded?</span> &nbsp;<span class="argument">warn-on-leaked-cursors?</span> &nbsp;<span class="argument">init-string-table?</span>) &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Execute <code>body</code> (which is assumed to include queries) and cleanup any lingering cursors. </p><p>If not written carefully, query code (e.g., code that uses <a href="#get-triples" title="description of get-triples">get-triples</a>) can fail to discard the cursors it creates. These undiscarded cursors will eventually be garbage collected and the resources they use will be freed but these <code>leaks</code> can interfere with AllegroGraph's performance and should be avoided. </p><p>The <code>with-query-environment</code> macro wraps <code>body</code> with additional bookkeeping code that will ensure that all cursors are properly discarded (cf. <code>with-open-file</code>). It is used internally by both the SPARQL and Prolog query engines. </p><p>The parameters are: </p>
<ul>
<li><p><code>db</code> - If supplied, binds <code>*db*</code> to <code>db</code> for in the body of the macro.</p></li>
<li><p><code>warn-on-leaked-cursors</code> - If false, then no warning messages will be logged when cursors are leaked. Note that the cursors will still be discarded but the action will occur silently. </p></li></ul><p>These parameters are for internal use and should not be used by client code: </p>
<ul>
<li><p><code>use-upi-maps-p</code> - (deprecated) Controls whether or not UPI-maps will be used while running the query. This is only relevant for the Prolog query engine. </p></li>
<li><p><code>default-base</code> - Used only by the SPARQL query engine.</p></li>
<li><p><code>check-cursors-discarded?</code> - (for internal use only)</p></li>
<li><p><code>init-string-table?</code> - If true, a call to <code>ready-query-environment-string-table</code> will occur prior to body evaluation. </p></li></ul><p>Note that query-environments do not nest. I.e., if multiple <code>with-query-environment</code> forms are used, the cleanup will only occur when the outermost one exits. </p>
</div>
</div>
   <a name='ref-sparql' id='ref-sparql'></a> <h3>SPARQL Query Language</h3> 
<a name="function.parse-sparql" id="function.parse-sparql"></a>
<a name="parse-sparql" id="parse-sparql"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">parse-sparql</span>
<span class="documentation-arguments"><span class="argument">string</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">default-prefixes</span> &nbsp;<span class="argument">default-base</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Parse a SPARQL query string into an s-expression. </p><p>This function is useful for three reasons: validation and inspection of queries, manual manipulation of query expressions without text processing, and performing parsing at a more convenient time than during query execution. </p><p>You do not need an open triple-store in order to parse a query. Any parse errors will signal a <code>sparql-parse-error</code>. </p><p>The optional arguments provide <code>BASE</code> and <code>PREFIX</code> arguments to the parser without inserting them textually into the query. </p>
<dl><dt><code>default-base</code> </dt>
<dd>A string to use as the BASE for the SPARQL query.</dd><dt><code>default-prefixes</code> </dt>
<dd>A <code>dictionary</code> or <code>hash-table</code> mapping string prefixes to their namespace expansions, or a list of two element lists where each sublist contains the prefix and its expansion. For example: 
<pre><code>(("rdf" "http://www.w3.org/1999/02/22-rdf-syntax-ns#")  
 ("rdfs" "http://www.w3.org/2000/01/rdf-schema#")  
 ("owl" "http://www.w3.org/2002/07/owl#")  
 ("xsd" "http://www.w3.org/2001/XMLSchema#")  
 ("xs" "http://www.w3.org/2001/XMLSchema#")  
 ("fn" "http://www.w3.org/2005/xpath-functions#")  
 ("err" "http://www.w3.org/2005/xqt-errors#")) </code></pre></dd><p>This list uses the same format as <a href="#x:2Astandard-namespaces:2A" title="description of *standard-namespaces*">db.agraph:<em>standard-namespaces</em></a>. </p></dl><p><code>parse-sparql</code> returns the s-expression representation of the query string. </p>
</div>
</div>
  
<a name="function.run-sparql" id="function.run-sparql"></a>
<a name="run-sparql" id="run-sparql"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">run-sparql</span>
<span class="documentation-arguments"><span class="argument">query</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">engine</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">default-base</span> &nbsp;<span class="argument">default-prefixes</span> &nbsp;<span class="argument">output-stream</span> &nbsp;<span class="argument">if-exists</span> &nbsp;<span class="argument">if-does-not-exist</span> &nbsp;<span class="argument">results-format</span> &nbsp;<span class="argument">rdf-format</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">offset</span> &nbsp;<span class="argument">from</span> &nbsp;<span class="argument">from-named</span> &nbsp;<span class="argument">default-dataset-behavior</span> &nbsp;<span class="argument">default-graph-uris</span> &nbsp;<span class="argument">using-named-graph-uri</span> &nbsp;<span class="argument">remove-graph-uri</span> &nbsp;<span class="argument">using-graph-uri</span> &nbsp;<span class="argument">insert-graph-uri</span> &nbsp;<span class="argument">with-variables</span> &nbsp;<span class="argument">destination-db</span> &nbsp;<span class="argument">cancel-query-on-warnings-p</span> &nbsp;<span class="argument">host</span> &nbsp;<span class="argument">basic-authorization</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">uuid</span> &nbsp;<span class="argument">log-query</span> &nbsp;<span class="argument">load-function</span> &nbsp;<span class="argument">verbosep</span> &nbsp;<span class="argument">permitted-verbs</span> &nbsp;<span class="argument">parsed-package</span> &nbsp;<span class="argument">primary?</span> &nbsp;<span class="argument">parent-executor</span> &nbsp;<span class="argument">service-db</span> &nbsp;<span class="argument">extendedp</span> &nbsp;<span class="argument">planner</span> &nbsp;<span class="argument">user-attributes-prefix-permission-p</span> &nbsp;<span class="marker">&amp;allow-other-keys</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p><code>run-sparql</code> takes a SPARQL query or update command as input and returns bindings or new triples as output. </p><p><code>SELECT</code>, <code>ASK</code> and <code>UPDATE</code> query results will be presented according to the value provided for <code>results-format</code>, whilst the RDF output of <code>DESCRIBE</code> and <code>CONSTRUCT</code> will be serialized according to <code>rdf-format</code>. Both of these arguments take keyword values. </p><p>If the format is programmatic (that is, it is intended to return values rather than print a representation; <code>:arrays</code> is an example) then any results will be returned as the first value, and nothing will be printed on <code>output-stream</code>. </p>
<ul>
<li>The <code>query</code> can be a string, which will be parsed by   <code>parse-sparql</code>, an s-expression as produced by   <code>parse-sparql</code>, or a query plan generated by a previous call   to <code>run-sparql</code>. The s-expression syntax is described in   greater detail in the <a href="sparql-sexpr.html">reference</a>.   If you expect to run a query many times,   you can avoid some parser overhead by parsing or planning your query   once and calling <code>run-sparql</code> with the parsed   representation. <p>If <code>query</code> is a string, then <code>default-base</code> and     <code>default-prefixes</code> are provided to <a href="#parse-sparql" title="description of parse-sparql">parse-sparql</a> to use     when parsing the query. The former specifies a <code>BASE</code> when none     is provided and the later specifies a set of namespace     abbreviations to use when parsing. Parser errors signaled     within <a href="#parse-sparql" title="description of parse-sparql">parse-sparql</a> will be propagated onwards by     <code>run-sparql</code>. </p></li>
<li><p><code>default-base</code> A string to use as the BASE for the SPARQL   query (only used when <code>query</code> is a string). </p>
<li><p><code>default-prefixes</code> A <code>hash-table</code> mapping string prefixes to their   expansions or a list of two element lists where each sublist   contains the prefix and its namespace expansion (only used when   <code>query</code> is a string; see <a href="#parse-sparql" title="description of parse-sparql">parse-sparql</a> for details). </p></li>
<li><p>Results or new triples will be serialized to <code>output-stream</code>. If a   programmatic format is chosen for output, the stream is   irrelevant. An error will be signaled if <code>output-stream</code> is not a   stream, <code>t</code> (for output to <code>*standard-output*</code>), or <code>nil</code> (for output   to a string) or a pathname.  If a pathname is specified, then the   <code>if-exists</code> and <code>if-does-not-exist</code> parameters will be as used to   create an output stream. </p></li>
<li><p>If <code>from</code> or <code>from-named</code> are provided,   they override the corresponding values specified in the   query string itself. As <code>FROM</code> and <code>FROM NAMED</code> together   define a dataset, and the SPARQL Protocol specification   states that a dataset specified in the protocol (in this   case, the programmatic API) overrides that in the query, if   either <code>from</code> or <code>from-named</code> are non-<code>nil</code> then any   dataset specifications in the query are ignored. You can   specify that the contents of the query are to be partially   overridden by providing <code>t</code> as the value of one of these   arguments. This is interpreted as 'use the contents of the   query'. <code>from</code> and <code>from-named</code> should be lists of URIs:   future-parts, UPIs, or strings. </p></li>
<li><p>If the <code>limit</code> parameter is specified and the query string   also contains a LIMIT, then the minimum of the two will   be used. </p></li>
<li><p>If the <code>offset</code> parameter is specified and the query string   also contains an OFFSET, then the sum of the two will be   used. </p></li>
<li><p>The <code>using-named-graph-uri</code> and <code>using-graph-uri</code> parameters   are used similarly to the <code>from</code> and <code>from-named</code> parameters   except that they are relevant only to SPARQL UPDATE commands. </p></li>
<li><p>The <code>remove-graph-uri</code> and <code>insert-graph-uri</code> parameters are   also used only in SPARQL update. The first specifies a graph or   list of graphs from which each triple to be deleted should be   removed whereas the second specifies a graph or   list of graphs into which each triple to be inserted should be   added. </p></li>
<li><p><code>default-dataset-behavior</code> controls how the query engine   builds the dataset environment if <code>FROM</code> or <code>FROM NAMED</code>   are not provided. Valid options are <code>:all</code> (ignore graphs;   include all triples) and <code>:default</code> (include only the   store's default graph). </p></li>
<li><p><code>default-graph-uris</code> allows you to specify a list of   resources which, when encountered in the SPARQL dataset   specification, are to be treated as the default graph of   the store. Each resource can be a resource UPI, resource   future-part, or a URI string. For example, specifying   '("http://example.com/default") will cause a query   featuring </p>
<pre><code>FROM &lt;http://example.com/default&gt;  
FROM &lt;http://example.com/baz&gt; </code></pre></li></li><p>to execute against the union of the contents of the named graph <code>&lt;http://example.com/baz&gt;</code> and the store's default graph, as determined by <code>(default-graph-upi db)</code>. </p>
<li><code>with-variables</code> should be an alist of variable names and   values. The variable names can be strings (which will be   interned in the package in which the query is parsed) or   symbols (which should be interned in the package in which   the query is to be, or was, parsed). The variable names can   include or omit a leading '?'. Note that a query literal in   code might be parsed at compile time. Using strings is the   most reliable method for naming variables. </li><p>Before the query is executed, the variables named after symbols will be bound to the provided values. </p><p>This allows you to use variables in your query which are externally imposed, or generated by other queries. The format expected by <code>with-variables</code> is the same as that used for each element of the list returned by the <code>:alists</code> <code>results-format</code>. </p>
<li><p><code>db</code> (<a href="#x:2Adb:2A" title="description of *db*"><code>*db*</code></a> by default) specifies the triple store   against which queries should run. </p></li>
<li><p><code>destination-db</code> (<code>db</code> by default) specifies the triple   store against which Update modifications should take place.   This is primarily of use when <code>db</code> is a read-only wrapper   around a writable store, such as when reasoning has been   applied. </p></li>
<li><p>If <code>verbosep</code> is non-<code>nil</code>, status information is written   to <code>*sparql-log-stream*</code> (<code>*standard-output*</code> by default). </p></li>
<li><p><code>basic-authorization</code> is used when making SPARQL SERVICE   calls. It must be a cons cell whose <code>car</code> is the user name and   whose <code>cdr</code> is the password. For example: `("test" . "password"). </p></li>
<li><p><code>load-function</code> must be <code>nil</code> or a function with signature <code>(uri db   type)</code>. If it is a function, it is called once for each <code>FROM</code> and   <code>FROM NAMED</code> parameter making up the dataset of the query. The   execution of the query commences once each parameter has been   processed. The <code>type</code> argument is either <code>:from</code> or <code>:from-named</code>,   and the <code>uri</code> argument is a part (ordinarily a <code>future-part</code>) naming   a URI. The default value is taken from   <code>*dataset-load-function*</code>. You can use this hook function to   implement loading of RDF before the query is executed. </p></li>
<li><p>If <code>cancel-query-on-warnings-p</code> is true, then any warning   found during query planning will immediately cancel the query.   Setting this to true can help in query debugging. </p></li>
<li><p><code>host</code> can be used to specify the URL of a SPARQL endpoint.   If <code>host</code> is given, then AllegroGraph will send the query   to the endpoint, retrieve any results and emit them in the   format specified by <code>results-format</code> or <code>rdf-format</code> as   appropriate. </p></li>
<li><p><code>timeout</code> should be the number of seconds after which the   query will be canceled. A value of nil means no timeout. Note   that a query timeout does not interrupt the query immediately.   Rather, the executing query will periodically check for   timeouts and cancel itself. This allows for any query resources   to be properly reclaimed. </p></li>
<li><p>The <code>engine</code> keyword specifies which query engine to use.  Allowable   values keyword symbols returned by <a href="sparql-reference.html#valid-query-engines" title="description of valid-query-engines">valid-query-engines</a>. Note   that depending on the version of AllegroGraph, there may be only a   single engine available. </p></li>
<li><p>`user-attributes-prefix-permission-p' must be given a true value in order to   run a Sparql query including "prefix franzOption_userAttributes" otherwise   an error is signalled. </p></li></ul><p>The values returned by <code>run-sparql</code> are dependent on the verb used. The first value is typically disregarded in the case of results being written to <code>output-stream</code>. If <code>output-stream</code> is <code>nil</code>, the first value will be the results collected into a string (similar to the way in which <code>cl:format</code> operates). </p><p>The second value is the query verb: one of <code>:select</code>, <code>:ask</code>, <code>:construct</code>, <code>:describe</code>, or <code>:update</code>. </p><p>The third value, for <code>SELECT</code> queries only, is a list of variables. This list can be used as a key into the values returned by the <code>:arrays</code> and <code>lists</code> results formats, amongst other things. </p><p>The fourth value will be a query-information structure which contains additional information AllegroGraph gathered while executing the query. </p><p>Individual results formats are permitted to return additional values. </p><p>The following parameters are used internally by AllegroGraph and should not be used: <code>parsed-package</code>, <code>primary?</code>, <code>parent-executor</code>, <code>uuid</code>, and <code>service-db</code>. </p><p>Note that the following arguments are deprecated and should no longer be used: <code>permitted-verbs</code>, <code>extendedp</code> and <code>planner</code>. </p>
</div>
</div>
  <p>The function <strong>sparql.algebra:sparql->algebra</strong> was part of SPARQL 1.0 and is no longer supported. Contact support@franz.com if you have code which used this function. </p> <a name='ref-prolog' id='ref-prolog'></a> <h3>Prolog Select</h3> <h4>Prolog tutorial and general Allegro Prolog documentation</h4><p>There is a tutorial on using Prolog with AllegroGraph <a href="prolog-tutorial.html">here</a>. The manual for the Allegro CL Prolog implementation is <a href="/support/documentation/current/doc/prolog.html" target="_blank">here</a>. A note on the differences between using SPARQL and using Prolog for queries can be found <a href="sparql-reference.html#sparql-v-prolog">here in the SPARQL Reference</a>. </p><h4>Prolog Notation</h4><p>There are some special conventions for documenting Prolog predicates, which is the name given to operators in Prolog (they are also called <em>functors</em>). This is because a Prolog predicate call (in Lisp syntax) looks like a regular Lisp function call; the symbol naming the predicate being the first element of the list and the remaining elements being arguments.  But arguments to a Prolog predicate call can either be supplied as input to the call, or unsupplied (that is specified as a variable rather than a value) so that the clause might return possible values for that argument as a result by unifying some data to it, or may be a tree of nodes containing both ground data and Prolog variables.  See the <a href="prolog-tutorial.html">Prolog Tutorial</a> for an example using <strong>append</strong>. </p><p>That fact leads to the following notational convention: A predicate argument that is an input to the predicate and which <em>must</em> be supplied is marked in the documentaiton with a <code>+</code>.  A predicate argument that is returned by the predicate and which must <em>not</em> be supplied is marked with a <code>-</code>. An argument that can be either is marked with &plusmn;.  (Prolog documentation generally used <code>?</code> for this, but in Lisp-based Prologs that character is used as the first character of a symbol that is a Prolog variable; overloading it to indicate an input-output argument would be very confusing.)  Within this convention append would be notated as <pre>  (append &plusmn;left &plusmn;right &plusmn;result) </pre> But a predicate like <code>part=</code> which simply checks whether two parts are the same UPI and which requires two actual future-part or UPI arguments, would be documented <pre>  (part= +part1 +part2) </pre> </p><p>Be aware that sometimes names ending in a <em>/N</em>, where <em>N</em> is a number, will appear in Prolog documentation and in the debugger: for example <strong>parent/2</strong>. This is the <strong>predicate/arity</strong> syntax. The portion of that notation that is the predicate name, <strong>parent</strong> in this example, is the same as the Lisp symbol naming the predicate.  The non-negative integer after the slash is the <strong>arity</strong>, which is the number of arguments to the predicate.  Two predicates with the same predicate name but different arities are completely different predicates.  In an example in the <a href="prolog-tutorial.html">tutorial</a>, the predicate <strong>parent/1</strong> has no relation to the <strong>parent/2</strong> predicate which it calls. </p><h4>!-reader and Prolog</h4><p>Users of Prolog should note that the bang character <strong>!</strong> (also called an exclamation point) can be established as a reader macro in AllegroGraph -- see <a href="#ref-bang-reader">The !-reader and future-parts</a> -- and also has a special meaning in Prolog which conflicts with its use as a reader macro.  Using \! in Prolog code avoids this conflict and works even if the reader macro is not enabled. See <a href="prolog-tutorial.html#bang-problem" title="">Problem with use of ! in Prolog code</a> in the <a href="prolog-tutorial.html">Prolog Tutorial</a>. </p><h4>The q, q-, and qd predicates</h4><p>The main interface to Prolog is the predicate <strong>q-</strong> (for simple query). The <strong>q-</strong> predicate is analogous to <a href="#get-triples" title="description of get-triples"><code>get-triples</code></a>. There are many versions of the predicate but the simplest one has three arguments (for subject, predicate and object). You can supply any combination of these arguments and the predicate will succeed for each possible match in the triple-store, unifying its logic variables to each result in turn. The example below assumes that <a href="#enable-print-decoded" title="description of enable-print-decoded"><code>enable-print-decoded</code></a> is active. </p>
<pre><code>&gt; (?- (q- ?x !rdf:type ?z))  
?x = {http://example/ok#ViewDerivedObject}  
?z = {owl:Class}  
                   ;; type Enter  
 
?x = {http://example/ok#UserActions}  
?z = {owl:Class}  
                   ;; type period ( . )  
</code></pre><p>The <code>?-</code> Lisp macro provides a kind of read-eval-print loop suitable for making interative Prolog queries.  After a solution to the query is printed, typing 'ENTER' will continue to try to find another solution, or you can stop the iteration by typing a period ('<strong> . </strong>'). </p><p>The three variants of the <a href="#q-" title="description of q-"><code>q-</code></a> query predicate support AllegroGraph <a href="#ref-range-queries" title="">range queries</a>; see below.. </p>
<a name="functor.q" id="functor.q"></a>
<a name="q" id="q"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">q</span>
<div class="documentation-arguments">(q &plusmn;s &plusmn;p &plusmn;o)
(q &plusmn;s &plusmn;p &plusmn;o &plusmn;g)
(q &plusmn;s &plusmn;p &plusmn;o &plusmn;g &plusmn;id)
(q &plusmn;s &plusmn;p &plusmn;o &plusmn;g &plusmn;id -triple)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Query the triple-store. If the store is a simple store, then q is the same as <a href="#q-" title="description of q-">q-</a>. If the store is an <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a> (for example, a <a href="#reasoning-triple-store" title="description of reasoning-triple-store">reasoning-triple-store</a>) then q and q- will differ. Unify <code>s</code>, <code>p</code>, and <code>o</code> with the triples in the store. </p><p>The third argument may be of the form <code>(-o +o-min +o-max)</code> to specify a range of values for the object component of the triples.  Range queries are always bypass any reasoning wrappers on the store. </p><p>Unify <code>s</code>, <code>p</code>, <code>o</code>, and <code>g</code> with the triples in the store. </p><p>The third argument may be of the form (-o +o1 +o2) to specify a range of values for the object component of the triples.  Range queries always bypass any reasoning wrappers on the store. </p><p>The fourth argument may be of the form (-g +g1 +g2) to specify a range of values for the graph component of the triples.  Only one of the object or graph positions may specify a range. </p><p>The fourth argument may also be of the form (-g (:member +g1 +g2 ...)) or (-g (:member . +glist)) to specify a finite set of allowed graph values. </p><p>Unify <code>s</code>, <code>p</code>, <code>o</code>, <code>g</code>, and <code>id</code> with the triples in the store. </p><p>Unify <code>s</code>, <code>p</code>, <code>o</code>, <code>g</code>, <code>id</code> and <code>triple</code>. </p>
</div>
</div>
  
<a name="functor.q-" id="functor.q-"></a>
<a name="q-" id="q-"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">q-</span>
<div class="documentation-arguments">(q- &plusmn;s &plusmn;p &plusmn;o)
(q- &plusmn;s &plusmn;p (-o +o-min +o-max))
(q- &plusmn;s &plusmn;p &plusmn;o &plusmn;g)
(q- &plusmn;s &plusmn;p &plusmn;o (-g +g-min +g-max))
(q- &plusmn;s &plusmn;p &plusmn;o &plusmn;g &plusmn;id -triple)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Query a triple-store's ground store. If the store is not a reasoning store, then <code>q-</code> is equivalent to <a href="#q" title="description of q">q</a> Unify <code>s</code>, <code>p</code>, and <code>o</code> with the triples in the store. </p><p>The third argument may be of the form <code>(-o +o1 +o2)</code> to specify a range of values for the object component of the triples.  Range queries always bypass any reasoning wrappers on the store. </p><p>Execute a range query for triples whose object is between <code>o-min</code> and <code>o-max</code>. Unify <code>s</code> and <code>p</code>. </p><p>Unify <code>s</code>, <code>p</code>, <code>o</code>, and <code>g</code> with the triples in the store. See <code>(q ?s ?p ?o ?g)</code> for a detailed description of the arguments </p><p>Execute a range query for triples whose graph is between <code>g-min</code> and <code>g-max</code>. Unify <code>s</code>, <code>p</code>, and <code>o</code>. </p><p>Unify <code>s</code>, <code>p</code>, <code>o</code>, <code>g</code>, <code>id</code> and <code>triple</code>. </p>
</div>
</div>
  
<a name="functor.qd" id="functor.qd"></a>
<a name="qd" id="qd"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">qd</span>
<div class="documentation-arguments">(qd +db &plusmn;s &plusmn;p &plusmn;o)
(qd +db &plusmn;s &plusmn;p &plusmn;o &plusmn;g)
(qd +db &plusmn;s &plusmn;p &plusmn;o &plusmn;g &plusmn;id)
(qd +db &plusmn;s &plusmn;p &plusmn;o &plusmn;g &plusmn;id -triple)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Query the triple store specified by the first argument.  The remaining arguments specify <code></code>s<code>, </code>p<code>, </code>o<code>, and/or </code>g` components as in <a href="#q" title="description of q">q</a> and <a href="#q-" title="description of q-">q-</a>. </p><p>The first argument must be a symbol that names a store defined in a <code>:named-store</code> planner option or it must be a Prolog expression that evaluates to a triple store.  The symbol <code>*db*</code> can appear as a name; in that case the <code>qd</code> form is equivalent to a <code>q</code> form with the same triple parts. Unify <code>s</code>, <code>p</code>, and <code>o</code> with the triples in the store. </p><p>The fourth argument may be of the form <code>(-o +o1 +o2)</code> to specify a range of values for the object component of the triples.  Range queries always bypass any reasoning wrappers on the store. </p><p>Unify <code>s</code>, <code>p</code>, <code>o</code>, and <code>g</code> with the triples in the store. See <code>(q ?s ?p ?o ?g)</code> for a detailed description of the arguments </p><p>Unify <code>s</code>, <code>p</code>, <code>o</code>, <code>g</code>, and <code>id</code> with the triples in the store. </p><p>Unify <code>s</code>, <code>p</code>, <code>o</code>, <code>g,</code> <code>id</code> and <code>triple</code>. </p>
</div>
</div>
  <h4>The Select Macros</h4><p>You can combine multiple <strong>q</strong> clauses into a query using one of the family of <a href="#select" title="description of select"><code>select</code></a> macros. These evaluate a list of Prolog clauses and then do something with the solutions found
<a name="fnr8-2018-06-08" id="fnr8-2018-06-08"></a>
<sup><a href="#fn8-2018-06-08">9</a></sup> . There are three dimensions in which this family of macros differ: </p>
<ul>
<li><p>distinct - if the macro has <code>distinct</code> in its name, then each unique solution is only returned once, i.e., it will only occur in the result set once or only be used as a callback once. </p></li>
<li><p>translation - If the macro has a <code>0</code> (zero) in its name, then it will return solutions whose UPIs are not translated.  Otherwise, it will look up the UPIs in the string dictionary and return those strings. Operations like <a href="#select0" title="description of select0"><code>select0</code></a> can therefore be much faster than <a href="#select" title="description of select"><code>select</code></a> and are more natural if the UPI will be used in a subsequent query. </p></li>
<li><p>callbacks - If the macro has <code>callback</code> in its name, then you must provide a callback function that will accept a solution and do something with it.  The callback function argument is evaluated and may be either a function of one argument or the name of such a function. </p></li></ul><p>Each macro takes as its first argument a <code>template</code>. Often the template is a single <code>variable</code> or a simple list of <code>variables</code>. But the template may in general be a tree composed of Lisp data and Prolog variables. </p><p>The select macros will find each solution to the list of supplied Prolog clauses. It will then build up a fresh instance of the template tree with each Prolog variable in the tree replaced by the variable in the solution. For example: </p>
<pre><code>&gt; (select ((:name ?name) (:age ?age))  
    (q- ?x !ex:isA !ex:person)  
    (q- ?x !ex:hasName ?name)  
    (q- ?x !ex:hasAge ?age)) </code></pre><p>would return a list of results like </p>
<pre><code>(((:name "Gary") (:age 12))  
 ((:name "Xaviar") (:age 56))  
 ...  
 ) </code></pre><p>Select planner options described below can also be used to control the behavior of the select expression and the format of the result. If planner options are used for this purpose, it is recommended to use the basic <code>select</code> macro instead of the variants.  Using a variant with a conflicting option may yield unexpected results. </p><p>You can find other examples of using select in the <a href="prolog-tutorial.html">Using Prolog with AllegroGraph</a> tutorial. </p>
<a name="macro.select" id="macro.select"></a>
<a name="select" id="select"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">select</span>
<span class="documentation-arguments"><span class="argument">template</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">clauses</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Evaluate the Prolog <code>clauses</code> and return a list of all solutions. Each solution is a copy of the template (which is a tree) where each Prolog variable is replaced by its string or numeric value. See <a href="#select0" title="description of select0">select0</a> if you want UPIs rather than Lisp values. </p><p>The code generated by all the variants of this macro always binds <code>*db*</code>.  Consequently, any modification of this variable in the body clauses will disappear when control exist the code. </p>
</div>
</div>
  
<a name="macro.select0" id="macro.select0"></a>
<a name="select0" id="select0"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">select0</span>
<span class="documentation-arguments"><span class="argument">template</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">clauses</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Evaluate the <code>clauses</code> and return a list of all solutions. Solutions consist fresh copies of the template (which is a tree) where each Prolog variable in the tree is replaced by its UPI value in the solution. If you are interested in part-names rather than raw UPIs, see <a href="#select" title="description of select">select</a>. 
</div>
</div>
  
<a name="macro.select:2Fcallback" id="macro.select:2Fcallback"></a>
<a name="select:2Fcallback" id="select:2Fcallback"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">select/callback</span>
<span class="documentation-arguments">(<span class="marker">&amp;rest</span> &nbsp;<span class="argument">vars</span>) &nbsp;<span class="argument">callback</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">clauses</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Evaluate the Prolog clauses and call <code>callback</code> once for each solution. Solutions consist of a fresh copy of the template with each <code>var</code> replaced by the string or numeric value of the Prolog variable in the solution.  The callback argument is evaluated. See <a href="#select0:2Fcallback" title="description of select0/callback">select0/callback</a> if you are want UPIs rather than Lisp values. 
</div>
</div>
  
<a name="macro.select0:2Fcallback" id="macro.select0:2Fcallback"></a>
<a name="select0:2Fcallback" id="select0:2Fcallback"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">select0/callback</span>
<span class="documentation-arguments">(<span class="marker">&amp;rest</span> &nbsp;<span class="argument">vars</span>) &nbsp;<span class="argument">callback</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">clauses</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Evaluate the Prolog clauses and call <code>callback</code> once for each solution.  Each solution is a copy of the template with each Prolog variable replaced by its UPI. The callback argument is evaluated. See <a href="#select:2Fcallback" title="description of select/callback">select/callback</a> if you want strings rather than UPIs. 
</div>
</div>
  
<a name="macro.select-distinct" id="macro.select-distinct"></a>
<a name="select-distinct" id="select-distinct"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">select-distinct</span>
<span class="documentation-arguments"><span class="argument">template</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">clauses</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Evaluate the <code>clauses</code> and return a list of all <em>distinct</em> solutions.  Each solution is a copy of the template where each Prolog variable in the tree is replaced by its string or numeric value See <a href="#select0-distinct" title="description of select0-distinct">select0-distinct</a> if you want UPIs rather than Lisp values. 
</div>
</div>
  
<a name="macro.select0-distinct" id="macro.select0-distinct"></a>
<a name="select0-distinct" id="select0-distinct"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">select0-distinct</span>
<span class="documentation-arguments"><span class="argument">template</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">clauses</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Evaluate the Prolog <code>clauses</code> and return a list of all <em>distinct</em> solutions. Each solution is a copy of the template (which is a tree) where each Prolog variable is replaced by its UPI value. See <a href="#select-distinct" title="description of select-distinct">select-distinct</a> if you want strings rather than UPIs, 
</div>
</div>
  
<a name="macro.select-distinct:2Fcallback" id="macro.select-distinct:2Fcallback"></a>
<a name="select-distinct:2Fcallback" id="select-distinct:2Fcallback"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">select-distinct/callback</span>
<span class="documentation-arguments">(<span class="marker">&amp;rest</span> &nbsp;<span class="argument">vars</span>) &nbsp;<span class="argument">callback</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">clauses</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Evaluate the Prolog clauses and call <code>callback</code> once for each <em>distinct</em> solution. Each solution is a fresh copy of the template with each <code>var</code> replaced by the string or numeric value of the Prolog variable in the solution.  The callback argument is evaluated. See <a href="#select0-distinct:2Fcallback" title="description of select0-distinct/callback">select0-distinct/callback</a> if you want UPIs rather than Lisp values. 
</div>
</div>
  
<a name="macro.select0-distinct:2Fcallback" id="macro.select0-distinct:2Fcallback"></a>
<a name="select0-distinct:2Fcallback" id="select0-distinct:2Fcallback"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">select0-distinct/callback</span>
<span class="documentation-arguments">(<span class="marker">&amp;rest</span> &nbsp;<span class="argument">vars</span>) &nbsp;<span class="argument">callback</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">clauses</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Evaluate the Prolog clauses and call <code>callback</code> once for each <em>distinct</em> solution. Each solution is a fresh copy of the template with each <code>var</code> replaced by the UPI value of the Prolog variable in the solution.  The callback argument is evaluated. See <a href="#select-distinct:2Fcallback" title="description of select-distinct/callback">select-distinct/callback</a> if you want strings rather than UPIs. 
</div>
</div>
  <h4>Prolog and range queries</h4><p>You can make range queries using the same prolog <code>q</code> predicates as you do to make non-range queries. We support range queries on either the <code>object</code> or the <code>graph</code> fields (but not on both simultaneously in the same <code>q</code> call). What follows is a list of all the 9 possibilities for <code>q</code>. Each argument in the call may be a UPI literal, a Prolog variable (possibly anonymous) or nil. We use a <code>-</code> prefix on a token to indicate that it is a placeholder and it <em>cannot</em> be used as a variable; a <code>+</code> prefix to indicate that the token <em>must</em> be supplied and a <code>?</code> to indicate that the token is either. </p><p>Suppose, for example, that we use AllegroGraph to record the velocities during a mythical 1000-km trip: </p>
<pre><code>;;;;;;;;;;;;;;;;;;;; A 1000 KM trip.  
 
(in-package :triple-store-user)  
 
(create-triple-store "My1000KmTrip" :if-exists :supersede)  
 
(register-namespace "t" "http://www.me.disorg#"  
                    :errorp nil)  
 
;; add triples describing a 1000-km trip  
(loop with km = 0           ; distance in km  
    with time = 0           ; time in seconds  
    as kmh = (random 80.0)  ; velocity in km/hr  
    do (add-triple !t:me  
                   !t:distance  
                   (value-&gt;upi km :double-float)  
                   :g (value-&gt;upi time :unsigned-long))  
       (add-triple !t:me  
                   !t:velocity  
                   (value-&gt;upi kmh :double-float)  
                   :g (value-&gt;upi time :unsigned-long))  
       (incf km (/ kmh 60))  
       (incf time 60)  
    count 1             ; Number of data points, which is  
                        ; also the duration in minutes.  
    while (&lt; km 1000)) </code></pre><p>We can then use the following <code>select</code> query to find triples that represent the 1-minute periods where average speed is 75..80 km/h and the distance at which it occurred. </p>
<pre><code>(loop for (time speed distance)  
    in (sort (select (?time ?v ?distance)  
               (lisp ?v75 (value-&gt;upi 75 :double-float))  
               (lisp ?v80 (value-&gt;upi 80 :double-float))  
               (q- !t:me !t:velocity (?v ?v75 ?v80) ?time)  
               (q- !t:me !t:distance ?distance ?time))  
             #&lt; :key 'first)  
    do (format t "~7d ~5f ~5f~%" (/ time 60) speed distance)) </code></pre><p>This last form could be written more succinctly using the <strong>??</strong> syntax explained in the tutorial: </p>
<pre><code>(loop for (time speed distance)  
    in (sort (select (?time ?v ?distance)  
               (q- !t:me  
                   !t:velocity  
                   (?v (?? (value-&gt;upi 75 :double-float))  
                       (?? (value-&gt;upi 80 :double-float)))  
                   ?time)  
               (q- !t:me !t:distance ?distance ?time))  
             '&lt; :key 'first)  
    do (format t "~7d ~5f ~5f~%" (/ time 60) speed distance)) </code></pre><h4>Prolog unification</h4><p>The datatypes used by AllegroGraph for UPIs and future-parts -- respectively <code>(simple-array (unsigned-byte 8) (12))</code> and an instance of <code>structure-object</code> -- would not normally be unifyable under Prolog semantics which is basically the same as Common Lisp <code>equal</code>; thus two UPIs or future-parts would unify only if they were <code>eq</code>. But when AllegroGraph is loaded into Lisp, Prolog's concept of unification is modified to follow these rules: </p>
<ul>
<li><p>Non-eq UPIs that are equivalent (byte-for-byte the same) will unify.</p></li>
<li><p>Non-eq future-parts that resolve to the same UPI will unify.</p></li>
<li><p>A UPI and a future-part that resolves to that UPI will will unify with each other.</p></li></ul><p>This enhancement does not change the capabilities of Prolog queries in AllegroGraph, but allows simpler, less-verbose coding that looks a little more declarative and less procedural.  For example, the following </p>
<pre><code>(select (?manager ?employee)  
  (member ?employee (!acme:joe !acme:jill !acme:jim !acme:jerry))  
  (q ?employee !acme:hasManager ?manager)  
  (member ?manager (!acme:bill !acme:bob !acme:betty !acme:benjamin))) </code></pre><p>would not work as intended before this change because ?manager would be unified with a UPI, and a UPI would not unify the future-parts in the last clause.  The last clause would have had to be coded as something like </p>
<pre><code>  (member ?manager1 (!acme:bill !acme:bob !acme:betty !acme:benjamin))  
  (part= ?manager manager1)  
</code></pre><h4>Other AllegroGraph Prolog predicates</h4>
<a name="functor.subject" id="functor.subject"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">subject</span>
<div class="documentation-arguments">(subject &plusmn;subject +triple)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Unify <code>subject</code> with the subject field of <code>triple</code>. 
</div>
</div>
  
<a name="functor.predicate" id="functor.predicate"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">predicate</span>
<div class="documentation-arguments">(predicate &plusmn;predicate +triple)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Unify <code>predicate</code> with the predicate field of <code>triple</code>. 
</div>
</div>
  
<a name="functor.object" id="functor.object"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">object</span>
<div class="documentation-arguments">(object &plusmn;object +triple)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Unify <code>object</code> with the object field of <code>triple</code>. 
</div>
</div>
  
<a name="functor.graph" id="functor.graph"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">graph</span>
<div class="documentation-arguments">(graph &plusmn;graph +triple)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Unify <code>graph</code> with the graph field of <code>triple</code>. 
</div>
</div>
  
<a name="functor.triple-id" id="functor.triple-id"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-id</span>
<div class="documentation-arguments">(triple-id &plusmn;triple-id +triple)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Unify <code>triple-id</code> with the triple-id field of <code>triple</code>. 
</div>
</div>
  
<a name="functor.part:3D" id="functor.part:3D"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">part=</span>
<div class="documentation-arguments">(part= +part1 +part2)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Succeed if <code>part1</code> is <a href="#function.part:3D" title="description of function part=">part=</a> to <code>part2</code>. Each of <code>part1</code> and <code>part2</code> should be UPIs, <a href="#ref-future-parts" title="">future-parts</a> or strings in N-Triples format that can be converted into resources or literals. 
</div>
</div>
  
<a name="functor.upi:3C" id="functor.upi:3C"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi<</span>
<div class="documentation-arguments">(upi< +upi1 +upi2)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Succeed if <code>upi1</code> is <a href="#function.upi:3C" title="description of function upi<">upi&lt;</a> to <code>upi2</code>. Each of <code>upi1</code> and <code>upi2</code> must be UPIs. 
</div>
</div>
  
<a name="functor.upi:3C:3D" id="functor.upi:3C:3D"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi<=</span>
<div class="documentation-arguments">(upi<= +upi1 +upi2)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Succeed if <code>upi1</code> is <a href="#function.upi:3C:3D" title="description of function upi<=">upi&lt;=</a> to <code>upi2</code>. Each of <code>upi1</code> and <code>upi2</code> must be UPIs. 
</div>
</div>
  
<a name="functor.upi:3D" id="functor.upi:3D"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi=</span>
<div class="documentation-arguments">(upi= +upi1 +upi2)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Succeed if <code>upi1</code> is <a href="#function.upi:3D" title="description of function upi=">upi=</a> to <code>upi2</code>. Each of <code>upi1</code> and <code>upi2</code> must be UPIs. 
</div>
</div>
   <a name='ref-query-planner' id='ref-query-planner'></a> <h3>Select Query Planner</h3> <p>AllegroGraph's Prolog query language (<a href="#select" title="description of select"><code>select</code></a>) includes an optimizer that speeds up complex queries via: </p>
<ul>
<li>clause re-ordering,</li>
<li>clause transformations and simplifications,</li>
<li>generation and use of <a href="#ref-upi-maps" title="">UPI maps</a>.</li></ul><p>As part of the transformation process, the query-optimizer works with AllegroGraph's dynamic <a href="#ref-rdfs-reasoning" title="">RDFS++ reasoner</a> to perform some inferences at query planning-time (rather than repeatedly during query run-time). </p><p>The optimizer works automatically and in most situations you do not need to do anything special to make use of it: simply ask your Prolog query and let the optimizer run. Query optimization is a black art, however, so sometimes you may want to see what is happening inside AllegroGraph. Furthermore, there are some additional, non-automatic tuning options that you may want to consider. </p><p>AllegroGraph's query optimizer and dynamic-reasoner are both areas of active research and development. We value your feedback on both the positives and the negatives so that we can continue to make AllegroGraph <em>the</em> best RDF graph database for your projects. </p><p> <div class='sidenote' id='query-planner-and-upi-maps'>  </p><p>Note that there is a problem in the query optimizer's handling of uncommitted triples and RDFS reasoning. In certain cases involving uncommitted triples, the optimizer will produce incorrect plans that may return fewer results than expected. The two possible work-arounds are to either call <a href="#commit-triple-store" title="description of commit-triple-store"><code>commit-triple-store</code></a> before executing the query or to add the clause <code>(:use-maps nil)</code> to the query plan. This problem will be corrected in the near future. </p></div> <h3>Query plan options</h3><p>Query plan options can be used to control the planning and transformation process. You can specify these options by including <code>keyword</code> clauses in the body of your query. A <code>keyword</code> clause is a two item list consisting of the option (a <code>keyword</code>) and its value. For example, this query uses the <code>:display-plan</code> option so that the generated plan will be printed to <code>*standard-output*</code>: </p>
<pre><code>(select0 (?x)  
  (:display-plan t)  
  (q ?x !ub:memberOf !&lt;http://www.Department0.University0.edu&gt;)  
  (q ?x !rdf:type !ub:Person)) </code></pre><p>There are four kinds of plan options: store management, introspection, planner control, and result manipulation. The current list of options is: </p>
<ul>
<li>Store Management
<a name="query-plan-option.graph-filter" id="query-plan-option.graph-filter"></a>
<a name="graph-filter" id="graph-filter"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:graph-filter</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents"><p>Specifies a graph-filtered-triple-store that will be used as the default store to be queried. </p><p>The format of the option is <code>(:graph-filter g1 g2 ...)</code> where <code>gi</code> are Lisp expressions that evaluate to triple parts.  The expressions are evaluated in the lexical context of the <code>select</code> expression. </p><p>At most one occurrence of this option is allowed in each <code>select</code>expression. An occurrence of this option rebinds the value of <code>*db*</code> for the entire <code>select</code> expression. The order of :reasoner and :graph-filter options is significant. </p>
</div>
</div>
  
<a name="query-plan-option.reasoner" id="query-plan-option.reasoner"></a>
<a name="reasoner" id="reasoner"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:reasoner</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents"><p>Specifies that a reasoning store will be used as the default store to be queried. </p><p>The format of the option is <code>(:reasoner [function] reasoner-keyword-args...)</code>. If the function name is ommitted. use <a href="#apply-rdfs:2B:2B-reasoner" title="description of apply-rdfs++-reasoner">apply-rdfs++-reasoner</a>.   The remainder of the option is used as the argument list of the call to the reasoner function. </p><p>An occurrence of this option rebinds the value of <code>*db*</code> for the entire <code>select</code> expression. The order of <code>:reasoner</code> and <code>:graph-filter</code> options is significant. </p>
</div>
</div>
  
<a name="query-plan-option.named-store" id="query-plan-option.named-store"></a>
<a name="named-store" id="named-store"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:named-store</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents"><p>Specifies a named triple-store. The name may be used as the store argument of <code>qd</code> clauses in the body of the <code>select</code> expression.  When a <code>qd</code> clauses specifies a named store, the clause is recognized by the select planner. </p><p>The format of the option is <code>(:named-store name store-expression)</code> where <code>name</code> must be a symbol that is not the symbol <code>*db*</code> and cannot be interpreted as a Prolog variable, and <code>store-expression</code> is a Lisp expression that evaluates to a triple store.  The expression is evaluated once when the <code>select</code> expression is evaluated. </p><p>This option may occur multiple times.  If a name is specified more than once, only the rightmost definition is seen by the body clauses. The ordering of <code>:named-store</code> options is significant, and the ordering with respect to <code>:graph-filter</code> and <code>:reasoner</code> options is also significant.<br />
</p>
</div>
</div>
  </li>
<li>Introspection
<a name="query-plan-option.display-plan" id="query-plan-option.display-plan"></a>
<a name="display-plan" id="display-plan"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:display-plan</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">prints a representation of the       transformed query to <code>*standard-output*</code>. 
</div>
</div>
  
<a name="query-plan-option.plan-only" id="query-plan-option.plan-only"></a>
<a name="plan-only" id="plan-only"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:plan-only</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">create the query plan but do not actually       run it. 
</div>
</div>
  
<a name="query-plan-option.verbose" id="query-plan-option.verbose"></a>
<a name="verbose" id="verbose"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:verbose</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">print details of the estimation process to       <code>*standard-output*</code>. 
</div>
</div>
  </li>
<li>Planner Control
<a name="query-plan-option.remove-redundant-type-filters" id="query-plan-option.remove-redundant-type-filters"></a>
<a name="remove-redundant-type-filters" id="remove-redundant-type-filters"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:remove-redundant-type-filters</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">indicate whether or       not to remove <code>rdf:type</code> clauses that seem to be       redundant from the query. A type clause might be       redundant because it can be inferred from other clauses       (e.g., via domain or range information). 
</div>
</div>
  
<a name="query-plan-option.reorder" id="query-plan-option.reorder"></a>
<a name="reorder" id="reorder"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:reorder</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">indicate whether or not to perform clause       re-ordering. 
</div>
</div>
  
<a name="query-plan-option.use-maps" id="query-plan-option.use-maps"></a>
<a name="use-maps" id="use-maps"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:use-maps</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">indicate whether or not to use <code>UPI maps</code>. 
</div>
</div>
  
<a name="query-plan-option.use-planner" id="query-plan-option.use-planner"></a>
<a name="use-planner" id="use-planner"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:use-planner</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">indicate whether or not to use the query       planner. 
</div>
</div>
  
<a name="query-plan-option.use-transforms" id="query-plan-option.use-transforms"></a>
<a name="use-transforms" id="use-transforms"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:use-transforms</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">indicate whether or not to transform       clauses into putatively simpler forms. 
</div>
</div>
  </li>
<li>Result Manipulation
<a name="query-plan-option.count-only" id="query-plan-option.count-only"></a>
<a name="count-only" id="count-only"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:count-only</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">ignore the result template and return       only the count of results. 
</div>
</div>
  
<a name="query-plan-option.distinct" id="query-plan-option.distinct"></a>
<a name="distinct" id="distinct"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:distinct</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">return only distinct results (this can be       achieved by using <a href="#select-distinct" title="description of select-distinct">select-distinct</a> and its kin). 
</div>
</div>
  
<a name="query-plan-option.limit" id="query-plan-option.limit"></a>
<a name="limit" id="limit"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:limit</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">Return at most <code>limit</code> results. If <code>:distinct</code> is also true, the at most <code>limit</code> distinct results are returned. 
</div>
</div>
  
<a name="query-plan-option.translate-upis" id="query-plan-option.translate-upis"></a>
<a name="translate-upis" id="translate-upis"></a>
<div class="documentation query-plan-option"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">:translate-upis</span>
</div>
<span class="documentation-kind">query-plan-option</span>
</div>
<div class="documentation contents">indicate whether or not to translate       UPIs into their strings. (This can also be controlled       by using the <a href="#select" title="description of select">select</a> and <a href="#select0" title="description of select0">select0</a> variants). 
</div>
</div>
  </li></ul><p>More options may be added in the future. See below for details on how you can determine which options exist and their current settings. </p><h3>Query Planner Examples</h3><p>The following example queries are taken from the <a href="http://agraph.franz.com/allegrograph/agraph_bench_lubm.lhtml" target="_blank">LUBM Benchmark</a>. We will cover several examples showing the different sorts of transformations that the query planner performs. </p><h4>Type Filter Removal and Transformations</h4><p>Q3 asks for all of the publications of a particular professor: </p>
<pre><code>(select0 (?x)  
    (:display-plan t)  
    (q ?x !ub:publicationAuthor !u0d0:AssistantProfessor0)  
    (q ?x !rdf:type !ub:Publication)) </code></pre><p>We use the <code>:display-plan</code> option so that we can see how AllegroGraph interprets the query. Note that the <em>rdfs:domain</em> of <em>!ub:publicationAuthor</em> is <em>!ub:Publication</em> so the second clause is redundant and can be removed.
<a name="fnr9-2018-06-08" id="fnr9-2018-06-08"></a>
<sup><a href="#fn9-2018-06-08">10</a></sup>  Secondly, <em>!ub:publicationAuthor</em> does not participate in any RDFS++ reasoning <em>for this store</em>. Thus the planner transforms the <code>q</code> clause into an internal <code>q/upis-</code> one: </p>
<pre><code>;; Return 1 variables: ?x  
;; estimate:          256 results per binding  
(q/upis- ?x {publicationAuthor} {AssistantProfessor0}) </code></pre><p>The <code>q/upis-</code> functor performs certain extra though minor optimizations over and above the more generic <a href="#q-" title="description of q-">q-</a>. </p><h4>Clause Reordering and More Transformations</h4><p>Query 2 asks for a listing of students who take a course from their advisors: </p>
<pre><code>(select0 (?x ?y ?z)  
    (:verbose t)  
    (:display-plan t)  
    (q ?x !ub:advisor ?y)        
    (q ?x !ub:takesCourse ?z)  
    (q ?y !ub:teacherOf ?z)  
    (q ?x !rdf:type !ub:Student)  
    (q ?y !rdf:type !ub:Faculty)  
    (q ?z !rdf:type !ub:Course)) </code></pre><p>Note that we've used the <code>:verbose</code> query plan option to display additional information during the query process. The information display below is unlikely to match what you see since it is dependent on the inner workings of the planner and the particular store being used. Here is the information from the planning process. </p>
<pre><code>;; Compute estimate: nil {advisor} nil nil :                             204,997  
;; Compute estimate: nil {takesCourse} nil nil :                       1,433,856  
;; Compute estimate: nil {teacherOf} nil nil :                           108,288  
;; Compute estimate: nil {type} {ResearchAssistant} nil :                 36,608  
;; Compute estimate: nil {type} {GraduateStudent} nil :                  126,208  
;; Compute estimate: nil {type} {UndergraduateStudent} nil :             393,984  
;; Compute estimate: nil {type} {Student} nil :                              256  
;;   Choose q ?y {teacherOf} ?z: approximately 108,288 bindings for ?y, ?z.  
 
;; Compute estimate: nil {advisor} 108288 nil :                                9  
;; Compute estimate: nil {takesCourse} 108288 nil :                           14  
;; Compute estimate: nil {type} {ResearchAssistant} nil :                 36,608  
;; Compute estimate: nil {type} {GraduateStudent} nil :                  126,208  
;; Compute estimate: nil {type} {UndergraduateStudent} nil :             393,984  
;; Compute estimate: nil {type} {Student} nil :                              256  
;;   Choose q ?x {advisor} ?y: approximately 9 bindings for ?x.  
 
;; Compute estimate: 8.177778 {takesCourse} 108288 nil :                       1  
;; Compute estimate: 8.177778 {type} {ResearchAssistant} nil :                 1  
;; Compute estimate: 8.177778 {type} {GraduateStudent} nil :                   1  
;; Compute estimate: 8.177778 {type} {UndergraduateStudent} nil :              1  
;; Compute estimate: 8.177778 {type} {Student} nil :                           1  
;;   Choose q ?x {takesCourse} ?z.  
 
;; Compute estimate: 1 {type} {ResearchAssistant} nil :                        1  
;; Compute estimate: 1 {type} {GraduateStudent} nil :                          1  
;; Compute estimate: 1 {type} {UndergraduateStudent} nil :                     1  
;; Compute estimate: 1 {type} {Student} nil :                                  1  
;;   Choose q ?x {type} {Student}. </code></pre><p>And now the generated plan: </p>
<pre><code>;; Return 3 variables: ?x, ?y, ?z  
(db.agraph::find-or-create-map #:?map13983 {advisor} :object :subject)  
(db.agraph::find-or-create-map #:?map13984 {takesCourse} :object  
 :subject)  
(db.agraph::find-or-create-map #:?map13985 (?? +rdf-type-uri+) :object  
 :subject)  
!  
;; estimate:      108,288 results per binding  
(q/upis- ?y {teacherOf} ?z)  
 
;; estimate:            9 results per binding  
(db.agraph::q-upi-table #:?map13983 ?y ?x)  
 
;; estimate:            1 results per binding  
(db.agraph::q-upi-table #:?map13984 ?z ?x)  
 
;; estimate:            4 results per binding  
(lispp*  
 (let ((reasoner (reasoner *db*)))  
   (declare (ignorable reasoner))  
   (or (db.agraph.upi-maps:upi-pair-present-p #:?map13985  
         {UndergraduateStudent} ?x)  
       (db.agraph.upi-maps:upi-pair-present-p #:?map13985  
         {GraduateStudent} ?x)  
       (db.agraph.upi-maps:upi-pair-present-p #:?map13985  
         {ResearchAssistant} ?x)  
       (db.agraph.upi-maps:upi-pair-present-p #:?map13985 {Student}  
         ?x)))) </code></pre><p>The <code>compute estimates</code> shows how the query planner is attempting to reorder the clauses more favorably. The planner currently uses a simple greedy heuristic but this will change as the planner evolves. Once the ordering is determined, the transformation process begins. There are two main transformations used in this query: <a href="#ref-upi-maps" title="">UPI maps</a> and reasoner simplification. </p><h3>Transformations</h3><p>The query-planner and dynamic-reasoner use the following broad categories of transformation: reordering, UPI maps, reasoner simplifications, and clause simplifications. Generally speaking, you should not worry about the exact nature and syntax of the transformations as these are both likely to change. </p><h4>Reordering</h4><p>When a query has many clauses, the order in which they are executed can have a huge effect on total query speed. The query-planner uses a set of heuristics and statistical information about the triple-store in order to try and determine the best order in which to run the query. The heuristics may fail especially for complex queries. If you suspect that the planner is ordering your query incorrectly, use the <code>:display-plan</code> and <code>:reorder</code> query-plan-options to diagnose the problem. </p><a name='ref-upi-maps' id='ref-upi-maps'></a> <h4>UPI maps transformation</h4><p>A UPI map is a persistent index mapping one column of a triple to another. Typically, the index is over only a portion of all of the triples in a store. For example, a UPI map might map from object to subject for all <code>rdf:type</code> triples in the store. This map would make determining whether or not some <code>x</code> was of type <code>C</code> very fast. UPI maps provide a cache for certain kinds of queries and can dramatically improve query speed. </p><p>The query-planner and dynamic-reasoner determine when building UPI maps makes sense for a query and will build them as necessary the first time that they are needed. Once built, maps can be reused until the store changes. See the <a href="#ref-select-query-planner-reference" title="">reference</a> section below for some variables that help control how the query planner uses UPI maps. </p><p>The UPI map transformation appears in a query-plan in two places: </p>
<ol>
<li>The finding or building of the map. This looks like </li>
<pre><code>(find-or-create-map #:?map13983 {advisor} :object :subject) </code></pre>
<li>The use of the map: </li>
<pre><code>(db.agraph::q-upi-table #:?map13983 ?y ?x) </code></pre></ol><p>The <code>:use-maps</code> query-plan-option controls whether or not a query will use any UPI maps. </p><h4>reasoner simplification</h4><p>The dynamic-reasoner examines each clause in the context of the store when the query is run. Depending on the store's ontology, many clauses can be re-written into faster executing forms at query-plan time. Most of the transformations let AllegroGraph move computation out of the <code>inner-loop</code> of the reasoner; they can help greatly increase query speed. As an example, consider how AllegroGraph can transform <code>(q ?x !rdf:type !ub:Student)</code>. The type information in the store will not change while the query is running, so AllegroGraph can consult the ontology <em>once</em> and determine that <code>?x</code> can be inferred to be a <code>student</code> if there is a ground triple that says <code>?x</code> is of <code>rdf:type</code> <code>ub:UndergraduateStudent</code>, <code>ub:GraduateStudent</code>, <code>ub:ResearchAssistant</code>, or <code>ub:Student</code>. Adding UPI maps into the mix, the finished transformation looks like: </p>
<pre><code>(lispp*  
 (or (db.agraph.upi-maps:upi-pair-present-p #:?map13985  
       {UndergraduateStudent} ?x)  
     (db.agraph.upi-maps:upi-pair-present-p #:?map13985  
       {GraduateStudent} ?x)  
     (db.agraph.upi-maps:upi-pair-present-p #:?map13985  
       {ResearchAssistant} ?x)  
     (db.agraph.upi-maps:upi-pair-present-p #:?map13985 {Student}  
       ?x))) </code></pre><p>The set of transformation and their actual syntax will change over time as the query-planner and dynamic-reasoner become more capable. </p><h4>Clause simplification</h4><p>Though reasoning transformations provide the most dramatic speedups, there are some other transformation that can also make queries more efficient. Most of these have more to do with reducing <code>consing</code> and shaving small amounts off of clause execution. An example is the transformation of <a href="#q-" title="description of q-">q-</a> clauses into <code>asserted-1</code>, <code>asserted-po</code>, <code>asserted-sp</code>, or <code>asserted-p</code> clauses. Because the latter four have slightly simpler execution paths, they provide measurable increases in speed. </p><p>Note that these <code>asserted-*</code> functors may change or disappear in future revisions and should <em>not</em> be relied in outside of the query planner itself. </p><a name='ref-select-query-planner-reference' id='ref-select-query-planner-reference'></a> <h3>Store Management Options</h3><p>The select options <code>:graph-filter</code> and <code>:reasoner</code> allow a program to modify the store used in the select query without affecting the current default store in the surrounding program.<br />
</p><p>A query such as </p>
<pre><code>(select (?x)  
   (:graph-filter !ex:g1)  
   (q ?x !ex:pred ?y)) </code></pre><p>is applied to the subset of triples where the graph component is <code>!ex:g1</code>. </p><p>And the query </p>
<pre><code>(select (?x)  
   (:graph-filter !ex:g1)  
   (:reasoner)  
   (q ?x !ex:pred ?y)) </code></pre><p>is applied to all the triples that can be inferred from the set of triples where the graph component is <code>!ex:g1</code>. </p><p>In both cases the triple store (bound to <em>db</em>) in the surrounding context is not affected. </p><p>Note that a query such as </p>
<pre><code>(select (?x)  
   (:reasoner)  
   (:graph-filter !ex:g1)  
   (q ?x !ex:pred ?y)) </code></pre><p>is likely to yield surprising or unexpected results.  In this case, the graph filter is applied to the triples generated by the reasoner.  But in the default case, these inferred triples use the default graph of the base store as the graph component of the inferred triples.  It would be more constructive to pose the query </p>
<pre><code>(select (?x)  
   (:reasoner :inferred-graph !ex:g2)  
   (:graph-filter !ex:g1 !ex:g2)  
   (q ?x !ex:pred ?y))  
 
 
 
 
 
</code></pre><h3>Reference</h3>
<a name="function.default-query-plan-option" id="function.default-query-plan-option"></a>
<a name="default-query-plan-option" id="default-query-plan-option"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">default-query-plan-option</span>
<span class="documentation-arguments"><span class="argument">name</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return the default value of query-plan-option <code>name</code>. 
</div>
</div>
  
<a name="function.defined-query-plan-options" id="function.defined-query-plan-options"></a>
<a name="defined-query-plan-options" id="defined-query-plan-options"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">defined-query-plan-options</span>
<span class="documentation-arguments"><span class="marker">&amp;optional</span> &nbsp;<span class="argument">include-values-p</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return a list of the defined query plan options and, optionally, their settings. 
</div>
</div>
  
<a name="variable.:2Aexpand-type-clause-with-map-p:2A" id="variable.:2Aexpand-type-clause-with-map-p:2A"></a>
<a name="x:2Aexpand-type-clause-with-map-p:2A" id="x:2Aexpand-type-clause-with-map-p:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*expand-type-clause-with-map-p*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents"><p>Controls whether or not UPI maps are used with type inference. </p><p>If true, then the dynamic-reasoner will build a UPI map on rdf:type and use this map for subsequent type inference. </p>
</div>
</div>
  
<a name="variable.:2Alast-query-plan:2A" id="variable.:2Alast-query-plan:2A"></a>
<a name="x:2Alast-query-plan:2A" id="x:2Alast-query-plan:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*last-query-plan*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents"><p>This variable will be nil or contain an instance of the type <code>query-plan</code>. </p><p><code>query-plan</code> is an opaque data structure. It should not generally be used other than internally. </p>
</div>
</div>
  
<a name="variable.:2Ause-maps-for-subproperties-s-o-p:2A" id="variable.:2Ause-maps-for-subproperties-s-o-p:2A"></a>
<a name="x:2Ause-maps-for-subproperties-s-o-p:2A" id="x:2Ause-maps-for-subproperties-s-o-p:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*use-maps-for-subproperties-s-o-p*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents"><p>Controls whether or not UPI maps may be used for sub-property reasoning. </p><p>If true, then the dynamic-reasoner may decide to use UPI maps when a predicate is involved in sub-property reasoning. </p>
</div>
</div>
   <a name='ref-rdfs-reasoning' id='ref-rdfs-reasoning'></a> <h3>RDFS++ Reasoning</h3> <p>AllegroGraph's reasoner supports the following predicates: </p>
<ul>
<li>rdf:type</li>
<li>rdfs:domain</li>
<li>rdfs:range</li>
<li>rdfs:subClassOf</li>
<li>rdfs:subPropertyOf</li>
<li>owl:inverseOf</li>
<li>owl:sameAs</li>
<li>owl:TransitiveProperty</li></ul><p>and OWL <em>restriction</em> reasoning like <code>owl:hasValue</code>, <code>owl:someValuesFrom</code> and <code>owl:allValuesFrom</code> (see the <a href="reasoner-tutorial.html" id="reasoner-tutorial-tab">reasoner tutorial</a> and the <a href="has-value-tutorial.html">hasValue reasoning</a> tutorials for more details). </p><p>Note that the reasoner is designed to efficiently answer questions like "What are properties of <em>this</em> subject?" or "Tell me all the subjects that have this <em>type</em>?" It is <em>not</em> designed for efficiently determining <em>all</em> of the inferred triples in a store (e.g., "Tell me everything you know."). You <em>should</em> expect fast answers for queries whose predicate is specified but you will not see such good performance for more open-ended calls to <a href="#get-triples" title="description of get-triples">get-triples</a>. We will continue to enhance the reasoner as AllegroGraph develops. </p><p>The following additional functions and variables are also part of the reasoner: </p>
<a name="function.apply-rdfs:2B:2B-reasoner" id="function.apply-rdfs:2B:2B-reasoner"></a>
<a name="apply-rdfs:2B:2B-reasoner" id="apply-rdfs:2B:2B-reasoner"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">apply-rdfs++-reasoner</span>
<span class="documentation-arguments"><span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">name</span> &nbsp;<span class="argument">restriction-reasoning-enabled</span> &nbsp;<span class="argument">remote-reasoning</span> &nbsp;<span class="argument">inferred-graph</span> &nbsp;<span class="argument">cached-wrapper-key</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a new <a href="#reasoning-triple-store" title="description of reasoning-triple-store">reasoning-triple-store</a> which wraps <code>db</code> with an <a href="#rdfs:2B:2B-reasoner" title="description of rdfs++-reasoner">rdfs++-reasoner</a>. </p>
<ul>
<li><p><code>db</code> - the triple-store to encapsulate. The defaults to the value of *db*.  If <code>db</code> is *db* then *db* will be set to the returned <a href="#reasoning-triple-store" title="description of reasoning-triple-store">reasoning-triple-store</a>. </p></li>
<li><p><code>name</code> - the name to give the <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a>. Defaults to the current <a href="#db-name" title="description of db-name">db-name</a> of the <code>db</code> prefixed with <em>rdfs++-</em> and with a generated suffix . </p></li>
<li><p><code>restriction-reasoning-enabled</code> - when true, enable OWL hasValue reasoning.  The default is nil. </p></li>
<li><p><code>inferred-graph</code> - This argument specifies the graph component of all inferred triples.  The default is to use the default graph of the specified triple store. </p></li>
<li><p><code>cached-wrapper-key</code> - If this argument is <code>nil</code>, the call creates a new instance of a reasoning wrapper; this instance will cause a new invocation of prepare-reasoning when the first query is issued.  If the argument is not nil, it is used as a key in an equalp hash-table; if a previously created wrapper is found, the previous instance is used.  If no entry is found, a new wrapper is created and saved in the table.  The default value is taken from the variable <code>*cached-wrapper-key*</code>.  The initial value of this variable is nil. </p></li>
<li><code>remote-reasoning</code> - This argument is meaningful only when the db argument is a remote-triple-store instance.  A non-nil value specifies that the reasoning wrapper is created on the server side.  The value returned by <code>apply-rdfs++-reasoner</code> is a new <code>remote-triple-store</code> instance pointing to the reasoner on the server side. </li></ul>
</div>
</div>
   
<a name="function.inferred-triple-p" id="function.inferred-triple-p"></a>
<a name="inferred-triple-p" id="inferred-triple-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">inferred-triple-p</span>
<span class="documentation-arguments"><span class="argument">triple</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns true if <code>triple</code> is the result of inference (as opposed to be physically present in the triple-store). 
</div>
</div>
  
<a name="class.rdfs:2B:2B-reasoner" id="class.rdfs:2B:2B-reasoner"></a>
<a name="rdfs:2B:2B-reasoner" id="rdfs:2B:2B-reasoner"></a>
<div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">rdfs++-reasoner</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">Though not a formal definition, an RDFS++ reasoner provides RDFS entailment along with owl:sameAs and owl:InverseFunctionalProperty. The AllegroGraph reasoner also supports inverse properties. 
</div>
</div>
  
<a name="function.reasoner" id="function.reasoner"></a>
<a name="reasoner" id="reasoner"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">reasoner</span>
<span class="documentation-arguments"><span class="argument">g216280</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the <code>reasoner</code> of a <a href="#reasoning-triple-store" title="description of reasoning-triple-store">reasoning-triple-store</a> which will be an instance of an <code>abstract-reasoner</code>. 
</div>
</div>
  <div class="documentation class"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">reasoning-triple-store</span>
</div>
<span class="documentation-kind">class</span>
</div>
<div class="documentation contents">An <a href="#encapsulated-triple-store" title="description of encapsulated-triple-store">encapsulated-triple-store</a> that adds reasoning to a triple-store. This store contains a <a href="#reasoner" title="description of reasoner">reasoner</a> slot that controls the sort of reasoning that the triple-store supplies. The <a href="#rdfs:2B:2B-reasoner" title="description of rdfs++-reasoner">rdfs++-reasoner</a> is an example of the sort of reasoning that AllegroGraph provides. 
</div>
</div>
  <p> AllegroGraph also supports <em>restriction</em> reasoning.
<a name="fnr10-2018-06-08" id="fnr10-2018-06-08"></a>
<sup><a href="#fn10-2018-06-08">11</a></sup>  </p>
<a name="function.restriction-reasoning-enabled-p" id="function.restriction-reasoning-enabled-p"></a>
<a name="restriction-reasoning-enabled-p" id="restriction-reasoning-enabled-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">restriction-reasoning-enabled-p</span>
<span class="documentation-arguments"><span class="argument">rdfs++-reasoner</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns whether or not <em>restriction</em> reasoning is enabled in the RDFS++ reasoner. </p><p>This includes reasoning about owl:hasValue, owl:someValuesFrom and owl:allValuesFrom. </p><p>You can control whether or not <em>has-value</em> reasoning is enabled when you use <a href="#apply-rdfs:2B:2B-reasoner" title="description of apply-rdfs++-reasoner">apply-rdfs++-reasoner</a>. </p>
</div>
</div>
  <p><code>Prepare-reasoning</code> is a function called internally by the AllegroGraph reasoner. It is unlikely that you will ever need to call it yourself. Its purpose is to update the internal data structures used by the reasoner. </p>
<a name="function.prepare-reasoning" id="function.prepare-reasoning"></a>
<a name="prepare-reasoning" id="prepare-reasoning"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">prepare-reasoning</span>
<span class="documentation-arguments"><span class="argument">reasoner</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">verbose</span> &nbsp;<span class="argument">force</span> &nbsp;<span class="argument">show-progress</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>This function has to be called before any inferences are made. It creates internal hash-tables to speed up the reasoner. In normal operation, AllegroGraph will call prepare-reasoning as necessary. You can see diagnostic messages by using the parameter <code>verbose</code> which defaults to the value of <code>nil</code>. You can also force the hash-tables to be regenerated using the <code>force</code> parameter. Finally, the <code>show-progress</code> keyword argument can be used to cause <code>prepare-reasoning</code> to print a message for each of the hash-tables it builds. </p><p>The function prepare-reasoning returns no value. </p>
</div>
</div>
    <a name='header2-95' id='header2-95'></a><h2>Specialized Datatypes</h2><p>In addition to the encoded <a href="agraph-introduction.html#upi-def">UPIs</a> for the various numeric datatypes, AllegroGraph supports several specialized datatypes for efficient storage, manipulation, and search of <a href="#sna">Social Network</a>, <a href="#lisp-nd-geospatial-reference">nD Geospatial</a>, <a href="#lisp-temporal-reference">Temporal information</a>, and the (now deprecated) <a href="#lisp-2d-geospatial-reference">2D Geospatial</a> data. </p><a name='sna' id='sna'></a> <h3>Social Network Analysis</h3> <p>The Magic Property based set of <a href="magic-properties.html#sparql-magic-sna">SNA extensions</a> (described in the linked section of the <a href="magic-properties.html">SPARQL Magic Properties</a> document) is a more modern interface that supports SNA queries. </p><p>By viewing interactions as connections in a graph, we can treat a multitude of different situations using the tools of Social Network Analysis (SNA). SNA lets us answer questions like: </p>
<ul>
<li><p>How closely connected are any two individuals?</p></li>
<li><p>What are the core groups or clusters within the data?</p></li>
<li><p>How important is this person (or company) to the  flow of information? </p></li>
<li><p>How likely is it that this person and that person know  one another? </p></li></ul><p> <img src="social-graph-example.png" alt="A Example Social Graph"></img> </p><p>The field is full of rich mathematical techniques and powerful algorithms. AllegroGraph's SNA toolkit includes an array of search methods, tools for measuring centrality and importance, and the building blocks for creating more specialized measures. These tools can be used with any "network" data set whether its connections between companies and directors, predator/prey food webs, chemical interactions, or links between web sites. </p><a name='ref-sna-generators' id='ref-sna-generators'></a> <h4>Navigating Through a Graph - Generators</h4><p>The graph functions described below all use <code>generators</code> in their definitions. A generator is a function of one-argument, a vertex, that returns a list of nodes that are <em>connected</em> to the vertex. </p><p>We provide several helper utilities and a generator definition language to define both simple and complex generator functions. When the graph operations below take a generator as argument, you may supply either a function of one argument or the name of a generator that has been defined using the generator definition language or a neighbor-matrix (see below). </p> 
<a name="macro.defsna-generator" id="macro.defsna-generator"></a>
<a name="defsna-generator" id="defsna-generator"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">defsna-generator</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;(<span class="marker">&amp;optional</span> &nbsp;<span class="argument">var</span>) &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Define a new SNA generator function and associate it with <code>name</code>. </p><p>A generator is a function of one-argument, a vertex, that returns a list of nodes that are <em>connected</em> to the vertex. In a directed graph, connected may refer to the nodes that point to a specific vertex (the <em>subjects-of</em>) or it may refer to the nodes at which the vertex points (the <em>objects-of</em>). Generators can also ignore edge direction in a graph and return a list of nodes that are adjacent to the specific vertex. </p><p>The <code>body</code> must be a list of clauses where each clause is one of: </p>
<ul>
<li><code>(:objects-of &amp;key node p)</code></li>
<li><code>(:subjects-of &amp;key node p)</code></li>
<li><code>(:undirected &amp;key p)</code></li>
<li><code>(select var select-clause*)</code></li></ul><p>When called, the generator returns the <em>distinct</em> union of the nodes found by each clause. </p><p>Some simple examples: </p>
<pre><code>(defsna-generator involved-with (node)  
  (:objects-of :p (!ex:kisses !ex:sleepsWith)))  
 
;; we can include `node` but it does not change the meaning  
(defsna-generator involved-with ()  
  (:objects-of :node node :p (!ex:kisses !ex:sleepsWith)))  
 
(defsna-generator involved-with ()  
  (:undirected :p (!ex:kisses !ex:sleepsWith)))  
 
(defsna-generator in-movie-with (node)  
  (select (?x)  
    (q- (?? ?x) !franz:stars node))) </code></pre><p><code>defsna-generator</code> returns the new function. </p><p>Note that: </p>
<ul>
<li><p>In both <code>:objects-of</code> and <code>:subjects-of</code>, the <code>node</code> parameter is    syntactic sugar and can be left off. </p></li>
<li><p>In all three of <code>:objects-of</code>, <code>:subjects-of</code>, and <code>:undirected</code>,    the <code>p</code> variable can be a single property or a list of properties. </p></li>
<li>Note the use of the Allegro Prolog <code>??</code> idiom that we use to treat the    symbol <code>node</code> as a variable in the body of the macro. </li></ul>
</div>
</div>
   
<a name="function.find-sna-generator" id="function.find-sna-generator"></a>
<a name="find-sna-generator" id="find-sna-generator"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">find-sna-generator</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">error?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Lookup a registered <code>sna-generator</code> by name and return its associated function. </p><p><code>name</code> can be: </p>
<ul>
<li><p>a generator function itself (in which case it is simply    returned), </p></li>
<li><p>a neighbor-matrix created via <a href="#build-neighbor-matrix" title="description of build-neighbor-matrix">build-neighbor-matrix</a></p></li>
<li><p>the name of a generator previously defined with the <a href="#defsna-generator" title="description of defsna-generator">defsna-generator</a> macro,</p></li>
<li><p>the name of a neighbor-matrix previously defined with <a href="#defneighbor-matrix" title="description of defneighbor-matrix">defneighbor-matrix</a>, or</p></li>
<li>a symbol naming an existing function which is assumed to act as a generator.</li></ul>
</div>
</div>
   
<a name="function.register-sna-generator" id="function.register-sna-generator"></a>
<a name="register-sna-generator" id="register-sna-generator"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-sna-generator</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="argument">function</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">check-for-updates?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Associate <code>name</code> with an SNA generator function. Returns the new function. If the <code>function</code> is <code>nil</code>, then the association is removed. 
</div>
</div>
  <a name='ref-sna-neighbor-matrix' id='ref-sna-neighbor-matrix'></a> <h4>Saving time - the Neighbor-Matrix</h4><p>Generators provide a fast and flexible mechanism to navigate though arbitrary graphs. AllegroGraph automatically saves the results of recent node expansions but generators still require repeated queries against the triple-store. If you know that you will be operating on a particular group of nodes in your graph, you can greatly increase the speed of some of the SNA algorithms by building a <em>neighbor-matrix</em> (which is essentially an in-memory sparse adjacency matrix) and using it rather than the generator in your queries. You can build a neighbor-matrix with <code>build-neighbor-matrix</code>. </p>
<a name="macro.defneighbor-matrix" id="macro.defneighbor-matrix"></a>
<a name="defneighbor-matrix" id="defneighbor-matrix"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">defneighbor-matrix</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="argument">group</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="argument">max-depth</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Defines a Neighbor-Matrix structure for <code>group</code> using <code>generator</code> including all nodes reachable within <code>max-depth</code> steps from group and associates it with <code>name</code>. </p><p>If <code>max-depth</code> is zero, then only the group will be queried; if it is one, then the cache will include the group and it neighbors; etc. </p>
</div>
</div>
  
<a name="function.build-neighbor-matrix" id="function.build-neighbor-matrix"></a>
<a name="build-neighbor-matrix" id="build-neighbor-matrix"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">build-neighbor-matrix</span>
<span class="documentation-arguments"><span class="argument">group</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="argument">max-depth</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return an Neighbor-Matrix structure for <code>group</code> using <code>generator</code> including all nodes reachable within <code>max-depth</code> steps from group. I.e., If <code>max-depth</code> is zero, then only the group will be queried; if it is one, then the cache will include the group and it neighbors; etc. 
</div>
</div>
  
<a name="function.find-neighbor-matrix" id="function.find-neighbor-matrix"></a>
<a name="find-neighbor-matrix" id="find-neighbor-matrix"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">find-neighbor-matrix</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">errorp</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Lookup a registered <code>neighbor-matrix</code> by name and return it. </p><p><code>name</code> should be a neighbor-matrix (in which case it is returned) or a symbol naming a previously registered neighbor-matrix. See <a href="#macro.defneighbor-matrix" title="description of macro defneighbor-matrix">defneighbor-matrix</a> macro. </p>
</div>
</div>
  
<a name="function.register-neighbor-matrix" id="function.register-neighbor-matrix"></a>
<a name="register-neighbor-matrix" id="register-neighbor-matrix"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-neighbor-matrix</span>
<span class="documentation-arguments"><span class="argument">name</span> &nbsp;<span class="argument">matrix</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Associate the neighbor-matrix <code>matrix</code> with <code>name</code>. </p><p>To remove a matrix use <code>register-neighbor-matrix</code> with <code>nil</code>. </p>
</div>
</div>
  <p>The neighbor-matrix for a particular group and generator saves all of the information needed to use the SNA algorithms (but <em>only</em> for that group and that generator). To use it, call the algorithm you want but pass in the neighbor-matrix instead of the generator. Secondly, the <code>group</code> argument to the function must be set to nil and any <code>actor</code> arguments must be members of the group used to create the matrix. The following examples compute the same result: </p><h5>Using just the generator</h5>
<pre><code>&gt; (defsna-generator knows ()  
    (:undirected :p !f:knows))  
#&lt;Function (:anonymous-lambda 35) @ #x11e18772&gt;  
 
&gt; (setf group (ego-group !&lt;http://www.franz.com/ont/person-1&gt; 2 'knows))  
({person-898} {person-47649} {person-91744} {person-90811}  
 {person-17690} {person-59736} {person-84513} {person-63689}  
 {person-91562} {person-62312} ...)  
 
&gt; (length group)  
147  
 
&gt; (time (group-degree-centrality group 'knows))  
; cpu time (non-gc) 100 msec user, 120 msec system  
; cpu time (gc)     20 msec user, 0 msec system  
; cpu time (total)  120 msec user, 120 msec system  
; real time  251 msec  
; space allocation:  
;  4,795 cons cells, 1,629,912 other bytes, 0 static bytes  
7.1275467e-4 </code></pre><h5>Using the Neighbor-Matrix</h5>
<pre><code>&gt; (time (setf neighbor-matrix  
	    (build-neighbor-matrix group 'knows 0)))  
; cpu time (non-gc) 130 msec user, 170 msec system  
; cpu time (gc)     30 msec user, 0 msec system  
; cpu time (total)  160 msec user, 170 msec system  
; real time  1,263 msec  
; space allocation:  
;  5,577 cons cells, 965,136 other bytes, 0 static bytes  
#&lt;neighbor-matrix 147 members @ #x11bbbe12&gt;  
 
&gt; (time (group-degree-centrality group neighbor-matrix))  
; cpu time (non-gc) 10 msec user, 0 msec system  
; cpu time (gc)     0 msec user, 0 msec system  
; cpu time (total)  10 msec user, 0 msec system  
; real time  9 msec  
; space allocation:  
;  594 cons cells, 684,728 other bytes, 0 static bytes  
7.1275467e-4 </code></pre><p>It's clear that the in-memory neighbor-matrix gives a tremendous speed boost (and is much more memory efficient). On the down side, it took some time to build so it would not make sense to use it unless you need to expand nodes <em>many</em> times. One area where this occurs is whenever an SNA algorithm relies on path-finding. For example, the <a href="#function.actor-closeness-centrality" title="description of function actor-closeness-centrality">actor-closeness-centrality</a>  algorithm requires finding the shortest path between an actor and every other member of the group. Lets compare: </p>
<pre><code>&gt; (time (actor-closeness-centrality  
         !&lt;http://www.franz.com/ont/person-1&gt; group 'knows))  
; cpu time (non-gc) 1,750 msec user, 2,140 msec system  
; cpu time (gc)     100 msec user, 10 msec system  
; cpu time (total)  1,850 msec user, 2,150 msec system  
; real time  20,200 msec  
; space allocation:  
;  84,703 cons cells, 13,531,840 other bytes, 0 static bytes  
0.5214286  
 
&gt; (time (actor-closeness-centrality  
         !&lt;http://www.franz.com/ont/person-1&gt; group neighbor-matrix))  
; cpu time (non-gc) 10 msec user, 0 msec system  
; cpu time (gc)     0 msec user, 0 msec system  
; cpu time (total)  10 msec user, 0 msec system  
; real time  12 msec  
; space allocation:  
;  13,273 cons cells, 1,803,600 other bytes, 0 static bytes  
0.5214286 </code></pre><p>As the groups get larger, path-finding algorithms do not scale well but this poor performance can be offset for a while using the neighbor-matrices. </p><h4>Search</h4><p>There are many ways to search in a graph and the one you choose will depend both on the application and on the kind of graph data you have collected. The SNA library provides multiple search functions whose operation is controlled by generators as defined above. Most operations come in several flavors. For example, </p>
<ul>
<li>breadth-first-search - returns whether or not you can get there from here.</li>
<li>map-breadth-first-search-paths - applies a function to each possible path from here to there</li>
<li>all-breadth-first-search-paths - collects and returns a list of all the paths from here to there.</li></ul><p>We also provide an additional set of search functions specialized for <a href="http://en.wikipedia.org/wiki/Bipartite_graph" class="external" target="_blank">bipartite graphs</a>. </p><h5>Breadth First Search</h5>
<a name="function.breadth-first-search" id="function.breadth-first-search"></a>
<a name="breadth-first-search" id="breadth-first-search"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">breadth-first-search</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Search <code>db</code> in <em>breadth</em> first fashion starting at <code>start</code> and looking for <code>end</code>, using <code>generator</code> to expand the search space. Returns <code>nil</code> if no path can be found (within <code>maximum-depth</code>) and the first such path found otherwise. The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li></ul>
</div>
</div>
  
<a name="function.breadth-first-distance" id="function.breadth-first-distance"></a>
<a name="breadth-first-distance" id="breadth-first-distance"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">breadth-first-distance</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return the length of the first path found between <code>start</code> and <code>end</code> using <a href="#breadth-first-search" title="description of breadth-first-search">breadth-first-search</a> to find the path and <code>generator</code> to determine when two nodes are adjacent. Returns <code>nil</code> if no path exists. The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li></ul>
</div>
</div>
  
<a name="function.map-breadth-first-search-paths" id="function.map-breadth-first-search-paths"></a>
<a name="map-breadth-first-search-paths" id="map-breadth-first-search-paths"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-breadth-first-search-paths</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="argument">fn</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Apply <code>fn</code> to each path between <code>start</code> and <code>end</code> using <code>generator</code> to determine adjacent nodes and <a href="#breadth-first-search" title="description of breadth-first-search">breadth-first-search</a> to find paths. </p><p>The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li>
<li>limit - If supplied, it must be a positive integer and no more than this many paths will be returned. If the limit is reached, then the second return value if the path searching function will be <code>:limit-reached</code>. </li>
<li>fn - This must be a function of one argument. It will be called once for each   path found. </li></ul>
</div>
</div>
  
<a name="function.all-breadth-first-search-paths" id="function.all-breadth-first-search-paths"></a>
<a name="all-breadth-first-search-paths" id="all-breadth-first-search-paths"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">all-breadth-first-search-paths</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a list of shortest paths between <code>start</code> and <code>end</code> using <code>generator</code> to determine adjacent nodes and <a href="#breadth-first-search" title="description of breadth-first-search">breadth-first-search</a> to find paths. </p><p><code>all-breadth-first-search-paths</code> will search for a path no longer than <code>maximum-depth</code>. If <code>maximum-depth</code> is left unspecified, then the entire graph will be searched (obviously, this can be very expensive in large graphs). Note that once a path is found, no longer paths will be found (i.e., the <code>maximum-depth</code> becomes the length of the first path found). Since breadth-first search is guaranteed to find the shortest path between <code>start</code> and <code>end</code>, this function actually returns a list of the shortest paths. </p><p>The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li>
<li>limit - If supplied, it must be a positive integer and no more than this many paths will be returned. If the limit is reached, then the second return value if the path searching function will be <code>:limit-reached</code>. </li></ul>
</div>
</div>
  <h5>Depth First Search</h5>
<a name="function.depth-first-search" id="function.depth-first-search"></a>
<a name="depth-first-search" id="depth-first-search"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">depth-first-search</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Search <code>db</code> in <em>depth</em> first fashion starting at <code>start</code> and looking for <code>end</code>, using <code>generator</code> to expand the search space.  Returns nil if no path can be found (within <code>maximum-depth</code>) and the first path found otherwise. The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li></ul>
</div>
</div>
  
<a name="function.depth-first-distance" id="function.depth-first-distance"></a>
<a name="depth-first-distance" id="depth-first-distance"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">depth-first-distance</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return the length of the first path found between <code>start</code> and <code>end</code> using <a href="#depth-first-search" title="description of depth-first-search">depth-first-search</a> to find the path and <code>generator</code> to determine when two nodes are adjacent. Returns <code>nil</code> if no path exists. The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li></ul>
</div>
</div>
  
<a name="functor.depth-first-search-path" id="functor.depth-first-search-path"></a>
<a name="depth-first-search-path" id="depth-first-search-path"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">depth-first-search-path</span>
<div class="documentation-arguments">(depth-first-search-path +start +end +generator -path)
(depth-first-search-path +start +end +generator +max-depth -path)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unifies <code>path</code> with the first path found from <code>start</code> to <code>end</code> using a <em>depth first</em> search strategy. </p>
<ul>
<li><code>start</code> - the node at which to start</li>
<li><code>end</code> - the node at which to stop</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li>
<li><code>max-depth</code> - the maximum depth to search.</li>
<li><code>path</code> - bound to a list of UPIs representing a path from <code>start</code> to <code>end</code>. Each element in the path will be a UPI <strong>U</strong> such that there is a triple whose subject is <strong>U</strong>; whose object is the next element in the list; and which is returned by a call to <code>generator</code>. Finds the first path between <code>start</code> and <code>end</code> of any  length. <strong>Warning</strong> Searching for a path of arbitrary length in a  large triple-store can take a long time. </li></ul><p>Finds the first path between <code>start</code> and <code>end</code> that is no longer than <code>max-depth</code>. </p>
</div>
</div>
  
<a name="function.map-depth-first-search-paths" id="function.map-depth-first-search-paths"></a>
<a name="map-depth-first-search-paths" id="map-depth-first-search-paths"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-depth-first-search-paths</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="argument">fn</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Apply <code>fn</code> to each path between <code>start</code> and <code>end</code> using <code>generator</code> to determine adjacent nodes and <a href="#depth-first-search" title="description of depth-first-search">depth-first-search</a> to find paths. </p><p>The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li>
<li>limit - If supplied, it must be a positive integer and no more than this many paths will be returned. If the limit is reached, then the second return value if the path searching function will be <code>:limit-reached</code>. </li>
<li>fn - This must be a function of one argument. It will be called once for each   path found. </li></ul>
</div>
</div>
  
<a name="function.all-depth-first-search-paths" id="function.all-depth-first-search-paths"></a>
<a name="all-depth-first-search-paths" id="all-depth-first-search-paths"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">all-depth-first-search-paths</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a list of all paths between <code>start</code> and <code>end</code> using <code>generator</code> to determine adjacent nodes and <a href="#depth-first-search" title="description of depth-first-search">depth-first-search</a> to find paths. </p><p><code>all-depth-first-search-paths</code> will search for a path no longer than <code>maximum-depth</code>. If <code>maximum-depth</code> is left unspecified, then the entire graph will be searched (obviously, this can be very expensive in large graphs). Note that once a node appears in a path, it will not appear in any longer paths (though it may appear in paths of the same or shorter length depending on the order in which nodes are discovered. </p><p>The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li>
<li>limit - If supplied, it must be a positive integer and no more than this many paths will be returned. If the limit is reached, then the second return value if the path searching function will be <code>:limit-reached</code>. </li></ul>
</div>
</div>
  <h5>Bidirectional Search</h5>
<a name="function.bidirectional-search" id="function.bidirectional-search"></a>
<a name="bidirectional-search" id="bidirectional-search"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">bidirectional-search</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Search to see if a path exists between <code>start</code> and <code>end</code> using <code>generator</code> to determine when two nodes are adjacent. The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li></ul>
</div>
</div>
  
<a name="function.bidirectional-distance" id="function.bidirectional-distance"></a>
<a name="bidirectional-distance" id="bidirectional-distance"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">bidirectional-distance</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return the length of the first path found between <code>start</code> and <code>end</code> using <a href="#bidirectional-search" title="description of bidirectional-search">bidirectional-search</a> to find the path and <code>generator</code> to determine when two nodes are adjacent. Returns <code>nil</code> if no path exists. The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li></ul>
</div>
</div>
  
<a name="function.map-bidirectional-search-paths" id="function.map-bidirectional-search-paths"></a>
<a name="map-bidirectional-search-paths" id="map-bidirectional-search-paths"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-bidirectional-search-paths</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="argument">fn</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Apply <code>fn</code> to each path between <code>start</code> and <code>end</code> using <code>generator</code> to determine adjacent nodes and <a href="#bidirectional-search" title="description of bidirectional-search">bidirectional-search</a> to find paths. </p><p>The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li>
<li>limit - If supplied, it must be a positive integer and no more than this many paths will be returned. If the limit is reached, then the second return value if the path searching function will be <code>:limit-reached</code>. </li>
<li>fn - This must be a function of one argument. It will be called once for each   path found. </li></ul>
</div>
</div>
  
<a name="function.all-bidirectional-search-paths" id="function.all-bidirectional-search-paths"></a>
<a name="all-bidirectional-search-paths" id="all-bidirectional-search-paths"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">all-bidirectional-search-paths</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">graph/s</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a list of paths between <code>start</code> and <code>end</code> using <code>generator</code> to determine adjacent nodes and <a href="#bidirectional-search" title="description of bidirectional-search">bidirectional-search</a> to find paths. </p><p><code>all-bidirectional-search-paths</code> will search for a path no longer than <code>maximum-depth</code>. If <code>maximum-depth</code> is left unspecified, then the entire graph will be searched. Note that once a path is found, no longer paths will be searched. (Though some longer paths may appear in the results after a shorter one because of the recursive algorithm employed). </p><p>The arguments are: </p>
<ul>
<li>start - a UPI or future-part or string that can be converted into a UPI.</li>
<li>end - a UPI, future-part or string that can be converted into a UPI.</li>
<li>generator - a function of one argument or a generator name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </li>
<li>maximum-depth - If supplied, this  restricts the length of the paths searched. Only paths (from <code>start</code>) less than or equal to this will be checked. If maximum-depth is not specified, it defaults to <code>nil</code> which means to search all paths. <strong>Warning</strong>: In large graphs this can be <em>very</em> expensive. </li>
<li>graph/s - If supplied, the search will be restricted to triples in the specified graph or graphs. The argument can either be a single UPI, future-part, or string that can be converted into a graph <em>or</em> it can be a list of UPIs, future-parts, and strings. </li>
<li>timeout - If supplied, the search will stop after this number of seconds has passed. If searching stops becaase of the timeout, then the second return value of the path searching function will be <code>:timeout</code> </li>
<li>limit - If supplied, it must be a positive integer and no more than this many paths will be returned. If the limit is reached, then the second return value if the path searching function will be <code>:limit-reached</code>. </li></ul>
</div>
</div>
  <h5>Bipartite graphs</h5>
<a name="function.map-breadth-first-search-paths-bipartite" id="function.map-breadth-first-search-paths-bipartite"></a>
<a name="map-breadth-first-search-paths-bipartite" id="map-breadth-first-search-paths-bipartite"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-breadth-first-search-paths-bipartite</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator-1</span> &nbsp;<span class="argument">generator-2</span> &nbsp;<span class="argument">fn</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Apply <code>fn</code> to each path between <code>start</code> and <code>end</code> using <code>generator-1</code> and <code>generator-2</code> to determine adjacent nodes and <a href="#breadth-first-search" title="description of breadth-first-search">breadth-first-search</a> to find paths. The function assumes that <code>generator-1</code> can be used on the <code>start</code> node; the node type of the <code>end</code> node does not matter. 
</div>
</div>
  
<a name="function.map-depth-first-search-paths-bipartite" id="function.map-depth-first-search-paths-bipartite"></a>
<a name="map-depth-first-search-paths-bipartite" id="map-depth-first-search-paths-bipartite"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-depth-first-search-paths-bipartite</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator-1</span> &nbsp;<span class="argument">generator-2</span> &nbsp;<span class="argument">fn</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Apply <code>fn</code> to each path between <code>start</code> and <code>end</code> using <code>generator-1</code> and <code>generator-2</code> to determine adjacent nodes and <a href="#depth-first-search" title="description of depth-first-search">depth-first-search</a> to find paths. The function assumes that <code>generator-1</code> can be used on the <code>start</code> node; the node type of the <code>end</code> node does not matter. 
</div>
</div>
  
<a name="function.map-bidirectional-search-paths-bipartite" id="function.map-bidirectional-search-paths-bipartite"></a>
<a name="map-bidirectional-search-paths-bipartite" id="map-bidirectional-search-paths-bipartite"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-bidirectional-search-paths-bipartite</span>
<span class="documentation-arguments"><span class="argument">start</span> &nbsp;<span class="argument">end</span> &nbsp;<span class="argument">generator-1</span> &nbsp;<span class="argument">generator-2</span> &nbsp;<span class="argument">fn</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">timeout</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Apply <code>fn</code> to each path between <code>start</code> and <code>end</code> using <code>generator-1</code> and <code>generator-2</code> to determine adjacent nodes and <a href="#bidirectional-search" title="description of bidirectional-search">bidirectional-search</a> to find paths. 
</div>
</div>
  <h4>Graphs Measures</h4><p>There are many ways to measure information about a graph and its structure. Some of these focus on the graph as a whole while others target particular actors (vertices). </p><h5>Who is nearby</h5>
<a name="function.nodal-neighbors" id="function.nodal-neighbors"></a>
<a name="nodal-neighbors" id="nodal-neighbors"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">nodal-neighbors</span>
<span class="documentation-arguments"><span class="argument">node</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p><code>nodal-neighbors</code> returns a list of other nodes that can be reached from <code>node</code> by following an edge. <code>Node</code> should be a vertex in the graph represented by the triple-store; See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </p><p>Note that the <a href="#function.nodal-degree" title="description of function nodal-degree">nodal-degree</a> of a node is the same as `(length (nodal-neighbors node)). See <a href="#function.nodal-degree" title="description of function nodal-degree">nodal-degree</a> for additional details. </p>
</div>
</div>
  
<a name="function.nodal-degree" id="function.nodal-degree"></a>
<a name="nodal-degree" id="nodal-degree"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">nodal-degree</span>
<span class="documentation-arguments"><span class="argument">node</span> &nbsp;<span class="argument">generator</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>The nodal-degree of <code>node</code> is the total number of edges that connect it to other nodes in the graph. Edges are found using the <code>generator</code>. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </p><p>Note that the <em>interpretation</em> of nodal-degree depends entirely on the generator being using in the calculation. Suppose, for example, that we have a graph with three nodes and two edges: </p>
<pre><code> A --&gt; B &lt;-- C </code></pre><p>and that these are encoded in AllegroGraph as </p>
<pre><code>!ex:A !ex:linksTo !ex:B  
!ex:C !ex:linksTo !ex:B </code></pre><p>If we define three generators: </p>
<pre><code>(defsna-generator linksTo (node)  
  (:objects-of :p !ex:linksTo))  
 
(defsna-generator linksFrom (node)  
  (:subjects-of :p !ex:linksTo))  
 
(defsna-generator links (node)  
  (:undirected :p !ex:linksTo)) </code></pre><p>then we will find that </p>
<pre><code>&gt; (nodal-degree !ex:B 'linksTo)  
0  
 
&gt; (nodal-degree !ex:B 'linksFrom)  
2  
 
&gt; (nodal-degree !ex:B 'links)  
2 </code></pre><p>Finally, note that <code>nodal-degree</code> is the same as the length of the list of nodes returned by <a href="#function.nodal-neighbors" title="description of function nodal-neighbors">nodal-neighbors</a>. </p>
</div>
</div>
  
<a name="function.ego-group" id="function.ego-group"></a>
<a name="ego-group" id="ego-group"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">ego-group</span>
<span class="documentation-arguments"><span class="argument">node</span> &nbsp;<span class="argument">depth</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>The ego-group function returns a list of nodes in <code>node</code>'s <em>ego group</em>. </p><p>These are the other nodes in the graph that can be reached by following paths of at most length <code>depth</code> starting at <code>node</code>. The paths are determined using the <code>generator</code> to select neighbors of each node in the ego-group. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </p>
</div>
</div>
  <h5>Centrality Measures</h5><p>The <em>centrality</em> of an actor in a network is a measure of its prestige or importance or power. There are many ways to measure it and the best way varies with the application. </p>
<a name="function.graph-density" id="function.graph-density"></a>
<a name="graph-density" id="graph-density"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">graph-density</span>
<span class="documentation-arguments"><span class="argument">subgraph</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">This is the normalized average degree of the actors in the graph. Roughly, how many of the possible connections between actors are realized. Subgraph is a list of nodes and generator is a generator function or name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. 
</div>
</div>
  
<a name="function.actor-degree-centrality" id="function.actor-degree-centrality"></a>
<a name="actor-degree-centrality" id="actor-degree-centrality"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">actor-degree-centrality</span>
<span class="documentation-arguments"><span class="argument">actor</span> &nbsp;<span class="argument">group</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">An actor centrality measure provides insight into how central or important an actor is in the group. Degree-centrality uses the number of actor connections (the degree) as a proxy for importance. <code>Actor</code> is a node in the graph; <code>group</code> is a list of nodes (e.g., the actor's <a href="#function.ego-group" title="description of function ego-group">ego group</a>) and generator is either a function or name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. 
</div>
</div>
  
<a name="function.group-degree-centrality" id="function.group-degree-centrality"></a>
<a name="group-degree-centrality" id="group-degree-centrality"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">group-degree-centrality</span>
<span class="documentation-arguments"><span class="argument">group</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Group centrality measures the cohesion a group relative to some measure of actor-centrality. <code>group-degree-centrality</code> measures group cohesion by finding the maximum actor centrality in the group, summing the difference between this and each other actor's degree centrality and then normalizing. It ranges from 0 (when all actors have equal degree) to 1 (when one actor is connected to every other and no other actors have connections). 
</div>
</div>
  
<a name="function.actor-closeness-centrality" id="function.actor-closeness-centrality"></a>
<a name="actor-closeness-centrality" id="actor-closeness-centrality"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">actor-closeness-centrality</span>
<span class="documentation-arguments"><span class="argument">actor</span> &nbsp;<span class="argument">group</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>An actor centrality measure provides insight into how central or important an actor is in the group. Closeness-centrality is the (normalized) inverse average path length of all the shortest paths between the actor and every other member of the group. (The inverse so that higher values indicate more central actors). </p><p><code>Actor</code> is a node in the graph; <code>group</code> is a list of nodes (e.g., the actor's <a href="#function.ego-group" title="description of function ego-group">ego group</a>) and generator is either a function or name.  See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </p>
</div>
</div>
  
<a name="function.group-closeness-centrality" id="function.group-closeness-centrality"></a>
<a name="group-closeness-centrality" id="group-closeness-centrality"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">group-closeness-centrality</span>
<span class="documentation-arguments"><span class="argument">group</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Group centrality measures the cohesion a group relative to some measure of actor-centrality. <code>group-closeness-centrality</code> is measured by first finding the actor whose <code>closeness-centrality</code> is maximized and then summing the difference between this maximum value and the <a href="#function.actor-closeness-centrality" title="description of function actor-closeness-centrality">actor-closeness-centrality</a> of all other actors. This value is then normalized so that it ranges between 0 and 1. 
</div>
</div>
  
<a name="function.actor-betweenness-centrality" id="function.actor-betweenness-centrality"></a>
<a name="actor-betweenness-centrality" id="actor-betweenness-centrality"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">actor-betweenness-centrality</span>
<span class="documentation-arguments"><span class="argument">actor</span> &nbsp;<span class="argument">group</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>An actor centrality measure provides insight into how central or important an actor is in the group. Betweenness-centrality measures how much <strong>control</strong> an actor has over communication in the group. </p><p>The actor-betweenness-centrality of actor <em>i</em> is computed by counting the number of shortest paths between all pairs of actors (not including <em>i</em>) that pass through actor <em>i</em>. The assumption being that this is the chance that actor <em>i</em> can control the interaction between <em>j</em> and <em>k</em>. </p><p><code>Actor</code> is a node in the graph; <code>group</code> is a list of nodes (e.g., the actor's <a href="#function.ego-group" title="description of function ego-group">ego group</a>) and generator is either a function or name. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. </p>
</div>
</div>
  
<a name="function.group-betweenness-centrality" id="function.group-betweenness-centrality"></a>
<a name="group-betweenness-centrality" id="group-betweenness-centrality"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">group-betweenness-centrality</span>
<span class="documentation-arguments"><span class="argument">group</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Group centrality measures the cohesion a group relative to some measure of actor-centrality. <code>group-betweenness-centrality</code> is measured by first finding the actor whose <code>betweenness-centrality</code> is maximized and then summing the difference between this maximum value and the <a href="#function.actor-betweenness-centrality" title="description of function actor-betweenness-centrality">actor-betweenness-centrality</a> of all other actors. This value is then normalized so that it ranges between 0 and 1. 
</div>
</div>
  
<a name="function.page-rank-centrality" id="function.page-rank-centrality"></a>
<a name="page-rank-centrality" id="page-rank-centrality"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">page-rank-centrality</span>
<span class="documentation-arguments"><span class="argument">group</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">dampening-factor</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Page-rank centrality is a specific implementation of a more general <a href="http://en.wikipedia.org/wiki/Eigenvector_centrality#Eigenvector_centrality" class="external" target="_blank">eigenvector centrality</a> measure. Given a set of nodes in a graph, the <code>page-rank-centrality</code> function returns a vector representing the <em>importance</em> or <em>influence</em> of each node. Though it is not actually computed like this, you can imagine that we repeatedly pick a node at random and then execute a random walk following the edges of the graph while noticing which nodes our walker visits. The page-rank centrality is the probability that the walker will be on a particular node when it stops. </p>
<ul>
<li>group - a list of nodes in the triple-store</li>
<li>generator - a generator describing how to get from one to another</li>
<li>:dampening-factor - the effects how quickly the iterate algorithm stabilizes </li></ul><p>Returns a vector of (unnormalized) page-ranks in the same order as the nodes in <code>group</code>. </p>
</div>
</div>
  <h5>Cliques</h5><p>In graph theory, a <code>clique</code> is a fully connected subgraph in a larger graph. AllegroGraph supplies function to determine is a subgraph is a clique and to find all of the cliques in a graph. </p>
<a name="function.cliquep" id="function.cliquep"></a>
<a name="cliquep" id="cliquep"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">cliquep</span>
<span class="documentation-arguments"><span class="argument">subgraph</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return true if every member of <code>subgraph</code> is linked to every other member. As usual, the <code>generator</code> is used to determine whether or not a link exists between two nodes. See the description of <a href="#ref-sna-generators" title="">generators</a> for additional details. 
</div>
</div>
  
<a name="function.cliques" id="function.cliques"></a>
<a name="cliques" id="cliques"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">cliques</span>
<span class="documentation-arguments"><span class="argument">node</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">minimum-size</span> &nbsp;<span class="argument">maximum-size</span> &nbsp;<span class="argument">maximal-only</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return a list of the cliques of which <code>node</code> is a member (using <code>generator</code> to find adjacent nodes). Each clique returned will contain at least <code>minimum-size</code> and no more than <code>maximum-size</code> members. If `maximal-only is true, then only the largest cliques will be returned. 
</div>
</div>
  
<a name="function.map-cliques" id="function.map-cliques"></a>
<a name="map-cliques" id="map-cliques"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">map-cliques</span>
<span class="documentation-arguments"><span class="argument">node</span> &nbsp;<span class="argument">generator</span> &nbsp;<span class="argument">fn</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">minimum-size</span> &nbsp;<span class="argument">maximum-size</span> &nbsp;<span class="argument">maximal-only</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Apply <code>fn</code> to each clique in which <code>node</code> is a member and whose size is at least <code>minimum-size</code> and less than <code>maximum-size. The </code>generator<code> is used to find adjacent nodes. If </code>maximal-only` is true, then only maximal-cliques are mapped. 
</div>
</div>
  <h4>Prolog and Social Network Analysis</h4><p>The functions described above have analogues in the Prolog world. </p><h5>Prolog Graph Search</h5>
<a name="functor.breadth-first-search-paths" id="functor.breadth-first-search-paths"></a>
<a name="breadth-first-search-paths" id="breadth-first-search-paths"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">breadth-first-search-paths</span>
<div class="documentation-arguments">(breadth-first-search-paths +start +end +generator -path)
(breadth-first-search-paths +start +end +generator +max-depth -path)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unifies path with each path found from <code>start</code> to <code>end</code> using a <em>breadth first</em> search strategy. </p>
<ul>
<li><code>start</code> - the node at which to start</li>
<li><code>end</code> - the node at which to stop</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li>
<li><code>max-depth</code> - the maximum depth to search.</li>
<li><code>path</code> - bound to a list of UPIs representing a path from <code>start</code> to <code>end</code>. Each element in the path will be a UPI <strong>U</strong> such that there is a triple whose subject is <strong>U</strong>; whose object is the next element in the list; and which is returned by a call to <code>generator</code>. Iterates over paths between <code>start</code> and <code>end</code> of all  lengths. <strong>Warning</strong> Searching for <em>all</em> possible paths in a large triple-store can take a long amount of time. </li></ul><p>Iterates over paths between <code>start</code> and <code>end</code> that are no longer than <code>max-depth</code>. </p>
</div>
</div>
  
<a name="functor.breadth-first-search-path" id="functor.breadth-first-search-path"></a>
<a name="breadth-first-search-path" id="breadth-first-search-path"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">breadth-first-search-path</span>
<div class="documentation-arguments">(breadth-first-search-path +start +end +generator -path)
(breadth-first-search-path +start +end +generator +max-depth -path)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unifies <code>path</code> to a list of UPIs connecting <code>start</code> and <code>end</code>     using <code>generator</code> using a <em>breadth first</em> search strategy. </p>
<ul>
<li><code>start</code> - the node at which to start</li>
<li><code>end</code> - the node at which to stop</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li>
<li><code>max-depth</code> - the maximum depth to search.</li>
<li><code>path</code> - bound to a list of UPIs representing a path from <code>start</code> to <code>end</code>. Each element in the path will be a UPI <strong>U</strong> such that there is a triple whose subject is <strong>U</strong> and whose object is the next element in the list and which is returned by a call to <code>generator</code>. Binds <code>path</code> to a list of UPIs connecting <code>start</code> and <code>end</code>. </li></ul><p>The path will use <code>generator</code> to find the links between nodes. Since a breadth-first search strategy is used, the shortest path will be found. </p><p>Binds <code>path</code> to a list of UPIs connecting <code>start</code> and <code>end</code>. </p><p>The path will be no longer than <code>max-depth</code> and will use <code>generator</code> to find the links between nodes. Since a breadth-first search strategy is used, the shortest path will be found. </p>
</div>
</div>
  
<a name="functor.depth-first-search-paths" id="functor.depth-first-search-paths"></a>
<a name="depth-first-search-paths" id="depth-first-search-paths"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">depth-first-search-paths</span>
<div class="documentation-arguments">(depth-first-search-paths +start +end +generator -path)
(depth-first-search-paths +start +end +generator +max-depth -path)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unifies <code>path</code> with each path found from <code>start</code> to <code>end</code> using a <em>depth first</em> search strategy. </p>
<ul>
<li><code>start</code> - the node at which to start</li>
<li><code>end</code> - the node at which to stop</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li>
<li><code>max-depth</code> - the maximum depth to search.</li>
<li><code>path</code> - bound to a list of UPIs representing a path from <code>start</code> to <code>end</code>. Each element in the path will be a UPI <strong>U</strong> such that there is a triple whose subject is <strong>U</strong>; whose object is the next element in the list; and which is returned by a call to <code>generator</code>. Iterates over paths between <code>start</code> and <code>end</code> of all  lengths. <strong>Warning</strong> Searching for <em>all</em> possible paths in a large triple-store can take a long amount of time. </li></ul><p>Iterates over paths between <code>start</code> and <code>end</code> that are no longer than <code>max-depth</code>. </p>
</div>
</div>
  
<a name="functor.bidirectional-search-paths" id="functor.bidirectional-search-paths"></a>
<a name="bidirectional-search-paths" id="bidirectional-search-paths"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">bidirectional-search-paths</span>
<div class="documentation-arguments">(bidirectional-search-paths +start +end +generator -path)
(bidirectional-search-paths +start +end +generator +max-depth -path)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unifies <code>path</code> with each path found from <code>start</code> to <code>end</code> using a <em>bidirectional</em> search strategy (i.e., preceding from <code>start</code> and <code>end</code> simultaneously). </p>
<ul>
<li><code>start</code> - the node at which to start</li>
<li><code>end</code> - the node at which to stop</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li>
<li><code>max-depth</code> - the maximum depth to search.</li>
<li><code>path</code> - bound to a list of UPIs representing a path from <code>start</code> to <code>end</code>. Each element in the path will be a UPI <strong>U</strong> such that there is a triple whose subject is <strong>U</strong>; whose object is the next element in the list; and which is returned by a call to <code>generator</code>. Iterates over paths between <code>start</code> and <code>end</code> of all  lengths. <strong>Warning</strong> Searching for <em>all</em> possible paths in a large triple-store can take a long amount of time. </li></ul><p>Iterates over paths between <code>start</code> and <code>end</code> that are no longer than <code>max-depth</code>. </p>
</div>
</div>
  
<a name="functor.bidirectional-search-path" id="functor.bidirectional-search-path"></a>
<a name="bidirectional-search-path" id="bidirectional-search-path"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">bidirectional-search-path</span>
<div class="documentation-arguments">(bidirectional-search-path +start +end +generator -path)
(bidirectional-search-path +start +end +generator +max-depth -path)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unifies <code>path</code> with the first path found from <code>start</code> to <code>end</code> using a <em>bidirectional</em> search strategy (i.e., preceding from <code>start</code> and <code>end</code> simultaneously). </p>
<ul>
<li><code>start</code> - the node at which to start</li>
<li><code>end</code> - the node at which to stop</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li>
<li><code>max-depth</code> - the maximum depth to search.</li>
<li><code>path</code> - bound to a list of UPIs representing a path from <code>start</code> to <code>end</code>. Each element in the path will be a UPI <strong>U</strong> such that there is a triple whose subject is <strong>U</strong>; whose object is the next element in the list; and which is returned by a call to <code>generator</code>. Binds <code>path</code> to a list of UPIs connecting <code>start</code> and <code>end</code>. </li></ul><p>Binds <code>path</code> to a list of UPIs <code>start</code> and <code>end</code> that is no longer than <code>max-depth</code>. </p>
</div>
</div>
  <h5>Prolog Graph Measures</h5>
<a name="functor.nodal-degree" id="functor.nodal-degree"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">nodal-degree</span>
<div class="documentation-arguments">(nodal-degree +actor +generator -degree)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unifies <code>degree</code> to be the <a href="#function.nodal-degree" title="description of function nodal-degree">nodal-degree</a> of <code>actor</code> in the current triple-store (i.e., the current value of <a href="#x:2Adb:2A" title="description of *db*">*db*</a>). </p>
<ul>
<li><code>actor</code> - a node in the graph</li>
<li><code>generator</code> - the name of the generator function used to compute adjacent nodes in the graph (see the section on <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
  
<a name="functor.nodal-neighbors" id="functor.nodal-neighbors"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">nodal-neighbors</span>
<div class="documentation-arguments">(nodal-neighbors +actor +generator -neighbor)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unifies <code>neighbor</code> to each vertex that has an edge pointing away from or towards <code>actor</code> in the graph defined by <code>generator</code> in the current triple-store (i.e., the current value of <a href="#x:2Adb:2A" title="description of *db*">*db*</a>). </p>
<ul>
<li><code>actor</code> - a node in the graph</li>
<li><code>generator</code> - the name of the function used to determine adjacent nodes. (See <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
  
<a name="functor.graph-density" id="functor.graph-density"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">graph-density</span>
<div class="documentation-arguments">(graph-density +group +generator -density)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>The density of <code>group</code> is the normalized average degree of the actors in the group. Roughly, this is a measure of how many of the possible connections between actors are actually realized. </p>
<ul>
<li><p><code>group</code> - a list of nodes in the graph (these can be UPIs, <a href="#ref-future-parts" title="">future-parts</a>, or strings that can be coerced into UPIs). </p></li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
  
<a name="functor.ego-group" id="functor.ego-group"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">ego-group</span>
<div class="documentation-arguments">(ego-group +actor +depth +generator -group)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unify <code>group</code> to the list of UPIs representing the <em>ego group</em> of <code>actor</code> in the graph. </p>
<ul>
<li><code>actor</code> - a node in the graph</li>
<li><code>depth</code> - how many links to travel when fining the ego group.</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul><p>See <a href="#functor.ego-group-member" title="description of functor ego-group-member">ego-group-member</a> to iterate over each member instead of collecting them all into a list. </p>
</div>
</div>
  
<a name="functor.ego-group-member" id="functor.ego-group-member"></a>
<a name="ego-group-member" id="ego-group-member"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">ego-group-member</span>
<div class="documentation-arguments">(ego-group-member +actor +depth +generator +member)
(ego-group-member +actor +depth +generator -member)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>If <code>member</code> is supplied, then <code>ego-group-member</code> succeeds if and only if <code>member</code> is in the ego-group of <code>actor</code>. </p><p>Unify <code>member</code> with each of the other actors in <code>actor</code>'s ego-group. </p>
<ul>
<li><code>actor</code> - a node in the graph</li>
<li><code>depth</code> - how many links to travel when fining the ego group.</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul><p>See <a href="#functor.ego-group" title="description of functor ego-group">ego-group</a> to directly collect all of the members of an actor's ego-group. </p>
</div>
</div>
  
<a name="functor.clique" id="functor.clique"></a>
<a name="clique" id="clique"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">clique</span>
<div class="documentation-arguments">(clique +actor +generator -clique)
(clique +actor +minimum-size +generator -clique)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unify <code>clique</code> with each of the graph cliques (i.e., completely connected sub-graphs) in graph in which <code>actor</code> plays a member. </p>
<ul>
<li><code>actor</code> - a node in the graph</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). The arity three version of <code>clique</code> iterates over all cliques that have three or more members </li></ul><p>The arity four version of <code>clique</code> iterates over all cliques that have <code>minimum-size</code> or more members </p>
</div>
</div>
  
<a name="functor.cliquep" id="functor.cliquep"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">cliquep</span>
<div class="documentation-arguments">(cliquep +group +generator)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Succeeds if <code>group</code> is a <em>clique</em> in graph (where edges between nodes are defined by <code>generator</code>). </p>
<ul>
<li><code>group</code> - a list of items that can be coerced into UPIs in the graph</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
  
<a name="functor.actor-degree-centrality" id="functor.actor-degree-centrality"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">actor-degree-centrality</span>
<div class="documentation-arguments">(actor-degree-centrality +actor +group +generator -centrality)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unify <code>centrality</code> with the <a href="#function.actor-degree-centrality" title="description of function actor-degree-centrality">actor-degree-centrality</a> of <code>actor</code>. </p>
<ul>
<li><code>actor</code> - a UPI in the graph (or something that can be coerced into a UPI). </li>
<li><code>group</code> - a list of items that can be coerced into UPIs in the graph</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
  
<a name="functor.group-degree-centrality" id="functor.group-degree-centrality"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">group-degree-centrality</span>
<div class="documentation-arguments">(group-degree-centrality +group +generator -centrality)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unify <code>centrality</code> with the <a href="#function.group-degree-centrality" title="description of function group-degree-centrality">group-degree-centrality</a> of <code>group</code>. </p>
<ul>
<li><code>group</code> - a list of items that can be coerced into UPIs in the graph</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
  
<a name="functor.actor-closeness-centrality" id="functor.actor-closeness-centrality"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">actor-closeness-centrality</span>
<div class="documentation-arguments">(actor-closeness-centrality +actor +group +generator -centrality)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unify <code>centrality</code> with the <a href="#function.actor-closeness-centrality" title="description of function actor-closeness-centrality">actor-closeness-centrality</a> of <code>actor</code>. </p>
<ul>
<li><code>actor</code> - a UPI in the graph (or something that can be coerced into a UPI). </li>
<li><code>group</code> - a list of items that can be coerced into UPIs in the graph</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
  
<a name="functor.group-closeness-centrality" id="functor.group-closeness-centrality"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">group-closeness-centrality</span>
<div class="documentation-arguments">(group-closeness-centrality +group +generator -centrality)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unify <code>centrality</code> with the <a href="#function.group-closeness-centrality" title="description of function group-closeness-centrality">group-closeness-centrality</a> of <code>group</code>. </p>
<ul>
<li><code>group</code> - a list of items that can be coerced into UPIs in the graph</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
  
<a name="functor.actor-betweenness-centrality" id="functor.actor-betweenness-centrality"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">actor-betweenness-centrality</span>
<div class="documentation-arguments">(actor-betweenness-centrality +actor +group +generator -centrality)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unify <code>centrality</code> with the <a href="#function.actor-betweenness-centrality" title="description of function actor-betweenness-centrality">actor-betweenness-centrality</a> of <code>actor</code>. </p>
<ul>
<li><code>actor</code> - a UPI in the graph (or something that can be coerced into a UPI). </li>
<li><code>group</code> - a list of items that can be coerced into UPIs in the graph</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
  
<a name="functor.group-betweenness-centrality" id="functor.group-betweenness-centrality"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">group-betweenness-centrality</span>
<div class="documentation-arguments">(group-betweenness-centrality +group +generator -centrality)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>Unify <code>centrality</code> with the <a href="#function.group-betweenness-centrality" title="description of function group-betweenness-centrality">group-betweenness-centrality</a> of <code>group</code>. </p>
<ul>
<li><code>group</code> - a list of items that can be coerced into UPIs in the graph</li>
<li><code>generator</code> - a function that specifies how to find the neighbors of an actor in the graph (see <a href="#ref-sna-generators" title="">generators</a> for more details). </li></ul>
</div>
</div>
   <a name='lisp-nd-geospatial-reference' id='lisp-nd-geospatial-reference'></a> <h3>nD Geospatial Primitives</h3> <h4>Introduction</h4><p>The AllegroGraph nD Geospatial facility supports multi-dimensional data and proximity searches on that data. The Lisp interface to nD Geospatial is described in this section. The best introduction for the <strong>nD</strong> encoding is the <a href="geospatial-nd.html">N-dimensional Geospatial</a> document and the associated <a href="geospatial-nd-tutorial.html">nD Geospatial Tutorial</a>. They explain the principles behind AllegroGraph's geospatial indexing, its support for higher dimensions, and proximity search. </p><p>In addition to the Lisp API there is a SPARQL Magic Property interface for nD geospatial queries using SPARQL triple-pattern syntax.  See <a href="magic-properties.html#sparql-magic-geo-nd">nD Geospatial Magic Properties</a>. The nD facility is also accessible through the HTTP interface (see <a href="http-protocol.html">REST/HTTP interface</a>) and the other client languages that depend upon it. </p><h4>Geospatial fundamentals</h4><p>AllegroGraph provides a novel mechanism for efficient storage and retrieval of data elements which are coordinates in an N-dimensional space.  We often refer to this kind of data as "geospatial" although that term refers more specifically to positions on or around the earth's surface.  AllegroGraph supports a more general notion of N-dimensional ordinates, both in an N-dimensional Cartesian domain such as the surface of a silicon chip, a sphere such as the earth's surface, or any other two-dimensional geometry system a user can define.  However, we will use the term geospatial to include any such data when there is no danger of ambiguity.  The <strong>nD</strong> API supports N-dimensional ordinate systems. There is no hard limit in the number of dimensions, although practical considerations will limit it to no more than 5 or 6. </p><p>The implementation employs a geospatial UPI type. The geospatial UPI type supports defining up to 256 subtypes in a single application (session) or any single repository. A geospatial UPI always encodes all its ordinates inside a single UPI in a way that allows efficient searching.  The subtype specifies how external numeric data (e.g. degrees, radians, meters, nanometers, temperature, date-time) is converted to and from the geospatial UPI internal representation. </p><h4>Geospatial Subtypes</h4><p>It is the job of a geospatial subtype to convert coordinates in some external representation to and from UPI representation.  There are helper functions for defining certain important kinds of subtypes, for example, latitude and longitude on the earth's surface, and simple X:Y coordinates over a finite range of the infinite Cartesian plane. </p><p>The precision of each ordinate in the internal UPI representation is 32-bits.  Dividing the circumference of the earth by 2^32 reveals that the resolution of a 32-bit integer longitude is slightly better than 1 cm. </p><p>Suppose we want to search a triple store for geospatial UPIs that are close to a certain XY, i.e., within a bounding box [X1,Y1,X2,Y2].  In a traditional RDF store (perhaps using :latitude and :longitude types) the X and Y would be in separate triples.  If the two ordinates were combined a single part, it would still only be possible to search over a range of {X1,X2}, but within that range <em>every</em> Y value must be retrieved and range tested.  As the size of the data increases, and therefore the total number of UPIs within the X range {X1,X2} increases, this scales badly. </p><p>A geospatial UPI <em>does</em> combine the two ordinates into a single value, but it adds a third component to the UPI. The Y dimension (or latitude) is decimated into strips of a fixed width, and UPIs are sorted first on the strip, then on the X, and finally on the actual Y value. </p><p>How does the Y strip help?  In any of the AllegroGraph indices, UPIs in any particular one of the SPOG are sorted as 12-byte unsigned integers.  Within any index, all geospatial UPIs of a given subtype will sort together, and are further sorted as described above (that is first on the strip, then on the X, and finally on the actual Y value). If we expect searches to be concerned with regions (or radii) about R in size, and if the strip width is chosen to be within an order of magnitude of the search size, it helps the search tremendously. </p><p>Suppose we have a large number of GPS latitude and longitude information of cell phone locations, and that the data points have a resolution around 10 meters.  Suppose we are interested in searching over a radius of 100 meters.  If we store the latitude-longitude UPIs using a strip width of 100 meters, then to find all candidates within the bounding box [X-100,Y-100,X+100,Y+100] requires scanning short regions of two strips.  Each candidate within those regions can be further filtered for exact distance.  The proportion of entries that must be filtered out is <code>1-(pi/4)</code>. </p><p>Suppose our strips are larger, 500 meters.  In that case our 100 meter radius search needs scan at most only two strips, and frequently only one, but the scan overall is somewhat less efficient because number of entries that must be filtered is greater.  Even if the Y region lies completely within a single strip, the proportion of undesired entries that must be filtered is approximately <code>1-(pi/(4*5))</code>.  If the Y region of interest spans two strips, the proportion of entries that must be examined and rejected by the filter is <code>10-(pi/(4*10))</code>. </p><p>If we err in the other direction and make the strips significantly smaller than the typical search radius, the proportion of entries that must be examined and filtered is not much affected, but the number of Y strips that must be scanned over the range [X1,X2] increases, causing more cursor creation and scans of disjoint sections of the index file.  For example, if the strip width were 10 meters, the 100-meter radius query would have to examine 10 or 11 strips.  This requires more cursor initialization and accessing multiple separate regions of the index. </p><p>In practice, even if the strip size for a particular geospatial subtype is as much as an order of magnitude away from the Y range used in a particular search, the strip approach is tremendously more efficient than direct X-Y search even for huge databases.  If it is anticipated that data will be searched using widely different ranges at different times, then the data can be duplicated in the database using multiple subtypes with different strip sizes.  For example, if we sometimes wanted to find cell phones records within a 100 meter radius of a location, and other times wanted to find calls within a 10 kilometer radius of a location, then it might make sense to record the data with multiple separate triples (or perhaps use both the object and graph UPIs of a single triple) with strip widths appropriate for each of the expected types of searches. </p><p>This points out the important limitation of the geospatial UPI strip concept.  It requires that the program creating the data know in advance something about how the data will be used, i.e., the typical width of regions of interest.  Fortunately, this estimate does not need to be exact.  Even an order of magnitude error will not make the data unusable. </p><p>AllegroGraph cannot anticipate all of the geospatial subtypes that future applications might find necessary.  An application must define the subtypes it wants to use, and there are some helper functions to assist for obvious popular requirements such as Earth-surface latitude/longitude with any desired strip width. </p><a name='lisp-geospatial-reference-nd' id='lisp-geospatial-reference-nd'></a> <h4>The <strong>nD</strong> API</h4><p>The database designer will generally want to experiment with the parameters of the several ordinates, especially the distribution of the available resolution over those ordinates.  The most convenient way to experiment with subtype design is through the Geospatial Designer Tool in WebView.  See the <a href="geospatial-nd.html#webview-geo">WebView Geospatial Datatype Designer</a> in <a href="geospatial-nd.html">N-dimensional Geospatial</a>. The programmatic interface here returns a new subtype object but does not install it in the Lisp image unless the <code>:install</code> boolean is true.  The subtype object can be examined with <code>describe</code>. </p><p><em>Installing</em> a subtype means adding it to internal structures so data using that subtype can be loaded into the store. Only 256 subtypes can be installed. Calling <strong>geo-register-nd-subtype</strong> with <code>:install nil</code> (the default) creates a subtype which can be examined with <strong>describe</strong> but does not install it. To install an as yet uninstalled subtype, call <strong>geo-register-nd-subtype</strong> again with the same argument except now specify <code>:install t</code>. </p>
<a name="function.geo-register-nd-subtype" id="function.geo-register-nd-subtype"></a>
<a name="geo-register-nd-subtype" id="geo-register-nd-subtype"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">geo-register-nd-subtype</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">ordinates</span> &nbsp;<span class="argument">type</span> &nbsp;<span class="argument">install</span> &nbsp;<span class="argument">handle-errors</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Computes, returns, and installs (if <code>install</code> is true) an nD geospatial subtype according to the <code>ordinates</code> or <code>type</code> argument, one and only one of which must be supplied. </p><p>The <code>type</code> argument if supplied must be the RDF resource string identifying this subtype. The string must be expressed as an RDF resource with angle brackets, for example: </p>
<pre><code>(geo-register-nd-subtype  
 :type "&lt;http://franz.com/ns/allegrograph/5.0/geo/nd#_lat_la_-9.+1_+9.+1_+1.-4_+1.-3_lon_lo_-1.8+2_+1.8+2_+1.-4&gt;"  
 ) </code></pre><p>It is not possible for a user to construct a resource string.  They may be obtained using the WebView nD Datatype Designer, or from typed literal data being ingested, or from a subtype previously defined using the <code>ordinates</code> argument. </p><p>The <code>ordinates</code> argument is an ordered list of lists describing the ordered set of ordinates. Each sublist is syntactically a Lisp plist and must have these properties in any order: </p>
<ul>
<li><p><code>:name</code> is a Lisp keyword symbol naming this ordinate.    The name must not contain whitespace or any of these characters: <code>` </code>_<code> </code>&amp;<code> </code>:<code> </code>$` </p>
<li><p><code>:minimum</code> and <code>:maximum</code> are the minimum and maximum values of this ordinate's range.</p></li>
<li><p><code>:resolution</code> is the desired resolution for this ordinate's encoded values in the same units    as <code>:minimum</code> and <code>:maximum</code>. </p></li>
<li><p><code>:strip-width</code> is the ordinate strip-width in the same units.    It must be provided for each ordinate except the last, for which it must not be supplied. </p></li>
<li><p><code>:type</code> is optional and will default intuitively when the <code>:name</code> is the same as the desired type,    e.g. <code>:latitude</code>.  Some types affect how proximity searches are done with the subtype; other types    only affect the use of human-readable externalizations.    The possible values are: </p>
<ul>
<li><code>:latitude</code> and <code>:longitude</code> specify two-dimensional spherical coordinates in degrees. If either is present both must be and there must be only one of each. If <code>:latitude</code> and <code>:longitude</code> are used, there must be no <code>:cartesian</code> ordinates. </li></ul></li></li><p>If <code>:latitude</code> and <code>:longitude</code> are present ISO 6709 format will be used when the upi is externalized into string representation.  This is solely a convenience for human readability.  The several alternative human-readable ISO 6709 formats are also accepted for ingest.  See     <a href="http://en.wikipedia.org/wiki/ISO_6709">http://en.wikipedia.org/wiki/ISO_6709</a>. Note ordinates outside the nominal range of -90 to +90 for latitude and -180 to +180 for longitude are not supported and may lead to incorrect results. </p>
<ul>
<li><p><code>:altitude</code> type only affects externalization.  If an <code>:altitude</code> type is present along with <code>:latitude</code> and <code>:longitude</code> then it will be added to the ISO 6709 representation. </p>
<li><p><code>:cartesian</code> specifies a cartesian ordinate.  There must be at least two, and no <code>:latitude</code> and <code>:longitude</code> ordinate types. </p></li>
<li><p><code>:time</code> specifies a date-time.  Upon ingest and enxoding all times are at present converted to UTC (also known as "zulu" or <code>Z</code>).  This is because all ordinate values must be strictly orderable, and the ordering between times with and without a time zone are sometimes indeterminate. </p></li></li><p>ISO 8601 format is used when a <code>:time</code> ordinate is externalized, and this is also accepted for ingest.  If ISO 6709 is also in effect for this subtype, the ISO 6709 and ISO 8601 components are concatenated, separated by a <code>^</code> character. Again, this is intended as a human-readability convenience. </p>
<li><code>:default</code> is the default and is treated as a plain real number both internally and under externalization. </li></ul></ul><p>The new subtype is installed in the currently executing image if and only if the <code>install</code> argument is supplied true. One or two values are returned: the computed subtype object, and if it was installed, the mod 256 index of the subtype in this image. </p>
</div>
</div>
  
<a name="function.parse-nd-datatype" id="function.parse-nd-datatype"></a>
<a name="parse-nd-datatype" id="parse-nd-datatype"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">parse-nd-datatype</span>
<span class="documentation-arguments"><span class="argument">type-string</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">start</span> &nbsp;<span class="argument">end</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><code>type-string</code> is the datatype for an <strong>nD</strong> subtype such as is accepted as the <code>type</code> argument to <a href="#geo-register-nd-subtype" title="description of geo-register-nd-subtype">geo-register-nd-subtype</a>. It is parsed into an equivalent list of plists such as is accepted as the <code>ordinates</code> argument to that function. 
</div>
</div>
  <p>The encoding and decoding of <strong>nD</strong> UPIs generally use Lisp plists as the external representation.  The following three functions do the conversions, and although the ordinates of an <strong>nD</strong> subtype are intrinsically ordered, in the plist representation they may appear in any order. </p>
<a name="function.geo-upi-:3Eplist" id="function.geo-upi-:3Eplist"></a>
<a name="geo-upi-:3Eplist" id="geo-upi-:3Eplist"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">geo-upi-&gt;plist</span>
<span class="documentation-arguments"><span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">The <code>upi</code> argument must be an <strong>nD</strong> encoded upi. It is decoded and a plist is returned. Each key is the keyword name of an ordinate and the value is that ordinate value. The plist is ordered in the order of the ordinates. 
</div>
</div>
  
<a name="function.geo-plist-:3Egeo" id="function.geo-plist-:3Egeo"></a>
<a name="geo-plist-:3Egeo" id="geo-plist-:3Egeo"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">geo-plist-&gt;geo</span>
<span class="documentation-arguments"><span class="argument">subtype-designator</span> &nbsp;<span class="marker">&amp;rest</span> &nbsp;<span class="argument">rest</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>The <code>subtype-designator</code> argument is a string, future-part, or UPI denoting an nD subtype installed in this client. </p><p>All the other arguments are in the form of a plist with keys being ordinate names and values being ordinate values. The plist may be in any order. The ordinates values are encoded into the <code>upi</code> according to the subtype. The <code>upi</code> argument is a upi, or if omitted or <code>nil</code>, a fresh upi is created. </p>
</div>
</div>
  
<a name="function.geo-ordinate-value" id="function.geo-ordinate-value"></a>
<a name="geo-ordinate-value" id="geo-ordinate-value"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">geo-ordinate-value</span>
<span class="documentation-arguments"><span class="argument">ordinate-name</span> &nbsp;<span class="argument">upi-or-plist</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the numeric real-number value of the <code>ordinate-name</code> ordinate in the <code>upi-or-plist</code>. If a plist, it might have been returned by <a href="#geo-upi-:3Eplist" title="description of geo-upi->plist">geo-upi-&gt;plist</a>. 
</div>
</div>
  <p>These three functions perform the three kinds of geospatial queries.  Each returns a cursor. </p>
<a name="function.get-triples-nd-within-bounding-box" id="function.get-triples-nd-within-bounding-box"></a>
<a name="get-triples-nd-within-bounding-box" id="get-triples-nd-within-bounding-box"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-nd-within-bounding-box</span>
<span class="documentation-arguments"><span class="marker">&amp;rest</span> &nbsp;<span class="argument">keys</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">subtype</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">debug</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a cursor that will return the specified triples. </p><p><code>p</code> is a UPI or future part specifying the predicate of triples to be matched.  It must be supplied. </p><p><code>subtype</code> is a geospatial-subtype designator. It can be an object such as is returned by <a href="#register-latitude-striping-in-miles" title="description of register-latitude-striping-in-miles">register-latitude-striping-in-miles</a> or a string, future-part, or UPI denoting such a subtype. It may be omitted if the db has an automatic predicate mapping for the given predicate.  Usually this will have been established automatically. </p><p><code>db</code> may be used to override the current default <em>db</em>. </p><p>Two additional keyword arguments must be supplied for each of the N ordinates specifying the minimum and maximum range of that ordinate in the N-dimensional bounding box.  For example, if there is a <code>:weight</code> ordinate then arguments must be supplied for <code>:weight-min</code> and  <code>:weight-max</code>. </p><p>If the <code>use-g</code> argument is specified and is true, the graph part of triples is searched instead of the object.  The other arguments are as for <a href="#get-triples" title="description of get-triples">get-triples</a>.  This includes the <code>s</code> argument which limits returned triples to those with the given subject. </p><p>It is an error to specify both <code>g</code> and <code>use-g</code> as is specifying <code>o</code> when <code>use-g</code> is nil. </p><p>If it can be determined that one of the search parameters (i.e., <code>s</code>, <code>p</code>, or <code>g</code>) is not interned in the triple-store, then <code>get-triples-nd-within-bounding-box</code> will return a <code>null-cursor</code> (i.e., a cursor that has no rows) and a second value of :part-not-found. </p>
</div>
</div>
  
<a name="function.get-triples-nd-within-radius" id="function.get-triples-nd-within-radius"></a>
<a name="get-triples-nd-within-radius" id="get-triples-nd-within-radius"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-nd-within-radius</span>
<span class="documentation-arguments"><span class="marker">&amp;rest</span> &nbsp;<span class="argument">keys</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">subtype</span> &nbsp;<span class="argument">radius</span> &nbsp;<span class="argument">units</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">debug</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a cursor that will return the specified triples. </p><p><code>p</code>, <code>subtype</code>, <code>db</code>, and <code>use-g</code> are as for <a href="#function.get-triples-nd-within-bounding-box" title="description of function get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a>. </p><p><code>radius</code> is the radius of the region of interest.  For a spherical subtype, i.e. one that has both a latitude and a longitude type ordinate, the radius is measured in <code>units</code> which may be <code>:km</code> (default) or <code>:miles</code> relative to the earth's surface, or <code>:radians</code>. For a cartesian subtype the unit is the same as the units of the several <code>:cartesian</code> type ordinates. </p><p>The radius for spherical subtypes is computed in two dimensions using the haversine formula on the latitude and longitude.  For cartesian subtypes the radius is computed in the same dimensionality as the several cartesian ordinates, the root of the sum of their squares. </p><p>Two additional minimum and maximum keyword arguments must be supplied for each additional ordinate that is neither spherical or cartesian, as for <a href="#function.get-triples-nd-within-bounding-box" title="description of function get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a>. </p><p>The <code>p</code>, <code>subtype</code>, <code>use-g</code>, and <code>db</code> arguments are also as for <a href="#function.get-triples-nd-within-bounding-box" title="description of function get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a>. </p><p>If it can be determined that one of the search parameters (i.e., <code>s</code>, <code>p</code>, or <code>g</code>) is not interned in the triple-store, then <code>get-triples-nd-within-radius</code> will return a <code>null-cursor</code> (i.e., a cursor that has no rows) and a second value of :part-not-found. </p>
</div>
</div>
  
<a name="function.get-triples-nd-within-polygon" id="function.get-triples-nd-within-polygon"></a>
<a name="get-triples-nd-within-polygon" id="get-triples-nd-within-polygon"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-nd-within-polygon</span>
<span class="documentation-arguments"><span class="marker">&amp;rest</span> &nbsp;<span class="argument">keys</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">subtype</span> &nbsp;<span class="argument">polygon</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">debug</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a cursor that will return the specified triples. </p><p><code>p</code>, <code>subtype</code>, <code>db</code>, and <code>use-g</code> are as for <a href="#function.get-triples-nd-within-bounding-box" title="description of function get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a>. </p><p><code>polygon</code> is a designator for a polygon as described above. </p><p>Two additional minimum and maximum keyword arguments must be supplied for each additional ordinate that is neither spherical or cartesian, as for <a href="#function.get-triples-nd-within-bounding-box" title="description of function get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a>. </p><p>If it can be determined that one of the search parameters (i.e., <code>s</code>, <code>p</code>, or <code>g</code>) is not interned in the triple-store, then <code>get-triples-nd-within-polygon</code> will return a <code>null-cursor</code> (i.e., a cursor that has no rows) and a second value of :part-not-found. </p>
</div>
</div>
  <p><em>nD</em> has a new <em>automation</em> facility to simplify database setup, data ingest, and querying. The goal is to reduce the places where application code must pass a subtype argument or even be aware of subtypes. This automation requires that certain reasonable conventions be obeyed in the database design.  These are: </p>
<ul>
<li><p>Any predicate that has an <strong>nD</strong> geospatial object must only have objects of that type.</p></li>
<li><p>There must be a predicate mapping for that predicate and type.    This mapping (and if necessary creation of the subtype itself)    will be established automatically upon ingest if automation is enabled. </p></li></ul><p>Automation allows externalized triples from a previous database to be imported into a new database without setup in the new database. It is recommended that automation be enabled for databases using <strong>nD</strong>. </p>
<a name="function.automate-nd-datatype-mappings" id="function.automate-nd-datatype-mappings"></a>
<a name="automate-nd-datatype-mappings" id="automate-nd-datatype-mappings"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">automate-nd-datatype-mappings</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>A setfable property of <code>db</code> that determines whether that <code>db</code> will obey certain nD usage conventions which allow the system to automate subtype management. The value is initialized by the :automate-nd-datatype-mappings argument (default <em>false</em>) at database creation time and is setfable. It is suggested that the property be <em>true</em> for databases using the nD geo facility. The default will probably change in a future release. </p><p>If <em>true</em>, when a not-yet-defined geospatial subtype is encountered as a typed literal, the subtype will be reconstructed and added to the db. Automatic predicate and datatype mappings will also be established. </p>
</div>
</div>
  <p>This property is an attribute of each individual database. </p><h4><strong>nD</strong> and Prolog</h4><p>The Prolog query API to <strong>nD</strong> has been made more user friendly by using functor names and argument conventions that are same as the Lisp API. The Prolog query predicates below accept a variable number of arguments. Arguments are identified by keywords, similar to Lisp <code>&amp;key</code> arguments. </p><p>For example, here are two versions of the same query, the first in Lisp, the second in Prolog. </p>
<pre><code>(get-triples-nd-within-radius :p !ex:location  
                              :latitude 37.43 :longitude -124.65  
                              :radius 1.0 :units :miles)  
 
(get-triples-nd-within-radius ?triple :p !ex:location  
                              :latitude 37.43 :longitude -124.65  
                              :radius 1.0 :units :miles) </code></pre><p>The only difference is that the Lisp example returns a cursor with which subsequent code can iterate, while the Prolog query succeeds multiple times, each time unifying <code>?triple</code> with a triple from the database.  Aside from this first argument in the Prolog example, the keyword-argument pairs can appear in any order. </p>
<a name="functor.get-triples-nd-within-bounding-box" id="functor.get-triples-nd-within-bounding-box"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-nd-within-bounding-box</span>
<div class="documentation-arguments">(get-triples-nd-within-bounding-box -triple +predicate ...)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>This is the Prolog version of <a href="#function.get-triples-nd-within-bounding-box" title="description of function get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a>. </p>
</div>
</div>
  
<a name="functor.get-triples-nd-within-radius" id="functor.get-triples-nd-within-radius"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-nd-within-radius</span>
<div class="documentation-arguments">(get-triples-nd-within-radius -triple +predicate ...)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>This is the Prolog version of <a href="#function.get-triples-nd-within-radius" title="description of function get-triples-nd-within-radius">get-triples-nd-within-radius</a>. </p>
</div>
</div>
  
<a name="functor.get-triples-nd-within-polygon" id="functor.get-triples-nd-within-polygon"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-nd-within-polygon</span>
<div class="documentation-arguments">(get-triples-nd-within-polygon -triple +predicate ...)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>This is the Prolog version of <a href="#function.get-triples-nd-within-polygon" title="description of function get-triples-nd-within-polygon">get-triples-nd-within-polygon</a>. </p>
</div>
</div>
  <p>The following is the Prolog equivalent of <a href="#function.geo-ordinate-value" title="description of function geo-ordinate-value">geo-ordinate-value</a>. </p>
<a name="functor.geo-ordinate-value" id="functor.geo-ordinate-value"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">geo-ordinate-value</span>
<div class="documentation-arguments">(geo-ordinate-value ordinate-name -value +nd-part)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents"><p>This unifies <code>?-value</code> with the ordinate value of <code>?ordinate-name</code> in <code>?+nd-part</code>. <code>?ordinate-name</code> is a Lisp keyword symbol.  If unbound, this predicate succeeds once for each ordinate. </p>
</div>
</div>
   <a name='lisp-temporal-reference' id='lisp-temporal-reference'></a> <h3>Temporal Primitives</h3><p>The Magic Property based set of <a href="magic-properties.html#sparql-magic-temporal">temporal extensions</a> (described in the linked section of the <a href="magic-properties.html">SPARQL Magic Properties</a> document) is a more modern interface that supports temporal queries. </p><p>AllegroGraph's <a href="#ref-type-mapping" title="">encoded UPIs</a> support efficient storage and retrieval of temporal data including datetimes, time points, and time intervals: </p>
<ul>
<li>datetimes in <a href="http://en.wikipedia.org/wiki/ISO_8601" class="external" target="_blank">ISO 8601</a> format: "2008-02-01T00:00:00-08:00"</li>
<li>time points: !ex:point1, !ex:h-hour, !ex:when-the-meeting-began, etc</li>
<li>time intervals: !ex:delay-interval (e.g., from point !ex:point1 to !ex:h-hour)</li></ul><p>Once data has been encoded, applications can perform queries involving a broad range of temporal constraints on data in the store, including: </p>
<ul>
<li>relations between points and datetimes</li>
<li>relations between intervals and datetimes</li>
<li>relations between two points</li>
<li>relations between two intervals</li>
<li>relations between points and intervals</li></ul><p>The <a href="temporal-tutorial.html">temporal reasoning tutorial</a> describes all of these capabilities in detail and also functions as a reference guide. </p> <a name='lisp-2d-geospatial-reference' id='lisp-2d-geospatial-reference'></a> <h3>2D Geospatial Primitives</h3> <h4>Introduction</h4><p>Since release 5.0, AllegroGraph has supported an N-dimensional (nD) geospatial facility which supports multi-dimensional data and proximity searches. That facility is described in the <a href="geospatial-nd.html">N-dimensional Geospatial</a> document and the Lisp interface to it is described <a href="#lisp-nd-geospatial-reference">above in this document</a>. </p><p>Also supported is an older, 2D geospatial facility. This is maintained in this release for backward-compatibility but support will be discontinued in a future release. New projects should use the nD facility. The Lisp interface to the 2D facility is described in the following section. </p><p>As well as the Lisp API to the 2D geospatial system, there are SPARQL Magic Property interfaces that support geospatial queries using SPARQL triple-pattern syntax. See <a href="magic-properties.html#sparql-magic-geo-2d">2D geospatial</a> for magic properties for 2D geospatial. </p><h4>2D Geospatial fundamentals</h4><p>The 2D geospatial facility in AllegroGraph stores ordinate data for both dimensions in a single UPI. Note that though we call this "geospatial" information, it can refer to any 2 diimensional geometrical data. such as the surface of a silicon chip, planar maps, or a sphere such as the earth's surface. The geospatial UPI type supports up to 256 subtypes which the application programmer must custom design. A geospatial UPI always encodes all its ordinates inside a single UPI in a way that allows efficient searching.  The subtype specifies how external numeric data (e.g. degrees, radians, meters, nanometers, temperature, date-time) is converted to and from the geospatial UPI internal representation. </p><h4>Geospatial Subtypes</h4><p>It is the job of a geospatial subtype to convert coordinates in some external representation to and from UPI representation.  There are helper functions for defining certain important kinds of subtypes, for example, latitude and longitude on the earth's surface, and simple X-Y coordinates over a finite range of the infinite Cartesian plane. </p><p>The precision of each ordinate in the internal UPI representation is 32-bits.  Dividing the circumference of the earth by 2^32 reveals that the resolution of a 32-bit integer longitude is slightly better than 1 cm. </p><p>Suppose we want to search a triple store for geospatial UPIs that are close to a certain X-Y, i.e., within a bounding box [X1,Y1,X2,Y2].  In a traditional RDF store (perhaps using :latitude and :longitude types) the X and Y would be in separate triples.  If the two ordinates were combined into a single part, it would still only be possible to search over a range of {X1,X2}, but within that range <em>every</em> Y value must be retrieved and range tested.  As the size of the data increases, and therefore the total number of UPIs within the X range {X1,X2} increases, this scales badly. </p><p>A geospatial UPI <em>does</em> combine the two ordinates into a single value, but it adds a third component to the UPI. The Y dimension (or latitude) is decimated into strips of a fixed width, and UPIs are sorted first on the strip, then on the X, and finally on the actual Y value. </p><p>How does the Y strip help?  In any of the AllegroGraph indices, UPIs in any particular one of the SPOG are sorted as 12-byte unsigned integers.  Within any index, all geospatial UPIs of a given subtype will sort together, and are further sorted as described above (that is first on the strip, then on the X, and finally on the actual Y value). If we expect searches to be concerned with regions (or radii) about R in size, and if the strip width is chosen to be within an order of magnitude of the search size, it helps the search tremendously. </p><p>Suppose we have a large number of GPS latitude and longitude information of cell phone locations, and that the data points have a resolution around 10 meters.  Suppose we are interested in searching over a radius of 100 meters.  If we store the latitude-longitude UPIs using a strip width of 100 meters, then to find all candidates within the bounding box [X-100,Y-100,X+100,Y+100] requires scanning short regions of two strips.  Each candidate within those regions can be further filtered for exact distance.  The proportion of entries that must be filtered out is <code>1-(pi/4)</code>. </p><p>Suppose our strips are larger, 500 meters.  In that case our 100 meter radius search needs to scan at most only two strips, and frequently only one, but the scan overall is somewhat less efficient because the number of entries that must be filtered is greater.  Even if the Y region lies completely within a single strip, the proportion of undesired entries that must be filtered is approximately <code>1-(pi/(4*5))</code>.  If the Y region of interest spans two strips, the proportion of entries that must be examined and rejected by the filter is <code>10-(pi/(4*10))</code>. </p><p>If we err in the other direction and make the strips significantly smaller than the typical search radius, the proportion of entries that must be examined and filtered is not much affected, but the number of Y strips that must be scanned over the range [X1,X2] increases, causing more scans of disjoint sections of the index file.  For example, if the strip width were 10 meters, the 100-meter radius query would have to examine 10 or 11 strips. </p><p>In practice, even if the strip size for a particular geospatial subtype is as much as an order of magnitude away from the Y range used in a particular search, the strip approach is tremendously more efficient than direct X-Y search even for huge databases.  If it is anticipated that data will be searched using widely different ranges at different times, then the data can be duplicated in the database using multiple subtypes with different strip sizes.  For example, if we sometimes wanted to find cell phone records within a 100 meter radius of a location, and other times wanted to find calls within a 10 kilometer radius of a location, then it might make sense to record the data with multiple separate triples (or perhaps use both the object and graph UPIs of a single triple) with strip widths appropriate for each of the expected types of searches. </p><p>This points out the important limitation of the geospatial UPI strip concept.  It requires that the program creating the data know in advance something about how the data will be used, i.e., the typical width of regions of interest.  Fortunately, this estimate does not need to be exact.  Even an order of magnitude error will not make the data unusable. </p><p>AllegroGraph cannot anticipate all of the geospatial subtypes that future applications might find necessary.  An application must define the subtypes it wants to use, and there are some helper functions to assist for obvious popular requirements such as Earth-surface latitude/longitude with any desired strip width. </p><a name='note-on-spherical-coordinates' id='note-on-spherical-coordinates'></a> <p>When working in spherical coordinates it is idiomatic to speak of "latitude and longitude" and to present the latitude before the longitude, as in "37.5N127.3W".  Latitude, i.e. the North/South axis, corresponds intuitively to Cartesian Y, and longitude corresponds intuitively to Cartesian X.  However, in Cartesian coordinates it is typical to present X before Y, as in "the point {3,-5}".  Since Cartesian and spherical coordinates mostly share a common API, we will in AllegroGraph uniformly speak of longitude/latitude and present the longitude before the latitude.  The only exception will be in parsing and printing ISO6709 latitude-longitude strings, where the standard defines latitude to appear before longitude. </p><p>Internally, the several varieties of latitude-striping subtypes all represent latitude and longitude ordinates as 32-bit unsigned integers.  The ranges <code>-90..+90</code> and <code>-180..+180</code> are scaled so that any coordinate in ISO6709 format <code>DDMMSSDDDMMSS</code> will round-trip between internal and external string representations without change or loss of precision.  Each second in latitude corresponds to 3300 units in the integer encoding, and each second in longitude corresponds to 6600 integer units, so fractional seconds that are exact submultiples will be reproducible.  These rather strange numbers were chosen as being close to the maximum resolution possible within 32 bits, and having a large number of prime divisors: </p>
<pre><code>3300:   2 2 3 5 5 11  
6600: 2 2 2 3 5 5 11  
</code></pre><a name='lisp-geospatial-reference-40' id='lisp-geospatial-reference-40'></a> <h4>Defining and Managing Geospatial Subtypes (2D geospatial)</h4><p>A geospatial subtype needs to define a number of functions to translate to and from the internal fields of the UPI and the external data.  It is important to realize that an X-Y location most-intuitively consists of two separate numerical values.  Other UPI types one way or another contain only a single value -- a string for resources and string literals, and a single number for the various numeric types, including time etc.  This means that the familiar functions <a href="#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> and <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> may not immediately be applicable. Although the application program rarely needs be concerned with the strip component, it does need communicate back and forth the two values for X and Y. </p><p>An application can control all aspects of encoding and decoding two-dimensional data to and from geospatial UPIs by writing the necessary functions but this is rarely necessary and only for exceptional kinds of models. Simple operators are provided for defining geospatial subtypes for a region on a flat Cartesian plane and for the surface of a sphere (as for longitude/latitude): </p>
<a name="function.register-cartesian-striping" id="function.register-cartesian-striping"></a>
<a name="register-cartesian-striping" id="register-cartesian-striping"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-cartesian-striping</span>
<span class="documentation-arguments"><span class="argument">xmin</span> &nbsp;<span class="argument">xmax</span> &nbsp;<span class="argument">ymin</span> &nbsp;<span class="argument">ymax</span> &nbsp;<span class="argument">strip-width</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Creates and returns a geospatial-subtype object implementing Cartesian XY coordinates over the X range <code>xmin</code>..<code>xmax</code> and Y range <code>ymin</code>..<code>ymax</code> and with the <code>strip-width</code> specified. 
</div>
</div>
  
<a name="function.register-latitude-striping-in-miles" id="function.register-latitude-striping-in-miles"></a>
<a name="register-latitude-striping-in-miles" id="register-latitude-striping-in-miles"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-latitude-striping-in-miles</span>
<span class="documentation-arguments"><span class="argument">latitude-strip-width-in-miles</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">lat-min</span> &nbsp;<span class="argument">lat-max</span> &nbsp;<span class="argument">lon-min</span> &nbsp;<span class="argument">lon-max</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Creates and returns a geospatial-subtype object implementing spherical longitude-latitude coordinates with the specified <code>latitude-strip-width-in-miles</code>.  The range of latitudes and longitudes are given by these keyword arguments with these defaults: <code>lat-min</code> -90.0, <code>lat-max</code> +90.0, <code>lon-min</code> -180.0, <code>lon-max</code> +180.0. 
</div>
</div>
  
<a name="function.register-latitude-striping-in-km" id="function.register-latitude-striping-in-km"></a>
<a name="register-latitude-striping-in-km" id="register-latitude-striping-in-km"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-latitude-striping-in-km</span>
<span class="documentation-arguments"><span class="argument">latitude-strip-width-in-km</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">lat-min</span> &nbsp;<span class="argument">lat-max</span> &nbsp;<span class="argument">lon-min</span> &nbsp;<span class="argument">lon-max</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Like <a href="#register-latitude-striping-in-miles" title="description of register-latitude-striping-in-miles">register-latitude-striping-in-miles</a> but the strip width <code>latitude-strip-width-in-km</code> is specified in kilometers. 
</div>
</div>
  
<a name="function.register-latitude-striping-in-degrees" id="function.register-latitude-striping-in-degrees"></a>
<a name="register-latitude-striping-in-degrees" id="register-latitude-striping-in-degrees"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-latitude-striping-in-degrees</span>
<span class="documentation-arguments"><span class="argument">latitude-strip-width-in-degrees</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">lat-min</span> &nbsp;<span class="argument">lat-max</span> &nbsp;<span class="argument">lon-min</span> &nbsp;<span class="argument">lon-max</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Like <a href="#register-latitude-striping-in-miles" title="description of register-latitude-striping-in-miles">register-latitude-striping-in-miles</a> but the strip width <code>latitude-strip-width-in-degrees</code> is specified in degrees. 
</div>
</div>
   <p>Execution of these functions returns an opaque geospatial subtype object that implements the subtype.  It is typical to save it somewhere in order to use it later.  See the <strong>defparameter</strong> in the example below. </p><p>The first defines a Cartesian subtype covering the specified region of the Cartesian plane.  Units of the four arguments are at the discretion of the programmer and may be any type of real numbers. </p><p>The other four functions define a spherical subtype.  A subtype can be defined to use either longitude/latitude in decimal degrees or radians.  For longitude/latitude, the strip width may be given in miles (relative to the earth's average radius), kilometers, or degrees in latitude. </p><p>Before using a geospatial subtype it must be defined, usually by executing one of the above operators.  Before storing a triple with a part with a geospatial subtype into a triple store, it is necessary to add that subtype to the set of subtypes known to that store.  This is done with the <a href="#add-geospatial-subtype-to-db" title="description of add-geospatial-subtype-to-db">add-geospatial-subtype-to-db</a> function. </p><p>When opening a triple store containing one or more geospatial subtypes, geospatial subtypes it uses will be recreated in the running AllegroGraph program if they are not already registered in that image. </p><p>The geospatial programming API generally converts all numeric ordinate values to floats, and returns them similarly.  The need to scale ordinates to and from 32-bit unsigned integer quantities, as they are represented in a geospatial UPI, imposes rounding errors.  This is even more evident in Cartesian subtypes, since Cartesian ranges are arbitrary, unlike spherical ordinates, so no simple prime divisor selection can be applied.  Ordinate numbers that were encoded from pleasantly round decimal fractions, and even some integers, will when externalized show annoying lengthy decimal fractions.  This is unpleasant, but the intended application of Allegrograph geospatial encoding is efficient and accurate calculation, not the exact preservation of textual presentation.  It is more important that encoded geospatial data can be externalized and reloaded without loss of resolution or accuracy.  If you need reliable preservation of RDF lexical form, you might want to store duplicate data as string literals.  AllegroGraph obviously always preserves literals accurately. </p>
<a name="function.add-geospatial-subtype-to-db" id="function.add-geospatial-subtype-to-db"></a>
<a name="add-geospatial-subtype-to-db" id="add-geospatial-subtype-to-db"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">add-geospatial-subtype-to-db</span>
<span class="documentation-arguments"><span class="argument">subtype</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Once a geospatial subtype has been defined in the executing AllegroGraph image, the subtype object must be added to the set of subtypes known to a specific triple-store before triples containing that subtype can be added to the store. This function adds the subtype to the specified database (which defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>). 
</div>
</div>
  
<a name="function.report-loaded-geospatial-subtypes" id="function.report-loaded-geospatial-subtypes"></a>
<a name="report-loaded-geospatial-subtypes" id="report-loaded-geospatial-subtypes"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">report-loaded-geospatial-subtypes</span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Reports to <code>*standard-output*</code> the subtype index of each the geospatial subtypes that has been registered in the running AllegroGraph image. The subtype index is an integer between 0 and 255 inclusive (as the maximum number of allowed geospatial subtypes is 256). 
</div>
</div>
  
<a name="function.drop-geospatial-subtype" id="function.drop-geospatial-subtype"></a>
<a name="drop-geospatial-subtype" id="drop-geospatial-subtype"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">drop-geospatial-subtype</span>
<span class="documentation-arguments"><span class="argument">subtype</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Undoes the effect previous calls to the <a href="#register-geospatial-subtype" title="description of register-geospatial-subtype">register-geospatial-subtype</a> functions. The <code>subtype</code> argument may be a geospatial-subtype object returned by one of the register functions, or the subtype index (an integer between 0 and 255 inclusive) in this executing AllegroGraph image.  An error is signaled if the subtype is still in use (as in <a href="#add-geospatial-subtype-to-db" title="description of add-geospatial-subtype-to-db">add-geospatial-subtype-to-db</a>) by any open database. 
</div>
</div>
  
<a name="function.register-geospatial-subtype" id="function.register-geospatial-subtype"></a>
<a name="register-geospatial-subtype" id="register-geospatial-subtype"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">register-geospatial-subtype</span>
<span class="documentation-arguments"><span class="marker">&amp;key</span> &nbsp;<span class="argument">documentation</span> &nbsp;<span class="argument">base-uuid</span> &nbsp;<span class="argument">uuid</span> &nbsp;<span class="argument">type</span> &nbsp;<span class="argument">2v-encoder</span> &nbsp;<span class="argument">2v-decoder</span> &nbsp;<span class="argument">2v-writer</span> &nbsp;<span class="argument">2v-reader</span> &nbsp;<span class="argument">x-&gt;usb32</span> &nbsp;<span class="argument">usb32-&gt;x</span> &nbsp;<span class="argument">y-&gt;usb32</span> &nbsp;<span class="argument">usb32-&gt;y</span> &nbsp;<span class="argument">usb32-&gt;strip</span> &nbsp;<span class="argument">xsd-type</span> &nbsp;<span class="argument">x-min</span> &nbsp;<span class="argument">x-max</span> &nbsp;<span class="argument">y-min</span> &nbsp;<span class="argument">y-max</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Define a geospatial subtype.  It returns two values: an opaque object representing the subtype and an integer (between 0 and 255 inclusive) which is the subtype index within this running AllegroGraph image. </p><p>The arguments for this function are complicated.  It is usually called from higher-level geospatial subtype definers such as <a href="#register-cartesian-striping" title="description of register-cartesian-striping">register-cartesian-striping</a> and the several spherical subtype definers, and would only be called in applications that need to define custom geospatial subtypes not covered by those existing functions. If your application requires such definitions, please contact <a href="mailto:allegrograph-support@franz.com">Franz support</a>. </p>
</div>
</div>
  <p>AllegroGraph takes care of the mapping between the subtype index in the local AllegroGraph and the subtype index in an open triple store. In general these will not be the same. </p>
<a name="function.geospatial-subtypes-in-db" id="function.geospatial-subtypes-in-db"></a>
<a name="geospatial-subtypes-in-db" id="geospatial-subtypes-in-db"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">geospatial-subtypes-in-db</span>
<span class="documentation-arguments"><span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a list of the geospatial subtypes that have ever been added to the <code>db</code>. See <a href="#add-geospatial-subtype-to-db" title="description of add-geospatial-subtype-to-db">add-geospatial-subtype-to-db</a>.  Some geospatial queries require the subtype as an argument, and since opening a database with geospatial data reconstructs any unregistered subtypes automatically, it may be more convenient when opening an existing store to obtain a subtype object this way rather than by reregistering it manually. </p><p>All subtypes present in the db are returned, both 2D and nD. </p>
</div>
</div>
  <p><div class="documentation docs-group"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">Geospatial UPI accessors</span>
<span>geospatial-x</span> 
<span>geospatial-y</span> 
<span>geospatial-y-strip</span> 
<span>geospatial-subtype</span> 
</div>
<span class="documentation-kind">group</span>
</div>
<div class="documentation contents">These functions extract the raw component of a 2D geospatial UPI.  The     return types of geospatial-x and geospatial-y are (unsigned-byte 32),     the type of geospatial-y-strip is (unsigned-byte 16 ), and the type of     geospatial-subtype is (unsigned-byte 8).  Each is setfable.  They are     needed only in the rare case that an application programmer needs     define a subtype other than the built in Cartesian and spherical. 
</div>
</div>
  </p><h4>Converting between 2D Geospatial Data and UPIs</h4>
<a name="function.geo-parts-:3Eupi" id="function.geo-parts-:3Eupi"></a>
<a name="geo-parts-:3Eupi" id="geo-parts-:3Eupi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">geo-parts-&gt;upi</span>
<span class="documentation-arguments"><span class="argument">subtype-index</span> &nbsp;<span class="argument">strip-usb16</span> &nbsp;<span class="argument">x-usb32</span> &nbsp;<span class="argument">y-usb32</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Encodes a UPI using the specified <code>subtype-index</code>, <code>strip</code> and <code>x</code> and <code>y</code> coordinates. If the optional <code>upi</code> is supplied, it will be used. Otherwise a new UPI will be created. 
</div>
</div>
  
<a name="function.geospatial-:3Eupi" id="function.geospatial-:3Eupi"></a>
<a name="geospatial-:3Eupi" id="geospatial-:3Eupi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">geospatial-&gt;upi</span>
<span class="documentation-arguments"><span class="argument">subtype</span> &nbsp;<span class="argument">x</span> &nbsp;<span class="argument">y</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">This encodes a UPI with the given geospatial <code>subtype</code> and <code>x</code> and <code>y</code> coordinates. If the optional <code>upi</code> is supplied, it will be used. Otherwise a new UPI will be created. 
</div>
</div>
  
<a name="function.upi-:3Egeospatial" id="function.upi-:3Egeospatial"></a>
<a name="upi-:3Egeospatial" id="upi-:3Egeospatial"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi-&gt;geospatial</span>
<span class="documentation-arguments"><span class="argument">geo-upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the <code>x</code> and <code>y</code> coordinates of a geospatial UPI as multiple values. 
</div>
</div>
  
<a name="function.longitude-latitude-:3Eupi" id="function.longitude-latitude-:3Eupi"></a>
<a name="longitude-latitude-:3Eupi" id="longitude-latitude-:3Eupi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">longitude-latitude-&gt;upi</span>
<span class="documentation-arguments"><span class="argument">subtype</span> &nbsp;<span class="argument">longitude</span> &nbsp;<span class="argument">latitude</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Analogous to <a href="#value-:3Eupi" title="description of value->upi">value-&gt;upi</a>, takes a geospatial subtype and a longitude/latitude coordinate and encodes them as a UPI. If the optional <code>upi</code> is supplied, it will be used. Otherwise a new UPI will be created. 
</div>
</div>
  
<a name="function.upi-:3Elongitude-latitude" id="function.upi-:3Elongitude-latitude"></a>
<a name="upi-:3Elongitude-latitude" id="upi-:3Elongitude-latitude"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">upi-&gt;longitude-latitude</span>
<span class="documentation-arguments"><span class="argument">upi</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Decodes a longitude-latitude geospatial UPI and returns two values, the longitude and latitude, as floating point numbers. 
</div>
</div>
  <p><div class="documentation docs-group"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">Scaling functions</span>
<span>scale-latitude</span> 
<span>unscale-latitude</span> 
<span>scale-longitude</span> 
<span>unscale-longitude</span> 
</div>
<span class="documentation-kind">group</span>
</div>
<div class="documentation contents">These functions convert back and forth between floating-point latitude     and longitude values and the internal unsigned-byte 32 representation     in a UPI.  They are not normally needed by application code. 
</div>
</div>
  </p><h4>Using Automatic Predicate and Type Mapping with 2D Geospatial Data</h4><p>These functions create datatype or predicate mappings for geospatial subtypes. All of them share a similar signature: the <code>subtype</code> argument is a geospatial-subtype object whereas the <code>predicate-part</code> or <code>datatype</code> argument functions analogously to its use in <a href="#datatype-mapping" title="description of datatype-mapping">datatype-mapping</a> or <a href="#predicate-mapping" title="description of predicate-mapping">predicate-mapping</a>. </p>
<a name="function.set-spherical-predicate-mapping" id="function.set-spherical-predicate-mapping"></a>
<a name="set-spherical-predicate-mapping" id="set-spherical-predicate-mapping"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">set-spherical-predicate-mapping</span>
<span class="documentation-arguments"><span class="argument">predicate-part</span> &nbsp;<span class="argument">subtype</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Similar to <code>(setf predicate-mapping)</code> but is used for spherical geospatial subtypes. Automatic mapping needs to know the intended subtype for geospatial data predicates. If it is not already present, the <code>subtype</code> is added to the triple-store automatically. 
</div>
</div>
  
<a name="function.set-cartesian-predicate-mapping" id="function.set-cartesian-predicate-mapping"></a>
<a name="set-cartesian-predicate-mapping" id="set-cartesian-predicate-mapping"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">set-cartesian-predicate-mapping</span>
<span class="documentation-arguments"><span class="argument">predicate-part</span> &nbsp;<span class="argument">subtype</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Similar to <code>(setf predicate-mapping)</code> but is used for Cartesian geospatial subtypes. Automatic mapping needs to know the intended subtype for geospatial data predicates. If it is not already present, the <code>subtype</code> is added to the triple-store automatically. 
</div>
</div>
  
<a name="function.set-spherical-datatype-mapping" id="function.set-spherical-datatype-mapping"></a>
<a name="set-spherical-datatype-mapping" id="set-spherical-datatype-mapping"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">set-spherical-datatype-mapping</span>
<span class="documentation-arguments"><span class="argument">datatype</span> &nbsp;<span class="argument">subtype</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Similar to <code>(setf datatype-mapping)</code> but is used for spherical geospatial subtypes. Automatic mapping needs to know the intended subtype for geospatial datatypes.  If it is not already present, the <code>subtype</code> is added to the triple-store automatically. 
</div>
</div>
  
<a name="function.set-cartesian-datatype-mapping" id="function.set-cartesian-datatype-mapping"></a>
<a name="set-cartesian-datatype-mapping" id="set-cartesian-datatype-mapping"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">set-cartesian-datatype-mapping</span>
<span class="documentation-arguments"><span class="argument">datatype</span> &nbsp;<span class="argument">subtype</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Similar to <code>(setf datatype-mapping)</code> but is used for Cartesian geospatial subtypes. Automatic mapping needs to know the intended subtype for geospatial datatypes.  If it is not already present, the <code>subtype</code> is added to the triple-store automatically. 
</div>
</div>
  <h4>Retrieving 2D Geospatial Triples</h4>
<a name="function.get-triples-geospatial-bounding-box" id="function.get-triples-geospatial-bounding-box"></a>
<a name="get-triples-geospatial-bounding-box" id="get-triples-geospatial-bounding-box"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-geospatial-bounding-box</span>
<span class="documentation-arguments"><span class="argument">subtype</span> &nbsp;<span class="argument">p</span> &nbsp;<span class="argument">x-min</span> &nbsp;<span class="argument">x-max</span> &nbsp;<span class="argument">y-min</span> &nbsp;<span class="argument">y-max</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">use-g</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a cursor that iterates through all the triples with predicate <code>p</code> and an <code>object</code> UPI that is a geospatial UPI with the given subtype and within the specified Cartesian bounding box. If :use-g is true, the triple's <code>graph</code> slot is searched instead of the <code>object</code>.  The units are implicit in the data. </p><p>Note that it is an error to specify both <code>g</code> and <code>use-g</code> as is specifying <code>o</code> when <code>use-g</code> is nil. </p>
</div>
</div>
  
<a name="function.get-triples-geospatial-radius" id="function.get-triples-geospatial-radius"></a>
<a name="get-triples-geospatial-radius" id="get-triples-geospatial-radius"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-geospatial-radius</span>
<span class="documentation-arguments"><span class="argument">subtype</span> &nbsp;<span class="argument">pred</span> &nbsp;<span class="argument">x</span> &nbsp;<span class="argument">y</span> &nbsp;<span class="argument">radius</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">use-g</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a cursor that will iterate over the specified triples. </p><p><code>subtype</code> is a geospatial-subtype object such as is returned by <a href="#register-cartesian-striping" title="description of register-cartesian-striping">register-cartesian-striping</a>. </p><p><code>pred</code> is a UPI or future part specifying the predicate of triples to be matched.  It must be supplied. </p><p><code>x</code> and <code>y</code> are the coordinates around which to search, and <code>radius</code> is the search radius.  The units of <code>radius</code> are implicit in the subtype.  All matching triples with an object of the specified geospatial subtype and within the search radius will be returned by the cursor. </p><p>If the <code>use-g</code> argument is specified and is true, the graph part of triples is searched instead of the object.  The other arguments are as for <a href="#get-triples" title="description of get-triples">get-triples</a>. </p><p>Note that it is an error to specify both <code>g</code> and <code>use-g</code> as is specifying <code>o</code> when <code>use-g</code> is nil. </p>
</div>
</div>
  <p>The Haversine formula is used to compute the "Great Circle" distance on a sphere. See <a href="http://en.wikipedia.org/wiki/Haversine_formula">http://en.wikipedia.org/wiki/Haversine_formula</a> for background. Each of these functions returns a cursor that will return all the triples with predicate <code>pred</code> and an object UPI that is a geospatial UPI with the given subtype and within the specified spherical radius. If <code>:use-g</code> is true, the graph is searched instead of the object. This is the spherical analog to the bounding box functions above. </p>
<a name="function.get-triples-haversine-miles" id="function.get-triples-haversine-miles"></a>
<a name="get-triples-haversine-miles" id="get-triples-haversine-miles"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-haversine-miles</span>
<span class="documentation-arguments"><span class="argument">subtype</span> &nbsp;<span class="argument">pred</span> &nbsp;<span class="argument">lon</span> &nbsp;<span class="argument">lat</span> &nbsp;<span class="argument">radius-in-miles</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">use-g</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Returns a cursor that will return the specified triples. </p><p><code>subtype</code> is a geospatial-subtype designator. It can be an object such as is returned by <a href="#register-latitude-striping-in-miles" title="description of register-latitude-striping-in-miles">register-latitude-striping-in-miles</a> or a string, future-part or UPI describing such a subtype </p><p><code>pred</code> is a UPI or future part specifying the predicate of triples to be matched.  It must be supplied. </p><p><code>lon</code> and <code>lat</code> are the coordinates around which to search, and <code>radius-in-miles</code> is the search radius.  All matching triples with an object of the specified geospatial subtype and within the search radius will be returned by the cursor. </p><p>If the <code>use-g</code> argument is specified and is true, the graph part of triples is searched instead of the object.  The other arguments are as for <a href="#get-triples" title="description of get-triples">get-triples</a>. </p><p>Note that it is an error to specify both <code>g</code> and <code>use-g</code> as is specifying <code>o</code> when <code>use-g</code> is nil. </p>
</div>
</div>
  
<a name="function.get-triples-haversine-km" id="function.get-triples-haversine-km"></a>
<a name="get-triples-haversine-km" id="get-triples-haversine-km"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-haversine-km</span>
<span class="documentation-arguments"><span class="argument">subtype</span> &nbsp;<span class="argument">pred</span> &nbsp;<span class="argument">lon</span> &nbsp;<span class="argument">lat</span> &nbsp;<span class="argument">radius-in-km</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">use-g</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Like <a href="#get-triples-haversine-miles" title="description of get-triples-haversine-miles">get-triples-haversine-miles</a> but the <code>radius-in-km</code> is given in kilometers. </p><p>Note that it is an error to specify both <code>g</code> and <code>use-g</code> as is specifying <code>o</code> when <code>use-g</code> is nil. </p>
</div>
</div>
  
<a name="function.get-triples-haversine-radians" id="function.get-triples-haversine-radians"></a>
<a name="get-triples-haversine-radians" id="get-triples-haversine-radians"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-haversine-radians</span>
<span class="documentation-arguments"><span class="argument">subtype</span> &nbsp;<span class="argument">pred</span> &nbsp;<span class="argument">lon</span> &nbsp;<span class="argument">lat</span> &nbsp;<span class="argument">radius-in-radians</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">use-g</span> &nbsp;<span class="argument">s</span> &nbsp;<span class="argument">o</span> &nbsp;<span class="argument">g</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Like <a href="#get-triples-haversine-miles" title="description of get-triples-haversine-miles">get-triples-haversine-miles</a> but the <code>radius-in-radians</code> is given in radians. </p><p>This is incompletely implemented and nonfunctional in release 3.0. </p><p>Note that it is an error to specify both <code>g</code> and <code>use-g</code> as is specifying <code>o</code> when <code>use-g</code> is nil. </p>
</div>
</div>
  <h4>2D Geospatial and Prolog</h4><p>There are Prolog analogs to the functions above. The triple argument is unified to successive triples that have predicate <code>pred</code> and an <code>object</code> within the bounding box or radius. </p>
<a name="functor.triple-inside-bounding-box" id="functor.triple-inside-bounding-box"></a>
<a name="triple-inside-bounding-box" id="triple-inside-bounding-box"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-bounding-box</span>
<div class="documentation-arguments">(triple-inside-bounding-box -triple +subtype +pred +x-min +x-max +y-min +y-max)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Unify <code>-triple</code> against each triple with predicate <code>+pred</code> with an object of geospatial subtype <code>+subtype</code> within the bounding box <code>x-min</code> <code>x-max</code> <code>y-min</code> <code>y-max</code>. The <code>+subtype</code> is the object returned by <a href="#register-cartesian-striping" title="description of register-cartesian-striping">register-cartesian-striping</a> and similar functions. 
</div>
</div>
  
<a name="functor.triple-inside-radius" id="functor.triple-inside-radius"></a>
<a name="triple-inside-radius" id="triple-inside-radius"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-radius</span>
<div class="documentation-arguments">(triple-inside-radius -triple +subtype +pred &plusmn;x &plusmn;y &plusmn;radius)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Unify <code>-triple</code> against each triple with predicate <code>+pred</code> with an object of geospatial subtype <code>+subtype</code> within <code>radius</code> distance of coordinate <code>x</code> <code>y</code>. The <code>+subtype</code> is the object returned by <a href="#register-cartesian-striping" title="description of register-cartesian-striping">register-cartesian-striping</a> and similar functions. 
</div>
</div>
  
<a name="functor.triple-inside-bounding-box-g" id="functor.triple-inside-bounding-box-g"></a>
<a name="triple-inside-bounding-box-g" id="triple-inside-bounding-box-g"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-bounding-box-g</span>
<div class="documentation-arguments">(triple-inside-bounding-box-g -triple +subtype +pred +x-min +x-max +y-min +y-max)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Like <a href="#triple-inside-bounding-box" title="description of triple-inside-bounding-box">triple-inside-bounding-box</a> except it searches against the graph part or each triple instead of the object part. 
</div>
</div>
  
<a name="functor.triple-inside-radius-g" id="functor.triple-inside-radius-g"></a>
<a name="triple-inside-radius-g" id="triple-inside-radius-g"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-radius-g</span>
<div class="documentation-arguments">(triple-inside-radius-g -triple +subtype +pred &plusmn;x &plusmn;y &plusmn;radius)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Like <a href="#triple-inside-radius" title="description of triple-inside-radius">triple-inside-radius</a> except it searches against the graph part or each triple instead of the object part. 
</div>
</div>
  
<a name="functor.triple-inside-haversine-miles" id="functor.triple-inside-haversine-miles"></a>
<a name="triple-inside-haversine-miles" id="triple-inside-haversine-miles"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-haversine-miles</span>
<div class="documentation-arguments">(triple-inside-haversine-miles -triple +subtype +pred +lon +lat +radius)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Unify <code>-triple</code> against each triple with predicate <code>+pred</code> with an object of geospatial subtype <code>+subtype</code> within <code>+radius</code> miles of <code>+longitude</code> and  <code>+latitude</code>. These last three arguments are typically floating-point numbers. The <code>+subtype</code> is the object returned by <a href="#register-latitude-striping-in-miles" title="description of register-latitude-striping-in-miles">register-latitude-striping-in-miles</a> and similar functions. 
</div>
</div>
  
<a name="functor.triple-inside-haversine-km" id="functor.triple-inside-haversine-km"></a>
<a name="triple-inside-haversine-km" id="triple-inside-haversine-km"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-haversine-km</span>
<div class="documentation-arguments">(triple-inside-haversine-km -triple +subtype +pred +lon +lat +radius)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Like <a href="#functor.triple-inside-haversine-miles" title="description of functor triple-inside-haversine-miles">triple-inside-haversine-miles</a> except <code>+radius</code> is in kilometers. 
</div>
</div>
  
<a name="functor.triple-inside-haversine-radians" id="functor.triple-inside-haversine-radians"></a>
<a name="triple-inside-haversine-radians" id="triple-inside-haversine-radians"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-haversine-radians</span>
<div class="documentation-arguments">(triple-inside-haversine-radians -triple +subtype +pred +lon +lat +radius)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Like <a href="#functor.triple-inside-haversine-miles" title="description of functor triple-inside-haversine-miles">triple-inside-haversine-miles</a> except it searches against the graph part or each triple instead of the object part. 
</div>
</div>
  
<a name="functor.triple-inside-haversine-miles-g" id="functor.triple-inside-haversine-miles-g"></a>
<a name="triple-inside-haversine-miles-g" id="triple-inside-haversine-miles-g"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-haversine-miles-g</span>
<div class="documentation-arguments">(triple-inside-haversine-miles-g -triple +subtype +pred +lon +lat +radius)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Like <a href="#functor.triple-inside-haversine-miles" title="description of functor triple-inside-haversine-miles">triple-inside-haversine-miles</a> except it searches against the graph part or each triple instead of the object part. 
</div>
</div>
  
<a name="functor.triple-inside-haversine-km-g" id="functor.triple-inside-haversine-km-g"></a>
<a name="triple-inside-haversine-km-g" id="triple-inside-haversine-km-g"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-haversine-km-g</span>
<div class="documentation-arguments">(triple-inside-haversine-km-g -triple +subtype +pred +lon +lat +radius)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Like <a href="#functor.triple-inside-haversine-km" title="description of functor triple-inside-haversine-km">triple-inside-haversine-km</a> except it searches against the graph part or each triple instead of the object part. 
</div>
</div>
  
<a name="functor.triple-inside-haversine-radians-g" id="functor.triple-inside-haversine-radians-g"></a>
<a name="triple-inside-haversine-radians-g" id="triple-inside-haversine-radians-g"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-haversine-radians-g</span>
<div class="documentation-arguments">(triple-inside-haversine-radians-g -triple +subtype +pred +lon +lat +radius)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Like <a href="#functor.triple-inside-haversine-radians" title="description of functor triple-inside-haversine-radians">triple-inside-haversine-radians</a> except it searches against the graph part or each triple instead of the object part. 
</div>
</div>
  <h4>Haversine Conversions for 2D Geospatial</h4><p>These compute the haversine distance between two spherical coordinates. The first returns a value in radians while the other two return an actual distance on the earth's surface in kilometers or miles. </p>
<a name="function.haversine-r" id="function.haversine-r"></a>
<a name="haversine-r" id="haversine-r"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">haversine-r</span>
<span class="documentation-arguments"><span class="argument">lon1r</span> &nbsp;<span class="argument">lat1r</span> &nbsp;<span class="argument">lon2r</span> &nbsp;<span class="argument">lat2r</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Compute the great circle distance between the points on a unit radius sphere specified by <code>lon1r</code>, <code>lat1r</code>, <code>lon2r</code>, and <code>lat2r</code>, all in radians. 
</div>
</div>
  
<a name="function.haversine-miles" id="function.haversine-miles"></a>
<a name="haversine-miles" id="haversine-miles"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">haversine-miles</span>
<span class="documentation-arguments"><span class="argument">lon1</span> &nbsp;<span class="argument">lat1</span> &nbsp;<span class="argument">lon2</span> &nbsp;<span class="argument">lat2</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Compute the great circle distance in miles between the points on a the Earth's surface specified by <code>lon1</code>, <code>lat1</code>, <code>lon2</code>, and <code>lat2</code>, all in degrees. 
</div>
</div>
  
<a name="function.haversine-km" id="function.haversine-km"></a>
<a name="haversine-km" id="haversine-km"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">haversine-km</span>
<span class="documentation-arguments"><span class="argument">lon1</span> &nbsp;<span class="argument">lat1</span> &nbsp;<span class="argument">lon2</span> &nbsp;<span class="argument">lat2</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Compute the great circle distance in kilometers between the points on a the Earth's surface specified by <code>lon1</code>, <code>lat1</code>, <code>lon2</code>, and <code>lat2</code>, all in degrees. 
</div>
</div>
  <h4>Polygon Support for 2D Geospatial</h4><p>There is a facility for dealing with polygon regions which can be used to determine if a pair of geospatial ordinates lies within a region defined by a polygon. It is available in Lisp, Java, and Python. </p><p>All computations on a polygon are performed on a Lisp data representation, a proper list of conses of X and Y ordinates which are the vertexes of the polygon.  Successive vertexes define the edges with an implied edge between the last and first element.  There is no requirement that a polygon be convex, or even non-self-intersecting. Polygons work with any geospatial subtype, including both Cartesian and spherical ordinates, although the predicates for the interior of a polygon compute in the Cartesian plane and do not account for spherical ordinates.  This is a reasonable optimization for small regions of the sphere, except near the poles. </p><p>When a polygon (e.g. the boundaries of a city) must be stored in a triple store, by convention it can be done with an ordered set of triples, one for each vertex.  The Subject is any convenient identifier for the polygon, the Object is a geospatial UPI for the vertex, and the Graph is available for any other purpose.  The Predicate is a nonnegative integer UPI of type +rdf-subscript+ which orders the vertexes.  These can be extracted from the triple store by the polygon-vertexes function. </p>
<a name="function.polygon-vertexes" id="function.polygon-vertexes"></a>
<a name="polygon-vertexes" id="polygon-vertexes"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">polygon-vertexes</span>
<span class="documentation-arguments"><span class="argument">polygon</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns an ordered list of conses that are the (longitude . latitude) ordinates for each vertex of the polygon identified by <code>polygon-upi</code>. 
</div>
</div>
  <p>The polygon-subject-upi is the subject identifying the desired polygon.  This function returns a fresh list of the vertexes of the polygon.  A polygon could have been stored in a triple store with code like the following: </p>
<pre><code>(defparameter *cartesian-10*  
     (register-cartesian-striping -1000 1000 -1000 1000 10))  
 
(add-geospatial-subtype-to-db *cartesian-10*)  
 
(defparameter *my-pentagon*  
    '((234.56 . 347.31)  
      (243.07 . 348.40)  
      (247.85 . 357.02)  
      (230.68 . 349.52)  
      (231.37 . 348.62)))  
 
(defparameter *penta*  
    (with-temp-upi (u)  
      (with-temp-upi (s)  
        (loop with id = (new-blank-node)  
            for vertex-number from 1  
            for (x . y) in *my-pentagon*  
            do (add-triple id  
                           (value-&gt;upi vertex-number :subscript)  
                           (geospatial-&gt;upi *cartesian-10* x y u))  
            finally (return id))))) </code></pre><p><em>penta</em> will be set to the new blank node that names this polygon. Its vertexes can now be retrieved given its UPI as subject. </p>
<pre><code>(polygon-vertexes *penta*) =&gt;  
((234.56006 . 347.31006) (243.07007 . 348.40002)  
 (247.84998 . 357.02002) (230.67993 . 349.52002)  
 (231.37 . 348.62)) </code></pre>
<a name="function.point-inside-polygon-p" id="function.point-inside-polygon-p"></a>
<a name="point-inside-polygon-p" id="point-inside-polygon-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">point-inside-polygon-p</span>
<span class="documentation-arguments"><span class="argument">polygon</span> &nbsp;<span class="argument">x</span> &nbsp;<span class="argument">y</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><code>polygon</code> is a list of vertexes such as is returned by <a href="#polygon-vertexes" title="description of polygon-vertexes">polygon-vertexes</a>. Returns true if the point [x,y] is inside the polygon.  Boundary cases for vertexes of points on the edges are indeterminate. 
</div>
</div>
  <p>This predicate returns true if the given point is inside the polygon. The polygon is a list of coordinates, as above.  Points on an edge or vertex will return an indeterminate result since they are subject to float rounding. </p>
<pre><code>(point-inside-polygon-p (polygon-vertexes *penta*) 235.5 350.0) =&gt; t  
(point-inside-polygon-p *my-pentagon* 235.5 350.0)              =&gt; t  
(point-inside-polygon-p *my-pentagon* 235.5 356.0)              =&gt; nil </code></pre><p>See the polygon section in the <a href="geospatial-tutorial.html">2D Geospatial tutorial</a> for more examples how polygons can be used. </p>
<a name="function.polygon-inside-polygon-p" id="function.polygon-inside-polygon-p"></a>
<a name="polygon-inside-polygon-p" id="polygon-inside-polygon-p"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">polygon-inside-polygon-p</span>
<span class="documentation-arguments"><span class="argument">inner</span> &nbsp;<span class="argument">outer</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">outer-convex-p</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">For two lists representing polygons such as is returned by <a href="#polygon-vertexes" title="description of polygon-vertexes">polygon-vertexes</a>, returns true if and only if the <code>inner</code> polygon is contained entirely within the <code>outer</code> polygon.  Boundary cases for points on vertexes or edges are indeterminate. The <code>outer-convex-p</code> boolean may be passed, and if true allows a more-efficient algorithm to be used. 
</div>
</div>
  <p>This function tests whether the inner polygon is entirely contained by the outer polygon.  Again, results are indeterminate if any vertexes of the inner polygon fall on edges or vertexes of the outer polygon, or if any edges of the two polygons are collinear.  The outer-convex-p boolean may be passed, and if true allows a more-efficient algorithm to be used. </p>
<a name="function.get-triples-inside-polygon" id="function.get-triples-inside-polygon"></a>
<a name="get-triples-inside-polygon" id="get-triples-inside-polygon"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">get-triples-inside-polygon</span>
<span class="documentation-arguments"><span class="argument">subtype</span> &nbsp;<span class="argument">predicate</span> &nbsp;<span class="argument">polygon</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">use-g</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">polygon must be a list representing a polygon such as is returned by <a href="#polygon-vertexes" title="description of polygon-vertexes">polygon-vertexes</a>. Returns a cursor that will return all triples with predicate <code>predicate</code> and an object that is a geospatial UPI of subtype <code>subtype</code> within the polygon. If <code>use-g</code> is supplied and true, the graph is used instead. Boundary cases for vertexes of points on the edges are indeterminate. The other arguments are as for <a href="#get-triples-geospatial-bounding-box" title="description of get-triples-geospatial-bounding-box">get-triples-geospatial-bounding-box</a> 
</div>
</div>
  <p>This function returns a cursor that return all triples with the specified predicate that have an Object that is a geospatial UPI of the specified subtype and which is within the given polygon.  If :use-g is true, the graph is searched instead of the object. </p><h4>Polygon Support and Prolog for 2D Geospatial)</h4><p>These are the Prolog analogs to <code>get-triples-inside-polygon</code>.  They successively unify the <code>-triple</code> argument to each triple inside the given polygon. </p>
<a name="functor.triple-inside-polygon" id="functor.triple-inside-polygon"></a>
<a name="triple-inside-polygon" id="triple-inside-polygon"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-polygon</span>
<div class="documentation-arguments">(triple-inside-polygon -triple +subtype +predicate +polygon)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">This is the Prolog analog of <a href="#get-triples-inside-polygon" title="description of get-triples-inside-polygon">get-triples-inside-polygon</a> Unify <code>-triple</code> to each triple with predicate <code>+predicate</code> and an object part of geospatial subtype <code>+subtype</code> within the polygon denoted by the list <code>polygon</code>. Boundary cases on the vertexes and edges are not specified. 
</div>
</div>
  
<a name="functor.triple-inside-polygon-g" id="functor.triple-inside-polygon-g"></a>
<a name="triple-inside-polygon-g" id="triple-inside-polygon-g"></a>
<div class="documentation functor"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-inside-polygon-g</span>
<div class="documentation-arguments">(triple-inside-polygon-g -triple +subtype +predicate +polygon)
</div>
</div>
<span class="documentation-kind">functor</span>
</div>
<div class="documentation contents">Like <a href="#triple-inside-polygon" title="description of triple-inside-polygon">triple-inside-polygon</a> except it searches against the graph part or each triple instead of the object part. 
</div>
</div>
    <a name='header2-110' id='header2-110'></a><h2>REPL Interface</h2> <p>In addition to the <a href="#ref-bang-reader" title=""><code>!</code>-reader</a> macro, AllegroGraph provides a handful of functions to make it easier to interact with the triple-store from the REPL. </p><div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">enable-print-decoded</span>
<span class="documentation-arguments"><span class="argument">boolean</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">pprint-dispatch</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Triples and parts are represented by (simple-array (unsigned-byte 8) 56) and (simple-array (unsigned-byte 8) 12) respectively.  By default the Lisp printer prints these as vectors of bytes which is not very informative when using AllegroGraph interactively.  This function modifies a pprint-dispatch table to print triples and parts interpretively if this can be done in the current environment. Specifically, the value of *db* must be an open triple store, and the vector being printed must print without error in the manner of print-triple or upi-&gt;value.  If any of these conditions don't hold the vector is printed normally. </p><p>If the boolean argument is true, the informative printing is enabled, otherwise disabled.  For example: </p>
<pre><code>&gt; (enable-print-decoded t)  
t  
&gt; (upi !"Drst"^^xsd:string)  
{Drst}  
&gt; (enable-print-decoded nil)  
nil  
&gt; (upi !"Drst"^^xsd:string)  
#(48 61 125 164 117 231 137 163 64 100 17 2) </code></pre><p>The :pprint-dispatch argument specifies the dispatch  table to modify, by default the value of <em>print-pprint-dispatch</em>. Once enable-print-decoded has been turned on, you can also use the special-variable <code>*print-decoded*</code> to enable fine-grained control  of triple and UPI printing. See the AllegroGraph tutorial for more information on the <a href="lisp-quickstart.html#ref-agraph-notation" title="">various notations</a> AllegoGraph uses. </p>
</div>
</div>
  
<a name="variable.:2Aprint-decoded:2A" id="variable.:2Aprint-decoded:2A"></a>
<a name="x:2Aprint-decoded:2A" id="x:2Aprint-decoded:2A"></a>
<div class="documentation variable"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">*print-decoded*</span>
</div>
<span class="documentation-kind">variable</span>
</div>
<div class="documentation contents">When true and <a href="#enable-print-decoded" title="description of enable-print-decoded">enable-print-decoded</a> has been called with true, then triples and UPIs are printed with interpretation. 
</div>
</div>
  <div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">print-triple</span>
<span class="documentation-arguments"><span class="argument">triple</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="argument">stream</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">error?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Print a triple returned by <a href="#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> or <a href="#get-triples-list" title="description of get-triples-list">get-triples-list</a>. </p><p>Returns the triple printed unless stream is nil in which case it returns the string representation. </p><p>If <code>stream</code> is not <code>nil</code>, then a newline will also be printed. </p><p>The keyword argument <code>:format</code>, which defaults to <code>:ntriples</code>, specifies the syntax to be used when printing the triple. It can be one of: </p>
<ul>
<li><code>:ntriple</code> or <code>:ntriples</code> - use N-Triples syntax,</li>
<li><code>:nquad</code> or <code>:nquads</code> - use N-Quads syntax (i.e., include the graph),</li>
<li><code>:ntriple-ascii</code> or <code>ntriples-ascii</code> - N-Triples with non-ASCII   and control characters escaped. </li>
<li><code>:nquad-ascii</code> or <code>nquads-ascii</code> - N-Quads with non-ASCII and control   characters escaped. </li>
<li><code>:long</code> - Synonym for <code>:nquads</code>.</li>
<li><code>:concise</code> or <code>:terse</code> - use a short or very short human readable but   possibly ambiguous representation. </li></ul><p>The default for <code>error?</code> is true; if <code>error?</code> is nil, then any UPIs which cannot be printed in humanly readable fashion will instead be printed in hex. </p><p>The <code>stream</code> argument can be used to send output to the stream of your choice. If left unspecified, then output will go to <em>standard-output</em>. It can be <code>nil</code> to indicate a string-stream. </p>
</div>
</div>
  <div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">print-triples</span>
<span class="documentation-arguments"><span class="argument">triple-container</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">limit</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="argument">stream</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Display the triples in <code>triple-container</code> which can be either a triple store object, a list of triples such as is returned by <a href="#get-triples-list" title="description of get-triples-list">get-triples-list</a>, or a cursor such as is returned by <a href="#get-triples" title="description of get-triples">get-triples</a>. If the keyword argument <code>:limit</code> is supplied, then at most that many triples will be printed. The <code>:format</code> keyword argument controls how the triples will be displayed. The values <code>:ntriple</code> or <code>:ntriples</code> specify that they should be printed in N-Triples syntax. The values <code>:nquad</code> or <code>:nquads</code> specify that they should be printed in N-Quad syntax. The value <code>:long</code> is the same a <code>:ntriples</code>. The value <code>:ntriples-ascii</code> is the same as <code>:ntriples</code>, but all non-ascii characters will be escaped in the output. The value <code>:concise</code> means print the triple id, followed by the  triple values using prefixes when available (like <code>&lt;1986585: user:1076107471 rdf:type tp:User&gt;</code>). The value <code>:terse</code> means print triples with values only, without prefixes (like <code>&lt;1076107471 type User&gt;</code>). The default is <code>:ntriples</code>. The <code>stream</code> argument can be used to send output to the stream of your choice. If left unspecified, then output will go to <em>standard-output</em>. 
</div>
</div>
  <div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">pprint-subject</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Print information about <code>part</code> down to a maximum depth of <code>maximum-depth</code> using the format <code>format</code>. Triples for which part is a subject and their <code>children</code> will be printed. See <a href="#part-:3Estring" title="description of part->string">part-&gt;string</a> for information about part printing. See <a href="#pprint-object" title="description of pprint-object">pprint-object</a> to display information based on subjects rather than objects. </p><p>Note that <code>pprint-subject</code> is designed to show the actual triples in a store.  It uses <a href="#ground-triple-store" title="description of ground-triple-store">ground-triple-store</a> to remove one layer of reasoning from <code>db</code>. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
  <div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">pprint-object</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">maximum-depth</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Print information about <code>part</code> down to a maximum depth of <code>maximum-depth</code> using the format <code>format</code>. Triples for which part is an object and their <code>children</code> will be printed. See <a href="#part-:3Estring" title="description of part->string">part-&gt;string</a> for information about part printing. See <a href="#pprint-subject" title="description of pprint-subject">pprint-subject</a> to display information based on objects rather than subjects. </p><p>Note that <code>pprint-object</code> is designed to show the actual triples in a store. It uses <a href="#ground-triple-store" title="description of ground-triple-store">ground-triple-store</a> to remove one layer of reasoning from <code>db</code>. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a>. </p>
</div>
</div>
  <h4>From Parts and UPIs to Values</h4><p>See <a href="#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> and <a href="#upi-:3Evalues" title="description of upi->values">upi-&gt;values</a> for additional information. </p>
<a name="function.part-:3Econcise" id="function.part-:3Econcise"></a>
<a name="part-:3Econcise" id="part-:3Econcise"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">part-&gt;concise</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">stream</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">error?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a string representation of <code>part</code> in a short human-readable form </p><p>syntax. Part can be either a UPI or a future-part. </p>
</div>
</div>
  
<a name="function.part-:3Elong" id="function.part-:3Elong"></a>
<a name="part-:3Elong" id="part-:3Elong"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">part-&gt;long</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">stream</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">error?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a string representation of <code>part</code> in <em>long</em> </p><p>syntax. Part can be either a UPI or a future-part. </p>
</div>
</div>
  
<a name="function.part-:3Entriples" id="function.part-:3Entriples"></a>
<a name="part-:3Entriples" id="part-:3Entriples"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">part-&gt;ntriples</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">stream</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">error?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a string representation of <code>part</code> in N-Triples </p><p>syntax. Part can be either a UPI or a future-part. </p>
</div>
</div>
  
<a name="function.part-:3Estring" id="function.part-:3Estring"></a>
<a name="part-:3Estring" id="part-:3Estring"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">part-&gt;string</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">format</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Return a string representation of <code>part</code> (which can be a UPI or a future-part). The <code>:format</code> keyword argument controls the format and can be one of <code>:ntriples</code>, <code>:long</code>, <code>ntriples-ascii</code>, <code>:concise</code>, or <code>:terse</code>, as with the <code>:format</code> argument to <a href="#print-triple" title="description of print-triple">print-triple</a>. The default is :ntriples. 
</div>
</div>
  
<a name="function.part-:3Eterse" id="function.part-:3Eterse"></a>
<a name="part-:3Eterse" id="part-:3Eterse"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">part-&gt;terse</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">stream</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">error?</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents"><p>Return a string representation of <code>part</code> in a very-short human-readable form </p><p>syntax. Part can be either a UPI or a future-part. </p>
</div>
</div>
  
<a name="function.part-:3Evalue" id="function.part-:3Evalue"></a>
<a name="part-:3Evalue" id="part-:3Evalue"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">part-&gt;value</span>
<span class="documentation-arguments"><span class="argument">part</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Decodes <code>part</code> (which may be a UPI or a future-part) and returns the value, the type-code and any extra information as multiple values.  See <a href="#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> for details. 
</div>
</div>
   <a name='header2-112' id='header2-112'></a><h2>Miscellaneous Utilities</h2><a name='ref-upi-hash-tables' id='ref-upi-hash-tables'></a> <h3>UPI hash-tables</h3>
<a name="function.gethash:2Fupi" id="function.gethash:2Fupi"></a>
<a name="gethash:2Fupi" id="gethash:2Fupi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">gethash/upi</span>
<span class="documentation-arguments"><span class="argument">upi</span> &nbsp;<span class="argument">table</span> &nbsp;<span class="marker">&amp;optional</span> &nbsp;<span class="argument">default</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns (as multiple values) the value associated with <code>upi</code> in the upi-hash-table <code>table</code> and whether or not the value was found. setf may be used with <code>gethash/upi</code> to modify the value associated with a <code>upi</code> or to add a new association to the hash-table. 
</div>
</div>
  
<a name="function.hash-table-count:2Fupi" id="function.hash-table-count:2Fupi"></a>
<a name="hash-table-count:2Fupi" id="hash-table-count:2Fupi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">hash-table-count/upi</span>
<span class="documentation-arguments"><span class="argument">table</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns the number of UPI/value associations in the upi-hash-table <code>table</code>. 
</div>
</div>
  
<a name="function.make-upi-hash-table" id="function.make-upi-hash-table"></a>
<a name="make-upi-hash-table" id="make-upi-hash-table"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">make-upi-hash-table</span>
<span class="documentation-arguments"><span class="marker">&amp;rest</span> &nbsp;<span class="argument">rest</span> &nbsp;<span class="marker">&amp;key</span> &nbsp;<span class="argument">size</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Returns a hash-table optimized for storing UPIs. 
</div>
</div>
  
<a name="function.maphash:2Fupi" id="function.maphash:2Fupi"></a>
<a name="maphash:2Fupi" id="maphash:2Fupi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">maphash/upi</span>
<span class="documentation-arguments"><span class="argument">fn</span> &nbsp;<span class="argument">table</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Apply <code>fn</code> to each UPI/value association in the upi-hash-table <code>table</code>. <code>fn</code> should be a function of two arguments. It will be called with a UPI as the first argument and the value associated with the UPI as the second. 
</div>
</div>
  
<a name="function.remhash:2Fupi" id="function.remhash:2Fupi"></a>
<a name="remhash:2Fupi" id="remhash:2Fupi"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">remhash/upi</span>
<span class="documentation-arguments"><span class="argument">upi</span> &nbsp;<span class="argument">table</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">Remove the association (if any) between <code>upi</code> and its value in the upi-hash-table <code>table</code>. 
</div>
</div>
  <h3>Other</h3>
<a name="macro.with-temp-triple" id="macro.with-temp-triple"></a>
<a name="with-temp-triple" id="with-temp-triple"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">with-temp-triple</span>
<span class="documentation-arguments">(<span class="argument">var</span>) &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Binds var to a fresh stack-allocated triple which can be used within the dynamic extent of the code body.  Corruption may result if the triple is referenced after exiting the body. 
</div>
</div>
  
<a name="macro.with-temp-upi" id="macro.with-temp-upi"></a>
<a name="with-temp-upi" id="with-temp-upi"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">with-temp-upi</span>
<span class="documentation-arguments">(<span class="argument">var</span>) &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Binds var to a fresh stack-allocated upi which can be used within the dynamic extent of the code body.  Corruption may result if the upi is referenced after exiting the body. 
</div>
</div>
  
<a name="macro.with-temp-upis" id="macro.with-temp-upis"></a>
<a name="with-temp-upis" id="with-temp-upis"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">with-temp-upis</span>
<span class="documentation-arguments"><span class="argument">vars</span> &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents">Binds vars to fresh stack-allocated upis which can be used within the dynamic extent of the code body.  Corruption may result if the upis are referenced after exiting the body. 
</div>
</div>
  <p> </p><p> </p>
<a name="function.string:2B" id="function.string:2B"></a>
<a name="string:2B" id="string:2B"></a>
<div class="documentation function"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">string+</span>
<span class="documentation-arguments"><span class="marker">&amp;rest</span> &nbsp;<span class="argument">args</span></span>
</div>
<span class="documentation-kind">function</span>
</div>
<div class="documentation contents">string+ returns a fresh simple string that contains the printed representation of all the individual objects passed as arguments in the order that they are supplied. Actual strings among objects are copied into the result string. Other objects are made into strings as if they were passed to princ-to-string (although the actual mechanism may be different for some types of objects), with <em>print-pretty</em> bound to nil. This function is designed to allow string to be used as identifiers or labels to be created quickly and efficiently. See the <a href="/support/documentation/current/doc/string-utilities.htm" target="_blank">Franz documentation on string+</a> for more details. 
</div>
</div>
  
<a name="type.triple-part" id="type.triple-part"></a>
<a name="triple-part" id="triple-part"></a>
<div class="documentation type"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">triple-part</span>
</div>
<span class="documentation-kind">type</span>
</div>
<div class="documentation contents">A triple-part is either a UPI or a future-part. 
</div>
</div>
   <a name='header2-114' id='header2-114'></a><h2>Logging</h2>
<a name="macro.with-log-routed-to-server" id="macro.with-log-routed-to-server"></a>
<a name="with-log-routed-to-server" id="with-log-routed-to-server"></a>
<div class="documentation macro"><div class="documentation header"><div class="doc name-and-args"><span class="hidden">X</span>
<span class="documentation-name">with-log-routed-to-server</span>
<span class="documentation-arguments">(<span class="marker">&amp;key</span> &nbsp;<span class="argument">db</span> &nbsp;<span class="argument">host</span> &nbsp;<span class="argument">port</span> &nbsp;<span class="argument">scheme</span> &nbsp;<span class="argument">fetch-log-levels?</span>) &nbsp;<span class="marker">&amp;body</span> &nbsp;<span class="argument">body</span></span>
</div>
<span class="documentation-kind">macro</span>
</div>
<div class="documentation contents"><p>Arrange for log messages to be sent to an AllegroGraph server. If <code>db</code> represents a direct connection, then it specifies which server to use. Else the server on localhost listening on <code>port</code> is used. Currently it is not possible to route log messages to a remote server. <code>db</code> defaults to <a href="#variable.:2Adb:2A" title="description of variable *db*">*db*</a> and <code>port</code> to <a href="#variable.:2Adefault-ag-http-port:2A" title="description of variable *default-ag-http-port*">*default-ag-http-port*</a>. </p><p>WARNING: This macro open and closes a connection to the hub each time it is used.  Avoid using it in code that may be called frequently (such as in db-synchronize).  If you have an ag4-triple-store object, use the with-log-routed-to-hub macro instead. </p><p>This macro is only available in direct clients. </p>
</div>
</div>
  <a name='header2-116' id='header2-116'></a><h2>Indices</h2><p>All of the functions and variables in AllegroGraph's public interface are indexed below. </p><a name='header3-118' id='header3-118'></a><h3>Function and Macro index</h3>
<a name="function" id="function"></a>
<div class="index function">
<ul>
<li><a href="#function.actor-betweenness-centrality">actor-betweenness-centrality</a></li>
<li><a href="#function.actor-closeness-centrality">actor-closeness-centrality</a></li>
<li><a href="#function.actor-degree-centrality">actor-degree-centrality</a></li>
<li><a href="#function.add-geospatial-subtype-to-db">add-geospatial-subtype-to-db</a></li>
<li><a href="#function.add-index">add-index</a></li>
<li><a href="#function.add-triple">add-triple</a></li>
<li><a href="#function.all-bidirectional-search-paths">all-bidirectional-search-paths</a></li>
<li><a href="#function.all-breadth-first-search-paths">all-breadth-first-search-paths</a></li>
<li><a href="#function.all-depth-first-search-paths">all-depth-first-search-paths</a></li>
<li><a href="#function.analyze-query-index-usage">analyze-query-index-usage</a></li>
<li><a href="#function.apply-rdfs:2B:2B-reasoner">apply-rdfs++-reasoner</a></li>
<li><a href="#function.automate-nd-datatype-mappings">automate-nd-datatype-mappings</a></li>
<li><a href="#function.automatically-mapped-types">automatically-mapped-types</a></li>
<li><a href="#function.bidirectional-distance">bidirectional-distance</a></li>
<li><a href="#function.bidirectional-search">bidirectional-search</a></li>
<li><a href="#function.blank-node-p">blank-node-p</a></li>
<li><a href="#function.breadth-first-distance">breadth-first-distance</a></li>
<li><a href="#function.breadth-first-search">breadth-first-search</a></li>
<li><a href="#function.build-neighbor-matrix">build-neighbor-matrix</a></li>
<li><a href="#function.cancel-purge-deleted-triples">cancel-purge-deleted-triples</a></li>
<li><a href="#function.catalogs">catalogs</a></li>
<li><a href="#function.clear-namespaces">clear-namespaces</a></li>
<li><a href="#function.clear-type-mappings">clear-type-mappings</a></li>
<li><a href="#function.cliquep">cliquep</a></li>
<li><a href="#function.cliques">cliques</a></li>
<li><a href="#function.close-triple-store">close-triple-store</a></li>
<li><a href="#function.collect-all-type-mappings">collect-all-type-mappings</a></li>
<li><a href="#function.collect-cursor">collect-cursor</a></li>
<li><a href="#function.collect-encoded-id-prefixes">collect-encoded-id-prefixes</a></li>
<li><a href="#function.collect-namespaces">collect-namespaces</a></li>
<li><a href="#function.collect-triples">collect-triples</a></li>
<li><a href="#function.commit-triple-store">commit-triple-store</a></li>
<li><a href="#function.copy-extended-triple">copy-extended-triple</a></li>
<li><a href="#function.copy-triple">copy-triple</a></li>
<li><a href="#function.copy-triples">copy-triples</a></li>
<li><a href="#function.copy-upi">copy-upi</a></li>
<li><a href="#function.count-cursor">count-cursor</a></li>
<li><a href="#function.count-query">count-query</a></li>
<li><a href="#function.create-freetext-index">create-freetext-index</a></li>
<li><a href="#function.create-triple-store">create-triple-store</a></li>
<li><a href="#function.cursor-next">cursor-next</a></li>
<li><a href="#function.cursor-next-row">cursor-next-row</a></li>
<li><a href="#function.cursor-peek">cursor-peek</a></li>
<li><a href="#function.cursor-row">cursor-row</a></li>
<li><a href="#function.datatype-mapping">datatype-mapping</a></li>
<li><a href="#function.db-name">db-name</a></li>
<li><a href="#function.default-graph-upi">default-graph-upi</a></li>
<li><a href="#function.default-query-plan-option">default-query-plan-option</a></li>
<li><a href="#function.define-attribute">define-attribute</a></li>
<li><a href="#function.defined-query-plan-options">defined-query-plan-options</a></li>
<li><a href="#macro.defneighbor-matrix">defneighbor-matrix</a></li>
<li><a href="#macro.defsna-generator">defsna-generator</a></li>
<li><a href="#function.delete-duplicate-triples">delete-duplicate-triples</a></li>
<li><a href="#function.delete-triple">delete-triple</a></li>
<li><a href="#function.delete-triple-store">delete-triple-store</a></li>
<li><a href="#function.delete-triples">delete-triples</a></li>
<li><a href="#function.depth-first-distance">depth-first-distance</a></li>
<li><a href="#function.depth-first-search">depth-first-search</a></li>
<li><a href="#function.discard-cursor">discard-cursor</a></li>
<li><a href="#function.display-namespaces">display-namespaces</a></li>
<li><a href="#function.drop-freetext-index">drop-freetext-index</a></li>
<li><a href="#function.drop-geospatial-subtype">drop-geospatial-subtype</a></li>
<li><a href="#function.drop-index">drop-index</a></li>
<li><a href="#function.dump-namespaces">dump-namespaces</a></li>
<li><a href="#function.duplicate-suppression-strategy">duplicate-suppression-strategy</a></li>
<li><a href="#function.ego-group">ego-group</a></li>
<li><a href="#function.enable-:21-reader">enable-!-reader</a></li>
<li><a href="#function.enable-print-decoded">enable-print-decoded</a></li>
<li><a href="#function.encapsulate-triple-store">encapsulate-triple-store</a></li>
<li><a href="#function.encoded-id-prefix-in-use-p">encoded-id-prefix-in-use-p</a></li>
<li><a href="#function.encoded-id-prefix-registered-p">encoded-id-prefix-registered-p</a></li>
<li><a href="#function.encoded-types">encoded-types</a></li>
<li><a href="#function.ensure-not-lingering">ensure-not-lingering</a></li>
<li><a href="#function.estimated-count-query">estimated-count-query</a></li>
<li><a href="#function.extended-triple-attributes">extended-triple-attributes</a></li>
<li><a href="#function.extended-triple-triple">extended-triple-triple</a></li>
<li><a href="#function.federate-triple-stores">federate-triple-stores</a></li>
<li><a href="#function.find-neighbor-matrix">find-neighbor-matrix</a></li>
<li><a href="#function.find-sna-generator">find-sna-generator</a></li>
<li><a href="#function.freetext-charset">freetext-charset</a></li>
<li><a href="#function.freetext-get-triples">freetext-get-triples</a></li>
<li><a href="#function.freetext-get-unique-subjects">freetext-get-unique-subjects</a></li>
<li><a href="#function.freetext-index-index-fields">freetext-index-index-fields</a></li>
<li><a href="#function.freetext-index-index-literals">freetext-index-index-literals</a></li>
<li><a href="#function.freetext-index-index-resources">freetext-index-index-resources</a></li>
<li><a href="#function.freetext-index-minimum-word-size">freetext-index-minimum-word-size</a></li>
<li><a href="#function.freetext-index-predicates">freetext-index-predicates</a></li>
<li><a href="#function.freetext-index-stop-words">freetext-index-stop-words</a></li>
<li><a href="#function.freetext-index-tokenizer">freetext-index-tokenizer</a></li>
<li><a href="#function.freetext-index-word-filters">freetext-index-word-filters</a></li>
<li><a href="#function.future-part-extra">future-part-extra</a></li>
<li><a href="#function.future-part-type">future-part-type</a></li>
<li><a href="#function.future-part-value">future-part-value</a></li>
<li><a href="#function.future-part:3D">future-part=</a></li>
<li><a href="#function.geo-ordinate-value">geo-ordinate-value</a></li>
<li><a href="#function.geo-parts-:3Eupi">geo-parts-&gt;upi</a></li>
<li><a href="#function.geo-plist-:3Egeo">geo-plist-&gt;geo</a></li>
<li><a href="#function.geo-register-nd-subtype">geo-register-nd-subtype</a></li>
<li><a href="#function.geo-upi-:3Eplist">geo-upi-&gt;plist</a></li>
<li><a href="#function.geospatial-:3Eupi">geospatial-&gt;upi</a></li>
<li><a href="#function.geospatial-subtypes-in-db">geospatial-subtypes-in-db</a></li>
<li><a href="#function.get-duplicate-triples">get-duplicate-triples</a></li>
<li><a href="#function.get-metadata">get-metadata</a></li>
<li><a href="#function.get-triple">get-triple</a></li>
<li><a href="#function.get-triple-by-id">get-triple-by-id</a></li>
<li><a href="#function.get-triples">get-triples</a></li>
<li><a href="#function.get-triples-geospatial-bounding-box">get-triples-geospatial-bounding-box</a></li>
<li><a href="#function.get-triples-geospatial-radius">get-triples-geospatial-radius</a></li>
<li><a href="#function.get-triples-haversine-km">get-triples-haversine-km</a></li>
<li><a href="#function.get-triples-haversine-miles">get-triples-haversine-miles</a></li>
<li><a href="#function.get-triples-haversine-radians">get-triples-haversine-radians</a></li>
<li><a href="#function.get-triples-inside-polygon">get-triples-inside-polygon</a></li>
<li><a href="#function.get-triples-list">get-triples-list</a></li>
<li><a href="#function.get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a></li>
<li><a href="#function.get-triples-nd-within-polygon">get-triples-nd-within-polygon</a></li>
<li><a href="#function.get-triples-nd-within-radius">get-triples-nd-within-radius</a></li>
<li><a href="#function.gethash:2Fupi">gethash/upi</a></li>
<li><a href="#function.graph">graph</a></li>
<li><a href="#function.graph-density">graph-density</a></li>
<li><a href="#function.graph-part:3D">graph-part=</a></li>
<li><a href="#function.graph-upi:3D">graph-upi=</a></li>
<li><a href="#function.ground-triple-store">ground-triple-store</a></li>
<li><a href="#function.group-betweenness-centrality">group-betweenness-centrality</a></li>
<li><a href="#function.group-closeness-centrality">group-closeness-centrality</a></li>
<li><a href="#function.group-degree-centrality">group-degree-centrality</a></li>
<li><a href="#function.hash-table-count:2Fupi">hash-table-count/upi</a></li>
<li><a href="#function.hashed-upi-p">hashed-upi-p</a></li>
<li><a href="#function.haversine-km">haversine-km</a></li>
<li><a href="#function.haversine-miles">haversine-miles</a></li>
<li><a href="#function.haversine-r">haversine-r</a></li>
<li><a href="#function.inferred-triple-p">inferred-triple-p</a></li>
<li><a href="#macro.inner-triple-store">inner-triple-store</a></li>
<li><a href="#function.intern-literal">intern-literal</a></li>
<li><a href="#function.intern-resource">intern-resource</a></li>
<li><a href="#macro.iterate-cursor">iterate-cursor</a></li>
<li><a href="#function.list-freetext-indices">list-freetext-indices</a></li>
<li><a href="#function.literal">literal</a></li>
<li><a href="#function.load-metadata">load-metadata</a></li>
<li><a href="#function.load-nquads">load-nquads</a></li>
<li><a href="#function.load-nquads-from-string">load-nquads-from-string</a></li>
<li><a href="#function.load-nqx">load-nqx</a></li>
<li><a href="#function.load-nqx-from-string">load-nqx-from-string</a></li>
<li><a href="#function.load-ntriples">load-ntriples</a></li>
<li><a href="#function.load-ntriples-from-string">load-ntriples-from-string</a></li>
<li><a href="#function.load-rdf-manifest">load-rdf-manifest</a></li>
<li><a href="#function.load-rdf:2Fxml">load-rdf/xml</a></li>
<li><a href="#function.load-rdf:2Fxml-from-string">load-rdf/xml-from-string</a></li>
<li><a href="#function.load-trig">load-trig</a></li>
<li><a href="#function.load-trig-from-string">load-trig-from-string</a></li>
<li><a href="#function.load-trix">load-trix</a></li>
<li><a href="#function.load-trix-from-string">load-trix-from-string</a></li>
<li><a href="#function.load-turtle">load-turtle</a></li>
<li><a href="#function.load-turtle-from-string">load-turtle-from-string</a></li>
<li><a href="#function.longitude-latitude-:3Eupi">longitude-latitude-&gt;upi</a></li>
<li><a href="#function.lookup-namespace">lookup-namespace</a></li>
<li><a href="#function.make-future-part">make-future-part</a></li>
<li><a href="#function.make-graph-filtered-store">make-graph-filtered-store</a></li>
<li><a href="#function.make-peekable-cursor">make-peekable-cursor</a></li>
<li><a href="#function.make-transform-cursor">make-transform-cursor</a></li>
<li><a href="#function.make-triple">make-triple</a></li>
<li><a href="#function.make-triples-peekable-cursor">make-triples-peekable-cursor</a></li>
<li><a href="#function.make-tutorial-store">make-tutorial-store</a></li>
<li><a href="#function.make-upi">make-upi</a></li>
<li><a href="#function.make-upi-hash-table">make-upi-hash-table</a></li>
<li><a href="#function.map-all-type-mappings">map-all-type-mappings</a></li>
<li><a href="#function.map-bidirectional-search-paths">map-bidirectional-search-paths</a></li>
<li><a href="#function.map-bidirectional-search-paths-bipartite">map-bidirectional-search-paths-bipartite</a></li>
<li><a href="#function.map-breadth-first-search-paths">map-breadth-first-search-paths</a></li>
<li><a href="#function.map-breadth-first-search-paths-bipartite">map-breadth-first-search-paths-bipartite</a></li>
<li><a href="#function.map-cliques">map-cliques</a></li>
<li><a href="#function.map-cursor">map-cursor</a></li>
<li><a href="#function.map-depth-first-search-paths">map-depth-first-search-paths</a></li>
<li><a href="#function.map-depth-first-search-paths-bipartite">map-depth-first-search-paths-bipartite</a></li>
<li><a href="#function.map-encoded-id-prefixes">map-encoded-id-prefixes</a></li>
<li><a href="#function.map-namespaces">map-namespaces</a></li>
<li><a href="#function.maphash:2Fupi">maphash/upi</a></li>
<li><a href="#function.modify-freetext-index">modify-freetext-index</a></li>
<li><a href="#function.new-blank-node">new-blank-node</a></li>
<li><a href="#function.next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a></li>
<li><a href="#function.nodal-degree">nodal-degree</a></li>
<li><a href="#function.nodal-neighbors">nodal-neighbors</a></li>
<li><a href="#function.object">object</a></li>
<li><a href="#function.object-part:3D">object-part=</a></li>
<li><a href="#function.object-upi:3D">object-upi=</a></li>
<li><a href="#function.open-triple-store">open-triple-store</a></li>
<li><a href="#function.optimize-indices">optimize-indices</a></li>
<li><a href="#function.page-rank-centrality">page-rank-centrality</a></li>
<li><a href="#function.parse-nd-datatype">parse-nd-datatype</a></li>
<li><a href="#function.parse-sparql">parse-sparql</a></li>
<li><a href="#function.part-:3Econcise">part-&gt;concise</a></li>
<li><a href="#function.part-:3Elong">part-&gt;long</a></li>
<li><a href="#function.part-:3Entriples">part-&gt;ntriples</a></li>
<li><a href="#function.part-:3Estring">part-&gt;string</a></li>
<li><a href="#function.part-:3Eterse">part-&gt;terse</a></li>
<li><a href="#function.part-:3Evalue">part-&gt;value</a></li>
<li><a href="#function.part-to-namespace">part-to-namespace</a></li>
<li><a href="#function.part:3D">part=</a></li>
<li><a href="#function.point-inside-polygon-p">point-inside-polygon-p</a></li>
<li><a href="#function.polygon-inside-polygon-p">polygon-inside-polygon-p</a></li>
<li><a href="#function.polygon-vertexes">polygon-vertexes</a></li>
<li><a href="#function.pprint-object">pprint-object</a></li>
<li><a href="#function.pprint-subject">pprint-subject</a></li>
<li><a href="#function.predicate">predicate</a></li>
<li><a href="#function.predicate-mapping">predicate-mapping</a></li>
<li><a href="#function.predicate-part:3D">predicate-part=</a></li>
<li><a href="#function.predicate-upi:3D">predicate-upi=</a></li>
<li><a href="#function.prepare-reasoning">prepare-reasoning</a></li>
<li><a href="#function.print-triple">print-triple</a></li>
<li><a href="#function.print-triples">print-triples</a></li>
<li><a href="#function.print-type-mappings">print-type-mappings</a></li>
<li><a href="#function.purge-deleted-triples">purge-deleted-triples</a></li>
<li><a href="#function.purge-rate-limit">purge-rate-limit</a></li>
<li><a href="#function.reasoner">reasoner</a></li>
<li><a href="#function.register-cartesian-striping">register-cartesian-striping</a></li>
<li><a href="#function.register-encoded-id-prefix">register-encoded-id-prefix</a></li>
<li><a href="#function.register-geospatial-subtype">register-geospatial-subtype</a></li>
<li><a href="#function.register-latitude-striping-in-degrees">register-latitude-striping-in-degrees</a></li>
<li><a href="#function.register-latitude-striping-in-km">register-latitude-striping-in-km</a></li>
<li><a href="#function.register-latitude-striping-in-miles">register-latitude-striping-in-miles</a></li>
<li><a href="#function.register-namespace">register-namespace</a></li>
<li><a href="#function.register-neighbor-matrix">register-neighbor-matrix</a></li>
<li><a href="#function.register-sna-generator">register-sna-generator</a></li>
<li><a href="#function.register-standard-namespaces">register-standard-namespaces</a></li>
<li><a href="#function.remhash:2Fupi">remhash/upi</a></li>
<li><a href="#function.remove-namespace">remove-namespace</a></li>
<li><a href="#function.report-loaded-geospatial-subtypes">report-loaded-geospatial-subtypes</a></li>
<li><a href="#function.resource">resource</a></li>
<li><a href="#function.restriction-reasoning-enabled-p">restriction-reasoning-enabled-p</a></li>
<li><a href="#function.rollback-triple-store">rollback-triple-store</a></li>
<li><a href="#function.run-sparql">run-sparql</a></li>
<li><a href="#function.save-metadata">save-metadata</a></li>
<li><a href="#macro.select">select</a></li>
<li><a href="#macro.select-distinct">select-distinct</a></li>
<li><a href="#macro.select-distinct:2Fcallback">select-distinct/callback</a></li>
<li><a href="#macro.select:2Fcallback">select/callback</a></li>
<li><a href="#macro.select0">select0</a></li>
<li><a href="#macro.select0-distinct">select0-distinct</a></li>
<li><a href="#macro.select0-distinct:2Fcallback">select0-distinct/callback</a></li>
<li><a href="#macro.select0:2Fcallback">select0/callback</a></li>
<li><a href="#function.serialize-nquads">serialize-nquads</a></li>
<li><a href="#function.serialize-ntriples">serialize-ntriples</a></li>
<li><a href="#function.serialize-rdf-manifest">serialize-rdf-manifest</a></li>
<li><a href="#function.serialize-rdf:2Fxml">serialize-rdf/xml</a></li>
<li><a href="#function.serialize-trix">serialize-trix</a></li>
<li><a href="#function.serialize-turtle">serialize-turtle</a></li>
<li><a href="#function.set-cartesian-datatype-mapping">set-cartesian-datatype-mapping</a></li>
<li><a href="#function.set-cartesian-predicate-mapping">set-cartesian-predicate-mapping</a></li>
<li><a href="#function.set-metadata">set-metadata</a></li>
<li><a href="#function.set-spherical-datatype-mapping">set-spherical-datatype-mapping</a></li>
<li><a href="#function.set-spherical-predicate-mapping">set-spherical-predicate-mapping</a></li>
<li><a href="#function.spogi-cache-enabled-p">spogi-cache-enabled-p</a></li>
<li><a href="#function.spogi-cache-size">spogi-cache-size</a></li>
<li><a href="#function.static-attribute-filter">static-attribute-filter</a></li>
<li><a href="#function.string:2B">string+</a></li>
<li><a href="#function.subject">subject</a></li>
<li><a href="#function.subject-part:3D">subject-part=</a></li>
<li><a href="#function.subject-upi:3D">subject-upi=</a></li>
<li><a href="#function.supported-types">supported-types</a></li>
<li><a href="#function.triple-count">triple-count</a></li>
<li><a href="#function.triple-exists-p">triple-exists-p</a></li>
<li><a href="#function.triple-id">triple-id</a></li>
<li><a href="#function.triple-spog:3D">triple-spog=</a></li>
<li><a href="#function.triple-store-exists-p">triple-store-exists-p</a></li>
<li><a href="#function.triple-store-id">triple-store-id</a></li>
<li><a href="#function.triple-store-indices">triple-store-indices</a></li>
<li><a href="#function.triple-store-names">triple-store-names</a></li>
<li><a href="#function.triple:3D">triple=</a></li>
<li><a href="#function.type-code-:3Etype-name">type-code-&gt;type-name</a></li>
<li><a href="#function.type-name-:3Etype-code">type-name-&gt;type-code</a></li>
<li><a href="#function.unregister-encoded-id-prefix">unregister-encoded-id-prefix</a></li>
<li><a href="#function.upi">upi</a></li>
<li><a href="#function.upi-:3Egeospatial">upi-&gt;geospatial</a></li>
<li><a href="#function.upi-:3Elongitude-latitude">upi-&gt;longitude-latitude</a></li>
<li><a href="#function.upi-:3Enumber">upi-&gt;number</a></li>
<li><a href="#function.upi-:3Evalue">upi-&gt;value</a></li>
<li><a href="#function.upi-:3Evalues">upi-&gt;values</a></li>
<li><a href="#function.upi-type-code">upi-type-code</a></li>
<li><a href="#function.upi-typep">upi-typep</a></li>
<li><a href="#function.upi:3C">upi&lt;</a></li>
<li><a href="#function.upi:3C:3D">upi&lt;=</a></li>
<li><a href="#function.upi:3D">upi=</a></li>
<li><a href="#function.upip">upip</a></li>
<li><a href="#function.value-:3Eupi">value-&gt;upi</a></li>
<li><a href="#function.warmup-triple-store">warmup-triple-store</a></li>
<li><a href="#macro.while-not-validating-that-upis-are-in-string-table">while-not-validating-that-upis-are-in-string-table</a></li>
<li><a href="#macro.with-blank-nodes">with-blank-nodes</a></li>
<li><a href="#macro.with-log-routed-to-server">with-log-routed-to-server</a></li>
<li><a href="#macro.with-open-triple-store">with-open-triple-store</a></li>
<li><a href="#macro.with-query-environment">with-query-environment</a></li>
<li><a href="#macro.with-temp-triple">with-temp-triple</a></li>
<li><a href="#macro.with-temp-upi">with-temp-upi</a></li>
<li><a href="#macro.with-temp-upis">with-temp-upis</a></li>
<li><a href="#macro.with-triple-store">with-triple-store</a></li>
</ul></div> <a name='header3-120' id='header3-120'></a><h3>Functor index</h3>
<a name="functor" id="functor"></a>
<div class="index functor">
<ul>
<li><a href="#functor.actor-betweenness-centrality">actor-betweenness-centrality</a></li>
<li><a href="#functor.actor-closeness-centrality">actor-closeness-centrality</a></li>
<li><a href="#functor.actor-degree-centrality">actor-degree-centrality</a></li>
<li><a href="#functor.bidirectional-search-path">bidirectional-search-path</a></li>
<li><a href="#functor.bidirectional-search-paths">bidirectional-search-paths</a></li>
<li><a href="#functor.breadth-first-search-path">breadth-first-search-path</a></li>
<li><a href="#functor.breadth-first-search-paths">breadth-first-search-paths</a></li>
<li><a href="#functor.clique">clique</a></li>
<li><a href="#functor.cliquep">cliquep</a></li>
<li><a href="#functor.depth-first-search-path">depth-first-search-path</a></li>
<li><a href="#functor.depth-first-search-paths">depth-first-search-paths</a></li>
<li><a href="#functor.ego-group">ego-group</a></li>
<li><a href="#functor.ego-group-member">ego-group-member</a></li>
<li><a href="#functor.geo-ordinate-value">geo-ordinate-value</a></li>
<li><a href="#functor.get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a></li>
<li><a href="#functor.get-triples-nd-within-polygon">get-triples-nd-within-polygon</a></li>
<li><a href="#functor.get-triples-nd-within-radius">get-triples-nd-within-radius</a></li>
<li><a href="#functor.graph">graph</a></li>
<li><a href="#functor.graph-density">graph-density</a></li>
<li><a href="#functor.group-betweenness-centrality">group-betweenness-centrality</a></li>
<li><a href="#functor.group-closeness-centrality">group-closeness-centrality</a></li>
<li><a href="#functor.group-degree-centrality">group-degree-centrality</a></li>
<li><a href="#functor.nodal-degree">nodal-degree</a></li>
<li><a href="#functor.nodal-neighbors">nodal-neighbors</a></li>
<li><a href="#functor.object">object</a></li>
<li><a href="#functor.part:3D">part=</a></li>
<li><a href="#functor.predicate">predicate</a></li>
<li><a href="#functor.q">q</a></li>
<li><a href="#functor.q-">q-</a></li>
<li><a href="#functor.qd">qd</a></li>
<li><a href="#functor.subject">subject</a></li>
<li><a href="#functor.triple-id">triple-id</a></li>
<li><a href="#functor.triple-inside-bounding-box">triple-inside-bounding-box</a></li>
<li><a href="#functor.triple-inside-bounding-box-g">triple-inside-bounding-box-g</a></li>
<li><a href="#functor.triple-inside-haversine-km">triple-inside-haversine-km</a></li>
<li><a href="#functor.triple-inside-haversine-km-g">triple-inside-haversine-km-g</a></li>
<li><a href="#functor.triple-inside-haversine-miles">triple-inside-haversine-miles</a></li>
<li><a href="#functor.triple-inside-haversine-miles-g">triple-inside-haversine-miles-g</a></li>
<li><a href="#functor.triple-inside-haversine-radians">triple-inside-haversine-radians</a></li>
<li><a href="#functor.triple-inside-haversine-radians-g">triple-inside-haversine-radians-g</a></li>
<li><a href="#functor.triple-inside-polygon">triple-inside-polygon</a></li>
<li><a href="#functor.triple-inside-polygon-g">triple-inside-polygon-g</a></li>
<li><a href="#functor.triple-inside-radius">triple-inside-radius</a></li>
<li><a href="#functor.triple-inside-radius-g">triple-inside-radius-g</a></li>
<li><a href="#functor.upi:3C">upi&lt;</a></li>
<li><a href="#functor.upi:3C:3D">upi&lt;=</a></li>
<li><a href="#functor.upi:3D">upi=</a></li>
</ul></div> <a name='header3-122' id='header3-122'></a><h3>Variable index</h3>
<a name="variable" id="variable"></a>
<div class="index variable">
<ul>
<li><a href="#variable.:2Adb:2A">*db*</a></li>
<li><a href="#variable.:2Adefault-ag-http-port:2A">*default-ag-http-port*</a></li>
<li><a href="#variable.:2Adefault-spogi-cache-enabled:2A">*default-spogi-cache-enabled*</a></li>
<li><a href="#variable.:2Adefault-spogi-cache-size:2A">*default-spogi-cache-size*</a></li>
<li><a href="#variable.:2Aexpand-type-clause-with-map-p:2A">*expand-type-clause-with-map-p*</a></li>
<li><a href="#variable.:2Aget-triples-list-limit:2A">*get-triples-list-limit*</a></li>
<li><a href="#variable.:2Alast-query-plan:2A">*last-query-plan*</a></li>
<li><a href="#variable.:2Aprint-decoded:2A">*print-decoded*</a></li>
<li><a href="#variable.:2Astandard-namespaces:2A">*standard-namespaces*</a></li>
<li><a href="#variable.:2Ause-maps-for-subproperties-s-o-p:2A">*use-maps-for-subproperties-s-o-p*</a></li>
</ul></div> <hr/><div id="footnotes"> <h2>Footnotes</h2>
<div class="footnotes">
<ol>
<li>
<a name="fn0-2018-06-08" id="fn0-2018-06-08"></a>
<p>While completely unrelated to AllegroGraph, there is another symbol with the same name exported from the <strong>dbi.oracle</strong> package.  If you try to have a package use both the <strong>dbi.oracle</strong> and the <strong>db.agraph</strong> packages, these two symbols will signal a package conflict error. Assuming you want to have the <strong>db.agraph</strong> symbol to be available without a package qualifier, you should define your package something like this </p>
<pre><code>    (defpackage :my-package  
      (:use :cl :dbi.oracle :triple-store ...)  
      (:shadowing-import-from :triple-store :*db*)  
      ...) </code></pre><p>or else execute this form </p>
<pre><code>    (shadowing-import 'db.agraph:*db*) </code></pre><p>before using either package. </p><a href="#fnr0-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 1 in the text">&#8617;</a></li>
<li>
<a name="fn1-2018-06-08" id="fn1-2018-06-08"></a>
For information on the N-Triples format, see both the <a href="http://www.w3.org/2001/sw/RDFCore/ntriples/" class="external" target="_blank">W3C description</a> and the information in the <a href="http://www.w3.org/TR/rdf-testcases/#ntriples" class="external" target="_blank">RDF test cases</a>. Additionally the file w3c-ntriples-tests.nt in the <code>sample-inputs</code> directory of the AllegroGraph distribution contains a set of test cases and provides a good overview of what can be represented. <a href="#fnr1-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 2 in the text">&#8617;</a></li>
<li>
<a name="fn2-2018-06-08" id="fn2-2018-06-08"></a>
Details of the RDF/XML syntax can be found in the <a href="http://www.w3.org/TR/rdf-primer/" class="external" target="_blank">RDF/XML-primer</a> and related documentation. <a href="#fnr2-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 3 in the text">&#8617;</a></li>
<li>
<a name="fn3-2018-06-08" id="fn3-2018-06-08"></a>
Language tags are defined in <a href="http://www.ietf.org/rfc/rfc3066.txt" title="Tags for the Identification of Languages">RFC-3066</a> <a href="#fnr3-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 4 in the text">&#8617;</a></li>
<li>
<a name="fn4-2018-06-08" id="fn4-2018-06-08"></a>
The function <code>do-cursor</code> has been removed from AllegroGraph as of version 3.0. Please use the function <a href="#map-cursor" title="description of map-cursor">map-cursor</a> and the macro <a href="#iterate-cursor" title="description of iterate-cursor">iterate-cursor</a> instead. <a href="#fnr4-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 5 in the text">&#8617;</a></li>
<li>
<a name="fn5-2018-06-08" id="fn5-2018-06-08"></a>
The Prolog <a href="#q-" title="description of q-">q-</a> functor provides an interface to range queries for only the <a href="#function.object" title="description of function object">object</a> and <a href="#function.graph" title="description of function graph">graph</a> slots of a triple. <a href="#fnr5-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 6 in the text">&#8617;</a></li>
<li>
<a name="fn6-2018-06-08" id="fn6-2018-06-08"></a>
It is possible to use range queries with UPIs of type :short-literal since these are stored directly in the UPI and not in the string dictionary. The only caveat is that you must make sure that all of your data really does fit into a short literal UPI. This is equivalent to saying that all of your strings must be less than or equal to 10 bytes in length after they have been UTF-8 encoded. <a href="#fnr6-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 7 in the text">&#8617;</a></li>
<li>
<a name="fn7-2018-06-08" id="fn7-2018-06-08"></a>
The Oracle and Sesame connections are in progress. Please contact <a href="mailto:allegrograph-support@franz.com">Franz</a> for more information. <a href="#fnr7-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 8 in the text">&#8617;</a></li>
<li>
<a name="fn8-2018-06-08" id="fn8-2018-06-08"></a>
Remember that <code>select</code> is a macro and that using it in the REPL will produce interpreted code. This means that selects run in the REPL will be significantly slower than those that you write inside of compiled functions. (Note also that both the HTTP and the Java interfaces to AllegroGraph ensure that any select calls get compiled before they run). Whether compiled queries execute significantly faster depends on whether the generated code performs a lot of backtracking or other repeated computation. <a href="#fnr8-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 9 in the text">&#8617;</a></li>
<li>
<a name="fn9-2018-06-08" id="fn9-2018-06-08"></a>
In this case, there are fewer <em>ub:publicationAuthor</em> triples than <em>rdf:type</em> ones so the <code>type</code> clause provides no help at all. If the type clause was <em>more restrictive</em>, then the planner will keep the type clause and move it first. <a href="#fnr9-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 10 in the text">&#8617;</a></li>
<li>
<a name="fn10-2018-06-08" id="fn10-2018-06-08"></a>
Previously, this was called <code>has-value-reasoning-enabled</code> because AllegroGraph only supported <code>owl:hasValue</code>. Now that AllegroGraph supports other restrictions, the name has been changed. <a href="#fnr10-2018-06-08" class="footnoteBacklink" title="Jump back to footnote 11 in the text">&#8617;</a></li>
</ol>
</div>  </div>  </div>  <p><script> $.each($("#agmenu ul li a"), function(ignore, link) {   var anchor = $(link);   anchor.parent().on("click", function () { window.location = anchor.prop("href"); }); }); $("#agmenu").css("display", "block") </script> </p> 
</body>
</html>
