<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="author" content="Franz Incorporated"/>
<title>Release Notes | AllegroGraph 6.4.2</title>
<link rel='stylesheet' href='jquery-ui.custom.min.css' />
<link rel='stylesheet' href='stylesheet.css' />
<link rel='stylesheet' href='print.css' media='print' />
<body id="release-notes"> <div id="header"> <p>                 </p>                <p><script src="jquery.min.js" type="text/javascript" charset="utf-8"></script> <script src="jquery-ui.custom.min.js" type="text/javascript" charset="utf-8"></script> <script src="activebookmark.js" type="text/javascript" charset="utf-8"></script> </p> <div id='search-form'>   <form method="GET" action="https://www.google.com/search">     <input type="hidden" name="as_sitesearch" value=""> </input>     <input type="text" size="40" name="as_q" value="" placeholder="Please enable JavaScript to use search!"> </input>&nbsp;     <input type="submit" value="Search" disabled> </input>   </form> </div> <script>    /* Docudown has no support for function calls in HTML attributes. 
<ul>
<li>Thus, we set the as_sitesearch attribute using JavaScript below.    */   (function () { 'use strict'; var properValue = "franz.com/agraph/support/documentation/6.4.2/"; var input = document.querySelector(   '#search-form input[name="as_sitesearch"]'); input.setAttribute('value', properValue); /* The submit button was disabled so that search would be 
<ul>
<li>impossible for users without JavaScript. Enabling now: */ document.querySelector('#search-form input[type="submit"]').   removeAttribute('disabled'); document.querySelector('#search-form input[name="as_q"]').   removeAttribute('placeholder');   })(); </script> <div id="copyright">  Copyright (c) 2005 - 2018 Franz, Incorporated</div> <div id="timestamp">  Last updated 8 June 2018 at 06:55</div> <a href="https://franz.com" alt="Franz Inc Home Page"><div id="hdLogo"> </div></a> </li></ul></li></ul>       <h1>AllegroGraph 6.4.2 Release Notes</h1></div> <div id="contents">  <div id="docIndex"> <ul id="agmenu"> <li><a href="index.html">Documentation Index</a> 
<ul>
<li><a href="release-notes.html">Release Notes</a></li>
<li><a href="agraph-quick-start.html">Quick Start</a></li>
<li><a href="agraph-introduction.html" id="agraph-introduction-tab">Introduction</a></li>
<li>Setup and Configuration
<ul>
<li><a href="http://franz.com/agraph/downloads/" target="_blank">Download</a></li>
<li><a href="server-installation.html">Server Installation</a></li>
<li><a href="daemon-config.html">Server Configuration and Control</a></li>
<li><a href="agwebview.html">WebView</a></li>
<li><a href="upgrade-guide.html">Database Upgrading</a></li></ul></li>
<li>Server Management
<ul>
<li><a href="performance-tuning.html">Performance Tuning</a></li>
<li><a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a></li>
<li><a href="purging-deleted-triples.html">Purging Deleted Triples</a></li>
<li><a href="audit.html">Auditing</a></li>
<li><a href="managing-users.html">Managing Users</a></li>
<li><a href="replication.html">Replication</a></li>
<li><a href="point-in-time-recovery.html">Point-in-Time Recovery</a></li>
<li><a href="transaction-log-archiving.html">Transaction Log Archiving</a></li>
<li><a href="security-overview.html">Security Overview</a></li>
<li><a href="security.html">Security Implementation</a></li></ul></li>
<li>Tools
<ul>
<li><a href="agtool.html">agtool</a></li>
<li><a href="agload.html">Data Loading</a></li>
<li><a href="agexport.html">Data Export</a></li>
<li><a href="backup-and-restore.html">Backup and Restore</a></li>
<li><a href="agquery.html">Querying</a></li>
<li><a href="reasoner-tutorial.html" id="reasoner-tutorial-tab">RDFS++</a></li>
<li><a href="materializer.html">Materializer</a></li></ul></li>
<li>Details
<ul>
<li><a href="triple-index.html">AllegroGraph Indices</a></li>
<li><a href="text-index.html">Full-text Indices</a></li>
<li><a href="encoded-ids.html">Encoded IDs</a></li>
<li><a href="connection-pooling.html">Connection Pooling</a></li>
<li><a href="geospatial-nd.html">N-dimensional Geospatial Overview</a></li>
<li><a href="magic-properties.html#sparql-magic-geo-2d">2-D Geospatial</a></li>
<li><a href="magic-properties.html#sparql-magic-temporal">Temporal</a></li>
<li><a href="magic-properties.html#sparql-magic-sna">Social Network</a></li>
<li><a href="javascript.html">JavaScript</a></li>
<li><a href="datatypes.html">Datatypes</a></li>
<li><a href="rapper.html">Data Conversion (Rapper)</a></li>
<li><a href="stored-procedures.html">Stored Procedures</a></li>
<li><a href="triple-attributes.html">Triple Attributes</a></li></ul></li>
<li>Querying
<ul>
<li><a href="sparql-overview.html">SPARQL documentation summary</a></li>
<li><a href="sparql-reference.html">SPARQL Reference</a></li>
<li><a href="spin.html">SPIN</a></li>
<li><a href="magic-properties.html">SPARQL Magic Properties</a></li>
<li><a href="prolog-tutorial.html">Prolog</a></li></ul></li>
<li>3rd-party tools
<ul>
<li><a href="solr-index.html">Solr text Indices</a></li>
<li><a href="mongo-interface.html">MongoDB integration</a></li>
<li><a href="TBCplugin.html">TopBraid Composer Plugin</a></li>
<li><a href="agraph-introduction.html#othertools">Cloudera</a></li></ul></li>
<li>Client APIs
<ul>
<li><a href="http://franz.com/agraph/gruff/" title="Gruff" target="_blank">Gruff</a></li>
<li><a href="http-protocol.html">REST/HTTP interface</a></li>
<li><a href="http-reference.html">HTTP reference</a></li>
<li><a href="javadoc/index.html">Javadocs (Sesame and Jena)</a></li>
<li><a href="python/index.html">Python API</a></li>
<li><a href="lisp-reference.html">Lisp Reference</a></li>
<li><a href="javascript.html">JavaScript</a></li></ul></li>
<li>Tutorials
<ul>
<li><a href="geospatial-nd-tutorial.html">N-dimensional Geospatial</a></li>
<li><a href="sparql-tutorial.html">SPARQL Tutorial</a></li>
<li><a href="java-tutorial/java-tutorial.html">Java Sesame</a></li>
<li><a href="java-tutorial/jena-tutorial.html">Java Jena</a></li>
<li><a href="python/tutorial.html">Python Sesame</a></li>
<li><a href="lisp-quickstart.html">Lisp</a></li>
<li><a href="prolog-tutorial.html">Prolog</a></li>
<li><a href="tutorial-index.html">More...</a></li></ul></li>
<li>Other
<ul>
<li><a href="suggested-reading.html">Suggested Reading</a></li>
<li><a href="http://franz.com/ps/services/conferences_seminars/" title="Conferences and Seminars" target="_blank">Conferences and Seminars</a></li>
<li><a href="http://github.com/franzinc">Source Code on Github</a></li>
<li><a href="http://agraph.franz.com/cresources/index.lhtml" target="_blank">Community Resources</a></li>
<li><a href="http://franz.com/agraph/ec2/">Amazon EC2</a></li>
<li><a href="copyrights.html">Copyrights</a></li>
<li><a href="change-history.html" id="change-history-tab">Change History</a></li></ul></li>
<li><a href="http://franz.com/" target="_blank">Franz, Inc.</a> </li> </ul> </li></ul><p><script> $(function() { $( "#agmenu" ).menu(); }); </script> </p></div>   
<div class='table-of-contents' id='table-of-contents'>

<ul>
<li><a href='#header2-8' title='Introduction'>Introduction</a></li>
<li><a href='#header2-12' title='Release 6.4.2'>Release 6.4.2</a>
<ul>
<li><a href='#header3-15' title='Database internal format unchanged from version 6.4.1 (last change 6.4.0)'>Database internal format unchanged from version 6.4.1 (last change 6.4.0)</a></li></ul></li>
<li><a href='#header2-18' title='Release 6.4.1'>Release 6.4.1</a>
<ul>
<li><a href='#header3-21' title='Database internal format unchanged from version 6.4.0 (last change 6.4.0)'>Database internal format unchanged from version 6.4.0 (last change 6.4.0)</a></li></ul></li>
<li><a href='#header2-24' title='Release 6.4.0'>Release 6.4.0</a>
<ul>
<li><a href='#header3-28' title='Database internal format changed from version 6.3.0'>Database internal format changed from version 6.3.0</a></li></ul></li>
<li><a href='#header2-30' title='Programmer notes'>Programmer notes</a>
<ul>
<li><a href='#header3-33' title='6.4.2 Programmer notes'>6.4.2 Programmer notes</a></li>
<li><a href='#header3-36' title='6.4.1 Programmer notes'>6.4.1 Programmer notes</a></li>
<li><a href='#header3-39' title='6.4.0 Programmer notes'>6.4.0 Programmer notes</a></li></ul></li>
<li><a href='#header2-45' title='AllegroGraph 6.4.2'>AllegroGraph 6.4.2</a>
<ul>
<li><a href='#header3-46' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-86' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-89' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-146' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-151' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-175' title='Prolog'>Prolog</a></li>
<li><a href='#header3-177' title='Documentation'>Documentation</a></li>
<li><a href='#header3-179' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-184' title='AllegroGraph 6.4.1'>AllegroGraph 6.4.1</a>
<ul>
<li><a href='#header3-185' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-224' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-227' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-282' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-285' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-308' title='Prolog'>Prolog</a></li>
<li><a href='#header3-310' title='Documentation'>Documentation</a></li>
<li><a href='#header3-312' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-321' title='AllegroGraph 6.4.0'>AllegroGraph 6.4.0</a>
<ul>
<li><a href='#header3-322' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-332' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-334' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-363' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-372' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-379' title='Prolog'>Prolog</a></li>
<li><a href='#header3-381' title='Documentation'>Documentation</a></li>
<li><a href='#header3-383' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-386' title='User-visible changes in earlier releases'>User-visible changes in earlier releases</a></li></ul>
<div id='tocLink'><a href='index.html'>Documentation Index</a></div>
</div>
  <div id="main-content"> <a name='header2-8' id='header2-8'></a><h2>Introduction</h2><p>This document lists all changes for the most recent major release (releases with number X.Y) and subsequent minor releases (with numbers X.Y.Z and perhaps further identifiers), including major and important changes and a list of all user-visible modifications. <a href="change-history.html" id="change-history-tab">Change History</a> repeats the list of user-visible modifications for this release and includes similar lists for earlier releases. </p><p>The release described in the documentation set is <strong>6.4.2</strong>. </p><p><a name="release-642"></a> </p><a name='header2-12' id='header2-12'></a><h2>Release 6.4.2</h2><p>Release 6.4.2 is a maintenance release with code fixes and enhancements.<br />
</p><p><a name="database-format641"></a> </p><a name='header3-15' id='header3-15'></a><h3>Database internal format unchanged from version 6.4.1 (last change 6.4.0)</h3><p>The database format is changed from time to time. When the format is changed, databases must be upgraded to the new format before they can be used. Upgrading is discussed in the <a href="upgrade-guide.html">Database Upgrading</a> document. The format in version 6.4.2 is unchanged from version 6.4.1. (The format was previously changed in release 6.4.0.) Therefore it is not necessary to upgrade 6.4.1 databases for them to be used with 6.4.2. Note that backing up repositories before before using them to a new version is always recommended. Once a database has been used in a later release, it cannot be used in an earlier release regardless of whether or not the database format is the same. </p><p><a name="release-641"></a> </p><a name='header2-18' id='header2-18'></a><h2>Release 6.4.1</h2><p>Release 6.4.1 is a maintenance release with code fixes and enhancements.<br />
</p><p><a name="database-format641"></a> </p><a name='header3-21' id='header3-21'></a><h3>Database internal format unchanged from version 6.4.0 (last change 6.4.0)</h3><p>The database format is changed from time to time. When the format is changed, databases must be upgraded to the new format before they can be used. Upgrading is discussed in the <a href="upgrade-guide.html">Database Upgrading</a> document. The format in version 6.4.1 is unchanged from version 6.4.0. (The format was previously changed in release 6.4.0.) Therefore it is not necessary to upgrade 6.4.0 databases for them to be used with 6.4.1. Note that backing up repositories before before using them to a new version is always recommended. Once a database has been used in a later release, it cannot be used in an earlier release regardless of whether or not the database format is the same. </p><p><a name="release-640"></a> </p><a name='header2-24' id='header2-24'></a><h2>Release 6.4.0</h2><p>Release 6.4.0 is a major release with significant new features.<br />
</p><p>The most important and far-reaching change is support for <strong>multi-master replication</strong>. AllegroGraph has long supported <a href="replication.html">single-master replication</a>, where several AllegroGraph instances share data in a repository, but only one of them can make changes (adding or deleting triples). The rest then catch up. In multi-master replication, even though one instance is identified as the controlling instance, any instance can add or delete triples, with the remainder catching up with those changes while perhaps making other changes of their own.  Single-master replication is still supported and is described in the <a href="replication.html">Replication</a> document. The new multi-master replication facility is described in <a href="multi-master.html">Multi-master Replication</a>. </p><p><a name="database-format640"></a> </p><a name='header3-28' id='header3-28'></a><h3>Database internal format changed from version 6.3.0</h3><p>The database format is changed from time to time. When the format is changed, databases must be upgraded to the new format before they can be used. Upgrading is discussed in the <a href="upgrade-guide.html">Database Upgrading</a> document. The format in version 6.4.0 is changed from version 6.3.0. (The format was previously changed in release 6.2.0.) Therefore it is necessary to upgrade 6.3.0 and earlier databases for them to be used with 6.4.0. Note that backing up repositories before before upgrading them to a new version is always recommended. Once a database has been used in a later release, it cannot be used in an earlier release regardless of whether the database format is the same. </p><a name='header2-30' id='header2-30'></a><h2>Programmer notes</h2><p>These sections note changes which may affect how certain operations or code work compared to earlier releases. These are emphasized here because the changes may be unexpected. The complete list of user-visible changes <a href="#user-visible">below</a> also mentions these changes in a shorter format. </p><p><a name="programmer-notes-642"></a> </p><a name='header3-33' id='header3-33'></a><h3>6.4.2 Programmer notes</h3>
<ul>
<li>The <code>--if-exists</code> option was added to the <strong>agtool repl create-cluster</strong> command in release 6.4.1. The default was then <code>supersede</code>. The default has been changed to <code>error</code>, to avoid unintended deletion of repository contents. An existing script using <strong>agtool repl create-cluster</strong> created for version 6.4.1 which expects <code>supersede</code> to be the default for <code>--if-exists</code> may fail to work in 6.4.2 until <code>--if-exists supersede</code> is added to the argument list. <strong>agtool repl create-cluster</strong> is described [here](multi-master.html#agt-create-cluster] in the <a href="multi-master.html">Multi-master Replication</a> document. </li></ul><p><a name="programmer-notes-641"></a> </p><a name='header3-36' id='header3-36'></a><h3>6.4.1 Programmer notes</h3>
<ul>
<li>In earlier releases, duplicate triples were automatically removed from SPARQL results. Now whether or not they should be removed is controlled by the new SPARQL query option <code>enableDuplicateReduction</code> and that option is off by default (earlier releases thus acted as if the option was on).  If your triple-store has duplicate triples, then this may change the results of your queries unless you explicitly set the option in your queries. See <a href="sparql-reference.html#sparql-queryoptions">SPARQL Query Options</a> in the <a href="sparql-reference.html">SPARQL Reference</a> document for information on SPARQL query options. </li></ul><p><a name="programmer-notes-640"></a> </p><a name='header3-39' id='header3-39'></a><h3>6.4.0 Programmer notes</h3>
<ul>
<li>The variable <code>*db*</code> is now bound in each thread. Each thread in a process binds a number of variables to appropriate initial values so that changes to a variable value within a thread are seen by that thread only. See the section <a href="https://franz.com/support/documentation/10.1/doc/multiprocessing.htm#dynamic-environments-1">Processes and their dynamic enviroments</a> in the Allegro CL documentation for more information. Starting in release 6.4.0, the AllegroGraph variable <code>*db*</code> is now bound in each thread, meaning changes to its value in one thread will not be seen by any other thread. This change helps avoid accidental sharing of a repository connection between thread.  Each new thread will start with <code>*db*</code> bound to <code>nil</code>. See <a href="#dbthread">below</a> for further information and an example. </li></ul><p><a name="user-visible"></a> ## User visible changes </p><p>These sections list changes in the current release and in some earlier releases. See the <a href="change-history.html" id="change-history-tab">Change History</a> for a list of changes in all earlier releases. </p> <p><a name="changes-642"></a> </p><a name='header2-45' id='header2-45'></a><h2>AllegroGraph 6.4.2</h2><a name='header3-46' id='header3-46'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe15599 - Disallow creation of repos within the system catalog</h4><p>Attempts to create repositories in the system catalog will now be met with the following error message: </p>
<pre><code>Repositories cannot be created within the 'system' catalog </code></pre><h4>Rfe15528 - Increase speed of finding distinct predicates or graphs in a reasoning triple-store</h4><p>It is now much more efficient to find distinct predicates or graphs when RDFS++ or restriction reasoning is enabled. </p><h4>Rfe15492: Use triple-store-spec for certain agtools</h4><p>The following agtools (see <a href="agtool.html">agtool</a>) have had their syntax changed to use a triple-store specification instead of the options <code>--port</code>, <code>--user</code>, <code>--password</code>, <code>--host</code>, and <code>--catalog</code>. The affected tools are: cancel-purge-deleted-triples, define-attribute, delete-static-attribute-filter, get-metadata, lookup-attribute-definition, memory-lock, memory-unlock, purge-deleted-triples, purge-rate-limit, set-purge-rate-limit, set-static-attribute-filter. The triple-store specification is </p>
<pre><code>http(s):[//[USER:PASSWORD@]HOST[:PORT]][/catalogs/CATALOG]/repositories/REPO </code></pre><p>Items in brackets ([]) may be left out in some circumstances depending on what is required for the tool. </p><h4>Rfe15482 - Change if-exists default for agtool repl create-cluster</h4><p>In <strong>agtool repl create-cluster</strong> --if-exists argument used to default to supersede and now defaults to error. Existing scripts using agtool repl create-cluster may now fail to work until --if-exists supersede  is added to the argument list. </p><h4>Rfe15481 - Improve turtle serializer output for numbers</h4><p>AllegroGraph's Turtle and TriG serializers now emit integers, decimals and double floats using the more concise numeric representation rather than the full XSD typed literal one. </p><h4>Rfe14740 - agtool can now manipulate users and roles</h4><p>Added <strong>agtool user</strong> and <strong>agtool role</strong> commands to manipulate user accounts and roles respectively. For more infomation, execute: </p>
<pre><code>agtool user --help  
agtool role --help </code></pre><p>See the <a href="managing-users.html">Managing Users</a> document for further information. </p><h4>Rfe11183 - Add --optimize option to agtool load</h4><p><strong>agtool load</strong> now accepts the <code>--optimize</code> option to request full (level 2) index optimization after loading completes. See the <a href="agload.html">AllegroGraph Loader</a> document. Index optimization is discussed in the <a href="triple-index.html#optimize">Optimizing indices</a> section of the <a href="triple-index.html">Triple Indices</a> document. </p><h4>Bug25289 - Dropping a text index deletes files too early</h4><p>Dropping a freetext index could result in instance startup errors if the instance crashed before a checkpoint occurred. This has been fixed. </p><h4>Bug25288: Free Text Index state updates not recorded in tlog during commit</h4><p>Starting in AllegroGraph v6.3.0, changes in text index configuration (such as creation and removal) were not stored in the transaction log during commit. This could result in disappearance of an added text index, or reappearance of a deleted text index after a repository crash restart. This problem is now fixed. </p><h4>Bug25266 - sna:egoGroup function does not find its generator in all cases</h4><p>The functional form of the <code>sna:egoGroup</code> magic property did not look up and register its SNA generator function if the generator was stored using triples. This has been corrected. </p><h4>Bug25236 - Turtle serializer could emit invalid qnames</h4><p>It was possible for the Turtle serializer to produce invalid output if resources contained characters that needed to be escaped. This has been corrected. </p><h4>Bug25207 - Using Japanese tokenizer can result in errors</h4><p>Using the Japanese text index tokenizer on a system that does not have the <code>mecab</code> package installed would result in an error like the following: </p>
<pre><code>tagger.cpp(153) [load_dictionary_resource(param)] param.cpp(71)  
[ifs] no such file or directory: /etc/mecabrc </code></pre><p>This has been fixed. </p><h4>Bug25201 - agtool export output depends on the value of LANG</h4><p>It was possible for the value of the LANG environment variable to alter the output of <a href="agexport.html">agtool export</a>. This has been corrected. </p><h4>Bug25138 - agtool CMD will fail if run from a directory it cannot write to.</h4><p>If the current working directory is not writable <strong>agtool query</strong> and <strong>agtool materialize</strong> would stop running with an error the first time they try to write to their respective log files. Now this behavior has been changed to warn the user that it was unable to write to the log file and then continues processing. It continues logging to the terminal as it would normally do. See <a href="agtool.html">agtool General Command Utility</a> for a description of <strong>agtool</strong>. </p><h4>Bug25115 - 'agtool export' errors when using --parallel and exporting NQX</h4><p>Attempting to use <strong>agtool export</strong> with <code>--output nqx</code> and <code>--parallel</code> mode would result in an error like the following: </p>
<pre><code>error `#&lt;consumer-cursor @ #x1000991a312&gt; does not support extended-triples`  
occurred in worker 11  
interrupting... </code></pre><p>This has been fixed. </p><a name='header3-86' id='header3-86'></a><h3>HTTP API</h3><h4>Bug25246 - Improve HTTP socket reuse for remote repositories</h4><p>Queries on remote triple stores now reuse the same underlying HTTP socket connection for efficiency. </p><a name='header3-89' id='header3-89'></a><h3>SPARQL</h3><h4>Rfe15644 - Improve probing decision</h4><p>AllegroGraph decides at query time whether it is more efficient to scan or probe to evaluate a triple pattern. However, if a pattern had certain constraints on some of its variables, then AllegroGraph was unable to probe. Now AllegroGraph is able to probe in more cases which can greatly improve performance for particular queries. </p><h4>Rfe15628 - Handle query + filter patterns more efficiently</h4><p>AllegroGraph now handles SPARQL queries where a pattern in a BGP can act as a filter on the existing set of solutions. As an example, consider this query: </p>
<pre><code>:target :select ?s .  
?s :has ?property .  
?property rdf:type :animal . </code></pre><p>Prior to this change, AllegroGraph would first find all &lt;?s :has ?property&gt; triples and only then filter the results using the &lt;?property rdf:type :animal&gt; pattern. Depending on the shape of the dataset, this could generate a large number of intermediate results. AllegroGraph is now able to treat the &lt;?property rdf:type :animal&gt; pattern as a filter while evaluating the &lt;?s :has ?property&gt; pattern which can help speed the query. </p><h4>Rfe15607 - Sort language tagged literals sensibly</h4><p>The SPARQL 1.1 standard does not define an ordering on language tagged literals. AllegroGraph now orders language tagged literals by first comparing their languages and then their string values. Plain and <code>xsd:string</code> typed literals come before any language tagged literal. </p><h4>Rfe15600 - Remove and warn about unused BINDings</h4><p>AllegroGraph now issues a query warning if variables introduced by a BIND clause are not used elsewhere in the query. For example: </p>
<pre><code>select distinct ?o {  
  bind(23 as ?number)  
  ?s ?p ?o .  
}  
</code></pre><h4>Rfe15541 - Warn when a BIND form is extending an empty set of solutions</h4><p>The SPARQL BIND construct operates by extending an existing set of bindings. If there are no bindings, then there is nothing to extend and so the assignment will uniformly fail. AllegroGraph now warns when it encounters this situation. For example, </p>
<pre><code>SELECT ?ABC {  
  BIND(?s AS ?ABC)  
  ?s ?p ?o .  
} </code></pre><p>Previously, AllegroGraph was incorrectly rearranging the above query so that it would return bindings for <code>?ABC</code>. Now the above query will leave <code>?ABC</code> unbound and emit a :warn-empty-bind-clause warning. </p><h4>Rfe15524 - Improve SPARQL property path efficiency</h4><p>The data structures used to compute SPARQL property paths have been improved to provide better performance. </p><h4>Rfe15523 - Improve SPARQL dataset efficiency</h4><p>SPARQL datasets are now slightly more efficient when processing queries. </p><h4>Rfe15522 -  Use existing constant bindings when evaluating subsequent ones</h4><p>AllegroGraph now uses existing constant BINDings when evaluating subsequent ones during query planning rather than waiting until query execution. </p><h4>Rfe15515 - Support variable attributes in SPARQL attributes block</h4><p>AllegroGraph SPARQL now supports variable attributes for SPARQL update operations. For example, the query: </p>
<pre><code>prefix attr: &lt;http://franz.com/ns/allegrograph/6.2.0/&gt;  
insert {  
  attributes ?attr { ?s ex:newPredicate ?o . }  
} where {  
  ?attr attr:attributes (?s ex:oldPredicate ?o }  
} </code></pre><p>would replace each triple whose predicate was <code>ex:oldPredicate</code> with one having the predicate <code>ex:newPredicate</code> and the same attributes. </p><h4>Rfe15501 - Make better use of FILTER constraints in property path queries</h4><p>AllegroGraph now uses constraints derived from SPARQL property path queries in more cases. This can help to improve the performance of some queries. </p><h4>Rfe15413 - Improve handling of constant BIND expressions</h4><p>AllegroGraph now analyzes constant expressions in BIND forms and can use the results to improve the efficency of some queries. </p><p>For example, AllegroGraph previously would execute only the first of the following two logically equivalent queries efficiently: </p>
<pre><code># BIND with a constant  
select * {  
  bind( &lt;http://example.com#Mammal&gt; as ?Class )  
  ?a rdf:type ?Class .  
}  
 
# BIND with a constant _expression_  
select * {  
  bind( iri('http://example.com#Mammal') as ?Class )  
  ?a rdf:type ?Class .  
} </code></pre><p>Now both of the queries will execute efficiently. </p><h4>Rfe15381 - Allow federated geospatial query if one store has no geospatial mappings at all</h4><p>When executing SPARQL geospatial query on federated-triple-stores an error was thrown if federated stores had different geospatial type mappings. This was an overly strict limitation, so that error is now only thrown when regular type mappings differ. </p><h4>Bug25271: Fix "agtool query" on SPARQL endpoint</h4><p>Running a query on a SPARQL endpoint using "agtool query", e.g. </p>
<pre><code>./agtool query http://dbpedia.org/sparql </code></pre><p>would, after printing results, signal the error: </p>
<pre><code>Error "http://dbpedia.org/sparql" is not a triple store occurred during setup </code></pre><p>This has been resolved. </p><h4>Bug25268 - Correct handling of query log line length</h4><p>It was previously impossible to set the query log line length using the <code>logQuery</code> query option. The log length can now be set with the new <code>logLineLength</code> query parameter. </p><h4>Bug25247 - Some SPARQL sub-queries with external filters could fail.</h4><p>AllegroGraph could fail to correctly execute SPARQL queries when they involved a sub-query and FILTERs that applied to triple-patterns within the sub-query. For example: </p>
<pre><code>select ?s ?timestamp {  
  {  
    select distinct ?s ?timestamp {  
      ?s allegro:hasCreationDate ?timestamp .  
    }  
  }  
  FILTER (?timestamp &gt;= '2018-04-12T20:32:53.213Z'^^xsd:dateTime&gt;)  
  FILTER (?timestamp &lt;= '2018-04-15T20:32:53.213Z'^^xsd:dateTime&gt;)  
} </code></pre><p>This has been corrected. </p><h4>Bug25170 - Property path analysis of missing constants is too stringent</h4><p>AllegroGraph was marking some property path queries as if they were impossible when elements of the path were not found in the repository. This led to some queries failing to return results. The problem has been corrected. </p><h4>Bug25197 - Fix handling 'select *' results from remote endpoints</h4><p>Queries of the form <code>select * { .. }</code> sent to a non-AllegroGraph endpoint could fail with a "result variables are in wrong order" error even though the query results sent by the endpoint were valid. This has been fixed. </p><h4>Bug25169 - Impossible NOT EXISTS clauses should not make query impossible</h4><p>The logic that notices when parts of a SPARQL query cannot succeed and marks them as impossible was incorrectly treating NOT EXISTS filters as if they were EXISTS filters which led to some queries failing to return results. This has been corrected. </p><h4>Bug25151 - Problem with complex NOT EXISTS filters</h4><p>Queries that used [NOT] EXISTS in a FILTER could lead to an error if the query inside the [NOT] EXISTS contained language filters. </p><h4>Bug22482 - Improve property path estimates with fixed subject/object</h4><p>AllegroGraph now does a much better job of estimating the cost of transitive closure (i.e., zero-or-more and one-or-more) property path queries. These improved estimates can lead to greatly improved plans. </p><a name='header3-146' id='header3-146'></a><h3>AGWebView</h3><h4>Rfe15410: Add repository name and group columns to the AGWebView cluster table</h4><p>On the replication manager page in Webview columns were added to display the repository name and catalog as well as the group of each instance. See the <a href="multi-master.html#managing-clusters-webview">Managing Clusters Using AGWebView</a> section for information on the WebView cluster table. </p><h4>Bug25146: Ok button never reenabled after failed text area load</h4><p>In AllegroGraph WebView when importing statements from a text area input the OK button didn't reenable after the loading process had failed. This has been corrected. </p><a name='header3-151' id='header3-151'></a><h3>Changes to the Lisp API</h3><h4>Rfe15547 - Add type checking to the upi function</h4><p>The <a href="lisp-reference.html#upi" title="description of upi">upi</a> function now includes type checking so that it will signal a clearer error message if passed an argument of the wrong type. The function is now also defined on UPIs in addition to future-parts. </p><h4>Rfe15499 - delete-triple improvements</h4><p><a href="lisp-reference.html#delete-triple" title="description of delete-triple">delete-triple</a> now accepts a triple object as argument, as alternative to a triple id. </p><p>In either case the return value now indicates whether the deletion was successful. </p><h4>Rfe15483 - Add part-to-namespace to the Lisp API</h4><p>The Lisp API now includes <a href="lisp-reference.html#part-to-namespace" title="description of part-to-namespace">part-to-namespace</a>. This function takes a UPI, a future part, or a string representing a URI (with or without angle brackets) and returns the Prefixed Name and Local Part (as multiple values) if a registered namespace can be found to abbreviate the resource. For example: </p>
<pre><code>(part-to-namespace "&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;")  
==&gt;  
"rdf"  
"type"  
</code></pre><h4>Rfe14068 - Let run-sparql return query metadata for remote triple stores</h4><p>Calling the <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> function on a remote triple store now returns query metadata like timing information as fourth value, just as for local triple stores. </p><h4>Rfe8199 - Add a with-open-triple-store convenience macro</h4><p>The Lisp API now includes <a href="lisp-reference.html#with-open-triple-store" title="description of with-open-triple-store">with-open-triple-store</a> macro which opens a triple-store, executes the body, and then closes it. </p><h4>Bug25305 - Export cursor-peek from db.agraph package</h4><p>The <a href="lisp-reference.html#cursor-peek" title="description of cursor-peek">cursor-peek</a> function was introduced in AllegroGraph v6.4.1 but was not exported from the <code>db.agraph</code> package. The symbol is now exported and also available in the <code>db.agraph.user</code> package. </p><h4>Bug25192 - materialize-entailed-triples was not supported in the remote Lisp client</h4><p>Both <a href="materializer.html#materialize-entailed-triples" title="description of materialize-entailed-triples">materialize-entailed-triples</a> and <a href="materializer.html#delete-materialized-triples" title="description of delete-materialized-triples">delete-materialized-triples</a> are now available in the remote Lisp client. </p><h4>Bug25168 - Fix leaked http-cursor finalizer clash</h4><p>Cursors can be leaked, for example by using <code>return-from</code> inside <a href="lisp-reference.html#iterate-cursor" title="description of iterate-cursor">iterate-cursor</a>. These cursors are eventually garbage-collected. There was a finalizer race condition in the collection of HTTP connection based cursors, that would lead to <code>stream-closed-error</code> being signaled to the user unexpectedly. This has been resolved. </p><h4>Bug25168 - Improve cursor leak message for get-triples on remote-triple-store</h4><p>If <a href="lisp-reference.html#get-triples" title="description of get-triples">get-triples</a> is called on a remote-triple-store outside <a href="lisp-reference.html#with-query-environment" title="description of with-query-environment">with-query-environment</a>, the cursor will open an HTTP socket to the triple store. If the cursor is leaked it will be garbage-collected eventually, but until that moment the socket will be kept open. This can negatively impact performance, therefore a warning will now be logged: </p>
<pre><code>[2018-03-12T09:06:27.250 p13791 W cursor] Cursor created by  
(get-triples) on remote-triple-store "db" was leaked,  
will be closed. </code></pre><h4>Bug25166 - remote-triple-stores reason on the client rather than the server</h4><p>AllegroGraph now ensures that the dynamic reasoner will execute on the server rather than the client when using a remote-triple-store. This prevents a large number of <a href="lisp-reference.html#get-triples" title="description of get-triples">get-triples</a> from executing via HTTP when using the RDFS++ reasoner. </p><a name='header3-175' id='header3-175'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-177' id='header3-177'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-179' id='header3-179'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-641"></a> </p><a name='header2-184' id='header2-184'></a><h2>AllegroGraph 6.4.1</h2><a name='header3-185' id='header3-185'></a><h3>AllegroGraph Server: General Changes</h3><h4>New agtool commands and some changed arguments</h4><p>The <em>*agtool</em> command-line utility has new commands available. Further some commands have new arguments and some arguments have changed. See the <a href="agtool.html">agtool General Command Utility</a> document for details. Most commands now have a <code>--scheme</code> argument which can be <em>http</em> or <em>https</em>. </p><h4>agtool repl create-cluster adds --if-exists and --force arguments</h4><p><strong>agtool repl create-cluster</strong> previously would only create new, empty repositories and if an existing repository were specified, it would be deleted and a new, empty repository with the same name would be created. (This behavior differed from the behavior when creating clusters with AGWebView, where a repository had to exist and need not be empty when it was converted to an initial replication instance.) Now <strong>agtool repl create-cluster</strong> accepts an <code>--if-exists</code> argument with allowable values <em>supersede</em> (the default, meaning delete the existing repository and create a new one with the same name), <em>overwrite</em> (same as <em>supersede</em>), <em>use</em> (convert an existing, possibly non-empty repository), and <em>error</em> (signal an error if the repository specified already exists). </p><p>If <em>use</em> is specified, then any encoded id definitions will be examined and if any do not allow for 2^60 distinct strings and so will not work with <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a>, the conversion will fail and a warning will be printed. If the <code>--force</code> argument with value <code>true</code> is supplied, then the conversion will be done but none of the offending encoded id prefixes must be used again. </p><h4>The Cluster Replication Manager page now displays statistics</h4><p>These help users to monitor the state of the cluster.  See the <a href="multi-master.html#managing-clusters-webview">Managing clusters in AGWebView once created</a> section in the <a href="multi-master.html">Multi-master Replication</a> document. </p><h4>When adding a cluster instance in AGWebView, a progress log is displayed</h4><p>When adding an instance in Webview you'll see that the log of actions is updated with progress reports describing what is being done. Also the AGWebView replication manager page has new columns and some columns have been renamed. See <a href="multi-master.html#using-webview">here</a> for information on using AGWebView to manage clusters. </p><h4>Rfe15465 - Disallow setting bulk-load-mode in replication instance</h4><p>In a replication instance one cannot set bulk load mode since replication depends on the transaction logs being an accurate reflection of the changes to the repository and logging is disabled in bulk loading mode. Specifying the <code>--bulk</code> option to <strong>agtool load</strong> or clicking the <em>Use bulk load mode</em> checkbox when adding triples from an uploaded file in AGWebView will cause the load to fail. </p><h4>Rfe15451 - Don't fail if unable to write to agload.log</h4><p>If the current working directory is not writable <a href="agload.html">agload</a> would stop running with an error the first time it tries to write to the log file <em>agload.log</em>. Now this behavior has been changed to warn the user that it was unable to write to the log file and then continues processing. It continues logging to the terminal as it would normally do. </p><h4>Rfe15426 - Expose and document the --parameter option for agtool load</h4><p><a href="agload.html">agtool load</a> now accepts the <code>--parameter</code> option for controlling the configuration of newly created repositories. See <a href="agload.html#parameter-option">the --parameter option</a> in the <a href="agload.html">agtool load</a> document for details. </p><h4>Rfe15418 - Change StringTableCompression default to 'none'</h4><p>AllegroGraph now in the default creates new repositories with string compression disabled. This results in faster out-of-the-box operation. String compression can be enabled by using the <code>StringTableCompression</code> directive in <em>agraph.cfg</em>.  See the <a href="daemon-config.html#stringtablecompress">description of StringTableCompress</a> in the <a href="daemon-config.html">Server Configuration and Control</a> document for information. </p><p>Note that the string compression type can only been set when creating a new repository. The <code>StringTableCompression</code> parameter is further discussed <a href="performance-tuning.html#string-table-compression">here</a> in the <a href="performance-tuning.html">Performance Tuning</a> document. </p><h4>Rfe15190 - Remove --repl argument from agtool archive backup and agtool recover</h4><p>The <code>--repl</code> argument for <strong>agtool archive backup</strong> and <strong>agtool recover</strong> is no longer present because it is no longer needed (whether or not a repository is a replication repository is now automatically determined). </p><h4>Rfe14770 - Error message from agload loses most of the detail</h4><p>When using <a href="agload.html">agtool load</a> the error messages signaled while loading triples were truncated. This is now corrected. </p><h4>Rfe14389: AllegroGraph no longer supports Callimachus</h4><p>AllegroGraph no longer supports Callimachus. Stores that were previously set up to integrate with Callimachus will open normally but they will no longer execute the Callimachus integration code. </p><h4>Bug25087 - TempDir is not being used for placing temporary query files</h4><p>Temporary query files were being placed in the repository's directory rather than in the location specified by the TempDir configuration parameter. This has been corrected. </p><h4>Bug25075 - Bidirectional search can return bad paths</h4><p>If there were many possible overlapping bidirectional paths between two nodes, AllegroGraph could return incorrect paths. This has been corrected. </p><h4>Bug25102 - Subscript UPIs did not print correctly.</h4><p>AllegroGraph was printing the prefix of a subscript UPIs twice. This has been corrected. Previously, they would print as </p>
<pre><code>&lt;http://franz.com/ns/allegrograph/4.14/index#_http://franz.com/ns/allegrograph/4.14/index#_4&gt; </code></pre><p>Now they print as </p>
<pre><code>&lt;http://franz.com/ns/allegrograph/4.14/index#_4&gt;  
</code></pre><h4>Bug25062 - Fix uninformative error when running agraph-control as root.</h4><p>When running agraph-control as root when there was no RunAs directive in agraph.cfg would result in the following uninformative error: </p>
<pre><code>Got error while executing plan: `nil' is not of the expected type  
`(array character (*))' for foreign type `(* :char)' </code></pre><p>Now the error messages generated for no RunAs user and non-existent RunAs user, respectively, are: </p>
<pre><code># bin/agraph-control --config lib/agraph.cfg start  
Running AllegroGraph as superuser is not recommended for security reasons.  
It is recommended that another less privileged user be used, specified  
via the `RunAs' directive in agraph.cfg.  
 
# bin/agraph-control --config lib/agraph.cfg start  
RunAs user `UserThatDoesNotExist' does not exist in the passwd database.  
 
Please run the AllegroGraph configuration script or adjust the `RunAs'  
directive in lib/agraph.cfg  
 
</code></pre><a name='header3-224' id='header3-224'></a><h3>HTTP API</h3><h4>Rfe15418 - Allow specifying string table compression method</h4><p>Added a <code>stringTableCompression</code> parameter to the repository creation HTTP service. </p><a name='header3-227' id='header3-227'></a><h3>SPARQL</h3><h4>Rfe15421 - Add control over duplicate triple reduction in SPARQL queries</h4><p>AllegroGraph now has a new query option: <code>enableDuplicateReduction</code> which controls whether or not the SPARQL engine reduces the number of duplicate triples it processes. See <a href="sparql-reference.html#sparql-queryoptions">SPARQL Query Options</a> in the <a href="sparql-reference.html">SPARQL Reference</a> document. </p><p>If the store has no duplicate triples (based on subject, predicate, object, and graph) then this option has no effect. </p><p>SPARQL is defined on sets of triples (i.e., no duplicates) but AllegroGraph can store duplicates which can lead to duplicate rows of bindings returned by a query. </p><p>If this option is set to <code>true</code>, then AllegroGraph will ignore consecutive duplicate triples returned from the storage layer. Since the storage layer makes no guarentees on the order of triples it returns, this can lead to different results from the same query. </p><p><strong>Note</strong>: Previous versions of AllegroGraph used duplicate reduction by default. This version turns if off by default. If your triple-store has duplicate triples, then this may change the results of your queries. </p><h4>Rfe15419 - Include query modifiers when printing a SPARQL query plan</h4><p>AllegroGraph now includes query modifiers like ORDER BY or LIMIT when it prints a query plan. </p><h4>Rfe15391 - Warn when the variable HOST of a SERVICE clause is not bound</h4><p>AllegroGraph now warns when the HOST variable of a SERVICE clause is unbound in the query. </p><p>For example, both of these queries will produce query warnings: </p>
<pre><code># Query 1  
select * {  
 {  
   :myService :isAtURL ?url  
 } union {  
   service ?url { ?s ?p ?o }  
 }  
}  
 
# Query 2  
select * { service ?unknown { ?s ?p ?o } } </code></pre><h4>Rfe15354 - Improve handling of queries containing GRAPH and JOIN clauses</h4><p>AllegroGraph will now handle queries involving GRAPH and JOIN clauses more efficiently. </p><h4>Rfe15336 - Sanity check on JSON/XML data returned by SPARQL endpoint</h4><p>If a SPARQL query includes a SERVICE call, the XML and JSON result data is now subject to more syntactic and semantic error checking. Nevertheless invalid result data from third parties might still lead to unexpected outcomes. </p><h4>Rfe15273 - Add Javascript API for defining SPARQL extensions</h4><p>AllegroGraph's server side Javascript engine now supports the following: </p>
<ul>
<li>sparql.extensionFunctions() - return a list of SPARQL extension function names.</li>
<li>sparql.defineExtensionFunction(uri, function) - define a new extension function    associated with <code>uri</code>. </li>
<li>sparql.magicProperties() - return a list of magic property URIs.</li>
<li>sparql.defineMagicProperty(uri, parameters) - define a new SPARQL magic    property. </li></ul><p>For details, see the Javascript documentation. </p><h4>Bug25145 - Illegal keyword error when executing some queries</h4><p>AllegroGraph could signal an Illegal Keyword error when executing some complex queries. This has been corrected. </p><h4>Bug25113: SPARQL planner stopped optimizing certain queries</h4><p>If a query has a FILTER like </p>
<pre><code>FILTER( ?var1 = ?var2 ) </code></pre><p>and it can be determined that both <code>?var1</code> and <code>?var2</code> are resources, then AllegroGraph can perform certain query optimizations. This feature was inadvertently broken in AllegroGraph 6.4 and has now been reinstated. </p><h4>Bug25097 - Graph not in dataset warning signaled inappropriately</h4><p>AllegroGraph v6.3.0 and following signal a query warning if the graph in a GRAPH clause is not in the dataset as in, for example, this query: </p>
<pre><code>select *  
from named &lt;http://example.com#graph&gt; {  
  graph &lt;http://example.org#otherGraph&gt; { ?s ?p ?o }  
} </code></pre><p>AllegroGraph was signaling this warning more often than necessary. This has been corrected. </p><h4>Bug25064 - GROUP BY expressions in a SUB-QUERY causes an error</h4><p>AllegroGraph was signaling an error if a SPARQL query used GROUP BY expressions in a SUB-QUERY. This has been corrected. An example query that used to fail would be </p>
<pre><code>select * {  
  { select ?strWho (sum(?amount) as ?sum) {  
      ?who ?p ?amount .  
    } group by (str(?who) as ?strWho)  
  }  
}  
</code></pre><h4>Bug25057 - Values and OPTIONAL could lead to too many results</h4><p>If a SPARQL query used a VALUES form inside the query and the VALUES form had only a single variable and a single binding for that variable and the query also used an OPTIONAL form that made use of the same variable, then AllegroGraph could return results with the variable unbound. This has been corrected. </p><p>As an example, AllegroGraph previously could have returned results with <code>?o2</code> unbound for the following query: </p>
<pre><code>SELECT ?s ?o1 ?o2 {  
  ?s ?p1 ?o1  
  OPTIONAL { ?s foaf:knows ?o2 }  
  VALUES (?o2) { (:b) }  
} </code></pre><h4>Bug25055 - Improve SPARQL parser error message for bad aggregation expression</h4><p>AllegroGraph was signaling an error for bad aggregation expressions rather than indicating that the query failed to parse. For example, this query is invalid because it is illegal to GROUP BY an aggreagate: </p>
<pre><code>select (sum(?o) as ?sum) (sample(?s) as ?ss) {  
  ?s ?p ?o .  
} group by (sum(?o) as ?xxx) having (?xxx &gt; 2) </code></pre><p>AllegroGraph now signals a SPARQL parser error for queries like this. </p><h4>Bug25034 - Catch additional SPARQL parse errors</h4><p>SPARQL is defined such that repeated variables in the projection are ignored. Previously, AllegroGraph would include each repeated variable. Now, it will include only the first instance and will warn if the list includes repetition. </p><p>For example, this query: </p>
<pre><code>SELECT ?s ?g ?s { graph ?g { ?s ?p ?o } } </code></pre><p>Will project only <code>?s</code> and <code>?g</code> and will warn that "The following variable is projected multiple times: ?s. Only the first projection will be included". </p><p>The variables in expressions and aggregation specifications may not overlap with other projected variables. AllegroGraph now catches errors like: </p>
<pre><code>SELECT ?o (str(?o) as ?o) {  
  ?s ?p ?o .  
} </code></pre><p>or </p>
<pre><code>SELECT ?s (count(1) as ?s) {  
  ?s ?p ?o .  
} GROUP BY ?s </code></pre><p>Previously, the above queries would have passed the parser. </p><a name='header3-282' id='header3-282'></a><h3>AGWebView</h3><h4>Rfe15395 - Highlight all instances of the token under cursor in the query editor</h4><p>AGWebView's SPARQL query editor now highlights any tokens that match the one currently under the cursor. This makes it easier to ensure that variable names are not mistyped. </p><a name='header3-285' id='header3-285'></a><h3>Changes to the Lisp API</h3><h4>rfe15430 Use of next-encoded-upi-for-prefix in multi-master cluster instances</h4><p>In order to use <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a> when the repository is a multi-master cluster instance, the template associated with the encoded id prefix must generate exactly 2^60 distinct strings. If it does not, the call to <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a> will signal an error.  As noted just below, the "plain" will work as a template. See <a href="lisp-reference.html#register-encoded-id-prefix" title="description of register-encoded-id-prefix">register-encoded-id-prefix</a>. </p><h4>Rfe15466 - Plain format encoded ids</h4><p><a href="lisp-reference.html#register-encoded-id-prefix" title="description of register-encoded-id-prefix">register-encoded-id-prefix</a> will treat the <code>format</code> argument of "plain" (a string) in this special way: The encoded id (the string after the @@) is a variable length integer in the range from 0 to (2^60 -1), much like blank nodes. This is a template suitable for use in multi-master cluster instances. See the <a href="encoded-ids.html">Encoded IDs</a> document. </p><h4>rfe15430 Use of next-encoded-upi-for-prefix in multi-master cluster instances</h4><p>In order to use <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a> when the repository is a multi-master cluster instance, the template associated with the encoded id prefix must generate exactly 2^60 distinct strings. If it does not, the call to <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a> will signal an error.  As noted just above, the "plain" will work as a template. See <a href="lisp-reference.html#register-encoded-id-prefix" title="description of register-encoded-id-prefix">register-encoded-id-prefix</a>. </p><h4>Rfe15379 - Remove in-line-data argument from the run-sparql</h4><p>The <code>in-line-data</code> argument to <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> is no longer supported. If you need to execute the same basic query with different sets of BINDINGS, then use the VALUES form in your SPARQL query string. </p><h4>Rfe15373 - Export peekable-cursors</h4><p>The Lisp API now includes these new functions: </p>
<ul>
<li><a href="lisp-reference.html#make-peekable-cursor" title="description of make-peekable-cursor">make-peekable-cursor</a></li>
<li><a href="lisp-reference.html#cursor-peek" title="description of cursor-peek">cursor-peek</a></li>
<li><a href="lisp-reference.html#make-triples-peekable-cursor" title="description of make-triples-peekable-cursor">make-triples-peekable-cursor</a></li></ul><p>A peekable-cursor is like a regular cursor except <a href="lisp-reference.html#cursor-peek" title="description of cursor-peek">cursor-peek</a> can be used to see what <a href="lisp-reference.html#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> will return <em>without</em> modifying the state of the cursor. See <a href="lisp-reference.html#peek-cursor">the documentation</a> for details. </p><h4>Bug25119 - load-turtle not accepting a :base-uri arg in remote lisp client</h4><p>The remote lisp client did not support the <code>base-uri</code> argument to <a href="lisp-reference.html#load-turtle" title="description of load-turtle">load-turtle</a>. This has been corrected. </p><h4>Bug25070 - upi-&gt;value uses <em>db</em> when decoded encoded IDs</h4><p>The <a href="lisp-reference.html#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> function was using <a href="lisp-reference.html#variable.:2Adb:2A" title="description of variable *db*"><em>db</em></a> to decode encoded IDs even when a specific value for <code>db</code> was passed into the function. This has been corrected. </p><h4>Bug25043 - get-triples-nd-* functions were incompletely documented</h4><p>The various nD get-triples functions (like <a href="lisp-reference.html#function.get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a>) return <code>:part-not-found</code> as a second return value if it can be determined that one of the search parameters is definitely not in the repository. This is now documented. </p><h4>Bug23635: Make Lisp client :default-graph-uris keyword work with remote-triple-stores</h4><p>SPARQL queries made against remote-triple-stores via <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a>, that passed the <code>:default-graph-uris</code> keyword argument, would not return expected results. This has now been fixed. </p><a name='header3-308' id='header3-308'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-310' id='header3-310'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-312' id='header3-312'></a><h3>nD Geospatial</h3><h4>Rfe13347 - Automatic nD datatype mapping is now on for new repositories</h4><p>AllegroGraph now creates new repositories with automatic N-dimensional (nD) datatype mapping enabled. This means that adding triples with nD objects will add the necessary type mapping with no further intervention. See <a href="geospatial-nd.html#geo-automation">nD Geospatial Automation</a> for details and a linke to further discussion in the geospatial examples document. </p><h4>Bug25129: Bus error on geospatial search with a non-existing predicate</h4><p>The bus error on the server happened when trying to obtain triples from polygon using predicate that was not previously added to the store. </p><p>Behaviour for obtaining triples from polygons was modified to properly handle this case. </p>  <p><a name="changes-640"></a> </p><a name='header2-321' id='header2-321'></a><h2>AllegroGraph 6.4.0</h2><a name='header3-322' id='header3-322'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe15302 - Remove support for using rapper as an external parser</h4><p>The <code>use-rapper</code> argument to the AllegroGraph data import commands has been removed because AllegroGraph now supports all of the standard formats. </p><p>The <code>rapper</code> command line argument to <a href="agload.html">agtool load</a> has similarly been removed. </p><h4>Rfe15219 - Add timeout and limit arguments to the SNA path-finding functions</h4><p>The SNA path finding functions now have a <code>timeout</code> argument and a <code>limit</code> argument. The first specifies the number of seconds to execute the search whereas the second indicates that searching should stop once that many paths have been found. </p><p>The SNA path functions will return (as a second value) the status of the search. This will be either <code>nil</code> if the search was not interrupted, :timeout if the search reached the timeout, or :limit-reached if the limit on the number of paths was reached. </p><p>Note that the return format for the REST API to the SNA path functions is now versioned.  The desired version if specified via a <code>version</code> parameter in the query string. If the version is <code>1</code>, then the previous result format of a list of lists representing paths will be returned. Otherwise, the new format will be used. The new format consists of a JSON object with two keys: "paths" and "status". "paths" contains the list of paths and "status" contains the reason that the search completed. It will be one of "complete", "timeout", or "limit-reached". </p><h4>Bug24980 - Turtle serializer escapes the PNAME_NS incorrectly</h4><p>The Turtle serializer was escaping both the namespace portion and the local portion of a qualified name using the same logic. This was incorrect as the escaping for the two differ. The problem has been corrected. </p><a name='header3-332' id='header3-332'></a><h3>HTTP API</h3><p>No significant changes. </p><a name='header3-334' id='header3-334'></a><h3>SPARQL</h3><h4>Rfe15337 - Have the NOW() SPARQL function include a timezone</h4><p>The SPARQL NOW() function now returns dateTimes in GMT. Previously, the dateTimes had no explicit timezone. </p><h4>Rfe15259 - Add a query option to limit the size of query log entries</h4><p>AllegroGraph's SPARQL engine now truncates query log message to 512 characters by default. This limit can be changed by adding ":LINE_LENGTH" to the logQuery query option either in the AllegroGraph configuration file or on a per-query basis. For example, this PREFIX line will limit log lines to 100-characters: </p>
<pre><code>PREFIX franzOption_logQuery: &lt;franz:yes:100&gt; </code></pre><h4>Rfe15258 - Add <code>maximumValuesCountForService</code> query option</h4><p>AllegroGraph uses the SPARQL VALUES clause to pass partial results to SPARQL endpoints. In general this can help the endpoint compute its results more efficiently but when there are many values the cost of transmitting the data can outweigh these benefits. </p><p>The <code>maximumValuesCountForService</code> provides a mechanism to limit the total number of VALUES sent. </p><h4>Rfe15250 - Improve treatment of very large VALUES clauses</h4><p>The query planner now handles large VALUES clauses significantly faster. In addition, the query executor now decides whether to probe or scan based on the number of VALUES and the expected number of rows that a cursor will need to traverse. These two changes can make some queries significantly faster. </p><h4>Rfe11137: Support the TIMEZONE() and TZ() functions</h4><p>AllegroGraph now supports the SPARQL 1.1. TIMEZONE() and TZ() functions. </p><h4>Bug25003 - FILTERing on an expression like ( ! ?a = ?b ) caused an error</h4><p>The above expression evaluates as <code>(!?a) = ?b</code> and AllegroGraph was not correctly handling the expression of the inner negation operator. This has been corrected. </p><h4>Bug24985 - FILTER EXISTS and SUB-QUERY can lose solutions</h4><p>If a FILTER EXISTS clause started with a sub-query then AllegroGraph could fail to find some solutions. This has been corrected. </p><h4>Bug24657 - GRAPH filter can be applied to the wrong clause</h4><p>If a graph variable appeared in the subject, predicate, or object position of a triple-pattern, it was possible for AllegroGraph to apply a GRAPH dataset constraint to it incorrectly. For example, AllegroGraph could have incorrectly determined that the <code>?g1 :predicate1 ?object</code> pattern in the query below should be evaluated as if it was inside a GRAPH clause which could lead to incorrect results. </p>
<pre><code>select * {  
  GRAPH ?g1 { ?s1 ?p1 ?o1 } .  
  GRAPH ?g2 { ?s2 ?p2 ?o1 } .  
  ?g1 :predicate1 ?object .  
} </code></pre><p>This has been corrected. </p><h4>Bug24151 - Correct a SPARQL FILTER analysis issue</h4><p>AllegroGraph's SPARQL engine would signal an error if a FILTER contained an expression like </p>
<pre><code>str( ?varOne ) = ?varTwo </code></pre><p>This has been corrected. </p><h4>Bug20593 - Support the SPARQL 1.1 BNODE( identifier ) function</h4><p>AllegroGraph has long supported the BNODE() function with no arguments. It now also supports the version that takes a single plain literal or XSD string argument. </p><h4>Bug24076 - Improve handling of DBPedia.org and other Virtuoso servers as SPARQL endpoints.</h4><p>AllegroGraph works around an apparent problem with Virtuoso. </p><a name='header3-363' id='header3-363'></a><h3>AGWebView</h3><h4>Rfe11480 - Added <strong>Shutdown instance</strong> operation to <strong>Repository Control</strong> section in AGWebView </h4><p>See the <a href="agwebview.html#RepositoryOverviewPage">desription of the repository page</a> in the <a href="agwebview.html">WebView</a> document. </p><h4>Bug24949 - Overview page broken for remote sessions</h4><p>Opening a session to a single, remote store in WebView used to produce the following error message: </p><p>   Loading failed:    Service not supported in a session that does not wrap a single local store. </p><p>instead of the overview page. This has been corrected. </p><h4>Bug24929 - Help messages appear out of view.</h4><p>Help messages were often shown at the top of the Webview page, out of sight of the current page location. They will now be displayed in tooltips. </p><a name='header3-372' id='header3-372'></a><h3>Changes to the Lisp API</h3><p><a name="dbthread"></a> </p><h4>Rfe15325: Make <code>*db*</code> a required thread binding</h4><p>To help avoid accidental sharing of a repository connection between threads, each new thread will start with <code>*db*</code> bound to <code>nil</code>. Previously, <code>*db*</code> would retain its global value in new threads. </p><p>Given this sample code: </p>
<pre><code>(open-triple-store "test") ;; sets global value of *db*  
 
(mp:process-run-function "new thread"  
   (lambda ()  
     ;; The new thread wants its own connection to the repository  
     (open-triple-store "test"))) </code></pre><p>Prior to v6.4.0, the call to <a href="lisp-reference.html#open-triple-store" title="description of open-triple-store">open-triple-store</a> in "new thread" would overwrite the global value of <code>*db*</code>.  In v6.4.0, "new thread" will have its own binding of <code>*db*</code> and the global value will not be affected. </p><a name='header3-379' id='header3-379'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-381' id='header3-381'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-383' id='header3-383'></a><h3>nD Geospatial</h3><p>No significant changes. </p> <a name='header2-386' id='header2-386'></a><h2>User-visible changes in earlier releases</h2><p>See <a href="change-history.html" id="change-history-tab">Change History</a> for user-visible changes to earlier releases. </p></div>  <p><script> $.each($("#agmenu ul li a"), function(ignore, link) {   var anchor = $(link);   anchor.parent().on("click", function () { window.location = anchor.prop("href"); }); }); $("#agmenu").css("display", "block") </script> </p> 
</body>
</html>
