<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="author" content="Franz Incorporated"/>
<title>Change History | AllegroGraph 6.4.2</title>
<link rel='stylesheet' href='jquery-ui.custom.min.css' />
<link rel='stylesheet' href='stylesheet.css' />
<link rel='stylesheet' href='print.css' media='print' />
<body id="change-history"> <div id="header"> <p>                 </p>                <p><script src="jquery.min.js" type="text/javascript" charset="utf-8"></script> <script src="jquery-ui.custom.min.js" type="text/javascript" charset="utf-8"></script> <script src="activebookmark.js" type="text/javascript" charset="utf-8"></script> </p> <div id='search-form'>   <form method="GET" action="https://www.google.com/search">     <input type="hidden" name="as_sitesearch" value=""> </input>     <input type="text" size="40" name="as_q" value="" placeholder="Please enable JavaScript to use search!"> </input>&nbsp;     <input type="submit" value="Search" disabled> </input>   </form> </div> <script>    /* Docudown has no support for function calls in HTML attributes. 
<ul>
<li>Thus, we set the as_sitesearch attribute using JavaScript below.    */   (function () { 'use strict'; var properValue = "franz.com/agraph/support/documentation/6.4.2/"; var input = document.querySelector(   '#search-form input[name="as_sitesearch"]'); input.setAttribute('value', properValue); /* The submit button was disabled so that search would be 
<ul>
<li>impossible for users without JavaScript. Enabling now: */ document.querySelector('#search-form input[type="submit"]').   removeAttribute('disabled'); document.querySelector('#search-form input[name="as_q"]').   removeAttribute('placeholder');   })(); </script> <div id="copyright">  Copyright (c) 2005 - 2018 Franz, Incorporated</div> <div id="timestamp">  Last updated 8 June 2018 at 06:55</div> <a href="https://franz.com" alt="Franz Inc Home Page"><div id="hdLogo"> </div></a> </li></ul></li></ul>       <h1>AllegroGraph 6.4.2 Change History</h1></div> <div id="contents">  <div id="docIndex"> <ul id="agmenu"> <li><a href="index.html">Documentation Index</a> 
<ul>
<li><a href="release-notes.html">Release Notes</a></li>
<li><a href="agraph-quick-start.html">Quick Start</a></li>
<li><a href="agraph-introduction.html" id="agraph-introduction-tab">Introduction</a></li>
<li>Setup and Configuration
<ul>
<li><a href="http://franz.com/agraph/downloads/" target="_blank">Download</a></li>
<li><a href="server-installation.html">Server Installation</a></li>
<li><a href="daemon-config.html">Server Configuration and Control</a></li>
<li><a href="agwebview.html">WebView</a></li>
<li><a href="upgrade-guide.html">Database Upgrading</a></li></ul></li>
<li>Server Management
<ul>
<li><a href="performance-tuning.html">Performance Tuning</a></li>
<li><a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a></li>
<li><a href="purging-deleted-triples.html">Purging Deleted Triples</a></li>
<li><a href="audit.html">Auditing</a></li>
<li><a href="managing-users.html">Managing Users</a></li>
<li><a href="replication.html">Replication</a></li>
<li><a href="point-in-time-recovery.html">Point-in-Time Recovery</a></li>
<li><a href="transaction-log-archiving.html">Transaction Log Archiving</a></li>
<li><a href="security-overview.html">Security Overview</a></li>
<li><a href="security.html">Security Implementation</a></li></ul></li>
<li>Tools
<ul>
<li><a href="agtool.html">agtool</a></li>
<li><a href="agload.html">Data Loading</a></li>
<li><a href="agexport.html">Data Export</a></li>
<li><a href="backup-and-restore.html">Backup and Restore</a></li>
<li><a href="agquery.html">Querying</a></li>
<li><a href="reasoner-tutorial.html" id="reasoner-tutorial-tab">RDFS++</a></li>
<li><a href="materializer.html">Materializer</a></li></ul></li>
<li>Details
<ul>
<li><a href="triple-index.html">AllegroGraph Indices</a></li>
<li><a href="text-index.html">Full-text Indices</a></li>
<li><a href="encoded-ids.html">Encoded IDs</a></li>
<li><a href="connection-pooling.html">Connection Pooling</a></li>
<li><a href="geospatial-nd.html">N-dimensional Geospatial Overview</a></li>
<li><a href="magic-properties.html#sparql-magic-geo-2d">2-D Geospatial</a></li>
<li><a href="magic-properties.html#sparql-magic-temporal">Temporal</a></li>
<li><a href="magic-properties.html#sparql-magic-sna">Social Network</a></li>
<li><a href="javascript.html">JavaScript</a></li>
<li><a href="datatypes.html">Datatypes</a></li>
<li><a href="rapper.html">Data Conversion (Rapper)</a></li>
<li><a href="stored-procedures.html">Stored Procedures</a></li>
<li><a href="triple-attributes.html">Triple Attributes</a></li></ul></li>
<li>Querying
<ul>
<li><a href="sparql-overview.html">SPARQL documentation summary</a></li>
<li><a href="sparql-reference.html">SPARQL Reference</a></li>
<li><a href="spin.html">SPIN</a></li>
<li><a href="magic-properties.html">SPARQL Magic Properties</a></li>
<li><a href="prolog-tutorial.html">Prolog</a></li></ul></li>
<li>3rd-party tools
<ul>
<li><a href="solr-index.html">Solr text Indices</a></li>
<li><a href="mongo-interface.html">MongoDB integration</a></li>
<li><a href="TBCplugin.html">TopBraid Composer Plugin</a></li>
<li><a href="agraph-introduction.html#othertools">Cloudera</a></li></ul></li>
<li>Client APIs
<ul>
<li><a href="http://franz.com/agraph/gruff/" title="Gruff" target="_blank">Gruff</a></li>
<li><a href="http-protocol.html">REST/HTTP interface</a></li>
<li><a href="http-reference.html">HTTP reference</a></li>
<li><a href="javadoc/index.html">Javadocs (Sesame and Jena)</a></li>
<li><a href="python/index.html">Python API</a></li>
<li><a href="lisp-reference.html">Lisp Reference</a></li>
<li><a href="javascript.html">JavaScript</a></li></ul></li>
<li>Tutorials
<ul>
<li><a href="geospatial-nd-tutorial.html">N-dimensional Geospatial</a></li>
<li><a href="sparql-tutorial.html">SPARQL Tutorial</a></li>
<li><a href="java-tutorial/java-tutorial.html">Java Sesame</a></li>
<li><a href="java-tutorial/jena-tutorial.html">Java Jena</a></li>
<li><a href="python/tutorial.html">Python Sesame</a></li>
<li><a href="lisp-quickstart.html">Lisp</a></li>
<li><a href="prolog-tutorial.html">Prolog</a></li>
<li><a href="tutorial-index.html">More...</a></li></ul></li>
<li>Other
<ul>
<li><a href="suggested-reading.html">Suggested Reading</a></li>
<li><a href="http://franz.com/ps/services/conferences_seminars/" title="Conferences and Seminars" target="_blank">Conferences and Seminars</a></li>
<li><a href="http://github.com/franzinc">Source Code on Github</a></li>
<li><a href="http://agraph.franz.com/cresources/index.lhtml" target="_blank">Community Resources</a></li>
<li><a href="http://franz.com/agraph/ec2/">Amazon EC2</a></li>
<li><a href="copyrights.html">Copyrights</a></li>
<li><a href="change-history.html" id="change-history-tab">Change History</a></li></ul></li>
<li><a href="http://franz.com/" target="_blank">Franz, Inc.</a> </li> </ul> </li></ul><p><script> $(function() { $( "#agmenu" ).menu(); }); </script> </p></div>   
<div class='table-of-contents' id='table-of-contents'>

<ul>
<li><a href='#header2-10' title='AllegroGraph 6.4.2'>AllegroGraph 6.4.2</a>
<ul>
<li><a href='#header3-11' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-51' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-54' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-111' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-116' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-140' title='Prolog'>Prolog</a></li>
<li><a href='#header3-142' title='Documentation'>Documentation</a></li>
<li><a href='#header3-144' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-149' title='AllegroGraph 6.4.1'>AllegroGraph 6.4.1</a>
<ul>
<li><a href='#header3-150' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-189' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-192' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-247' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-250' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-273' title='Prolog'>Prolog</a></li>
<li><a href='#header3-275' title='Documentation'>Documentation</a></li>
<li><a href='#header3-277' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-286' title='AllegroGraph 6.4.0'>AllegroGraph 6.4.0</a>
<ul>
<li><a href='#header3-287' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-297' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-299' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-328' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-337' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-344' title='Prolog'>Prolog</a></li>
<li><a href='#header3-346' title='Documentation'>Documentation</a></li>
<li><a href='#header3-348' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-352' title='AllegroGraph 6.3.0'>AllegroGraph 6.3.0</a>
<ul>
<li><a href='#header3-354' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-398' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-401' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-435' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-452' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-458' title='Prolog'>Prolog</a></li>
<li><a href='#header3-460' title='Documentation'>Documentation</a></li>
<li><a href='#header3-462' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-467' title='AllegroGraph 6.2.3'>AllegroGraph 6.2.3</a>
<ul>
<li><a href='#header3-468' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-475' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-478' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-512' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-514' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-517' title='Prolog'>Prolog</a></li>
<li><a href='#header3-519' title='Documentation'>Documentation</a></li>
<li><a href='#header3-521' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-526' title='AllegroGraph 6.2.2'>AllegroGraph 6.2.2</a>
<ul>
<li><a href='#header3-527' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-562' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-567' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-605' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-612' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-622' title='Prolog'>Prolog</a></li>
<li><a href='#header3-624' title='Documentation'>Documentation</a></li>
<li><a href='#header3-626' title='Python Client'>Python Client</a></li>
<li><a href='#header3-637' title='Java Client'>Java Client</a></li>
<li><a href='#header3-653' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-658' title='AllegroGraph 6.2.1'>AllegroGraph 6.2.1</a>
<ul>
<li><a href='#header3-659' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-678' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-680' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-699' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-701' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-705' title='Prolog'>Prolog</a></li>
<li><a href='#header3-707' title='Documentation'>Documentation</a></li>
<li><a href='#header3-709' title='Python Client'>Python Client</a></li>
<li><a href='#header3-716' title='Java Client'>Java Client</a></li>
<li><a href='#header3-718' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-723' title='AllegroGraph 6.2.0'>AllegroGraph 6.2.0</a>
<ul>
<li><a href='#header3-724' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-757' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-760' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-778' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-783' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-796' title='Prolog'>Prolog</a></li>
<li><a href='#header3-798' title='Documentation'>Documentation</a></li>
<li><a href='#header3-800' title='Python Client'>Python Client</a></li>
<li><a href='#header3-802' title='Java Client'>Java Client</a></li>
<li><a href='#header3-804' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-809' title='AllegroGraph 6.1.6'>AllegroGraph 6.1.6</a>
<ul>
<li><a href='#header3-810' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-822' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-824' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-827' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-829' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-831' title='Prolog'>Prolog</a></li>
<li><a href='#header3-833' title='Documentation'>Documentation</a></li>
<li><a href='#header3-836' title='Python Client'>Python Client</a></li>
<li><a href='#header3-848' title='Java Client'>Java Client</a></li>
<li><a href='#header3-850' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-855' title='AllegroGraph 6.1.5'>AllegroGraph 6.1.5</a>
<ul>
<li><a href='#header3-856' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-861' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-863' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-866' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-869' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-871' title='Prolog'>Prolog</a></li>
<li><a href='#header3-873' title='Documentation'>Documentation</a></li>
<li><a href='#header3-875' title='Python Client'>Python Client</a></li>
<li><a href='#header3-877' title='Java Client'>Java Client</a></li>
<li><a href='#header3-879' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-884' title='AllegroGraph 6.1.4'>AllegroGraph 6.1.4</a>
<ul>
<li><a href='#header3-885' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-907' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-909' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-914' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-916' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-932' title='Prolog'>Prolog</a></li>
<li><a href='#header3-934' title='Documentation'>Documentation</a></li>
<li><a href='#header3-936' title='Python Client'>Python Client</a></li>
<li><a href='#header3-944' title='Java Client'>Java Client</a></li>
<li><a href='#header3-946' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-951' title='AllegroGraph 6.1.3'>AllegroGraph 6.1.3</a>
<ul>
<li><a href='#header3-952' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-962' title='HTTP API'>HTTP API</a></li>
<li><a href='#header3-964' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-969' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-975' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-977' title='Prolog'>Prolog</a></li>
<li><a href='#header3-979' title='Documentation'>Documentation</a></li>
<li><a href='#header3-981' title='Python Client'>Python Client</a></li>
<li><a href='#header3-986' title='Java Client'>Java Client</a></li>
<li><a href='#header3-990' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-995' title='AllegroGraph 6.1.2'>AllegroGraph 6.1.2</a>
<ul>
<li><a href='#header3-996' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-1002' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-1004' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-1006' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-1015' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-1018' title='Prolog'>Prolog</a></li>
<li><a href='#header3-1020' title='Documentation'>Documentation</a></li>
<li><a href='#header3-1022' title='Python Client'>Python Client</a></li>
<li><a href='#header3-1024' title='Java Client'>Java Client</a></li>
<li><a href='#header3-1026' title='Javascript Client'>Javascript Client</a></li>
<li><a href='#header3-1029' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-1033' title='AllegroGraph 6.1.1'>AllegroGraph 6.1.1</a>
<ul>
<li><a href='#header3-1034' title='AllegroGraph Server: General Changes'>AllegroGraph Server: General Changes</a></li>
<li><a href='#header3-1045' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-1047' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-1049' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-1054' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-1058' title='Prolog'>Prolog</a></li>
<li><a href='#header3-1060' title='Documentation'>Documentation</a></li>
<li><a href='#header3-1062' title='Python Client'>Python Client</a></li>
<li><a href='#header3-1064' title='Java Client'>Java Client</a></li>
<li><a href='#header3-1066' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-1071' title='AllegroGraph 6.1'>AllegroGraph 6.1</a>
<ul>
<li><a href='#header3-1072' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-1123' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-1132' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-1192' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-1232' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-1250' title='Prolog'>Prolog</a></li>
<li><a href='#header3-1253' title='Documentation'>Documentation</a></li>
<li><a href='#header3-1258' title='Python Client'>Python Client</a></li>
<li><a href='#header3-1263' title='Java Client'>Java Client</a></li>
<li><a href='#header3-1265' title='Geospatial'>Geospatial</a></li></ul></li>
<li><a href='#header2-1278' title='AllegroGraph 6.0.2 user-visible changes'>AllegroGraph 6.0.2 user-visible changes</a>
<ul>
<li><a href='#header3-1279' title='Prolog'>Prolog</a></li></ul></li>
<li><a href='#header2-1283' title='AllegroGraph 6.0.1'>AllegroGraph 6.0.1</a>
<ul>
<li><a href='#header3-1285' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-1298' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-1304' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-1307' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-1312' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-1315' title='Prolog'>Prolog</a></li>
<li><a href='#header3-1320' title='Documentation'>Documentation</a></li>
<li><a href='#header3-1322' title='Python Client'>Python Client</a></li>
<li><a href='#header3-1325' title='Java Client'>Java Client</a></li>
<li><a href='#header3-1327' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-1332' title='AllegroGraph 6.0'>AllegroGraph 6.0</a>
<ul>
<li><a href='#header3-1333' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-1404' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-1427' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-1497' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-1506' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-1540' title='Prolog'>Prolog</a></li>
<li><a href='#header3-1545' title='Documentation'>Documentation</a></li>
<li><a href='#header3-1547' title='Python Client'>Python Client</a></li>
<li><a href='#header3-1550' title='Java Client'>Java Client</a></li>
<li><a href='#header3-1552' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-1557' title='AllegroGraph 5.1.2'>AllegroGraph 5.1.2</a>
<ul>
<li><a href='#header3-1558' title='Server Changes'>Server Changes</a></li></ul></li>
<li><a href='#header2-1563' title='AllegroGraph 5.1.1'>AllegroGraph 5.1.1</a>
<ul>
<li><a href='#header3-1565' title='Server Changes'>Server Changes</a></li></ul></li>
<li><a href='#header2-1578' title='AllegroGraph 5.1'>AllegroGraph 5.1</a>
<ul>
<li><a href='#header3-1579' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-1596' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-1599' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-1662' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-1664' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-1677' title='nD Geospatial'>nD Geospatial</a></li></ul></li>
<li><a href='#header2-1682' title='AllegroGraph 5.0.1'>AllegroGraph 5.0.1</a>
<ul>
<li><a href='#header3-1683' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-1686' title='HTTP Client'>HTTP Client</a></li></ul></li>
<li><a href='#header2-1689' title='AllegroGraph 5.0'>AllegroGraph 5.0</a>
<ul>
<li><a href='#header3-1690' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-1735' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-1748' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-1803' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-1816' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-1829' title='Prolog'>Prolog</a></li>
<li><a href='#header3-1831' title='N-dimensional geospatial'>N-dimensional geospatial</a></li>
<li><a href='#header3-1840' title='Documentation'>Documentation</a></li>
<li><a href='#header3-1842' title='Python Client'>Python Client</a></li>
<li><a href='#header3-1844' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-1861' title='AllegroGraph 4.14.1'>AllegroGraph 4.14.1</a>
<ul>
<li><a href='#header3-1862' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-1887' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-1892' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-1905' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-1908' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-1911' title='Prolog'>Prolog</a></li>
<li><a href='#header3-1913' title='Documentation'>Documentation</a></li>
<li><a href='#header3-1915' title='Python Client'>Python Client</a></li>
<li><a href='#header3-1920' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-1925' title='AllegroGraph 4.14'>AllegroGraph 4.14</a>
<ul>
<li><a href='#header3-1926' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-2008' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-2034' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-2113' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-2134' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-2152' title='Prolog'>Prolog</a></li>
<li><a href='#header3-2155' title='Documentation'>Documentation</a></li>
<li><a href='#header3-2157' title='Python Client'>Python Client</a></li>
<li><a href='#header3-2159' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-2166' title='AllegroGraph 4.13.2'>AllegroGraph 4.13.2</a></li>
<li><a href='#header2-2168' title='AllegroGraph 4.13.1'>AllegroGraph 4.13.1</a>
<ul>
<li><a href='#header3-2169' title='Server Changes'>Server Changes</a></li></ul></li>
<li><a href='#header2-2172' title='AllegroGraph 4.13'>AllegroGraph 4.13</a>
<ul>
<li><a href='#header3-2173' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-2213' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-2216' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-2291' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-2294' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-2304' title='Prolog'>Prolog</a></li>
<li><a href='#header3-2311' title='Documentation'>Documentation</a></li>
<li><a href='#header3-2313' title='Python Client'>Python Client</a></li>
<li><a href='#header3-2315' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-2317' title='AllegroGraph 4.12.2'>AllegroGraph 4.12.2</a>
<ul>
<li><a href='#header3-2318' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-2385' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-2387' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-2400' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-2402' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-2405' title='Prolog'>Prolog</a></li>
<li><a href='#header3-2407' title='Documentation'>Documentation</a></li>
<li><a href='#header3-2409' title='Python Client'>Python Client</a></li>
<li><a href='#header3-2411' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-2413' title='AllegroGraph 4.12'>AllegroGraph 4.12</a>
<ul>
<li><a href='#header3-2414' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-2477' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-2479' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-2626' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-2629' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-2658' title='Prolog'>Prolog</a></li>
<li><a href='#header3-2669' title='Documentation'>Documentation</a></li>
<li><a href='#header3-2671' title='Python Client'>Python Client</a></li>
<li><a href='#header3-2673' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-2676' title='AllegroGraph 4.11'>AllegroGraph 4.11</a>
<ul>
<li><a href='#header3-2677' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-2800' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-2804' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-2857' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-2860' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-2865' title='Documentation'>Documentation</a></li>
<li><a href='#header3-2867' title='Python Client'>Python Client</a></li>
<li><a href='#header3-2869' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-2878' title='AllegroGraph 4.10'>AllegroGraph 4.10</a>
<ul>
<li><a href='#header3-2879' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-2964' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-2970' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-3016' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-3018' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-3023' title='Documentation'>Documentation</a></li>
<li><a href='#header3-3025' title='Python Client'>Python Client</a></li>
<li><a href='#header3-3027' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-3032' title='AllegroGraph 4.9'>AllegroGraph 4.9</a>
<ul>
<li><a href='#header3-3033' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-3135' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-3148' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-3236' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-3267' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-3274' title='Documentation'>Documentation</a></li>
<li><a href='#header3-3276' title='Python Client'>Python Client</a></li>
<li><a href='#header3-3279' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-3286' title='AllegroGraph 4.8'>AllegroGraph 4.8</a>
<ul>
<li><a href='#header3-3287' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-3327' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-3332' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-3364' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-3366' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-3368' title='Documentation'>Documentation</a></li>
<li><a href='#header3-3370' title='Python Client'>Python Client</a></li>
<li><a href='#header3-3373' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-3380' title='AllegroGraph 4.7'>AllegroGraph 4.7</a>
<ul>
<li><a href='#header3-3381' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-3417' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#sparqlchanges' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-3496' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-3519' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-3525' title='Documentation'>Documentation</a></li>
<li><a href='#header3-3528' title='Python Client'>Python Client</a></li>
<li><a href='#header3-3535' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-3546' title='AllegroGraph 4.6'>AllegroGraph 4.6</a>
<ul>
<li><a href='#header3-3547' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-3627' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-3632' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-3694' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-3708' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-3718' title='Documentation'>Documentation</a></li>
<li><a href='#header3-3720' title='Python Client'>Python Client</a></li>
<li><a href='#header3-3726' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-3743' title='AllegroGraph 4.5'>AllegroGraph 4.5</a>
<ul>
<li><a href='#header3-3744' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-3778' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-3786' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-3847' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-3852' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-3854' title='Documentation'>Documentation</a></li>
<li><a href='#header3-3857' title='Python Client'>Python Client</a></li>
<li><a href='#header3-3860' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-3870' title='AllegroGraph 4.4.0.1'>AllegroGraph 4.4.0.1</a>
<ul>
<li><a href='#header3-3871' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-3876' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-3878' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-3903' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-3912' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-3915' title='Documentation'>Documentation</a></li>
<li><a href='#header3-3917' title='Python Client'>Python Client</a></li>
<li><a href='#header3-3919' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-3922' title='AllegroGraph 4.4'>AllegroGraph 4.4</a>
<ul>
<li><a href='#header3-3923' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-3974' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-3976' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-3992' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-3999' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-4003' title='Documentation'>Documentation</a></li>
<li><a href='#header3-4005' title='Python Client'>Python Client</a></li>
<li><a href='#header3-4010' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-4019' title='AllegroGraph 4.3.3'>AllegroGraph 4.3.3</a>
<ul>
<li><a href='#header3-4020' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-4033' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-4035' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-4037' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-4039' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-4041' title='Documentation'>Documentation</a></li>
<li><a href='#header3-4043' title='Python Client'>Python Client</a></li>
<li><a href='#header3-4045' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-4048' title='AllegroGraph 4.3.2'>AllegroGraph 4.3.2</a>
<ul>
<li><a href='#header3-4049' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-4051' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-4054' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-4056' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-4058' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-4060' title='Documentation'>Documentation</a></li>
<li><a href='#header3-4062' title='Python Client'>Python Client</a></li>
<li><a href='#header3-4064' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-4067' title='AllegroGraph 4.3.1'>AllegroGraph 4.3.1</a>
<ul>
<li><a href='#header3-4068' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-4089' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-4092' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-4095' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-4098' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-4100' title='Documentation'>Documentation</a></li>
<li><a href='#header3-4102' title='Python Client'>Python Client</a></li>
<li><a href='#header3-4104' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-4107' title='AllegroGraph 4.3'>AllegroGraph 4.3</a>
<ul>
<li><a href='#header3-4108' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-4146' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-4151' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-4156' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-4169' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-4179' title='Documentation'>Documentation</a></li>
<li><a href='#header3-4182' title='Python Client'>Python Client</a></li>
<li><a href='#header3-4184' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-4214' title='AllegroGraph 4.2.1c'>AllegroGraph 4.2.1c</a>
<ul>
<li><a href='#header3-4215' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-4224' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-4226' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-4228' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-4232' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-4235' title='Documentation'>Documentation</a></li>
<li><a href='#header3-4237' title='Python Client'>Python Client</a></li>
<li><a href='#header3-4239' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-4241' title='AllegroGraph 4.2.1a'>AllegroGraph 4.2.1a</a>
<ul>
<li><a href='#header3-4242' title='Server Changes'>Server Changes</a></li></ul></li>
<li><a href='#header2-4253' title='AllegroGraph 4.2.1.'>AllegroGraph 4.2.1.</a>
<ul>
<li><a href='#header3-4254' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-4335' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-4347' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-4388' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-4399' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-4411' title='Documentation'>Documentation</a></li>
<li><a href='#header3-4417' title='Python Client'>Python Client</a></li>
<li><a href='#header3-4430' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-4460' title='AllegroGraph 4.2'>AllegroGraph 4.2</a>
<ul>
<li><a href='#header3-4463' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-4594' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-4631' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-4650' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-4687' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-4705' title='Documentation'>Documentation</a></li>
<li><a href='#header3-4707' title='Python Client'>Python Client</a></li>
<li><a href='#header3-4714' title='Java Client'>Java Client</a></li></ul></li>
<li><a href='#header2-4738' title='AllegroGraph 4.1.1'>AllegroGraph 4.1.1</a>
<ul>
<li><a href='#header3-4740' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-4771' title='HTTP Client'>HTTP Client</a></li>
<li><a href='#header3-4779' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-4786' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-4823' title='Documentation'>Documentation</a></li></ul></li>
<li><a href='#header2-4846' title='AllegroGraph 4.1'>AllegroGraph 4.1</a>
<ul>
<li><a href='#header3-4891' title='Lisp Client'>Lisp Client</a></li>
<li><a href='#header3-4894' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-4901' title='AGWebView'>AGWebView</a></li>
<li><a href='#header3-4910' title='Documentation'>Documentation</a></li></ul></li>
<li><a href='#header2-4935' title='AllegroGraph 4.0.6a'>AllegroGraph 4.0.6a</a>
<ul>
<li><a href='#header3-4937' title='Server Changes'>Server Changes</a></li></ul></li>
<li><a href='#header2-4951' title='AllegroGraph 4.0.6'>AllegroGraph 4.0.6</a>
<ul>
<li><a href='#header3-4953' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-5071' title='HTTP Interface'>HTTP Interface</a></li>
<li><a href='#header3-5080' title='Documentation'>Documentation</a></li>
<li><a href='#header3-5083' title='Lisp Client'>Lisp Client</a></li>
<li><a href='#header3-5088' title='Python Client'>Python Client</a></li>
<li><a href='#header3-5093' title='Java Client'>Java Client</a></li>
<li><a href='#header3-5096' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-5103' title='WebView'>WebView</a></li></ul></li>
<li><a href='#header2-5110' title='AllegroGraph 4.0.5d'>AllegroGraph 4.0.5d</a>
<ul>
<li><a href='#header3-5112' title='Server Changes'>Server Changes</a></li></ul></li>
<li><a href='#header2-5115' title='AllegroGraph 4.0.5c'>AllegroGraph 4.0.5c</a>
<ul>
<li><a href='#header3-5117' title='Server Changes'>Server Changes</a></li></ul></li>
<li><a href='#header2-5126' title='AllegroGraph 4.0.5b'>AllegroGraph 4.0.5b</a>
<ul>
<li><a href='#header3-5128' title='Server Changes'>Server Changes</a></li></ul></li>
<li><a href='#header2-5134' title='AllegroGraph 4.0.5'>AllegroGraph 4.0.5</a>
<ul>
<li><a href='#header3-5136' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-5182' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-5187' title='Documentation'>Documentation</a></li>
<li><a href='#header3-5198' title='Java Client'>Java Client</a></li>
<li><a href='#header3-5201' title='Jena Client'>Jena Client</a></li></ul></li>
<li><a href='#header2-5204' title='AllegroGraph 4.0.4'>AllegroGraph 4.0.4</a>
<ul>
<li><a href='#header3-5206' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-5261' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-5264' title='Documentation'>Documentation</a></li>
<li><a href='#header3-5275' title='Text Indexing'>Text Indexing</a></li>
<li><a href='#header3-5280' title='WebView'>WebView</a></li></ul></li>
<li><a href='#header2-5283' title='AllegroGraph 4.0.3'>AllegroGraph 4.0.3</a>
<ul>
<li><a href='#header3-5285' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-5339' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-5347' title='Documentation'>Documentation</a></li>
<li><a href='#header3-5360' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-5363' title='Gruff'>Gruff</a></li></ul></li>
<li><a href='#header2-5376' title='AllegroGraph 4.0.2'>AllegroGraph 4.0.2</a>
<ul>
<li><a href='#header3-5378' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-5430' title='AllegroGraph Server: HTTP Interface'>AllegroGraph Server: HTTP Interface</a></li>
<li><a href='#header3-5449' title='Changes to the Lisp API'>Changes to the Lisp API</a></li>
<li><a href='#header3-5462' title='Documentation'>Documentation</a></li>
<li><a href='#header3-5482' title='Java Client'>Java Client</a></li>
<li><a href='#header3-5500' title='Python Client'>Python Client</a></li>
<li><a href='#header3-5509' title='Text Indexing'>Text Indexing</a></li>
<li><a href='#header3-5516' title='Changes to WebView'>Changes to WebView</a></li></ul></li>
<li><a href='#header2-5527' title='AllegroGraph 4.0.1'>AllegroGraph 4.0.1</a>
<ul>
<li><a href='#header3-5536' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-5548' title='Documentation'>Documentation</a></li></ul></li>
<li><a href='#header2-5553' title='AllegroGraph 4.0'>AllegroGraph 4.0</a>
<ul>
<li><a href='#header3-5561' title='Server Changes'>Server Changes</a></li>
<li><a href='#header3-5667' title='AllegroGraph Server: HTTP Interface'>AllegroGraph Server: HTTP Interface</a></li>
<li><a href='#header3-5716' title='Documentation'>Documentation</a></li>
<li><a href='#header3-5721' title='Java Client'>Java Client</a></li>
<li><a href='#header3-5739' title='Python Client'>Python Client</a></li></ul></li>
<li><a href='#header2-5764' title='AllegroGraph 4.0m2'>AllegroGraph 4.0m2</a>
<ul>
<li><a href='#header3-5765' title='General'>General</a></li>
<li><a href='#header3-5820' title='SPARQL'>SPARQL</a></li>
<li><a href='#header3-5832' title='Java Client'>Java Client</a></li>
<li><a href='#header3-5839' title='Python Client'>Python Client</a></li></ul></li>
<li><a href='#header2-5846' title='Changes to earlier releases'>Changes to earlier releases</a></li></ul>
<div id='tocLink'><a href='index.html'>Documentation Index</a></div>
</div>
  <div id="main-content">  <p><a name="changes-642"></a> </p><a name='header2-10' id='header2-10'></a><h2>AllegroGraph 6.4.2</h2><a name='header3-11' id='header3-11'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe15599 - Disallow creation of repos within the system catalog</h4><p>Attempts to create repositories in the system catalog will now be met with the following error message: </p>
<pre><code>Repositories cannot be created within the 'system' catalog </code></pre><h4>Rfe15528 - Increase speed of finding distinct predicates or graphs in a reasoning triple-store</h4><p>It is now much more efficient to find distinct predicates or graphs when RDFS++ or restriction reasoning is enabled. </p><h4>Rfe15492: Use triple-store-spec for certain agtools</h4><p>The following agtools (see <a href="agtool.html">agtool</a>) have had their syntax changed to use a triple-store specification instead of the options <code>--port</code>, <code>--user</code>, <code>--password</code>, <code>--host</code>, and <code>--catalog</code>. The affected tools are: cancel-purge-deleted-triples, define-attribute, delete-static-attribute-filter, get-metadata, lookup-attribute-definition, memory-lock, memory-unlock, purge-deleted-triples, purge-rate-limit, set-purge-rate-limit, set-static-attribute-filter. The triple-store specification is </p>
<pre><code>http(s):[//[USER:PASSWORD@]HOST[:PORT]][/catalogs/CATALOG]/repositories/REPO </code></pre><p>Items in brackets ([]) may be left out in some circumstances depending on what is required for the tool. </p><h4>Rfe15482 - Change if-exists default for agtool repl create-cluster</h4><p>In <strong>agtool repl create-cluster</strong> --if-exists argument used to default to supersede and now defaults to error. Existing scripts using agtool repl create-cluster may now fail to work until --if-exists supersede  is added to the argument list. </p><h4>Rfe15481 - Improve turtle serializer output for numbers</h4><p>AllegroGraph's Turtle and TriG serializers now emit integers, decimals and double floats using the more concise numeric representation rather than the full XSD typed literal one. </p><h4>Rfe14740 - agtool can now manipulate users and roles</h4><p>Added <strong>agtool user</strong> and <strong>agtool role</strong> commands to manipulate user accounts and roles respectively. For more infomation, execute: </p>
<pre><code>agtool user --help  
agtool role --help </code></pre><p>See the <a href="managing-users.html">Managing Users</a> document for further information. </p><h4>Rfe11183 - Add --optimize option to agload</h4><p><strong>agtool load</strong> now accepts the <code>--optimize</code> option to request full (level 2) index optimization after loading completes. See the <a href="agload.html">AllegroGraph Loader</a> document. Index optimization is discussed in the <a href="triple-index.html#optimize">Optimizing indices</a> section of the <a href="triple-index.html">Triple Indices</a> document. </p><h4>Bug25289 - Dropping a text index deletes files too early</h4><p>Dropping a freetext index could result in instance startup errors if the instance crashed before a checkpoint occurred. This has been fixed. </p><h4>Bug25288: Free Text Index state updates not recorded in tlog during commit</h4><p>Starting in AllegroGraph v6.3.0, changes in text index configuration (such as creation and removal) were not stored in the transaction log during commit. This could result in disappearance of an added text index, or reappearance of a deleted text index after a repository crash restart. This problem is now fixed. </p><h4>Bug25266 - sna:egoGroup function does not find its generator in all cases</h4><p>The functional form of the <code>sna:egoGroup</code> magic property did not look up and register its SNA generator function if the generator was stored using triples. This has been corrected. </p><h4>Bug25236 - Turtle serializer could emit invalid qnames</h4><p>It was possible for the Turtle serializer to produce invalid output if resources contained characters that needed to be escaped. This has been corrected. </p><h4>Bug25207 - Using Japanese tokenizer can result in errors</h4><p>Using the Japanese text index tokenizer on a system that does not have the <code>mecab</code> package installed would result in an error like the following: </p>
<pre><code>tagger.cpp(153) [load_dictionary_resource(param)] param.cpp(71)  
[ifs] no such file or directory: /etc/mecabrc </code></pre><p>This has been fixed. </p><h4>Bug25201 - agtool export output depends on the value of LANG</h4><p>It was possible for the value of the LANG environment variable to alter the output of <a href="agexport.html">agtool export</a>. This has been corrected. </p><h4>Bug25138 - agtool CMD will fail if run from a directory it cannot write to.</h4><p>If the current working directory is not writable <strong>agtool query</strong> and <strong>agtool materialize</strong> would stop running with an error the first time they try to write to their respective log files. Now this behavior has been changed to warn the user that it was unable to write to the log file and then continues processing. It continues logging to the terminal as it would normally do. See <a href="agtool.html">agtool General Command Utility</a> for a description of <strong>agtool</strong>. </p><h4>Bug25115 - 'agtool export' errors when using --parallel and exporting NQX</h4><p>Attempting to use <strong>agtool export</strong> with <code>--output nqx</code> and <code>--parallel</code> mode would result in an error like the following: </p>
<pre><code>error `#&lt;consumer-cursor @ #x1000991a312&gt; does not support extended-triples`  
occurred in worker 11  
interrupting... </code></pre><p>This has been fixed. </p><a name='header3-51' id='header3-51'></a><h3>HTTP API</h3><h4>Bug25246 - Improve HTTP socket reuse for remote repositories</h4><p>Queries on remote triple stores now reuse the same underlying HTTP socket connection for efficiency. </p><a name='header3-54' id='header3-54'></a><h3>SPARQL</h3><h4>Rfe15644 - Improve probing decision</h4><p>AllegroGraph decides at query time whether it is more efficient to scan or probe to evaluate a triple pattern. However, if a pattern had certain constraints on some of its variables, then AllegroGraph was unable to probe. Now AllegroGraph is able to probe in more cases which can greatly improve performance for particular queries. </p><h4>Rfe15628 - Handle query + filter patterns more efficiently</h4><p>AllegroGraph now handles SPARQL queries where a pattern in a BGP can act as a filter on the existing set of solutions. As an example, consider this query: </p>
<pre><code>:target :select ?s .  
?s :has ?property .  
?property rdf:type :animal . </code></pre><p>Prior to this change, AllegroGraph would first find all &lt;?s :has ?property&gt; triples and only then filter the results using the &lt;?property rdf:type :animal&gt; pattern. Depending on the shape of the dataset, this could generate a large number of intermediate results. AllegroGraph is now able to treat the &lt;?property rdf:type :animal&gt; pattern as a filter while evaluating the &lt;?s :has ?property&gt; pattern which can help speed the query. </p><h4>Rfe15607 - Sort language tagged literals sensibly</h4><p>The SPARQL 1.1 standard does not define an ordering on language tagged literals. AllegroGraph now orders language tagged literals by first comparing their languages and then their string values. Plain and <code>xsd:string</code> typed literals come before any language tagged literal. </p><h4>Rfe15600 - Remove and warn about unused BINDings</h4><p>AllegroGraph now issues a query warning if variables introduced by a BIND clause are not used elsewhere in the query. For example: </p>
<pre><code>select distinct ?o {  
  bind(23 as ?number)  
  ?s ?p ?o .  
}  
</code></pre><h4>Rfe15541 - Warn when a BIND form is extending an empty set of solutions</h4><p>The SPARQL BIND construct operates by extending an existing set of bindings. If there are no bindings, then there is nothing to extend and so the assignment will uniformly fail. AllegroGraph now warns when it encounters this situation. For example, </p>
<pre><code>SELECT ?ABC {  
  BIND(?s AS ?ABC)  
  ?s ?p ?o .  
} </code></pre><p>Previously, AllegroGraph was incorrectly rearranging the above query so that it would return bindings for <code>?ABC</code>. Now the above query will leave <code>?ABC</code> unbound and emit a :warn-empty-bind-clause warning. </p><h4>Rfe15524 - Improve SPARQL property path efficiency</h4><p>The data structures used to compute SPARQL property paths have been improved to provide better performance. </p><h4>Rfe15523 - Improve SPARQL dataset efficiency</h4><p>SPARQL datasets are now slightly more efficient when processing queries. </p><h4>Rfe15522 -  Use existing constant bindings when evaluating subsequent ones</h4><p>AllegroGraph now uses existing constant BINDings when evaluating subsequent ones during query planning rather than waiting until query execution. </p><h4>Rfe15515 - Support variable attributes in SPARQL attributes block</h4><p>AllegroGraph SPARQL now supports variable attributes for SPARQL update operations. For example, the query: </p>
<pre><code>prefix attr: &lt;http://franz.com/ns/allegrograph/6.2.0/&gt;  
insert {  
  attributes ?attr { ?s ex:newPredicate ?o . }  
} where {  
  ?attr attr:attributes (?s ex:oldPredicate ?o }  
} </code></pre><p>would replace each triple whose predicate was <code>ex:oldPredicate</code> with one having the predicate <code>ex:newPredicate</code> and the same attributes. </p><h4>Rfe15501 - Make better use of FILTER constraints in property path queries</h4><p>AllegroGraph now uses constraints derived from SPARQL property path queries in more cases. This can help to improve the performance of some queries. </p><h4>Rfe15413 - Improve handling of constant BIND expressions</h4><p>AllegroGraph now analyzes constant expressions in BIND forms and can use the results to improve the efficency of some queries. </p><p>For example, AllegroGraph previously would execute only the first of the following two logically equivalent queries efficiently: </p>
<pre><code># BIND with a constant  
select * {  
  bind( &lt;http://example.com#Mammal&gt; as ?Class )  
  ?a rdf:type ?Class .  
}  
 
# BIND with a constant _expression_  
select * {  
  bind( iri('http://example.com#Mammal') as ?Class )  
  ?a rdf:type ?Class .  
} </code></pre><p>Now both of the queries will execute efficiently. </p><h4>Rfe15381 - Allow federated geospatial query if one store has no geospatial mappings at all</h4><p>When executing SPARQL geospatial query on federated-triple-stores an error was thrown if federated stores had different geospatial type mappings. This was an overly strict limitation, so that error is now only thrown when regular type mappings differ. </p><h4>Bug25271: Fix "agtool query" on SPARQL endpoint</h4><p>Running a query on a SPARQL endpoint using "agtool query", e.g. </p>
<pre><code>./agtool query http://dbpedia.org/sparql </code></pre><p>would, after printing results, signal the error: </p>
<pre><code>Error "http://dbpedia.org/sparql" is not a triple store occurred during setup </code></pre><p>This has been resolved. </p><h4>Bug25268 - Correct handling of query log line length</h4><p>It was previously impossible to set the query log line length using the <code>logQuery</code> query option. The log length can now be set with the new <code>logLineLength</code> query parameter. </p><h4>Bug25247 - Some SPARQL sub-queries with external filters could fail.</h4><p>AllegroGraph could fail to correctly execute SPARQL queries when they involved a sub-query and FILTERs that applied to triple-patterns within the sub-query. For example: </p>
<pre><code>select ?s ?timestamp {  
  {  
    select distinct ?s ?timestamp {  
      ?s allegro:hasCreationDate ?timestamp .  
    }  
  }  
  FILTER (?timestamp &gt;= '2018-04-12T20:32:53.213Z'^^xsd:dateTime&gt;)  
  FILTER (?timestamp &lt;= '2018-04-15T20:32:53.213Z'^^xsd:dateTime&gt;)  
} </code></pre><p>This has been corrected. </p><h4>Bug25170 - Property path analysis of missing constants is too stringent</h4><p>AllegroGraph was marking some property path queries as if they were impossible when elements of the path were not found in the repository. This led to some queries failing to return results. The problem has been corrected. </p><h4>Bug25197 - Fix handling 'select *' results from remote endpoints</h4><p>Queries of the form <code>select * { .. }</code> sent to a non-AllegroGraph endpoint could fail with a "result variables are in wrong order" error even though the query results sent by the endpoint were valid. This has been fixed. </p><h4>Bug25169 - Impossible NOT EXISTS clauses should not make query impossible</h4><p>The logic that notices when parts of a SPARQL query cannot succeed and marks them as impossible was incorrectly treating NOT EXISTS filters as if they were EXISTS filters which led to some queries failing to return results. This has been corrected. </p><h4>Bug25151 - Problem with complex NOT EXISTS filters</h4><p>Queries that used [NOT] EXISTS in a FILTER could lead to an error if the query inside the [NOT] EXISTS contained language filters. </p><h4>Bug22482 - Improve property path estimates with fixed subject/object</h4><p>AllegroGraph now does a much better job of estimating the cost of transitive closure (i.e., zero-or-more and one-or-more) property path queries. These improved estimates can lead to greatly improved plans. </p><a name='header3-111' id='header3-111'></a><h3>AGWebView</h3><h4>Rfe15410: Add repository name and group columns to the AGWebView cluster table</h4><p>On the replication manager page in Webview columns were added to display the repository name and catalog as well as the group of each instance. See the <a href="multi-master.html#managing-clusters-webview">Managing Clusters Using AGWebView</a> section for information on the WebView cluster table. </p><h4>Bug25146: Ok button never reenabled after failed text area load</h4><p>In AllegroGraph WebView when importing statements from a text area input the OK button didn't reenable after the loading process had failed. This has been corrected. </p><a name='header3-116' id='header3-116'></a><h3>Changes to the Lisp API</h3><h4>Rfe15547 - Add type checking to the upi function</h4><p>The <a href="lisp-reference.html#upi" title="description of upi">upi</a> function now includes type checking so that it will signal a clearer error message if passed an argument of the wrong type. The function is now also defined on UPIs in addition to future-parts. </p><h4>Rfe15499 - delete-triple improvements</h4><p><a href="lisp-reference.html#delete-triple" title="description of delete-triple">delete-triple</a> now accepts a triple object as argument, as alternative to a triple id. </p><p>In either case the return value now indicates whether the deletion was successful. </p><h4>Rfe15483 - Add part-to-namespace to the Lisp API</h4><p>The Lisp API now includes <a href="lisp-reference.html#part-to-namespace" title="description of part-to-namespace">part-to-namespace</a>. This function takes a UPI, a future part, or a string representing a URI (with or without angle brackets) and returns the Prefixed Name and Local Part (as multiple values) if a registered namespace can be found to abbreviate the resource. For example: </p>
<pre><code>(part-to-namespace "&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;")  
==&gt;  
"rdf"  
"type"  
</code></pre><h4>Rfe14068 - Let run-sparql return query metadata for remote triple stores</h4><p>Calling the <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> function on a remote triple store now returns query metadata like timing information as fourth value, just as for local triple stores. </p><h4>Rfe8199 - Add a with-open-triple-store convenience macro</h4><p>The Lisp API now includes <a href="lisp-reference.html#with-open-triple-store" title="description of with-open-triple-store">with-open-triple-store</a> macro which opens a triple-store, executes the body, and then closes it. </p><h4>Bug25305 - Export cursor-peek from db.agraph package</h4><p>The <a href="lisp-reference.html#cursor-peek" title="description of cursor-peek">cursor-peek</a> function was introduced in AllegroGraph v6.4.1 but was not exported from the <code>db.agraph</code> package. The symbol is now exported and also available in the <code>db.agraph.user</code> package. </p><h4>Bug25192 - materialize-entailed-triples was not supported in the remote Lisp client</h4><p>Both <a href="materializer.html#materialize-entailed-triples" title="description of materialize-entailed-triples">materialize-entailed-triples</a> and <a href="materializer.html#delete-materialized-triples" title="description of delete-materialized-triples">delete-materialized-triples</a> are now available in the remote Lisp client. </p><h4>Bug25168 - Fix leaked http-cursor finalizer clash</h4><p>Cursors can be leaked, for example by using <code>return-from</code> inside <a href="lisp-reference.html#iterate-cursor" title="description of iterate-cursor">iterate-cursor</a>. These cursors are eventually garbage-collected. There was a finalizer race condition in the collection of HTTP connection based cursors, that would lead to <code>stream-closed-error</code> being signaled to the user unexpectedly. This has been resolved. </p><h4>Bug25168 - Improve cursor leak message for get-triples on remote-triple-store</h4><p>If <a href="lisp-reference.html#get-triples" title="description of get-triples">get-triples</a> is called on a remote-triple-store outside <a href="lisp-reference.html#with-query-environment" title="description of with-query-environment">with-query-environment</a>, the cursor will open an HTTP socket to the triple store. If the cursor is leaked it will be garbage-collected eventually, but until that moment the socket will be kept open. This can negatively impact performance, therefore a warning will now be logged: </p>
<pre><code>[2018-03-12T09:06:27.250 p13791 W cursor] Cursor created by  
(get-triples) on remote-triple-store "db" was leaked,  
will be closed. </code></pre><h4>Bug25166 - remote-triple-stores reason on the client rather than the server</h4><p>AllegroGraph now ensures that the dynamic reasoner will execute on the server rather than the client when using a remote-triple-store. This prevents a large number of <a href="lisp-reference.html#get-triples" title="description of get-triples">get-triples</a> from executing via HTTP when using the RDFS++ reasoner. </p><a name='header3-140' id='header3-140'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-142' id='header3-142'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-144' id='header3-144'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-641"></a> </p><a name='header2-149' id='header2-149'></a><h2>AllegroGraph 6.4.1</h2><a name='header3-150' id='header3-150'></a><h3>AllegroGraph Server: General Changes</h3><h4>New agtool commands and some changed arguments</h4><p>The <em>*agtool</em> command-line utility has new commands available. Further some commands have new arguments and some arguments have changed. See the <a href="agtool.html">agtool General Command Utility</a> document for details. Most commands now have a <code>--scheme</code> argument which can be <em>http</em> or <em>https</em>. </p><h4>agtool repl create-cluster adds --if-exists and --force arguments</h4><p><strong>agtool repl create-cluster</strong> previously would only create new, empty repositories and if an existing repository were specified, it would be deleted and a new, empty repository with the same name would be created. (This behavior differed from the behavior when creating clusters with AGWebView, where a repository had to exist and need not be empty when it was converted to an initial replication instance.) Now <strong>agtool repl create-cluster</strong> accepts an <code>--if-exists</code> argument with allowable values <em>supersede</em> (the default, meaning delete the existing repository and create a new one with the same name), <em>overwrite</em> (same as <em>supersede</em>), <em>use</em> (convert an existing, possibly non-empty repository), and <em>error</em> (signal an error if the repository specified already exists). </p><p>If <em>use</em> is specified, then any encoded id definitions will be examined and if any do not allow for 2^60 distinct strings and so will not work with <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a>, the conversion will fail and a warning will be printed. If the <code>--force</code> argument with value <code>true</code> is supplied, then the conversion will be done but none of the offending encoded id prefixes must be used again. </p><h4>The Cluster Replication Manager page now displays statistics</h4><p>These help users to monitor the state of the cluster.  See the <a href="multi-master.html#managing-clusters-webview">Managing clusters in AGWebView once created</a> section in the <a href="multi-master.html">Multi-master Replication</a> document. </p><h4>When adding a cluster instance in AGWebView, a progress log is displayed</h4><p>When adding an instance in Webview you'll see that the log of actions is updated with progress reports describing what is being done. Also the AGWebView replication manager page has new columns and some columns have been renamed. See <a href="multi-master.html#using-webview">here</a> for information on using AGWebView to manage clusters. </p><h4>Rfe15465 - Disallow setting bulk-load-mode in replication instance</h4><p>In a replication instance one cannot set bulk load mode since replication depends on the transaction logs being an accurate reflection of the changes to the repository and logging is disabled in bulk loading mode. Specifying the <code>--bulk</code> option to <strong>agtool load</strong> or clicking the <em>Use bulk load mode</em> checkbox when adding triples from an uploaded file in AGWebView will cause the load to fail. </p><h4>Rfe15451 - Don't fail if unable to write to agload.log</h4><p>If the current working directory is not writable <a href="agload.html">agload</a> would stop running with an error the first time it tries to write to the log file <em>agload.log</em>. Now this behavior has been changed to warn the user that it was unable to write to the log file and then continues processing. It continues logging to the terminal as it would normally do. </p><h4>Rfe15426 - Expose and document the --parameter option for agtool load</h4><p><a href="agload.html">agtool load</a> now accepts the <code>--parameter</code> option for controlling the configuration of newly created repositories. See <a href="agload.html#parameter-option">the --parameter option</a> in the <a href="agload.html">agtool load</a> document for details. </p><h4>Rfe15418 - Change StringTableCompression default to 'none'</h4><p>AllegroGraph now in the default creates new repositories with string compression disabled. This results in faster out-of-the-box operation. String compression can be enabled by using the <code>StringTableCompression</code> directive in <em>agraph.cfg</em>.  See the <a href="daemon-config.html#stringtablecompress">description of StringTableCompress</a> in the <a href="daemon-config.html">Server Configuration and Control</a> document for information. </p><p>Note that the string compression type can only been set when creating a new repository. The <code>StringTableCompression</code> parameter is further discussed <a href="performance-tuning.html#string-table-compression">here</a> in the <a href="performance-tuning.html">Performance Tuning</a> document. </p><h4>Rfe15190 - Remove --repl argument from agtool archive backup and agtool recover</h4><p>The <code>--repl</code> argument for <strong>agtool archive backup</strong> and <strong>agtool recover</strong> is no longer present because it is no longer needed (whether or not a repository is a replication repository is now automatically determined). </p><h4>Rfe14770 - Error message from agload loses most of the detail</h4><p>When using <a href="agload.html">agtool load</a> the error messages signaled while loading triples were truncated. This is now corrected. </p><h4>Rfe14389: AllegroGraph no longer supports Callimachus</h4><p>AllegroGraph no longer supports Callimachus. Stores that were previously set up to integrate with Callimachus will open normally but they will no longer execute the Callimachus integration code. </p><h4>Bug25087 - TempDir is not being used for placing temporary query files</h4><p>Temporary query files were being placed in the repository's directory rather than in the location specified by the TempDir configuration parameter. This has been corrected. </p><h4>Bug25075 - Bidirectional search can return bad paths</h4><p>If there were many possible overlapping bidirectional paths between two nodes, AllegroGraph could return incorrect paths. This has been corrected. </p><h4>Bug25102 - Subscript UPIs did not print correctly.</h4><p>AllegroGraph was printing the prefix of a subscript UPIs twice. This has been corrected. Previously, they would print as </p>
<pre><code>&lt;http://franz.com/ns/allegrograph/4.14/index#_http://franz.com/ns/allegrograph/4.14/index#_4&gt; </code></pre><p>Now they print as </p>
<pre><code>&lt;http://franz.com/ns/allegrograph/4.14/index#_4&gt;  
</code></pre><h4>Bug25062 - Fix uninformative error when running agraph-control as root.</h4><p>When running agraph-control as root when there was no RunAs directive in agraph.cfg would result in the following uninformative error: </p>
<pre><code>Got error while executing plan: `nil' is not of the expected type  
`(array character (*))' for foreign type `(* :char)' </code></pre><p>Now the error messages generated for no RunAs user and non-existent RunAs user, respectively, are: </p>
<pre><code># bin/agraph-control --config lib/agraph.cfg start  
Running AllegroGraph as superuser is not recommended for security reasons.  
It is recommended that another less privileged user be used, specified  
via the `RunAs' directive in agraph.cfg.  
 
# bin/agraph-control --config lib/agraph.cfg start  
RunAs user `UserThatDoesNotExist' does not exist in the passwd database.  
 
Please run the AllegroGraph configuration script or adjust the `RunAs'  
directive in lib/agraph.cfg  
 
</code></pre><a name='header3-189' id='header3-189'></a><h3>HTTP API</h3><h4>Rfe15418 - Allow specifying string table compression method</h4><p>Added a <code>stringTableCompression</code> parameter to the repository creation HTTP service. </p><a name='header3-192' id='header3-192'></a><h3>SPARQL</h3><h4>Rfe15421 - Add control over duplicate triple reduction in SPARQL queries</h4><p>AllegroGraph now has a new query option: <code>enableDuplicateReduction</code> which controls whether or not the SPARQL engine reduces the number of duplicate triples it processes. See <a href="sparql-reference.html#sparql-queryoptions">SPARQL Query Options</a> in the <a href="sparql-reference.html">SPARQL Reference</a> document. </p><p>If the store has no duplicate triples (based on subject, predicate, object, and graph) then this option has no effect. </p><p>SPARQL is defined on sets of triples (i.e., no duplicates) but AllegroGraph can store duplicates which can lead to duplicate rows of bindings returned by a query. </p><p>If this option is set to <code>true</code>, then AllegroGraph will ignore consecutive duplicate triples returned from the storage layer. Since the storage layer makes no guarentees on the order of triples it returns, this can lead to different results from the same query. </p><p><strong>Note</strong>: Previous versions of AllegroGraph used duplicate reduction by default. This version turns if off by default. If your triple-store has duplicate triples, then this may change the results of your queries. </p><h4>Rfe15419 - Include query modifiers when printing a SPARQL query plan</h4><p>AllegroGraph now includes query modifiers like ORDER BY or LIMIT when it prints a query plan. </p><h4>Rfe15391 - Warn when the variable HOST of a SERVICE clause is not bound</h4><p>AllegroGraph now warns when the HOST variable of a SERVICE clause is unbound in the query. </p><p>For example, both of these queries will produce query warnings: </p>
<pre><code># Query 1  
select * {  
 {  
   :myService :isAtURL ?url  
 } union {  
   service ?url { ?s ?p ?o }  
 }  
}  
 
# Query 2  
select * { service ?unknown { ?s ?p ?o } } </code></pre><h4>Rfe15354 - Improve handling of queries containing GRAPH and JOIN clauses</h4><p>AllegroGraph will now handle queries involving GRAPH and JOIN clauses more efficiently. </p><h4>Rfe15336 - Sanity check on JSON/XML data returned by SPARQL endpoint</h4><p>If a SPARQL query includes a SERVICE call, the XML and JSON result data is now subject to more syntactic and semantic error checking. Nevertheless invalid result data from third parties might still lead to unexpected outcomes. </p><h4>Rfe15273 - Add Javascript API for defining SPARQL extensions</h4><p>AllegroGraph's server side Javascript engine now supports the following: </p>
<ul>
<li>sparql.extensionFunctions() - return a list of SPARQL extension function names.</li>
<li>sparql.defineExtensionFunction(uri, function) - define a new extension function    associated with <code>uri</code>. </li>
<li>sparql.magicProperties() - return a list of magic property URIs.</li>
<li>sparql.defineMagicProperty(uri, parameters) - define a new SPARQL magic    property. </li></ul><p>For details, see the Javascript documentation. </p><h4>Bug25145 - Illegal keyword error when executing some queries</h4><p>AllegroGraph could signal an Illegal Keyword error when executing some complex queries. This has been corrected. </p><h4>Bug25113: SPARQL planner stopped optimizing certain queries</h4><p>If a query has a FILTER like </p>
<pre><code>FILTER( ?var1 = ?var2 ) </code></pre><p>and it can be determined that both <code>?var1</code> and <code>?var2</code> are resources, then AllegroGraph can perform certain query optimizations. This feature was inadvertently broken in AllegroGraph 6.4 and has now been reinstated. </p><h4>Bug25097 - Graph not in dataset warning signaled inappropriately</h4><p>AllegroGraph v6.3.0 and following signal a query warning if the graph in a GRAPH clause is not in the dataset as in, for example, this query: </p>
<pre><code>select *  
from named &lt;http://example.com#graph&gt; {  
  graph &lt;http://example.org#otherGraph&gt; { ?s ?p ?o }  
} </code></pre><p>AllegroGraph was signaling this warning more often than necessary. This has been corrected. </p><h4>Bug25064 - GROUP BY expressions in a SUB-QUERY causes an error</h4><p>AllegroGraph was signaling an error if a SPARQL query used GROUP BY expressions in a SUB-QUERY. This has been corrected. An example query that used to fail would be </p>
<pre><code>select * {  
  { select ?strWho (sum(?amount) as ?sum) {  
      ?who ?p ?amount .  
    } group by (str(?who) as ?strWho)  
  }  
}  
</code></pre><h4>Bug25057 - Values and OPTIONAL could lead to too many results</h4><p>If a SPARQL query used a VALUES form inside the query and the VALUES form had only a single variable and a single binding for that variable and the query also used an OPTIONAL form that made use of the same variable, then AllegroGraph could return results with the variable unbound. This has been corrected. </p><p>As an example, AllegroGraph previously could have returned results with <code>?o2</code> unbound for the following query: </p>
<pre><code>SELECT ?s ?o1 ?o2 {  
  ?s ?p1 ?o1  
  OPTIONAL { ?s foaf:knows ?o2 }  
  VALUES (?o2) { (:b) }  
} </code></pre><h4>Bug25055 - Improve SPARQL parser error message for bad aggregation expression</h4><p>AllegroGraph was signaling an error for bad aggregation expressions rather than indicating that the query failed to parse. For example, this query is invalid because it is illegal to GROUP BY an aggreagate: </p>
<pre><code>select (sum(?o) as ?sum) (sample(?s) as ?ss) {  
  ?s ?p ?o .  
} group by (sum(?o) as ?xxx) having (?xxx &gt; 2) </code></pre><p>AllegroGraph now signals a SPARQL parser error for queries like this. </p><h4>Bug25034 - Catch additional SPARQL parse errors</h4><p>SPARQL is defined such that repeated variables in the projection are ignored. Previously, AllegroGraph would include each repeated variable. Now, it will include only the first instance and will warn if the list includes repetition. </p><p>For example, this query: </p>
<pre><code>SELECT ?s ?g ?s { graph ?g { ?s ?p ?o } } </code></pre><p>Will project only <code>?s</code> and <code>?g</code> and will warn that "The following variable is projected multiple times: ?s. Only the first projection will be included". </p><p>The variables in expressions and aggregation specifications may not overlap with other projected variables. AllegroGraph now catches errors like: </p>
<pre><code>SELECT ?o (str(?o) as ?o) {  
  ?s ?p ?o .  
} </code></pre><p>or </p>
<pre><code>SELECT ?s (count(1) as ?s) {  
  ?s ?p ?o .  
} GROUP BY ?s </code></pre><p>Previously, the above queries would have passed the parser. </p><a name='header3-247' id='header3-247'></a><h3>AGWebView</h3><h4>Rfe15395 - Highlight all instances of the token under cursor in the query editor</h4><p>AGWebView's SPARQL query editor now highlights any tokens that match the one currently under the cursor. This makes it easier to ensure that variable names are not mistyped. </p><a name='header3-250' id='header3-250'></a><h3>Changes to the Lisp API</h3><h4>rfe15430 Use of next-encoded-upi-for-prefix in multi-master cluster instances</h4><p>In order to use <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a> when the repository is a multi-master cluster instance, the template associated with the encoded id prefix must generate exactly 2^60 distinct strings. If it does not, the call to <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a> will signal an error.  As noted just below, the "plain" will work as a template. See <a href="lisp-reference.html#register-encoded-id-prefix" title="description of register-encoded-id-prefix">register-encoded-id-prefix</a>. </p><h4>Rfe15466 - Plain format encoded ids</h4><p><a href="lisp-reference.html#register-encoded-id-prefix" title="description of register-encoded-id-prefix">register-encoded-id-prefix</a> will treat the <code>format</code> argument of "plain" (a string) in this special way: The encoded id (the string after the @@) is a variable length integer in the range from 0 to (2^60 -1), much like blank nodes. This is a template suitable for use in multi-master cluster instances. See the <a href="encoded-ids.html">Encoded IDs</a> document. </p><h4>rfe15430 Use of next-encoded-upi-for-prefix in multi-master cluster instances</h4><p>In order to use <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a> when the repository is a multi-master cluster instance, the template associated with the encoded id prefix must generate exactly 2^60 distinct strings. If it does not, the call to <a href="lisp-reference.html#next-encoded-upi-for-prefix" title="description of next-encoded-upi-for-prefix">next-encoded-upi-for-prefix</a> will signal an error.  As noted just above, the "plain" will work as a template. See <a href="lisp-reference.html#register-encoded-id-prefix" title="description of register-encoded-id-prefix">register-encoded-id-prefix</a>. </p><h4>Rfe15379 - Remove in-line-data argument from the run-sparql</h4><p>The <code>in-line-data</code> argument to <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> is no longer supported. If you need to execute the same basic query with different sets of BINDINGS, then use the VALUES form in your SPARQL query string. </p><h4>Rfe15373 - Export peekable-cursors</h4><p>The Lisp API now includes these new functions: </p>
<ul>
<li><a href="lisp-reference.html#make-peekable-cursor" title="description of make-peekable-cursor">make-peekable-cursor</a></li>
<li><a href="lisp-reference.html#cursor-peek" title="description of cursor-peek">cursor-peek</a></li>
<li><a href="lisp-reference.html#make-triples-peekable-cursor" title="description of make-triples-peekable-cursor">make-triples-peekable-cursor</a></li></ul><p>A peekable-cursor is like a regular cursor except <a href="lisp-reference.html#cursor-peek" title="description of cursor-peek">cursor-peek</a> can be used to see what <a href="lisp-reference.html#cursor-next-row" title="description of cursor-next-row">cursor-next-row</a> will return <em>without</em> modifying the state of the cursor. See <a href="lisp-reference.html#peek-cursor">the documentation</a> for details. </p><h4>Bug25119 - load-turtle not accepting a :base-uri arg in remote lisp client</h4><p>The remote lisp client did not support the <code>base-uri</code> argument to <a href="lisp-reference.html#load-turtle" title="description of load-turtle">load-turtle</a>. This has been corrected. </p><h4>Bug25070 - upi-&gt;value uses <em>db</em> when decoded encoded IDs</h4><p>The <a href="lisp-reference.html#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> function was using <a href="lisp-reference.html#variable.:2Adb:2A" title="description of variable *db*"><em>db</em></a> to decode encoded IDs even when a specific value for <code>db</code> was passed into the function. This has been corrected. </p><h4>Bug25043 - get-triples-nd-* functions were incompletely documented</h4><p>The various nD get-triples functions (like <a href="lisp-reference.html#function.get-triples-nd-within-bounding-box">get-triples-nd-within-bounding-box</a>) return <code>:part-not-found</code> as a second return value if it can be determined that one of the search parameters is definitely not in the repository. This is now documented. </p><h4>Bug23635: Make Lisp client :default-graph-uris keyword work with remote-triple-stores</h4><p>SPARQL queries made against remote-triple-stores via <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a>, that passed the <code>:default-graph-uris</code> keyword argument, would not return expected results. This has now been fixed. </p><a name='header3-273' id='header3-273'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-275' id='header3-275'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-277' id='header3-277'></a><h3>nD Geospatial</h3><h4>Rfe13347 - Automatic nD datatype mapping is now on for new repositories</h4><p>AllegroGraph now creates new repositories with automatic N-dimensional (nD) datatype mapping enabled. This means that adding triples with nD objects will add the necessary type mapping with no further intervention. See <a href="geospatial-nd.html#geo-automation">nD Geospatial Automation</a> for details and a linke to further discussion in the geospatial examples document. </p><h4>Bug25129: Bus error on geospatial search with a non-existing predicate</h4><p>The bus error on the server happened when trying to obtain triples from polygon using predicate that was not previously added to the store. </p><p>Behaviour for obtaining triples from polygons was modified to properly handle this case. </p>  <p><a name="changes-640"></a> </p><a name='header2-286' id='header2-286'></a><h2>AllegroGraph 6.4.0</h2><a name='header3-287' id='header3-287'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe15302 - Remove support for using rapper as an external parser</h4><p>The <code>use-rapper</code> argument to the AllegroGraph data import commands has been removed because AllegroGraph now supports all of the standard formats. </p><p>The <code>rapper</code> command line argument to <a href="agload.html">agtool load</a> has similarly been removed. </p><h4>Rfe15219 - Add timeout and limit arguments to the SNA path-finding functions</h4><p>The SNA path finding functions now have a <code>timeout</code> argument and a <code>limit</code> argument. The first specifies the number of seconds to execute the search whereas the second indicates that searching should stop once that many paths have been found. </p><p>The SNA path functions will return (as a second value) the status of the search. This will be either <code>nil</code> if the search was not interrupted, :timeout if the search reached the timeout, or :limit-reached if the limit on the number of paths was reached. </p><p>Note that the return format for the REST API to the SNA path functions is now versioned.  The desired version if specified via a <code>version</code> parameter in the query string. If the version is <code>1</code>, then the previous result format of a list of lists representing paths will be returned. Otherwise, the new format will be used. The new format consists of a JSON object with two keys: "paths" and "status". "paths" contains the list of paths and "status" contains the reason that the search completed. It will be one of "complete", "timeout", or "limit-reached". </p><h4>Bug24980 - Turtle serializer escapes the PNAME_NS incorrectly</h4><p>The Turtle serializer was escaping both the namespace portion and the local portion of a qualified name using the same logic. This was incorrect as the escaping for the two differ. The problem has been corrected. </p><a name='header3-297' id='header3-297'></a><h3>HTTP API</h3><p>No significant changes. </p><a name='header3-299' id='header3-299'></a><h3>SPARQL</h3><h4>Rfe15337 - Have the NOW() SPARQL function include a timezone</h4><p>The SPARQL NOW() function now returns dateTimes in GMT. Previously, the dateTimes had no explicit timezone. </p><h4>Rfe15259 - Add a query option to limit the size of query log entries</h4><p>AllegroGraph's SPARQL engine now truncates query log message to 512 characters by default. This limit can be changed by adding ":LINE_LENGTH" to the logQuery query option either in the AllegroGraph configuration file or on a per-query basis. For example, this PREFIX line will limit log lines to 100-characters: </p>
<pre><code>PREFIX franzOption_logQuery: &lt;franz:yes:100&gt; </code></pre><h4>Rfe15258 - Add <code>maximumValuesCountForService</code> query option</h4><p>AllegroGraph uses the SPARQL VALUES clause to pass partial results to SPARQL endpoints. In general this can help the endpoint compute its results more efficiently but when there are many values the cost of transmitting the data can outweigh these benefits. </p><p>The <code>maximumValuesCountForService</code> provides a mechanism to limit the total number of VALUES sent. </p><h4>Rfe15250 - Improve treatment of very large VALUES clauses</h4><p>The query planner now handles large VALUES clauses significantly faster. In addition, the query executor now decides whether to probe or scan based on the number of VALUES and the expected number of rows that a cursor will need to traverse. These two changes can make some queries significantly faster. </p><h4>Rfe11137: Support the TIMEZONE() and TZ() functions</h4><p>AllegroGraph now supports the SPARQL 1.1. TIMEZONE() and TZ() functions. </p><h4>Bug25003 - FILTERing on an expression like ( ! ?a = ?b ) caused an error</h4><p>The above expression evaluates as <code>(!?a) = ?b</code> and AllegroGraph was not correctly handling the expression of the inner negation operator. This has been corrected. </p><h4>Bug24985 - FILTER EXISTS and SUB-QUERY can lose solutions</h4><p>If a FILTER EXISTS clause started with a sub-query then AllegroGraph could fail to find some solutions. This has been corrected. </p><h4>Bug24657 - GRAPH filter can be applied to the wrong clause</h4><p>If a graph variable appeared in the subject, predicate, or object position of a triple-pattern, it was possible for AllegroGraph to apply a GRAPH dataset constraint to it incorrectly. For example, AllegroGraph could have incorrectly determined that the <code>?g1 :predicate1 ?object</code> pattern in the query below should be evaluated as if it was inside a GRAPH clause which could lead to incorrect results. </p>
<pre><code>select * {  
  GRAPH ?g1 { ?s1 ?p1 ?o1 } .  
  GRAPH ?g2 { ?s2 ?p2 ?o1 } .  
  ?g1 :predicate1 ?object .  
} </code></pre><p>This has been corrected. </p><h4>Bug24151 - Correct a SPARQL FILTER analysis issue</h4><p>AllegroGraph's SPARQL engine would signal an error if a FILTER contained an expression like </p>
<pre><code>str( ?varOne ) = ?varTwo </code></pre><p>This has been corrected. </p><h4>Bug20593 - Support the SPARQL 1.1 BNODE( identifier ) function</h4><p>AllegroGraph has long supported the BNODE() function with no arguments. It now also supports the version that takes a single plain literal or XSD string argument. </p><h4>Bug24076 - Improve handling of DBPedia.org and other Virtuoso servers as SPARQL endpoints.</h4><p>AllegroGraph works around an apparent problem with Virtuoso. </p><a name='header3-328' id='header3-328'></a><h3>AGWebView</h3><h4>Rfe11480 - Added <strong>Shutdown instance</strong> operation to <strong>Repository Control</strong> section in AGWebView </h4><p>See the <a href="agwebview.html#RepositoryOverviewPage">desription of the repository page</a> in the <a href="agwebview.html">WebView</a> document. </p><h4>Bug24949 - Overview page broken for remote sessions</h4><p>Opening a session to a single, remote store in WebView used to produce the following error message: </p><p>   Loading failed:    Service not supported in a session that does not wrap a single local store. </p><p>instead of the overview page. This has been corrected. </p><h4>Bug24929 - Help messages appear out of view.</h4><p>Help messages were often shown at the top of the Webview page, out of sight of the current page location. They will now be displayed in tooltips. </p><a name='header3-337' id='header3-337'></a><h3>Changes to the Lisp API</h3><p><a name="dbthread"></a> </p><h4>Rfe15325: Make <code>*db*</code> a required thread binding</h4><p>To help avoid accidental sharing of a repository connection between threads, each new thread will start with <code>*db*</code> bound to <code>nil</code>. Previously, <code>*db*</code> would retain its global value in new threads. </p><p>Given this sample code: </p>
<pre><code>(open-triple-store "test") ;; sets global value of *db*  
 
(mp:process-run-function "new thread"  
   (lambda ()  
     ;; The new thread wants its own connection to the repository  
     (open-triple-store "test"))) </code></pre><p>Prior to v6.4.0, the call to <a href="lisp-reference.html#open-triple-store" title="description of open-triple-store">open-triple-store</a> in "new thread" would overwrite the global value of <code>*db*</code>.  In v6.4.0, "new thread" will have its own binding of <code>*db*</code> and the global value will not be affected. </p><a name='header3-344' id='header3-344'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-346' id='header3-346'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-348' id='header3-348'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <a name='header2-352' id='header2-352'></a><h2>AllegroGraph 6.3.0</h2><p><a name="changes-630"></a> </p><a name='header3-354' id='header3-354'></a><h3>AllegroGraph Server: General Changes</h3><h4>Catalogs may no longer be named root or system.</h4><p>The names <strong>root</strong> and <strong>system</strong> are reserved as catalog names. <strong>root</strong> interferes with the default catalog (which is referred to as the <em>root</em> catalog) and the <strong>system</strong> catalog is used for auditing and other system data. If you have catalogs named <em>root</em> or <em>system</em>, contact <em>allegrograph-support@franz.com</em> if you have difficulty upgrading to 6.3.0. </p><h4>'agtool archive' no longer accepts --catalog, catalog now part of repo name</h4><p>The <strong>agtool archive</strong> program (see <a href="backup-and-restore.html">Backup and Restore</a>) now specifies catalogs and repositories together using the <code>catalog:repository</code> format. The <code>--catalog</code> option to <strong>agtool archive</strong> is no longer accepted. </p><h4>Rfe15210 -  Log which user starts a session</h4><p>When a session is started, AllegroGraph now logs the name of the user that started the session. (Although not documented, the AllegroGraph log has always said when a session was started and stopped.) A sample log message: </p>
<pre><code>[2017-09-21T15:59:48.028 p21266 back] Session on port 43704 started by user "test".  
</code></pre><h4>Rfe15194 - Support XQuery and XPath Math Functions</h4><p>AllegroGraph now supports the following XPATH math functions </p>
<ul>
<li>acos</li>
<li>asin</li>
<li>atan</li>
<li>atan2</li>
<li>cos</li>
<li>exp</li>
<li>exp10</li>
<li>log</li>
<li>log10</li>
<li>pi</li>
<li>pow</li>
<li>sin</li>
<li>sqrt</li>
<li>tan</li></ul><p>See <a href="http://www.w3.org/2005/xpath-functions/math/">http://www.w3.org/2005/xpath-functions/math/</a> for details. </p><h4>Rfe15132 - <code>agtool archive list</code> can operate on backup directories</h4><p><strong>agtool archive list</strong> now can operate not only on single archive file but can be given backup directory as source. In that case it displays details about every repository inside backup. </p><p>Additionally it can be given the optional <code>DB-IN-ARCHIVE</code> argument to display details about single repository in <code>ARCHIVE</code> even if other repositories are present. </p><p>New option --summary allows <strong>agtool archive list</strong> to only list repositories inside <code>ARCHIVE</code>, without printing details about every one. </p><p><strong>agtool archive</strong> is described in the <a href="backup-and-restore.html">Backup and Restore</a> document. </p><h4>Rfe12362 - CORS support</h4><p>CORS (Cross-Origin Resource Sharing), if enabled, allows scripts run on a web page from one server to make HTTP requests to the (different) server where AllegroGraph is running. CORS is not enabled by default. You enable it with various donfiguration directives described in the <a href="daemon-config.html#cors">CORS directives</a> section of the <a href="daemon-config.html">Server Configuration and Control</a> document. </p><h4>Rfe12201 - Switching a repository between commit and no-commit modes</h4><p>This now requires superuser privileges. </p><h4>Bug24927 - Turtle serializer tried to escape capital A</h4><p>The turtle serializer could try to escape the letter capital A which could lead to invalid output. This has been corrected. </p><h4>Bug24910 - Unhelpful Turtle parser error message</h4><p>Improved the error message the Turtle parser produced when the object of a triple was missing. </p><h4>Bug24905 - Audit log does not display in AG 6.2.3</h4><p>The Audit log display feature in AGWebView was inadvertently broken in release v6.2.3. This has been corrected. </p><h4>Bug24842 - Custom services should not use user namespaces</h4><p>Custom services were being executed in the context of the current user rather than in the context of the code that defined the service. This has been corrected. </p><h4>Bug23757 - If a script file generates errors (warnings) while loading, don't start the session.</h4><p>Previously, any errors or warnings that occurred when compiling a Lisp script were written to the AllegroGraph log file and the session would still start. Now, any problems are still written to the log file but the session will not start and the text of the problem(s) will be returned in the HTTP response. </p><a name='header3-398' id='header3-398'></a><h3>HTTP API</h3><h4>Bug20845 - /version/info web service removed</h4><p>The /version/info web service caused the server to report detailed internal information about the server and the machine on which the server was running. It was decided that the information was not in fact useful and could expose security vulnerabilities. The URL now returns 404. </p><a name='header3-401' id='header3-401'></a><h3>SPARQL</h3><h4>Defining your own magic properties</h4><p>AllegroGraph lets you define your own Magic Properties using the Lisp API. The <a href="defmagic-tutorial.html">Defining Magic Properties Tutorial</a> describes how to do this and provides numerous simple examples. </p><h4>Rfe15182 - All of AllegroGraph's query warnings are now documented.</h4><p>See the <a href="sparql-reference.html#query-warnings">Query Warnings</a> section of the <a href="sparql-reference.html">SPARQL Reference</a> document. </p><h4>Rfe15152 - Propagate impossible query conditions outward in the plan</h4><p>When a query contains a triple pattern that cannot possibly match, it will mark the pattern as <code>impossible</code>. The impossible marking will propagate outward (e.g., from the pattern to the BGP to the enclosing JOIN and so on). This allows queries with typos or other errors to fail quickly. </p><h4>Rfe15135 - Warn if any SPARQL type errors occur during query execution</h4><p>SPARQL will now log a warning if any type errors are encountered during query execution. For example, it is an error to try and cast the string '1.23e4' to an integer because the lexical representation of an XSD integer consists of "a finite-length sequence of decimal digits (#x30-#x39) with an optional leading sign." (cf https://www.w3.org/TR/xmlschema-2/#integer). Therefore, a query like: </p>
<pre><code>select * { bind(xsd:integer('1.23e4') as ?int) } </code></pre><p>will leave <code>?int</code> unbound. Previously, this type error would have been surpressed. Now, AllegroGraph will issue a <code>warn-sparql-type-errors</code> warning. </p><h4>Rfe15112 - Improve cancelQueryOnWarnings option</h4><p>The <code>cancelQueryOnWarnings</code> query option now cancels queries immediately for most plan or query warnings. This option defaults to off but can be turned on by placing </p>
<pre><code>QueryOption cancelQueryOnWarnings=yes </code></pre><p>in the AllegroGraph configuration or by prefixing a SPARQL query with the PREFIX </p>
<pre><code>PREFIX franzOption_cancelQueryOnWarnings: &lt;franz:yes&gt;  
 
</code></pre><h4>Rfe12249 - Improve magic predicates for Solr and MongoDB</h4><p>The magic predicates that interface AllegroGraph's SPARQL engine with Solr and MongoDB have been improved. The three magic predicates: </p>
<ul>
<li><a href="http://www.franz.com/ns/allegrograph/4.5/solr/match">http://www.franz.com/ns/allegrograph/4.5/solr/match</a></li>
<li><a href="http://www.franz.com/ns/allegrograph/4.5/solr/matchId">http://www.franz.com/ns/allegrograph/4.5/solr/matchId</a></li>
<li><a href="http://franz.com/ns/allegrograph/4.7/mongo/find">http://franz.com/ns/allegrograph/4.7/mongo/find</a></li></ul><p>can now take an optional second parameter in their list of subject <em>arguments</em>. This second parameter will be bound to the matching objects of any triples found by the search in the case of <code>solr:matchID</code> and to the associated linking identifier in the cases of <code>solr:match</code> and <code>mongo:find</code>. For example, the following query will bind <code>?s</code> to the subjects found and <code>?text</code> to the object: </p>
<pre><code>prefix solr: &lt;http://franz.com/ns/allegrograph/4.5/solr/&gt;  
select ?s ?text {  
  (?s ?text) solr:matchId 'boatswain' .  
} </code></pre><h4>Rfe11193 - Improvement performance of SPARQL expression      compilation </h4><p>The SPARQL query expression compiler is now approximately 45 times faster than before. This means that queries that use many expressions (e.g., in FILTERs, BIND, ORDER BY, etc.) will perform more efficiently. </p><p>Note that aggregation expressions still use the older and slower compiler. </p><h4>Rfe11678 - Full-scan warning should take dataset into account</h4><p>AllegroGraph signals a warning when a SPARQL query needs to perform a full scan and the store contains more than one million triples. AllegroGraph was incorrectly signaling this warning when the query was executed against a SPARQL dataset. This has been corrected. </p><h4>Bug24898 - Fix problem with magic SNA centrality predicates and neighbor caches</h4><p>Some queries that used AllegroGraph's SNA centrality magic predicates and neighbor caches could cause an error. This has been corrected. </p><h4>Bug24861 - Sparql parser confused by "?o<='foo'^^<...> "</h4><p>The SPARQL parser was incorrectly treating the inequality operator as the start of a URI. This has been corrected. </p><h4>Bug24681 - Parsing should fail if a blank node label is used in more than one BGP</h4><p>AllegroGraph did not signal a parsing error if a SPARQL query used the same blank node in more than one basic graph pattern (BGP). This has been corrected. </p><a name='header3-435' id='header3-435'></a><h3>AGWebView</h3><h4>Rfe15198 - Index management page</h4><p>An index management page has been added to AGWebView.  The new page can be accessed from the <a href="agwebview.html#RepositoryOverviewPage">Repository Overview page</a> by following a link labeled 'Manage triple indices'. The list of indices has been removed from the overview page and the 'purge deleted triples' link has been moved to the index management page. See <a href="agwebview.html#manage-indices-page">The Manage triple indices page</a> for more information. </p><h4>Rfe14563 - Repository reports</h4><p>A set of reports describing disk usage and other repository properties has been added to WebView. The reports can be accessed through links on the repository overview page. See the <a href="agwebview.html#reports-link">Reports section</a> in the <a href="agwebview.html#RepositoryOverviewPage">Repository Overview page</a> description for more information. </p><h4>Rfe13419 - Add warmup triple-store to AGWebView</h4><p>Add new option <strong>Warmup store</strong> in <strong>Repository Control</strong> section in repository overview page. See the description of the <a href="agwebview.html#RepositoryOverviewPage">Repository Overview Page</a> in the <a href="agwebview.html">WebView</a> document. </p><h4>Rfe11915 - Creating freetext index prefills stop words with default ones.</h4><p>The AGWebView dialog for creating a freetext index now starts with a default selection of stop words (rather than starting with no stop words and the option to add a default selection). See the <a href="agwebview.html#FreeTextIndicesPage">Free-Text Indices page</a> in the <a href="agwebview.html">WebView</a> document for more information. </p><h4>Rfe11256: Import RDF statements directly.</h4><p>It is now possible to import RDF statements directly by typing or pasting them into a text box in AG WebView. See the <a href="agwebview.html#load-delete-data">Load and Delete Data</a> section of the <a href="agwebview.html#RepositoryOverviewPage">Repository Overview page</a> description. </p><h4>Bug24824 - Spurious warning for ASK queries in AGWebView</h4><p>AllegroGraph WebView was showing a query warning for ASK queries when the "Limit to 1000 results" checkbox was checked. This has been corrected. </p><h4>Bug24480: "Ignore errors" option was ignored when loading triples from server file</h4><p>The "Ignore errors" error handling option was not being honored when loading a server-side file using AG WebView. This has been fixed. </p><h4>Bug23607 - Improve accuracy of query timing results in AGWebView</h4><p>Previously, the timing results in AGWebView represented the time it took to find the first result. Now, it represents the time it takes to find all results. The total time to display may still be longer as it will also include the time it takes the web browser to render the returned data. </p><a name='header3-452' id='header3-452'></a><h3>Changes to the Lisp API</h3><h4>Remove :plain datatype mapping</h4><p>The <code>:plain</code> datatype mapping converted typed string literals into the equivalent plain literal. E.g., it would convert <code>"bear"^^xsd:string</code> into <code>"bear"</code>. <code>:plain</code> mappings are no longer necessary because AllegroGraph handles typed strings more efficiently automatically. Mappings are specified with <strong>setf</strong> and <a href="lisp-reference.html#datatype-mapping" title="description of datatype-mapping">datatype-mapping</a> and <a href="lisp-reference.html#predicate-mapping" title="description of predicate-mapping">predicate-mapping</a>. </p><p>Note that any existing datatype or predicate mappings of type <code>:plain</code> will be automatically removed from the store. </p><h4>Bug24857 - path-finding over HTTP fails when paths include literals</h4><p>If an SNA path included typed literals, then a remote-triple-store would convert them into the wrong UPI type leading to UPI not in string-table errors. This has been corrected. </p><a name='header3-458' id='header3-458'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-460' id='header3-460'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-462' id='header3-462'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-623"></a> </p><a name='header2-467' id='header2-467'></a><h2>AllegroGraph 6.2.3</h2><a name='header3-468' id='header3-468'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe15101: Restore tlmgr to tlmgr.restored</h4><p>The tlmgr file contains information about replication jobs.  Since the existence of replication job information can result in transaction log files accumulating, the tlmgr file is no longer restored as is. Now it is renamed to tlmgr.restored during a restore.  After a restore, replication jobs must be reestablished by the user. </p><h4>Rfe12408 - Add graph filtering support to agmaterialize</h4><p><strong>agtool materialize</strong> can now limit materialization to a specified list of graphs via the <code>--graph</code> (short form <code>-f</code> -- note that <code>-g</code> specifies the default graph for inferred triples) command line argument. The inferred graph (specified with <code>--inferred-graph</code> or <code>-g</code>) will always be included in the list. See the <a href="materializer.html">Materializer</a> document. </p><h4>Bug24729 - Spaces in filenames prevent server-side file import.</h4><p>Importing a server-side file with spaces in its path would fail with an error message about illegal characters in a URI. This issue affected both WebView and the HTTP API, but not <strong>agtool load</strong> and has been corrected. </p><a name='header3-475' id='header3-475'></a><h3>HTTP API</h3><h4>Bug20772 - Loading JSON format may fail to commit all triples</h4><p>Using the 'commit=<em>number</em>' parameter when importing statements through the HTTP API could result in some statements not being committed. The issue only affected JSON imports and has been corrected. </p><a name='header3-478' id='header3-478'></a><h3>SPARQL</h3><h4>Rfe15077 - Signal a query warning when CONSTRUCT tries to generate invalid triples</h4><p>AllegroGraph will now signal a query warning if any triples produced by the CONSTRUCT template are invalid. Formerly, these triples were silently discarded. </p><h4>Rfe15075 - Improve parsing efficiency of large USING [NAMED] datasets</h4><p>The SPARQL parser now parses UPDATE commands with very large dataset specifications using the USING and USING NAMED clauses more efficiently. </p><h4>Rfe15074 - SPARQL parser has non-linear behavior for large VALUES clauses</h4><p>Improved the SPARQL parser performance for queries with 1000s of elements inside of VALUES clauses. </p><h4>Rfe15061 - Improve efficiency of SPARQL queries with large datasets</h4><p>AllegroGraph now determines at query time whether it would be more efficient to issue getStatements calls for each graph in a dataset or to issue a single getStatements call and filter the results to include only graphs in the dataset. Depending on the triple-store and the dataset, this can be significantly more efficient. </p><h4>Rfe15006 - Improve GRAPH and PROPERTY PATH query planning and execution</h4><p>AllegroGraph now handles property path queries inside of GRAPH clauses more efficiently when the graph is a variable and the clause contains no property path queries that use any of the ZeroOrMorePath, OneOrMorePath, or ZeroOrOnePath operators. </p><h4>Rfe14450 - Improving cross product warning</h4><p>The warning issued when AllegroGraph detects a cross product in a SPARQL query is now more descriptive. </p><h4>Bug24779: Constructed triples should not allow blank nodes in the predicate postion</h4><p>AllegroGraph was incorrectly allowing CONSTRUCT to produce blank nodes in the predicate position of triples. This has been corrected. </p><h4>Bug24762 - SPARQL DELETE/INSERT/WHERE and Chunk processing could fail</h4><p>If the chunk size was too small, a SPARQL DELETE/INSERT/WHERE command could fail to correctly process triples. </p><h4>Bug24755 - Problems in intervalAfterDatetime and intervalBeforeDatetime</h4><p>The <code>intervalAfterDatetime</code> magic property could fail to find solutions when using a constant datetime rather than a variable. Additionally, both <code>intervalAfterDatetime</code> and <code>intervalBeforeDatetime</code> could fail to find solutions when the intervals were defined on explicit times rather than using named time points. </p><h4>Bug24709 - FILTER EXISTS and unbound variables on the RHS</h4><p>AllegroGraph used to return incorrect results for FILTER EXISTS expressions when the RHS contained any unbound variables. This has been corrected. </p><h4>Bug24704 - Improve strategy used to find unique values in a store</h4><p>AllegroGraph uses several techniques to determine all of the unique values stored for subject, predicate, object, or graph. Depending on the quads in the store and the shape of the query, one of these techniques can be much more efficient than the others. It was possible, however, for AllegroGraph to choose the wrong technique in some cases. This has been corrected. </p><h4>Bug24665 - SPARQL queries with :dateTime inequality filters could lose results</h4><p>Query results could be lost if a SPARQL query used a non-inclusive inequality filter on xsd:dateTimes or xsd:times. This has been corrected. </p><h4>Bug24455 - Incorrect results when join variables might be unbound</h4><p>AllegroGraph would sometimes return incorrect results from joins where a part of the join key was unbound. </p><p>This has been corrected. </p><h4>Bug24215 - Unbound values in join keys</h4><p>When merging solutions during a join, AllegroGraph would sometimes not produce bindings for variables that are only bound on the RHS of the join and are a part of the join key. </p><p>For instance when running this query: </p>
<pre><code>select * {  
  { values(?x ?y) {(1 undef)} }  
  { values(?x ?y) {(undef 2)} }  
} </code></pre><p>AllegroGraph would return <code>(?x = 1, ?y = undef)</code> instead of the expected <code>(?x = 1, ?y = 2)</code>. </p><p>This has been corrected. </p><a name='header3-512' id='header3-512'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-514' id='header3-514'></a><h3>Changes to the Lisp API</h3><h4>Bug24796 - intern-resource error on future-part with unregistered namespace abbreviation</h4><p>A call to <a href="lisp-reference.html#intern-resource" title="description of intern-resource">intern-resource</a> on a future-part whose namespace abbreviation was not defined would signal a bus error. This will now signal a condition of type <code>cannot-resolve-namespace-for-future-part-error</code>. </p><a name='header3-517' id='header3-517'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-519' id='header3-519'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-521' id='header3-521'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-622"></a> </p><a name='header2-526' id='header2-526'></a><h2>AllegroGraph 6.2.2</h2><a name='header3-527' id='header3-527'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe14926: Reserve parentheses characters</h4><p>Parentheses are no longer allowed in triple store or catalog names. These characters are reserved for use in triple store specifications. </p> <h4>Bug24700 - Unfriendly error message when session ports are unavailable</h4><p>Previously, if a request to create a session cannot be completed due to lack of an available session port, an unfriendly error message was reported.  This has been fixed and now a clear error message is returned. </p><h4>Bug24687 - Deleting a tlog when free list is full throws error.</h4><p>Fixes a bug introduced in v6.1.4 where a tlog that was deleted due to the free list being full would be repeatedly deleted by AllegroGraph despite it no longer existing. This bug could prevent the freeing/deletion of old tlogs, causing them to accumulate. </p><p>Log entries that indicate this bug, would be similar to the following: </p>
<pre><code>[2017-05-22T13:49:21.800 p17318 tlarchiver] Store "bug24687", free list is full, will just delete "tlog-2477c96f-0579-ba54-b60b-7083f2293fa8-27"  
 
... later ...  
 
[2017-05-22T13:51:34.996 p17318 tlarchiver] Store "bug24687", free list is full, will just delete "tlog-2477c96f-0579-ba54-b60b-7083f2293fa8-27"  
[2017-05-22T13:51:34.999 p17318 E tlarchiver] Store "bug24687", Attempt to delete tlog-27 gave error There is no file named /dbs/bug24687/tlog-2477c96f-0579-ba54-b60b-7083f2293fa8-27: No such file or directory [errno=2].: No such file or directory [errno=2].  
</code></pre><h4>Bug24673 - FTI merger can create empty data file</h4><p>The FTI merger process sometimes fails and logs an error message similar to the following: </p>
<pre><code>Process 'repo FTI Merger' raised: opening  
#&lt;mapped-file-simple-stream  
#P"/agdata/data/rootcatalog/repo/fti-2-chunk-114-data" mapped  
closed @ #x100054959b2&gt; resulted in error (code 22): Invalid  
argument. </code></pre><p>this has been corrected. </p><h4>Bug24663 - TriG parser uses the wrong graph on the first blank node</h4><p>In TriG nested blank nodes can be specified in a graph other than the default graph. When the TriG parser encountered the first nested blank node inside a non-default graph the graph for the triples derived from the parsing of that nested blank node would incorrectly be set to the default graph. This has been fixed to use the correct graph. </p><h4>Bug24642: Incorrect text index query warning</h4><p>AllegroGraph v6.1.4 added a check and warning for text index queries which could not possibly match. Under certain circumstances this check would warn even though the query could match.  This has been corrected. </p><h4>Bug24623 - SNA path finding in remote-triple-stores did not suppport blank nodes</h4><p>If a path contained blank nodes, then the SNA path finding functions would signal an error if used on a remote triple-store. This has been corrected. </p><h4>Bug24615 - Static filter function not re-esablished when attaching to a store</h4><p>Previously when opening an existing triple store, the static attribute filter was not reestablished.  This has been fixed. </p> <h4>Bug24588 - load-nqx does not properly track line numbers</h4><p>When an error occurs loading extended triples via <a href="lisp-reference.html#load-nqx" title="description of load-nqx">load-nqx</a> and <strong>agload</strong> the incorrect line number is reported. This has been corrected. </p><h4>Bug24548: TransactionLogArchive directive doesn't create catalog and repository directories when tlarchiver is initiated</h4><p>AllegroGraph did not previously create the TransactionLogArchive directory when starting a database instance. Instead a "no such file or directory" error was logged when the tlarchiver ran. This has been fixed. The directory (and any subdirectories) are now created when a database instance starts, if needed. </p><h4>Bug24545 - Store specification containing a remote URL could fail</h4><p>A "missing value for argument db.agraph::user" error would occur when starting a session using a store specification containing a remote URL without authentication information. This has been fixed. </p><h4>Bug24342 - load-turtle loses default-attributes for RDF collections</h4><p>Previously the Turtle parser would fail to include attributes when parsing an RDF collection such as: </p>
<pre><code>prefix : &lt;ex://foo#&gt;  
:a :p (1 2 3) . </code></pre><p>This has been fixed. </p><h4>Bug21595 - agload bad error message when given a filespec that does not exist</h4><p>The <strong>agload</strong> program reported misleading error messages when attempting to load files that did not exist or contained wildcards. This has been improved by reporting an accurate and more useful error message. See <a href="agload.html">Data Loading</a> for more information on <strong>agload</strong>. </p><a name='header3-562' id='header3-562'></a><h3>HTTP API</h3><h4>Rfe14967 -  Ensure that the statements REST API uses namespace abbreviations</h4><p>The statements REST API was not using user defined namespaces to abbreviate RDF resources in formats that supported them like turtle or TriG. This has been corrected. </p><h4>Rfe14930 - Improve error message when a file cannot be accessed</h4><p>The <strong>agload</strong> process for loading a local file via the HTTP interface reported misleading and inaccurate error messages when the local file was inaccessible. This has been improved by returning an accurate and useful error message in the HTTP response. </p><a name='header3-567' id='header3-567'></a><h3>SPARQL</h3><h4>Rfe14978 - Improve efficiency for SPARQL datasets with many graphs</h4><p>AllegroGraph now operates on SPARQL datasets with many graphs more efficiently. </p><h4>Rfe14975 - SPARQL dataset validator is inefficient for large dataset specifications</h4><p>The SPARQL engine validates any dataset specification before it begins execution. This change improves the performance of the validation which helps query speed especially when the dataset has more than a few thousand graphs. </p><h4>Rfe14974 - SPARQL parser is inefficient for large dataset specifications</h4><p>SPARQL queries with thousands of FROM and FROM NAMED clauses in their dataset description now parse much more efficiently. </p><h4>Rfe14931 - Improve how property path queries implement filtering</h4><p>SPARQL Property Path queries now handle FILTERs more efficiently. </p><h4>Rfe14899 - Warn if query LIMIT/OFFSET and externally imposed LIMIT/OFFSET conflict</h4><p>Pursuant with the changes made for Rfe14597 (described below), AllegroGraph will now warn if a query's internal and external LIMITs differ or if a both an internal and external OFFSET are supplied. </p><h4>Rfe14597 - Reduce confusion between internal and external query limit and offsets</h4><p>Previously, any externally imposed LIMIT or OFFSET would override the LIMIT or OFFSET in the query string. This was most evident in AGWebView because the web interface uses a dropdown selector to pick the LIMIT and this LIMIT overrode any specified in the query. </p><p>Now, AllegroGraph will: </p>
<ul>
<li>use the <em>minimum</em> of the internal and external LIMITs.</li>
<li>use the <em>sum</em> of the internal and external OFFSETS.</li></ul><h4>Bug24684 - Property Paths and MINUS could interact badly</h4><p>It was possible for queries that used MINUS and Property Paths to generate incorrect answers. This has been corrected. </p><h4>Bug24610 - Trivial equivalence constraints cause an error.</h4><p>Queries containing trivial equivalence constraints, such as <code>filter(?x = ?x)</code>, used to cause the following error: </p>
<pre><code>missing value for argument db.agraph.sbqe::var2 </code></pre><p>This has been corrected. </p><h4>Bug24609 - User attributes set via the SPARQL prefix could be ignored</h4><p>Depending on how a query was executed, any user attributes set via the <code>userAttributes</code> SPARQL query prefix option could be ignored. This has been corrected. </p><h4>Bug24608 - Spurious join results.</h4><p>When performing joins where the left hand side contained unbound values (resulting from the use of OPTIONAL or UNDEF keywords) AllegroGraph could sometimes return the same solution row multiple times. For instance, the following query: </p>
<pre><code>SELECT * {  
  { values (?a ?x ?y) {(0 1 2)} }  
  optional { values (?a ?y ?z) {  
		(0 2 3)  
		(0 undef 4)  
		(undef 2 5) }  
  }  
} </code></pre><p>Would return 4 results, including two copies of the (0 1 2 5) row. This has been corrected. </p><h4>Bug24599 - concatenated-cursors don't support extended triples</h4><p>When a SPARQL query which uses attributes-related magic properties is issued against a graph-filtered triple store, an error like the following can occur: </p>
<pre><code>Executing query failed: #&lt;concatenated-cursor @ #x1000732dc52&gt;  
does not support fat-triples </code></pre><p>This has been fixed. </p><h4>Bug24538 - Invalid effective boolean value of constant strings in filters</h4><p>A query like: </p>
<pre><code>SELECT * {  
 ?s ?p ?o  
 FILTER ("bruce")  
} </code></pre><p>was returning no results when it should have returned every row in the store. Non-blank strings are supposed to have an effective boolean value of "true". Blank strings have an effective boolean value of "false". This has been fixed. </p><h4>Bug24530 - SPARQL-JSON result format does not handle encoded boolean properly</h4><p>Previously, boolean values in SPARQL-JSON results were represented as the strings "0" and "1". Now boolean values are correctly represented as "false" and "true". </p><a name='header3-605' id='header3-605'></a><h3>AGWebView</h3><h4>Rfe14968 - Remove the deprecated <code>planner</code> option from AGWebView</h4><p>Remove the long deprecated <code>planner</code> option from AGWebView's query page. This option has had no effect for some time. </p><h4>Rfe13239 - Provide "no limit" option for query results in AGWebView</h4><p>Subject to the resources of the web browser, AGWebView can now return an unlimited number of results from a query. By default, AGWebView will display 1000 results or use the limit specified by the query (if it is smaller than 1000). Because of this, the <em>More Results</em> button has also been removed. See the <a href="agwebview.html">WebView</a> document for information on AGWebView. </p><h4>Bug24616 - N-Triples parser errors mention NQX</h4><p>When trying to load a .nt or .nq file through AGWebView and a parsing error occurs the error message states that a "NQX" parsing error occurred when it should have stated it was an N-Triples (for .nt) or N-Quads (for .nq) parsing error. This has been fixed to report the correct format type. </p><a name='header3-612' id='header3-612'></a><h3>Changes to the Lisp API</h3><h4>Bug24669 - serialize-nqx does not work on remote-triple-stores</h4><p>Serialization of attributed triples was not working correctly for remote-triple-stores. This has been corrected. </p><h4>Bug24658 - load-nqx fails on remote-triple-stores</h4><p>An error would occur if no default attributes were passed to <a href="lisp-reference.html#load-nqx" title="description of load-nqx">load-nqx</a> on a remote-triple-store. This has been corrected. </p><p>In order to reduce future confusion, the <strong>:attributes</strong> argument to the various load functions in the Lisp API has been changed to <strong>:default-attributes</strong>. Note this is an incompatible change. Code using <code>:attributes</code> will signal an error. </p><h4>Bug24549: open-store-from-specification does not work</h4><p>Previously, attempting to open a triple store using a URL could fail like so: </p>
<pre><code>(open-triple-store "http://localhost:10443/repositories/kennedy")  
Error: Invalid character in triple-store name  
       "//localhost:10443/repositories/kennedy".  
The name may not contain these characters /, \, ~, :,  
Space, $, {, }, &lt;, &gt;, *, +, |, [, ]. </code></pre><p>This has been fixed. </p><a name='header3-622' id='header3-622'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-624' id='header3-624'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-626' id='header3-626'></a><h3>Python Client</h3><h4>Bug24680 - To<em>native</em>string is broken on Python 2</h4><p>The Python client sometimes failed while processing values with non-ascii characters, showing the following error message: </p>
<pre><code>UnicodeEncodeError: 'ascii' codec can't encode characters in position ??: ordinal not in range(128) </code></pre><p>This has been corrected. </p><h4>Bug24443 - getStatements sometimes breaks for raw Python values</h4><p>The getStatements function can be called with a raw Python value, instead of an RDF term, as its third argument (object filter). For instance, the following call: </p>
<pre><code>conn.getStatements(None, somePredicate, True) </code></pre><p>would retrieve all triples with the predicate of somePredicate and the object equal to "true"^^xsd:boolean. </p><p>This mechanism did not work correctly if the second argument (predicate filter) was None. In that case an AttributeError exception would be raised. </p><p>This has been corrected. </p><a name='header3-637' id='header3-637'></a><h3>Java Client</h3><h4>Rfe14990 - Provide methods to download query results</h4><p>The Java client now contains methods to download and save query results to a file. The new methods are: </p>
<ul>
<li>AGRepositoryConnection.downloadStatements</li>
<li>AGRepositoryConnection.streamStatements</li>
<li>AGQuery.download</li>
<li>AGQuery.stream</li></ul><p>Both methods have multiple overloads, allowing for the output path and desired output format to be passed in a variety of ways. </p><h4>Rfe14970 - Speed up AllegroGraph java client connection pools.</h4><p>Depending on the connection pool configuration, many unnecessary requests could be made to the AllegroGraph server when borrowing/returning connections to/from a connection pool. </p><p>These calls have been cleaned up, resulting in improved connection pool performance. </p><h4>Bug24648 - inferredGraph parameter missing from AGMaterializer</h4><p>When materializing triples through the Java API it is now possible to specify the graph into which the generated triples will be added. </p><h4>Bug24644 - Fix TriG import via the Java client.</h4><p>The AllegroGraph Java client would fail when attempting to import TriG data due to the content-type "application/x-trig" being unsupported in the server. </p><p>AllegroGraph now supports TriG data imported with a content-type of either "application/trig" or "application/x-trig". </p><a name='header3-653' id='header3-653'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-621"></a> </p><a name='header2-658' id='header2-658'></a><h2>AllegroGraph 6.2.1</h2><a name='header3-659' id='header3-659'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe14881 - Cross attribute comparisons</h4><p>AllegroGraph 6.2.0 added a restriction against using an attribute filter operator with two different types.  An attempt to perform such an operation would result in a "Comparisons between attributes of different types is not supported" error message. </p><p>This restriction has been removed.  Note, however, that ordered comparisons between different attribute types is still not allowed since there is no defined ordering between two ordered attributes. Triple attrinutes are discussed in <a href="triple-attributes.html">Triple Attributes</a>. </p><h4>Bug24567 - Initial superuser account file owned by root if configure-agraph run as root</h4><p>Previously, if AllegroGraph was installed, configured, and started as root, the directories and account file for the initial superuser remained owned by root. This resulted in the following error the first time the superuser made access to AllegroGraph: </p>
<pre><code>mkstemp failed: Permission denied [errno=13] </code></pre><p>This has been corrected. </p><h4>Bug24557 - Fix bug restoring repositories with a non-default stringTableSize.</h4><p>When restoring repositories with a non-default stringTableSize directive to v6.2.0, a bug in an upgrade step would cause the repo's string table to be set to the default size of 16M. If the stringTableSize was larger than this default, the string table would be truncated, causing data loss and possible corruption. </p><p>This bug has been fixed. </p> <h4>Bug24548 - TransactionLogArchive directive doesn't create catalog and repository directories when tlarchiver is initiated</h4><p>AllegroGraph did not previously create the TransactionLogArchive directory when starting a database instance. Instead a "no such file or directory" error was logged when the tlarchiver ran. This has been fixed. The directory (and any subdirectories) are now created when a database instance starts, if needed. </p> <h4>Bug24342 - load-turtle loses default-attributes for RDF collections</h4><p>Previously the Turtle parser would fail to include attributes when parsing an RDF collection such as: </p>
<pre><code>prefix : &lt;ex://foo#&gt;  
:a :p (1 2 3) . </code></pre><p>This has been fixed. </p><a name='header3-678' id='header3-678'></a><h3>HTTP API</h3><p>No significant changes. </p><a name='header3-680' id='header3-680'></a><h3>SPARQL</h3> <h4>Bug24538 - Invalid effective boolean value of constant strings in filters</h4>
<pre><code>A query like:  
SELECT * {  
 ?s ?p ?o  
 FILTER ("bruce")  
} </code></pre><p>was returning no results when it should have returned every row in the store.  Non-blank strings are supposed to have an effective boolean value of "true".  Blank strings have an effective boolean value of "false".  This has been fixed. </p> <h4>Bug24530 - SPARQL-JSON result format does not handle encoded boolean properly</h4><p>Previously, boolean values in SPARQL-JSON results were represented as the strings "0" and "1".  Now boolean values are correctly represented as "false" and "true". </p><h4>Bug24529 - Some queries using VALUES produce wrong results.</h4><p>Some queries using the VALUES keyword and joins or unions produced incorrect results. More specifically some rows were missing from the result. </p><p>Two examples of such queries are: </p>
<pre><code>select ?x { { values(?x) {(1)} } union { values(?x) {(2)} } } </code></pre><p>and </p>
<pre><code>select ?x ?y ?z { { values (?x ?y ?z) {(1 2 3)} }  
                  { values () {()} }} </code></pre><p>The first one would produce only a single result (2), while the second one would not produce any results. This has been corrected. </p><h4>Bug24528 - Wrong join results when using the CAAT strategy</h4><p>When using the chunk-at-a-time execution strategy some queries that performed left joins with the identity set would produce spurious results. One such query is: </p>
<pre><code>select ?a ?b ?c {  
  { ?a ?b ?c } union { ?c ?b ?a }  
  optional { bind(42 as ?x) }  
} </code></pre><p>This has been corrected. </p><a name='header3-699' id='header3-699'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-701' id='header3-701'></a><h3>Changes to the Lisp API</h3> <h4>Bug24545 - parse-remote-store-specification returns inconsistent results</h4><p>A "missing value for argument db.agraph::user" error would occur when starting a session using a store specification containing a remote URL without authentication information.  This has been fixed. </p><a name='header3-705' id='header3-705'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-707' id='header3-707'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-709' id='header3-709'></a><h3>Python Client</h3><h4>Rfe14695 - Replace pycurl with requests.</h4><p>The HTTP library used by the AllegroGraph Python client has been changed from pycurl to requests. This change means that the Python client no longer depends on any libraries that require native extensions. This results in a simpler installation process, as it is no longer necessary to have a working C development environment on the target machine. </p><p>Note that pycurl will still be used if it is installed, since it might offer better performance in some scenarios. </p><h4>Bug24582 - AGRAPH_PROXY variable not used</h4><p>Proxy settings specified through the AGRAPH_PROXY environment variable used to be ignored. </p><p>This has been corrected. </p><a name='header3-716' id='header3-716'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-718' id='header3-718'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-620"></a> </p><a name='header2-723' id='header2-723'></a><h2>AllegroGraph 6.2.0</h2><a name='header3-724' id='header3-724'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe14846 - Revised triple attribute filter operators</h4><p>There are extensive changes to attribute filter operators, allowing better control when comparing user attributes with triple attributes. New operators include </p>
<pre><code>or, not, empty, overlap, attributes-overlap, subset, superset,  
equal, attribute-set\&lt;=, attribute-set&lt;, attribute-set=,  
attribute-set&gt;, attribute-set&gt;= </code></pre><p>The existing operator <code>attribute&gt;=</code> has been renamed <code>attribute-set&gt;=</code> (the old name is still accepted but users are advised to switch to the new name). See <a href="triple-attributes.html">Triple Attributes</a> for information on attribute filter operators. </p><h4>Rfe14806 - Audit attribute and static filter definitions</h4><p>If auditing is enabled an audit record is made for defining an attribute and for defining the static attribute filter. See the <a href="audit.html">Auditing</a> document for more information on auditing. </p><p>The rdf:type of the new records are: </p>
<pre><code>&lt;http://franz.com/allegrograph/4.11/audit-log#defineAttribute&gt;  
&lt;http://franz.com/allegrograph/4.11/audit-log#deleteAttribute&gt;  
&lt;http://franz.com/allegrograph/4.11/audit-log#defineStaticAttributeFilter&gt; </code></pre><h4>Rfe14773 - Changes to agraph-control</h4><p>The <strong>agraph-control</strong> program that starts and stops AllegroGraph has a new command <em>restart</em>, which requests that the server shut itself down, if running, and then start back up again. The <em>reload</em> command, which reloaded the configuration file, is no longer supported. See the <a href="daemon-config.html#agraph-control">agraph-control</a> section of the <a href="daemon-config.html">Server Configuration and Control</a> document. </p><h4>Rfe14797 - Add permissions for user-attribute specification</h4><p>Added user permissions <code>user-attributes-header</code> (if true, user can send attributes via HTTP as the value of the <code>x-user-attributes</code> header), and <code>user-attributes-prefix</code> (if true, user can specify the user attributes via the SPARQL prefix <code>franzOption_userAttributes</code>. See the <a href="agwebview.html#ManagingUsers">Managing Users</a> section of the <a href="agwebview.html">WebView</a> document for information on user permissions. </p><h4>Rfe14733 - String comparison operator for attribute filter</h4><p>Added the <code>attribute=</code> operator which can be used to compare attributes to other attributes, attributes to strings, or strings to strings. See <a href="triple-attributes.html">Triple Attributes</a> for information on attribute filter operators. </p><h4>Rfe14671 - New configuration option StringTableCompression</h4><p>The <a href="daemon-config.html#stringtablecompress">StringTableCompression</a> configuration option allows specifying the compression type (including no compression) for the string table. The default is <code>lzo999</code> compression. See <a href="daemon-config.html">Server Configuration and Control</a> for information on configuration options. </p><h4>Rfe14661 - agtool combines many command-line programs</h4><p>The <em>*agtool</em> program replaces the programs <strong>agraph-backup</strong>, <strong>agmaterialize</strong>, <strong>agquery</strong>, <strong>agexport</strong>, <strong>agload</strong>, <strong>agraph-recover</strong>, <strong>agraph-replicate</strong>, and <strong>convertdb</strong>. <strong>agtool</strong> takes as its first argument the task to perform (usually indicated by a shortened version of the old program name but sometimes quite different -- so <strong>agraph-backup</strong> becomes <strong>archive</strong> and <strong>convertdb</strong> becomes <strong>upgrade</strong>) and then the various argument and options for that task. For example, in order to load the Ntriples file <em>mytriples.nt</em> into the <em>mystore</em> database in the server listening on port 10035, in earlier releases you ran this command: </p>
<pre><code>% agload --port 10035 mytriples.nt mystore </code></pre><p>now you use <strong>agtool</strong> as follows: </p>
<pre><code>% agtool load --port 10035 mytriples.nt mystore </code></pre><p>(Other argument/option combinations will do the same as those shown.) For most tasks, the arguments and options are the same as with the earlier tools, with the following differrences: </p><p><strong>agraph-backup</strong> (archive), <strong>agmaterialize</strong> (materialize), The <code>--ext-backup-command</code> is no longer supported. Otherwise arguments and options are the same. </p><p><strong>agraph-recover</strong> (recover), <strong>convertdb</strong> (upgrade), these changes: <code>-c</code> accepted for <code>--catalog</code>, <code>-p</code> accepted for <code>--port</code>. </p><p><strong>agload</strong> (load), this change: <code>-u</code> not accepted as synonym for <code>--base-uri</code>. </p><p><strong>agquery</strong> (query) and <strong>agexport</strong> (export), this change: <code>--username</code> is now <code>--user</code> and <code>-u</code> is a synonym of <code>--user</code>. </p><p><strong>agraph-replicate</strong> (replicate), this change: <code>-c</code> accepted for <code>--catalog</code>, <code>-u</code> accepted for <code>--user</code>. </p><p>See the <strong>agtool General Command Utility</strong> document for more information and links to all the documentation for the individual tasks. </p><h4>Rfe13254 - Tools for saving and loading metadata</h4><p>Metadata, that is attribute and static filter definitions, can be saved from a database and loaded into a database. The methods for doing so include using the new <code>--save-metadata</code> option to <strong>agtool export</strong> (see <a href="agexport.html">Data Export</a>) and the new <code>--metadata</code> option to <strong>agtool load</strong> (see <a href="agload.html">Data Loading</a>), along with new Lisp functions and REST API, discussed under Lisp API and HTTP API below. </p><h4>Bug24425 - install-agraph no longer creates a log/ directory</h4><p><strong>install-agraph</strong> would incorrectly create a log/ directory alongside the lib/ and bin/ directories it creates. It no longer does so, leaving the creation of the log directory to tools like <strong>configure-agraph</strong>, <strong>agraph-control</strong>, or the agraph server itself. </p><a name='header3-757' id='header3-757'></a><h3>HTTP API</h3><h4>Rfe13254 - load/save attribute metadata</h4><p>GET and POST metadata commands allow obtaining metadata (attribute and static filter definitions) from a repo and loading them into another repo. See the <a href="http-protocol.html#attributes">Attributes</a> section of the <a href="http-protocol.html">REST/HTTP interface</a> document for details. </p><a name='header3-760' id='header3-760'></a><h3>SPARQL</h3><h4>Rfe14812 - Support attributes in INSERT DATA and INSERT/WHERE</h4><p>The syntax of SPARQL INSERT DATA and DELETE/INSERT/WHERE commands has been extended to support the fine-grained specification of attributes on a per-triple basis. See <a href="triple-attributes.html">Triple Attributes</a> for more information on attributes. </p><h4>Rfe14726 - New prefixes for attributes</h4><p>The <code>defaultAttributes</code> SPARQL query option specifies the attributes to be associated with each triple added via the INSERT DATA, DELETE/INSERT/WHERE, or LOAD commands. The <code>userAttributes</code> query option specifies the user attributes to be used when processing the query. See <a href="triple-attributes.html">Triple Attributes</a> for more information on attributes. </p><h4>Rfe13305 - Old-style SPARQL GEO queries are no longer supported</h4><p>Because AllegroGraph's magic properties support a richer range of geospatial features than the old-style SPARQL GEO syntax, the old syntax was deprecated in 2014 and has now been removed from the code. Any queries that use the old-style syntax will need to be rewritten. </p><p>Magic properties support both the deprecated 2D geospatial encodings and the newer nD ones. </p><h4>Bug24481 - Wrong results for VALUES with a single variable</h4><p>When processing a VALUES clause in a SPARQL query AllegroGraph would return incorrect results if there was exactly one variable bound by that clause and the list of values contained either: </p>
<ul>
<li><p>An UNDEF value: it would be silently ignored (but other values   would still be used). </p></li>
<li><p>Duplicates: each value will be matched exactly once,   regardless of the number of times it appears inside VALUES. </p></li></ul><p>This has been corrected. </p><h4>Bug24470 - Spurious results for SELECT DISTINCT on a bound variable</h4><p>When executing a query which tries to find unique values of an already bound variable like in the example below: </p>
<pre><code>select distinct ?s WHERE {  
  bind(ex:A as ?s) .  
  ?s ?p ?o .  
} </code></pre><p>AllegroGraph would ignore the binding and return all results that match the pattern. This error could be observed only if the single-set execution strategy was used. </p><p>This has been corrected. </p><a name='header3-778' id='header3-778'></a><h3>AGWebView</h3><h4>Rfe14576 - Make deleting namespaces easier on AGWebView Query page</h4><p>You can now delete namespaces on the AGWebView Query page. </p><h4>Rfe14569 - New vmstat-like server performance charts added to WebView</h4><p>A new menu item in the WebView Utilities menu brings up a page of performance charts on the server machine. The several charts show approximately the same machine load data printed by the <em>vmstat</em> command, charted for the past five minutes. AGWebView is documented in the <a href="agwebview.html">WebView</a> document. The new Server Load page is documented <a href="agwebview.html#server-load">here</a> in that document. </p><a name='header3-783' id='header3-783'></a><h3>Changes to the Lisp API</h3><h4>Rfe14797 - New user-attributes-prefix-permission-p keyword argument to run-sparql</h4><p>The function <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> now have a <code>user-attributes-prefix-permission-p</code> keyword argument. It must be given a true value in order to run a SPARQL query including "PREFIX franzOption_userAttributes". </p><h4>Rfe14754 - Allow #\: to be used as the catalog and repository delimiter</h4><p>In addition to using the slash character (#\/), the colon (#\:) can now be used to designate a triple-store in a different catalog. I.e., the following are equivalent: </p>
<pre><code>(open-triple-store "test" :catalog "production")  
(open-triple-store "production/test")  
(open-triple-store "production:test") </code></pre><p>Note that the format AllegroGraph uses to display triple-stores will now be <code>catalog:name</code> rather than <code>catalog/name</code>. </p><h4>Rfe14705 - The triple-store-user (db.agraph.user) package uses the sparql package</h4><p>The <code>triple-store-user</code> package, also named the <code>db.agraph.user</code> package, now uses the <code>sparql</code> package which means that symbols in the <code>sparql</code> package like <code>run-sparql</code> can be used more easily as they do not need to be package qualified. </p><h4>Rfe14703 - :return-fat-triples keyword argument is now :return-extended-triples</h4><p>The <code>return-fat-triples</code> keyword argument to <a href="lisp-reference.html#get-triples" title="description of get-triples">get-triples</a>, <a href="lisp-reference.html#get-triples-list" title="description of get-triples-list">get-triples-list</a>, and <a href="lisp-reference.html#freetext-get-triples" title="description of freetext-get-triples">freetext-get-triples</a> has been renamed <code>return-extended-triples</code>. The new functions <a href="lisp-reference.html#extended-triple-triple" title="description of extended-triple-triple">extended-triple-triple</a> and <a href="lisp-reference.html#extended-triple-attributes" title="description of extended-triple-attributes">extended-triple-attributes</a> return the triple and the attributes (respectively) of an extended triple. The new function <a href="lisp-reference.html#copy-extended-triple" title="description of copy-extended-triple">copy-extended-triple</a> makes a copy of an extended triple. </p><h4>Rfe13254 - New functions to load/save attribute metadata</h4><p>The functions <a href="lisp-reference.html#get-metadata" title="description of get-metadata">get-metadata</a>. <a href="lisp-reference.html#set-metadata" title="description of set-metadata">set-metadata</a>, <a href="lisp-reference.html#load-metadata" title="description of load-metadata">load-metadata</a>, and <a href="lisp-reference.html#save-metadata" title="description of save-metadata">save-metadata</a> allow retrieving metadata (attribute and static filter definitions) from a store and adding metadata to a store. The metadata can be transmitted as a string or written/read from a file. </p><a name='header3-796' id='header3-796'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-798' id='header3-798'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-800' id='header3-800'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-802' id='header3-802'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-804' id='header3-804'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-616"></a> </p><a name='header2-809' id='header2-809'></a><h2>AllegroGraph 6.1.6</h2><a name='header3-810' id='header3-810'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe14785 - Allow default session idle timeout to be set in agraph.cfg</h4><p>Two new configuration parameters have been defined for controlling the default and the maximum allowed session idle timeout. <code>DefaultSessionTimeout</code> specifies the default timeout and <code>MaximumSessionTimeout</code> specifies the maximum timeout.  See the description of those directives in the <a href="daemon-config.html#TopLevel">list of top-level directives</a> in <a href="daemon-config.html">Server Configuration and Control</a> for details. </p><h4>Bug24519 - Path-finding broken on remote-reasoning-triple-store</h4><p>Path-finding operations (such as depth-first-search) were broken for remote-reasoning-triple-stores since v6.1.4.  This has been fixed. </p><h4>Bug24389 - Bus error when adding triples with unspecified graph to security-filtered-triple-store</h4><p>Previously, adding a triple to a security-filtered-triple-store could result in a bus error.  This has been fixed. </p><h4>Bug24221 - String table configuration mismatch during restore.</h4><p>An error would occur when trying to restore a database that was backed up in AllegroGraph prior to version 6 if the catalog it was restored to had a string table size different than the default 16M entries. </p><p>The error was: </p>
<pre><code>&gt; String table configuration mismatch: Configured number of slots X  
 does not match recovered number of slots (16777216) </code></pre><p>This has been corrected. </p><a name='header3-822' id='header3-822'></a><h3>HTTP API</h3><p>No significant changes. </p><a name='header3-824' id='header3-824'></a><h3>SPARQL</h3><h4>Bug24463 - Binding produced index out of range error during query</h4><p>Some queries using BIND used to fail with the above error message. This has been corrected. </p><a name='header3-827' id='header3-827'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-829' id='header3-829'></a><h3>Changes to the Lisp API</h3><p>No significant changes. </p><a name='header3-831' id='header3-831'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-833' id='header3-833'></a><h3>Documentation</h3><h4>Bug24427 - Javadocs missing from agraph server distribution</h4><p>Previously the Javadocs for the AllegroGraph Java client were missing from the installed documentation set.  This has been fixed. </p><a name='header3-836' id='header3-836'></a><h3>Python Client</h3><h4>Rfe14803 - Support for decimal literals</h4><p>Literal objects constructed from Python's Decimal values will now have the default datatype of <code>xsd:decimal</code>. </p><h4>Rfe14694 - Drop support for cjson</h4><p>The Python client no longer uses the cjson library. Python 2.6 users should install the simplejson library instead to avoid a significant degradation in performance. Other versions of Python are unaffected. </p><h4>Bug24428 - Creating literals from time objects with timezone</h4><p>RepositoryConnection.createLiteral used to raise an error when passed a datetime.time instance that contains time zone information. This has been corrected - such calls will now return literals of type xsd:time with time value converted to UTC. </p><h4>Bug24405 - Non-ASCII characters in addData()</h4><p>The Python client used to raise an exception (specifically a UnicodeDecodeError) if the data passed to addData was a Unicode string containing non-ASCII characters. </p><p>This has been corrected.<br />
</p><h4>Bug24322 - Python clients reads imported file into memory</h4><p>When uploading data to the server the Python client used to read the whole file into memory before sending it. This could cause out of memory errors for larger files. To avoid this issue, the client now sends files in chunks. This method requires only a limited amount of memory. </p><a name='header3-848' id='header3-848'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-850' id='header3-850'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-615"></a> </p><a name='header2-855' id='header2-855'></a><h2>AllegroGraph 6.1.5</h2><a name='header3-856' id='header3-856'></a><h3>AllegroGraph Server: General Changes</h3><h4>Bug24442 - Fix intermittent query failures that report a "broken pipe" error</h4><p>A bug was introduced in v6.1.3 where requests could fail inappropriately under certain conditions, with a "broken pipe" error message appearing in agraph.log or reported in AG WebView. This has been fixed. </p><h4>Bug24412: agload incorrect line number reporting on invalid character</h4><p>The <strong>agload</strong> program (see <a href="agload.html">Data Loading (<em>agload</em>)</a>) could report incorrect line numbers if errors were encountered when loading large N-Triples and N-Quads files in parallel. This problem could only occur if the files were larger 4MB.  This has been corrected. </p><a name='header3-861' id='header3-861'></a><h3>HTTP API</h3><p>No significant changes. </p><a name='header3-863' id='header3-863'></a><h3>SPARQL</h3><h4>Bug24352 - In FILTERs can be handled very inefficiently</h4><p>SPARQL queries that constrain a particular binding to a set of values could operate very inefficiently in some circumstances. Such queries include ones that use the IN FILTER or that use the VALUES clause to supply a list of possible matches. The inefficiency has been corrected. </p><a name='header3-866' id='header3-866'></a><h3>AGWebView</h3><h4>Bug24423 - WebView hangs if HTTP tracing is enabled.</h4><p>Previously AGWebView would hang on page load if HTTP tracing was enabled. This has been fixed. </p><a name='header3-869' id='header3-869'></a><h3>Changes to the Lisp API</h3><p>No significant changes. </p><a name='header3-871' id='header3-871'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-873' id='header3-873'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-875' id='header3-875'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-877' id='header3-877'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-879' id='header3-879'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-614"></a> </p><a name='header2-884' id='header2-884'></a><h2>AllegroGraph 6.1.4</h2><a name='header3-885' id='header3-885'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe14558 - If possible increase the file descriptor limit at startup</h4><p>If the agraph server is started as root it will set the number of file descriptors agraph can use to 65536 thus not being limited by the default operating system setting (which is usually quite low). </p><p>If the file descriptor limit is raised you'll see a line like the following in agraph.log just after the server starts: </p>
<pre><code>[2016-11-08T17:07:23.956 p13419 daemon] Set fd limits soft: 65536, hard: 65536 </code></pre><h4>Rfe11277 - Warn when a freetext query tries to match on things that cannot possibly match</h4><p>AllegroGraph now generates a query warning when a freetext search expression cannot possibly find matches. For example, the default stop words in an AllegroGraph freetext index include <em>the</em> and <em>an</em> so it is impossible to search for matches on the expression <code>(or 'an' 'the')</code>. This means that a query like </p>
<pre><code>select * { ?s fti:match 'the || an' . } </code></pre><p>will return no results. Previously, AllegroGraph would have returned no results without generating a warning. Now, AllegroGraph will warn that <code>The freetext expression </code>the || an<code> cannot succeed</code>. </p><h4>Rfe11046 - Release fds for free text index disk tries</h4><p>Making use of a free text index will require far fewer file descriptors than before. </p><h4>Bug24395 - TriG parser errors could print that they were from the Turtle parser</h4><p>Some TriG parser errors incorrectly indicated that the current parser was using Turtle syntax rather than TriG. This has been corrected. </p><h4>Bug24349: Transaction log archiving to same filesystem broken</h4><p>Transaction log archiving was broken in v6.1.2 when archiving to the same filesystem. This problem is now corrected. </p><h4>Bug23354 - Check SSL cert when frontend starts</h4><p>If the SSL certificate information you put in your configuration file is not correct AllegroGraph will log an error and exit during server startup. Previously you didn't find out about SSL certificate errors until the first https request came to the server. </p><h4>Bug24332 - AllegroGraph doesn't fail gracefully if it cannot claim desired ports</h4><p>Previously, if AllegroGraph was unable to bind the TCP port specified by the Port configuration directive, it would leave some lingering processes after printing the error message.  This has been fixed. </p><h4>Bug24297 - &lt;http://www.w3.org/2005/xpath-functions#:translate&gt; was broken</h4><p>The XPath translate function could not be used between AllegroGraph 6.0.2 and 6.1. This has been corrected. </p><p>If a query attempted to use the translate function, it would get a parse time error. </p><a name='header3-907' id='header3-907'></a><h3>HTTP API</h3><p>No significant changes. </p><a name='header3-909' id='header3-909'></a><h3>SPARQL</h3><h4>Rfe14722 - Improve planning speed for SPARQL queries that use IN filters</h4><p>The code generated for evaluating SPARQL IN queries has been optimized for some common cases. This will result in faster plan times for such queries. </p><h4>Bug24383 - Sparql Update can fail if the WHERE part uses string literals</h4><p>If the WHERE portion of a SPARQL DELETE/INSERT/WHERE command used string literals that were not already interned in the triple-store in FILTER expressions, then it was possible for the UPDATE to fail. This has been corrected. </p><a name='header3-914' id='header3-914'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-916' id='header3-916'></a><h3>Changes to the Lisp API</h3><h4>Rfe14736 - Add graph parameter to SNA path finding functions</h4><p>The various SNA path finding functions like <code>all-depth-first-search-paths</code> and <code>bidirectional-distance</code> all take a new <code>graph/s</code> parameter. This can specify either a single graph or a list of graphs that will be used to restrict path search to only triples from these graphs. </p><h4>Rfe14721 - Path finding functions accept lists of predicates as generators</h4><p>The Lisp API to AllegroGraph's Social Network Analysis path finding algorithms has been extended. Previously, the functions took a generator that must have been previously defined. Now, you can pass a list of predicates in the place of a generator and these will be used to create a generator on the fly. Note that this added flexibility does come at the cost of between 5 and 10 percent slower performance so predefined generators are to be preferred. </p><p>The syntax of the predicate list is as follows. Each element in the list must be one of </p>
<ul>
<li><code>predicate URI</code></li>
<li>(:undirected <code>predicate URI</code>)</li>
<li>(:subjects-of <code>predicate URI</code>)</li>
<li>(:objects-of <code>predicate URI</code>)</li></ul><p>For example, we can find the paths between ex:A and ex:B using undirected links on either ex:knows or ex:likes via the following: </p>
<pre><code>(all-breadth-first-search-paths  
  !ex:A !ex:B  
  '((:undirected !ex:knows) (:undirected !ex:likes))) </code></pre><p>This change also adds a new REST API to the path finding algorithms via <code>sna/paths</code>. See the HTTP reference for details. </p><h4>Bug24293 - Some plain literals could be printed incorrectly</h4><p>Changes in AllegroGraph 6.1 made it possible for some plain literals to print incorrectly in some situations when using remote-triple-stores. For example, the literal <code>a/b/c</code> could print as <code>a/b"/c</code>. </p><p>This has been corrected. </p><a name='header3-932' id='header3-932'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-934' id='header3-934'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-936' id='header3-936'></a><h3>Python Client</h3><h4>Rfe14693 - Allow data import from strings</h4><p>A new method named addData has been added to the connection class. This method makes it possible to add RDF data stored in a string to the store. All RDF data formats supported by addFile can be used. </p><h4>Rfe14692 - Add more RDFFormats</h4><p>The only formats supported during data import (addFile) used to be N-Triples and RDF/XML. It is now possible to use other formats, namely Turtle, TriG, N-Quads, NQX and TriX. The addFile method is now capable of determining the correct format based on the filename. When using this capability it is also possible to import gzip compressed files. </p><p>bug24379: HTTPS in Python does not work with Basic auth </p><p>The Python client used to only allow HTTPS connections if a client certificate was used for authentication. </p><p>It is now possible to connect to HTTPS servers by passing either a <code>host</code> value starting with 'https://' or a <code>protocol</code> value of 'https' when creating the server object. </p><a name='header3-944' id='header3-944'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-946' id='header3-946'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-613"></a> </p><a name='header2-951' id='header2-951'></a><h2>AllegroGraph 6.1.3</h2><a name='header3-952' id='header3-952'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe14363: Add binary-only, non-interactive modes for install-agraph</h4><p>Two command-line options have been added to install-agraph to support non-interactive installation: </p>
<ul>
<li><code>--no-configure</code>: do a binary-only install. Skips the <strong>configure-agraph</strong> step.</li>
<li><code>--supersede</code>: skip interactive prompt and overwrite installation directory if it exists.</li></ul><p>Installation and configuration are described in the <a href="server-installation.html">Server Installation</a> document. </p><h4>Bug24253 - Triple-store statistics could become stale when new datatypes were added</h4><p>It was possible for the statistics AllegroGraph keeps on each predicate to become stale if triples were added with heretofore unseen XSD datatypes. This has been corrected. </p><h4>Bug24245 - Text index word filters and wildcard search do not work together</h4><p>A freetext index that used word filters like <code>drop-accent</code>s or the stemmer could fail to find matches when using wildcard searches. This has been corrected. </p><a name='header3-962' id='header3-962'></a><h3>HTTP API</h3><p>No significant changes. </p><a name='header3-964' id='header3-964'></a><h3>SPARQL</h3><h4>Bug24273 - The SPARQL RAND() function was being evaluated at plan time</h4><p>AllegroGraph was mistakenly evaluating the SPARQL RAND() function at plan time rather than query execution time. This could lead to incorrect results and has been corrected. </p><h4>Bug24214 - Querying using the direct reification magic property returns at most one match</h4><p>AllegroGraph's direct reification magic property only returned the first matching triple. This has been corrected so that all matches are returned. </p><a name='header3-969' id='header3-969'></a><h3>AGWebView</h3><h4>Rfe14205: Maintain and provide information on live HTTP requests</h4><p>A new page, Admin -&gt; Requests, was added in AGWebView. It shows all the currently running and recently finished HTTP requests handled by AllegroGraph and its subprocesses. </p><h4>Bug24256 - Regular users cannot see catalogs</h4><p>The catalogs list displayed on the main WebView page used to contain only the catalogs for which the current user has 'read' access to all repositories therein. </p><p>The list now contains catalogs for which the user has 'read' access to at least one repository therein. </p><a name='header3-975' id='header3-975'></a><h3>Changes to the Lisp API</h3><p>No significant changes. </p><a name='header3-977' id='header3-977'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-979' id='header3-979'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-981' id='header3-981'></a><h3>Python Client</h3><h4>Bug24300: Python shutdown hang</h4><p>Previously if a session was created but not closed before Python was ready to exit, the shutdown of Python could be delayed by a very long time.  This problem has been fixed.  However, it is always best to call closeSession() on a session when it is no longer needed. </p><h4>Bug24290 - Changes to Python tutorial</h4><p>The Python tutorial is now configurable using environment varaibles which provide information about the catalog, username, password, etc. See the <a href="python/tutorial.html">Python Tutorial</a> for more information. </p><a name='header3-986' id='header3-986'></a><h3>Java Client</h3><h4>Bug24238 - Java API Unicode issues</h4><p>The Java client used to incorrectly process non-ascii characters in results of CONSTRUCT queries. Such characters were replaced by question marks. A similar problem could be observed with results of some other calls (e.g. evalInServer) on platforms where the default encoding used by Java is not UTF-8. A notable example is Windows, where the encoding tends to be CP-1252 (although that depends on the language). </p><p>Both issues have been corrected. </p><a name='header3-990' id='header3-990'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <p><a name="changes-612"></a> </p><a name='header2-995' id='header2-995'></a><h2>AllegroGraph 6.1.2</h2><a name='header3-996' id='header3-996'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe14561 - Remove the deprecated --encoding option from agload</h4><p>Previously, the <code>-C/--encoding</code> option was used to allow <strong>agload</strong> to process N-Triples and N-Quads files encoded in a character encoding other than UTF-8. </p><p>This option has been removed. All N-Triples and N-Quads files with non-standard encoding must be converted with a separate tool, such as <a href="https://en.wikipedia.org/wiki/Iconv">iconv</a>, prior to being processed by <strong>agload</strong>. <strong>agload</strong> is described in the <a href="agload.html">Data Loading (<em>agload</em>)</a> document. </p><h4>Bug24233 - Install-agraph.sh errors on tutorial directory when overwriting</h4><p>When installing AllegroGraph to an existing installation directory, an error would occur when attempting to install the tutorial directory. This is now fixed. </p><a name='header3-1002' id='header3-1002'></a><h3>HTTP Client</h3><p>No significant changes. </p><a name='header3-1004' id='header3-1004'></a><h3>SPARQL</h3><p>No significant changes. </p><a name='header3-1006' id='header3-1006'></a><h3>AGWebView</h3><h4>Rfe14407 - Use RDF syntax for displaying namespaces in AGWebView</h4><p>The display style of namespace abbreviations in AGWebView was changed so that they can now be copied and pasted into a SPARQL query. </p><h4>Bug24194 - Free text search URI incorrectly parsed slashes in WebView</h4><p>In WebView, URLs of full-text search and script pages were incorrectly parsed if their arguments contained slashes. This has been corrected. </p><h4>Bug24172 - Namespace sorting and duplicate inconsistencies in WebView</h4><p>In AGWebView, namespace abbreviations on the Namespaces and Query pages are now sorted alphabetically. Also, adding a namespace with a duplicate prefix is now forbidden. To modify a namespace, delete it and add it, modified, again. </p><h4>Bug22807 - WebView error when asking for the plan of a SPARQL update command</h4><p>AllegroGraph signaled an error when asked to display the plan of a SPARQL Update command. This has been corrected. </p><a name='header3-1015' id='header3-1015'></a><h3>Changes to the Lisp API</h3><h4>Bug23492 - with-query-environment is not documented</h4><p>Documentation has now been added for <a href="lisp-reference.html#with-query-environment" title="description of with-query-environment">with-query-environment</a>. That macro ensures all cursors created in its body are discarded when the body completes.<br />
</p><a name='header3-1018' id='header3-1018'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-1020' id='header3-1020'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-1022' id='header3-1022'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-1024' id='header3-1024'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-1026' id='header3-1026'></a><h3>Javascript Client</h3><h4>Bug24207 - Javascript client library could leak cursors</h4><p>It was possible for scripts using the Javascript client library to leave cursors in an active state. Although these cursors are eventually freed, they use resources and can cause lock contention. The problem is now corrected: Javascript scripts will always close all cursors automatically. </p><a name='header3-1029' id='header3-1029'></a><h3>nD Geospatial</h3><p>No significant changes. </p>  <a name='header2-1033' id='header2-1033'></a><h2>AllegroGraph 6.1.1</h2><a name='header3-1034' id='header3-1034'></a><h3>AllegroGraph Server: General Changes</h3><h4>Rfe14493 - Print progress messages during long restores.</h4><p>During a database restore by <strong>agraph-backup</strong> a progress report is periodically printed to stdout, showing the fraction of the data file which has been processed, the recent processing rate, and an estimate of the completion time. See <a href="backup-and-restore.html">Backup and Restore</a>. </p><h4>Bug24168 - Wrong triple count after a delete with duplicate suppression</h4><p>Deleting an uncommited triple could cause AllegroGraph to report an incorrect triple count (possibly negative) if duplicate suppression was active at commit time. </p><p>This has been corrected. </p><h4>Bug24153 - owl:sameAs interferes with owl:transitiveProperty during materialization</h4><p>The presence of owl:sameAs assertions could lead to AllegroGraph failing to infer all owl:transitivePropery triples during materialization. This has been corrected. (Note that this problem only occurred using the materializer and not the dynamic RDFS++ reasoner). </p><h4>Bug24147 - Support "null" as a synonym for the default graph</h4><p>The remove-graph-uri, insert-graph-uri and using-graph-uri parameters of the SPARQL and Prolog HTTP endpoints now allow the default graph to be referred to by using the string "null" as the URI. </p><p>This resolves a problem with the Java client in which SPARQL Update queries issued through the Jena API did not work as expected. Specifically, a WHERE clause would fail to match any triples unless a graph was specified explictly in the query. </p><a name='header3-1045' id='header3-1045'></a><h3>HTTP Client</h3><p>No significant changes. </p><a name='header3-1047' id='header3-1047'></a><h3>SPARQL</h3><p>No significant changes. </p><a name='header3-1049' id='header3-1049'></a><h3>AGWebView</h3><h4>Bug24062 - AGWebView uses "Repository" and "Store" interchangeably</h4><p>In WebView, both "repository" and "store" (and also "triple store) were used to describe repositories. Now, "repository" is used in all places. The <a href="agwebview.html">documentation</a> has been updated to reflect the change, </p><h4>Bug24173 - TypeError when going back to query view with saved query result in AGWebView</h4><p>In <a href="agwebview.html">AGWebView</a>, going back to a recent query view with cached result caused a harmless error to appear on the browser console. This has been corrected. </p><a name='header3-1054' id='header3-1054'></a><h3>Changes to the Lisp API</h3><h4>Bug24179 - Unicode issues in the remote Lisp client.</h4><p>The remote Lisp client in AllegroGraph 6.1 used to fail in an unpredicatable manner if non-ascii characters were present in query results. </p><p>This has been corrected. </p><a name='header3-1058' id='header3-1058'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-1060' id='header3-1060'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-1062' id='header3-1062'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-1064' id='header3-1064'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-1066' id='header3-1066'></a><h3>nD Geospatial</h3><p>No significant changes. </p> <p><a name="v61-changes"></a> </p> <a name='header2-1071' id='header2-1071'></a><h2>AllegroGraph 6.1</h2><a name='header3-1072' id='header3-1072'></a><h3>Server Changes</h3><h4>Rfe14282 TBC 5.1.4 plugin</h4><p>AllegroGraph plugin for TopBraid Composer has been updated to be compatible with TBC 5.1.4. See <a href="TBCplugin.html">TopBraid Composer Plugin</a> for more information. </p><h4>Rfe14279 - agraph-backup should shut down instances</h4><p>Previously, <strong>agraph-backup</strong> would leave instances open and lingering after performing a backup or restore operation. This could result in hangs due to memory exhaustion when running <em>backup-all</em> or <em>restore-all</em> operations across many repositories. The likelihood of hang would depend on a combination of repository size and the value of the InstanceTimeout directive. </p><p>Now, <strong>agraph-backup</strong> will attempt to shut down the instance process of all repositories it operates on, as soon as the operation has completed. <strong>agraph-backup</strong> is described in the <a href="backup-and-restore.html">Backup and Restore</a> document. </p><h4>Rfe14273 - Reduce repeated query log messages</h4><p>AllegroGraph was repeating some messages unnecessarily when logging query execution. This repetition has been reduced. </p><h4>Bug24130 - Access to the system initfile should be protected</h4><p>It was possible for any user to access the contents of the AllegroGraph init file. This has been corrected. Now only users with <code>superuser</code> privileges will be allowed to view the file. </p><h4>Bug24128 - Blank nodes in RDF/XML collections</h4><p>When parsing an RDF/XML file containing a collection with a blank node as one of its elements, AllegroGraph used to generate an invalid triple (using "li" as the predicate, instead of one of <em>1, </em>2, _3, ...). </p><p>This has been corrected. </p><h4>Bug24126 - RDF/XML parser incorrectly handles empty elements.</h4><p>The RDF/XML parser used to incorrectly handle empty literals encoded as property elements with empty bodies. The parser would generate a blank node instead of an empty literal. </p><p>This has been corrected. </p><h4>Bug24079 - agload with '--error-strategy ignore' and unrecognized file types</h4><p><strong>agload</strong> will now print a warning before ignoring a file of an unrecognized type regardless of the value of the <code>--error-strategy</code> argument. <strong>agload</strong> is described in the document <a href="agload.html">Data Loading</a>. Example: </p>
<pre><code>agload --error-strategy ignore repo wrong-file  
Cannot guess the format of wrong-file. Use --input to specify it.  
Load finished 0 sources in 00:00:01 (1.00 seconds).  No triples added.  
Terminating agload processes, please wait... </code></pre><p>Compare with previous behavior: </p>
<pre><code>agload --error-strategy ignore repo wrong-file  
Load finished 0 sources in 00:00:01 (1.00 seconds).  No triples added.  
Terminating agload processes, please wait... </code></pre><h4>Bug24066 - Sessions did not close their databases after idle timeout expires</h4><p>When a session expired after a given timeout, it would not close its database until another session was started. This has been corrected. </p><h4>Bug23964 - Incorrect escaping of IRIs in Turtle output</h4><p>AllegroGraph used to incorrectly escape some characters when using the Turtle format. Furthermore, spaces and a few other characters that are not legal in IRIs were not escaped at all. Other characters, such as double quotes, were escaped using an invalid syntax (\" instead of \u0022). </p><p>Qualified names were affected by a similar problem. </p><p>This has been corrected - all characters are now properly escaped in both IRIs and qualified names. </p><h4>Bug23960 - gz file import is broken</h4><p>Importing .gz or .bz2 files using single-threaded import used to cause an error as the file was not correctly uncompressed. </p><p>This has been corrected. </p><h4>Bug23828 - CSRF vulnerability in file upload</h4><p>The import dialog in AGWebView was not adequately protected against Cross-Site Request Forgery (CSRF) attacks. When a logged-in user visited a malicious web site, an attacker could import arbitrary triples into any store the user can access. </p><p>This has been corrected - a CSRF attempt will now result in a password prompt. </p><h4>Bug23820: Prevent repository access when a restore is in progress</h4><p>Previously, an attempt to access a repository while it was in the process of being restored could result in random errors and problems, including being unable to close a repository. This change improves the way in which AllegroGraph notes that a repository is being restored, and improves the check for restore-mode so that these issues are prevented. </p><h4>Bug23705 - A triple-store must be open to define SPIN magic properties</h4><p>Changes in AllegroGraph 6.0 required that a triple-store be open before any SPIN magic properties could be defined. This has been corrected. </p><h4>Bug23339 - Canonical escaping in N-Triples</h4><p>AllegroGraph used to produce invalid escape sequences in URIs when printing triples in the N-Triples format. Some reserved characters, such as double quotes, were escaped with a backslash. Others were not escaped at all. </p><p>This has been corrected. All reserved characters are now properly escaped using the \u notation. </p><p>In addition, escaping of strings in N-Triples has been modified to make the output match the canonical form described in the standard. The most notable change is that non-ascii characters are no longer escaped. </p><h4>Bug23181 - Consistency bug when backing up deleted bitmap</h4><p>If a triple was deleted while backup was in progress, that triple would also be marked as deleted in the restored store. This has been fixed, backup now represents a consistent state of the store at the time it was started. </p><h4>Bug22115: Fix configure-agraph handling of passwords.</h4><p>configure-agraph could crash when entering passwords that contain certain non-alphanumeric characters in them. This bug has now been fixed. </p><h4>Bug21655 - serialize-rdf/xml can emit illegal xml characters</h4><p>In XML, control characters (e.g. NUL, BEL, STX, ...) cannot be represented in any form. The RDF/XML serializer (with the Lisp function <a href="lisp-reference.html#serialize-rdf:2Fxml" title="description of serialize-rdf/xml">serialize-rdf/xml</a>, used by <strong>agexport</strong> when passed <code>--output rdfxml</code>) used to silently output such characters, producing files that could not be parsed. </p><p>This has been corrected - if the serialized data contains any invalid characters an error will be reported, as in the following example: </p>
<pre><code>bash-4.2$ agexport -o rdfxml store output.rdf  
open the triple-store store on port 10035 and export to ...  
Warming up the store  
Error Unable to escape character U+0008 (Backspace). occurred during processing  
logging error to /.../agexport.log  
</code></pre><h4>Bug20220 - Fix bug when validating the --loaders argument to agload</h4><p>The <code>--loaders</code> argument to <a href="agload.html">agload</a> accepts as a value a positive integer between 1 and 32. On machines with a large number of cores, <strong>agload</strong> would default to a number of loaders greater than 32 and then error due to the value being too large. This validation bug is now fixed. </p><a name='header3-1123' id='header3-1123'></a><h3>HTTP Client</h3><h4>Rfe14445 - Add REST API for [catalogs/CATNAME]/respositories/REPONAME/exists</h4><p>AllegroGraph's REST API now includes </p>
<pre><code>[catalogs/CATNAME]/respositories/REPONAME/exists </code></pre><p>which can be used to determine whether or not the named repository exists. It will return a 404 code if the repository does not exist and a 200 response with the body <code>true</code> if it does. </p><h4>Bug23942 - Handle HTTPS scheme for SPARQL UPDATE LOAD command</h4><p>The SPARQL UPDATE LOAD command would fail when using the HTTPS URL scheme. This has been corrected. </p><h4>Bug23817 - Running a query that used MINUS repeatedly via REST could error</h4><p>Under certain circumstances, if a SPARQL query that used MINUS was evaluated more than once using the HTTP REST API, AllegroGraph could signal an error. This has been corrected. </p><a name='header3-1132' id='header3-1132'></a><h3>SPARQL</h3><h4>Rfe14278 - Improve SPARQL SERVICE efficiency for AllegroGraph endpoints</h4><p>AllegroGraph now uses a more efficient binary data format when communicating with AllegroGraph-based SPARQL endpoints. This can lead to large performance improvements for SPARQL SERVICE calls. </p><h4>Rfe14257 - DISTINCT|REDUCED mode should be passed on to SERVICE calls</h4><p>When the main query uses DISTINCT or REDUCED, any use of SPARQL federation will pass on the modifier to endpoints. This can greatly reduce overall IO. </p><h4>Rfe14254 - SERVICE should remove duplicates from any VALUES it passes along</h4><p>If the main query is using the DISTINCT or REDUCED modifier, then the SERVICE requests should remove duplicate rows from the list of VALUES that is passed to the endpoint. This can make the query much more efficient. </p><h4>Rfe14086 - New SPARQL functions for performing haversine calculations.</h4><p>These SPARQL functions accept various combinations of latitude/longitude coordinates and nD encoded literals. They compute distances on the Earth's surface. </p>
<ul>
<li><strong>haversineLatLonLatLon</strong></li>
<li><strong>haversineLatLonLoc</strong></li>
<li><strong>haversineLocLoc</strong></li></ul><p>The individual names indicate the required argument types: a <code>Lat</code> or <code>Lon</code> must be a number interpreted as degrees. A <code>Loc</code> must be an nD literal that encodes a latitude and a longitude. Its nD encoding must be registered in the open database, but is not needed in any of the function calls themselves. </p><p>Each of these functions accepts an optional additional argument specifying the units of the computed result.  It may be :km (default) or :miles expressed as a resource in the keyword namespace, i.e., &lt;http://franz.com/ns/keyword#km&gt; or &lt;http://franz.com/ns/keyword#miles&gt;. </p><p>See the <a href="sparql-reference.html#sparql-functions-list">SPARQL functions list</a> for a list of SPARQL function with links to further documentation. </p><h4>Rfe11390 - Modify SPARQL 1.1 lexer/parser to match changes to standard</h4><p>The SPARQL parser used to fail when the input contained any: </p>
<ul>
<li>Qualified names containing backslash escapes in the local part,  such as <code>ns:something\#\.</code> </li>
<li>Qualified names containing percent escapes in the local part,  such as <code>ns:something%23%2E</code> </li>
<li>'.' not followed by whitespace, for example:  <code>?s ?p ?o.filter(?o &gt; 42)</code> </li>
<li>Some expressions containing longer products, such as:  <code>select ?x {bind (1+1*1*1 as ?x)}</code> </li></ul><p>All mentioned cases are now parsed correctly, in accordance with the SPARQL grammar. </p><h4>Bug24161 - Correct possible segmentation faults during SPARQL DELETE operations</h4><p>Under some circumstances, a SPARQL DELETE command could cause a segmentation fault. This has been corrected. </p><h4>Bug24103 - Correct problem in nD magic property SPARQL queries</h4><p>It was possible to get an error when executing a query that combined nD magic properties and other patterns. This has been corrected. </p><h4>Bug24030 - An empty IN filter is ignored if there are any other IN filters</h4><p>If a SPARQL query contained two or more IN filters that were associated with the same triple pattern <em>and</em> one of the IN filters was empty, then both IN filters were ignored. This has been corrected. </p><h4>Bug24026 - Fix query failure when using DISTINCT, SERVICE and magic predicates</h4><p>It was possible for a query to fail during planning if it used multiple SERVICE clauses, the service clauses used magic predicates, and the query asked for DISTINCT results. This has been corrected. </p><h4>Bug24020 - Property path queries in saved plans with Chunk-at-a-Time engine can lose solutions</h4><p>It was possible for some solutions to be lost on subsequent runs of a saved query plan using the Chunk-at-a-Time execution engine if the query used SPARQL OneOrMorePath or ZeroOrMorePath property path expressions. This bug sometimes appeared when running queries in AGWebView because it directs AllegroGraph to use saved plans. This has been corrected. </p><h4>Bug23988 - Fix query failure in federations of reasoning and non-reasoning stores</h4><p>Some queries could fail with an error in a federated triple-store composed of a mix of reasoning and non-reasoning leaf stores. This has been corrected. </p><h4>Bug23949 - Filtering on multiple language tags could fail</h4><p>The FILTERing machinery in AllegroGraph's SPARQL engine could fail to correctly process collections of language tag checks. For example, a query with a filter like: </p>
<pre><code>FILTER( lang(?x) = 'fr' || lang(?x) = 'en' ) </code></pre><p>could fail. This has been corrected. </p><h4>Bug23897 - Query warnings are incorrectly cached</h4><p>Query warnings saved in SPARQL plans were not being updated to take account of changes in the underlying store. </p><h4>Bug23893 - Federated-triple-stores and statistics caching could lead to poor plans</h4><p>The caching of store statistics could lead to incorrect plans when querying a federated-triple-store. This has been corrected. </p><h4>Bug23889 - Correct breakage in solR magic property queries</h4><p>The SPARQL magic properties for solR queries were broken in AllegroGraph 6.0. This has been corrected. </p><h4>Bug23884 - Constant pattern only CONSTRUCT could fail when executed via a saved plan</h4><p>If a CONSTRUCT query template contained only constant patterns (i.e., no variables), and there was a limit on the query, and the query was being executed via a saved plan, then only the first execution would return results and subsequent executions would return nothing. This has been corrected. </p><h4>Bug23882 - Algebraic query combines some BGPs too aggressively</h4><p>The query planner was sometimes combining BGPs and inadvertently producing cross-products which could lead to slower query performance. This has been corrected. </p><h4>Bug23881 - FILTER clause could be lost in complex SPARQL queries</h4><p>It was possible for a FILTER clause to be lost during query planning. This has been corrected. </p><h4>Bug23873 - Neither limit nor planner should require eval permission</h4><p>Users without 'eval' permissions were unable to choose a planner or limit for a query. This has been corrected. </p><h4>Bug23870 - Restriction reasoning could cause error during SPARQL query</h4><p>Depending on the way it was invoked, a SPAQRL query could signal a error when restriction reasoning was used. This has been corrected. </p><h4>Bug23841 - Do not allow triples in query results to be deleted</h4><p>It was possible to remove triples from the database by clicking the <em>X</em> icon next to CONSTRUCT or DESCRIBE query results. This possibility has been disabled. CONSTRUCT and DESCRIBE queries do not return enough information to uniquely identify a triple in the triple-store. Offering to delete them is error prone and ambiguous. To delete triples, either use a SPARQL DELETE statement or the node view (click any part of a triple in the results). </p><h4>Bug23755 - Problem with alternating property path in sub-queries</h4><p>A sub-query that used a property path pattern with alternation could incorrectly bind the predicate of matched triples to output variables. An example of the problem would have been: </p>
<pre><code>select ?s ?o {  
  { select ?s ?o {  
     ?s :hasChild | :hasParent ?o .  
    } }  
} </code></pre><p>This query would bind the predicate of matched triples to <code>?o</code>. This has been corrected. </p><a name='header3-1192' id='header3-1192'></a><h3>AGWebView</h3><h4>Rfe14371 - Allow the number of loaders to be selected in AGWebView</h4><p>It is now possible to specify the number of loaders when invoking <strong>agload</strong> through AGWebView. </p><h4>Rfe13428 - Display query information for CONSTRUCT, DESCRIBE and ASK queries</h4><p>The query information tab is now displayed alongside results of CONSTRUCT, DESCRIBE and ASK queries. </p><h4>Bug24047 - WebView: download duplicates ignores mode</h4><p>The <strong>Export duplicate statement</strong> command in Store Control ignored the choice of SPO/SPOG. This has been corrected. </p><h4>Bug23948: Fixed paged behavior after using the browser's back button</h4><p>Previously, the <code>Download</code> and <code>Load more</code> buttons would function incorrectly if used after clicking the browser's back button. This has been corrected. </p><h4>Bug23888 - Upload progress indicator not showing</h4><p>AGWebView will now display progress information when uploading a file. This was previously not visible due to a bug. Progress is reported as a text line similar to this: </p>
<pre><code>Uploading file triples.nt(1475 Kb uploaded) </code></pre><h4>Bug23887 - Automatic scrolling in the AGWebView view server log pane broken</h4><p>The server log in AGWebView would not auto-scroll when new log data appeared. This has been corrected. </p><h4>Bug23857 - Load more does not work in Free Text search</h4><p>Loading the next page of Free Text search results did not work. This has been corrected. </p><h4>Bug23856 - Repeated text search breaks navigation</h4><p>Page navigation would sometimes break when a user entered the same query twice in the Free Text search field. This has been corrected. </p><h4>Bug23840 - Wrong even/odd row coloring when odd limit chosen</h4><p>Row coloring could appear incorrect when using an odd limit and paging in the query view. This has been corrected. </p><h4>Bug23839 - Planner selector grayed-out after language detection</h4><p>It was possible to disable the planner selector in the query view if language autodetection was used. This has been corrected. </p><h4>Bug23827 - Process list in WebView crashes on Firefox</h4><p>The process and job list views of AllegroGraph WebView did not display any processes or jobs on Firefox. This has been corrected. </p><h4>Bug23811 - AGWebView import fails for RDF/XML</h4><p>Multi-core file import in AGWebView would fail if the chosen format was RDF/XML. This has been corrected. </p><h4>Bug23810 - Importing via file upload no longer works in AGWebView</h4><p>The multi-core file import feature in AGWebView was not working unless the file type was set directly. This has been corrected. In addition, AllegroGraph now recognizes application/n-triples and application/n-quads as media-types for the import of N-Triples and N-Quads (respectively). </p><h4>Bug23800 - Query progress spinner only appears on every other query in Agwebview</h4><p>The "Loading..." indicator was not displaying the first time that a new SPARQL query was executed via <a href="http://franz.com/agraph/agwebview/index.lhtml" target="_blank">AGWebView</a>'s query editor.  Now the loading indicator is shown every time. </p><h4>Bug23774 - CONSTRUCT queries not displaying results in AGWebView</h4><p>Results from CONSTRUCT queries were not being displayed in Safari under OS X. This has been corrected. </p><h4>Bug23752 - Agwebview Lisp editor fails when digits are at the end of a line</h4><p>The Lisp and Prolog script editors would become unresponsive if the last token on a line was a number. The JavaScript console showed the following error: </p>
<pre><code>TypeError: undefined is not an object (evaluating 'stream.peek().toUpperCase') </code></pre><p>This has been fixed. </p><h4>Bug23141 - AGWebView's CONSTRUCT doesn't show the MORE button</h4><p>Previously, if the number of results of a CONSTRUCT query exceeded the limit set by the user, there was no way to show more results. Now, there is a MORE button at the bottom of the results which functions similarly to the one used for SELECT queries. </p><h4>Bug22314 - Federated-triples-stores, encoded IDs and AGWebview don't mix</h4><p>Attempting to use AGWebView to query a federated triple-store whose leaf nodes used encoded IDs led to an error. This has been corrected. Note: Correct behavior of a federation of stores that use encoded IDs assumes that each leaf node has the <em>same</em> definitions for encoded ID prefixes. </p><a name='header3-1232' id='header3-1232'></a><h3>Changes to the Lisp API</h3><h4>Rfe11567 - Support store specifications in the Lisp client</h4><p>In addition to using the <code>catalog</code> keyword argument, AllegroGraph now accepts store names in the form CATALOG-NAME/STORE-NAME. E.g., </p>
<pre><code>(open-triple-store "general/test-data") </code></pre><p>would open the store <code>test-data</code> in the catalog <code>general</code>. </p><p>You can also supply a triple-store specification in calls to <a href="lisp-reference.html#open-triple-store" title="description of open-triple-store">open-triple-store</a>. This will build a store instance from the specification, bind it to <code>*db*</code> and return it. In this case, the store instance will be given a name like <code>store12341</code>. </p><p>Finally, you can query store specifications directly using any of the HTTP clients by using a URL encoded version of the specification in place of a simple store name. E.g., </p>
<pre><code>curl -X GET -v "http://localhost:11040/repositories/%3Ca%3E%2B%3Cb%3E?query=select%20*%20%7B%20%3Fs%20%3Fp%20%3Fo%20%7D%20limit%205" </code></pre><p>would send the query </p>
<pre><code>select * { ?s ?p ?o } limit 5 </code></pre><p>to the federation of triples stores <code>a</code> and <code>b</code> (as specified by <code>&lt;a&gt;+&lt;b&gt;</code>). </p><p>Note that in this case, AllegroGraph will <em>not</em> start a new session so Prolog functors or other things defined in the servers initialization file will <em>not</em> necessarily be present. </p><h4>Bug24105 - Deprecate serialize-rdf-n3 in favor of serialize-turtle</h4><p>AllegroGraph can serialize data in turtle format but not in N3 so it is better to use the correct name. The now deprecated function <strong>serialize-n3-rdf</strong> will be removed in a future release and should no longer be used. <a href="lisp-reference.html#serialize-turtle" title="description of serialize-turtle">serialize-turtle</a> should be used instead. </p><h4>Bug24006 - pcache Lisp module conflicts with AllegroGraph</h4><p>A package conflict made it impossible to load AllegroCache and pcache in the same Lisp execution as AllegroGraph (without tiresome package manipulation). The problem has been fixed in this release. </p><h4>Bug23846 - warmup-triple-store does not work in remote-lisp-client</h4><p>Calling <a href="lisp-reference.html#warmup-triple-store" title="description of warmup-triple-store">warmup-triple-store</a> on a remote store used to have no effect. The call did not fail, but no operation was performed. The remote client will now correctly pass the request to the server it is connected to, preparing it for subsequent operations. </p><a name='header3-1250' id='header3-1250'></a><h3>Prolog</h3><h4>Bug23877 - Prolog select exposes a security hole</h4><p>There was a remote code execution vulnerability in Prolog query handling code where users without <em>eval</em> permissions could execute arbitrary code on the server. Executing Prolog queries now requires <em>eval</em> permissions. (This bug was fixed in various maintenance releases including version 6.0.2. We repeat it here because of its importance.) </p><a name='header3-1253' id='header3-1253'></a><h3>Documentation</h3><h4>Bug23874 - Documentation search in local AllegroGraph docs doesn't work</h4><p>The documentation search field in the upper left corner of AllegroGraph documentation pages now uses Google to search for the given phrase within: </p>
<pre><code>franz.com/agraph/support/documentation/&lt;version&gt;/ </code></pre><p>where &lt;version&gt; is <em>vX.Y[.Z]</em> (v6.1 in the case of the current release). This means that even if you have a local copy of the documentation the search is done in the web copy on the Franz Inc. website. </p><a name='header3-1258' id='header3-1258'></a><h3>Python Client</h3><h4>RepositoryConnection.createCoordinate arguments renamed</h4><p>The <code>lat</code> and <code>long</code> arguments of <code>RepositoryConnection.createCoordinate</code> have been renamed <code>latitude</code> and <code>longitude</code>. </p><h4>Bug23901 - RepositoryResult.asList() always returns None</h4><p>The <code>asList</code> method in the <code>RepositoryResult</code> class was buggy and always returned None. It now correctly returns all statements from the result object. </p><a name='header3-1263' id='header3-1263'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-1265' id='header3-1265'></a><h3>Geospatial</h3><h4>Rfe12345 - Unnecessary geospatial functions removed</h4><p>The functions <strong>geospatial-subtype-index-in-this-image</strong> and <strong>geospatial-subtype-index-in-db</strong> are neither useful nor necessary in the geospatial API.  They have been unexported and removed from the documentation. </p><h4>Bug23933 - Geospatial subtypes could be mistranslated on remote stores</h4><p>It was possible for encoded geospatial data to be mistranslated when connecting to AllegroGraph via a remote-triple-store in the Lisp environment. This has been corrected. </p><h4>Bug23848 - nd:inCircle :units incorrectly defaults to :miles, not :km</h4><p>The <code>:units</code> argument to <a href="lisp-reference.html#function.get-triples-nd-within-radius" title="description of function get-triples-nd-within-radius">get-triples-nd-within-radius</a> in Lisp and the <a href="lisp-reference.html#functor.get-triples-nd-within-radius" title="description of functor get-triples-nd-within-radius">similarly named functor</a> in Prolog, and <code>nd:inCircle</code> in SPARQL, incorrectly defaulted to <code>:miles</code> instead of <code>:km</code>.  This has been fixed so the behavior now agrees with the documentation.  Since a kilometer is less than a mile, the change may cause previous queries that did not specify <code>:units</code> now to return fewer results. The extra results before the change were bogus. </p><h4>Bug23767 - automate-nd-datatype-mappings could fail under parallel load</h4><p>Spurious metadata conflict errors could be signaled if a store using automatic nD-datatype mappings was being accessed from multiple clients (for example, via <strong>agload</strong>). This has been corrected. </p><h4>Bug23584 - nD query support for ISO6709 time</h4><p>In an nD query, the min and max limits for a :time type ordinate may be expressed as a real number, as a dateTime UPI, or as a string literal in ISO6709 syntax (either as an xsd:dateTime typed string or an untyped string).  These are supported in both SPARQL and Lisp/Prolog queries. Previously ISO6709 was not accepted in all contexts. </p>  <a name='header2-1278' id='header2-1278'></a><h2>AllegroGraph 6.0.2 user-visible changes</h2><a name='header3-1279' id='header3-1279'></a><h3>Prolog</h3><h4>Bug23877 - Prolog select exposes a security hole</h4><p>There was a remote code execution vulnerability in Prolog query handling code where users without <em>eval</em> permissions could execute arbitrary code on the server.  Executing Prolog queries now requires <em>eval</em> permission.  User permissions are discussed in the section <a href="agwebview.html#ManagingUsers">Managing Users</a> in the <a href="agwebview.html">WebView</a> document. </p> <a name='header2-1283' id='header2-1283'></a><h2>AllegroGraph 6.0.1</h2> <a name='header3-1285' id='header3-1285'></a><h3>Server Changes</h3><h4>Bug23796: Disk-chunks-search.*.tmp files leaked when closing database</h4><p>Starting in v6.0, files matching the pattern disk-chunks-search.*.tmp would remain open after closing a database.  If a database was opened and closed frequently, this would eventually exhaust all available file descriptors in the process. This has been fixed. </p><h4>Bug23715 and Bug23748  - FTI bugs</h4><p><strong>Bug23715</strong>: Creating a text index in which a word occurred in more than two million triples could sometimes crash the server. </p><p>This resulted in a log message similar to the following: </p>
<pre><code>Process 'db-name FTI Merger' raised: opening #&lt;...&gt; resulted  
in error (code 22): Invalid argument. </code></pre><p><strong>Bug23748</strong>: Indexing a very long document might cause a crash. </p><p>An error would sometimes occur when trying to add a triple with very long text to a text index. The error looked like this: </p>
<pre><code>Error: opening #&lt;mapped-file-simple-stream ...&gt;  
       resulted in error (code 22): Invalid argument. </code></pre><p>Both bugs have been corrected. </p><h4>Bug23010 - Rolling back a freshly staged text index leaves a file around</h4><p>When a text index was deleted or its creation rolled back, a relatively large (~5MB) file used to be left behind and only deleted at the next checkpoint. This has been changed. The file is now deleted immediately as long as there are no live sessions that could still "see" the index before deletion. </p><a name='header3-1298' id='header3-1298'></a><h3>HTTP Client</h3><h4>Bug23589 - Sending a SPARQL Update command to the Prolog REST API generates a backtrace</h4><p>Sending a Prolog query that is not a valid list (e.g. because it is actually a SPARQL query) to the Prolog REST API caused the system to produce a backtrace and return error 500 with the following message: </p>
<pre><code>Attempt to take the cdr of db.agraph.query.prolog:select  
which is not listp. </code></pre><p>This has been corrected: the server now answers with code 400 and the following message: </p>
<pre><code>MALFORMED QUERY: Prolog queries must be lists.  
</code></pre><a name='header3-1304' id='header3-1304'></a><h3>SPARQL</h3><h4>Bug23789, Bug23788 - issues with nD geospatial SPARQL queries</h4><p>SPARQL n-Dimensional geospatial magic properties were signaling an error when used inside of a GRAPH clause. They were also signaling an error when the magic property was used with no variable bindings (i.e., when all of the arguments in the pattern were fixed). Both of these issues have been corrected. (Repeated under nD Geospatial below.) </p><a name='header3-1307' id='header3-1307'></a><h3>AGWebView</h3><h4>Bug22920 - Agwebview result list has dynamic height</h4><p>The window with SPARQL query results in AGWebView used to have a height of 300 pixels. The height is now dynamically adjusted to fill the available viewport. </p><h4>Bug22604 - Improve handling of invalid user files</h4><p>Previously, an invalid user file (e.g., one that was zero length or corrupted) would cause AGWebView to become unusable. This has been corrected. Now, invalid files will be ignored. Note that this means they will not be displayed in AGWebView's user list. </p><a name='header3-1312' id='header3-1312'></a><h3>Changes to the Lisp API</h3><h4>Bug21770 - Some old SPARQL functionality now deprecated</h4><p>Using either of the <code>extendedp</code> and <code>permitted-verbs</code> arguments to <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> will now signal a warning. These parameters will be dropped completely in a future release of AllegroGraph. This change also removes the special variable <strong>sparql:*use-extended-sparql-verbs-p*</strong>. </p><a name='header3-1315' id='header3-1315'></a><h3>Prolog</h3><h4>Bug23745 - Improve future-part handling in Prolog select queries</h4><p>It was possible for a Prolog select query to fail to find results if future-parts were used inside <code>lisp</code> expressions in the query. This has been corrected. </p><h4>Bug23726 - Prolog select queries that involved type mapping could fail</h4><p>Under some circumstances, a Prolog select query that used constants requiring type mapping (e.g., '1234'^^xsd:integer) could fail to return results. This has been corrected. </p><a name='header3-1320' id='header3-1320'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-1322' id='header3-1322'></a><h3>Python Client</h3><h4>Bug22303 - python-client: missing not-equal method for URIs</h4><p>Trying to test if two URI objects in the Python API are different used to be impossible (i.e. code such as <code> uri1 != uri2</code> raised an exception). The missing comparison method has been implemented. In addition, it is now possible to order URIs, literals and BNodes. Comparing values of two different types yields an arbitrary but consistent result under Python 2 and causes an exception under Python 3. This follows conventions established by Python's built-in types. </p><a name='header3-1325' id='header3-1325'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-1327' id='header3-1327'></a><h3>nD Geospatial</h3><h4>Bug23789, Bug23788 - issues with nD geospatial SPARQL queries</h4><p>SPARQL n-Dimensional geospatial magic properties were signaling an error when used inside of a GRAPH clause. They were also signaling an error when the magic property was used with no variable bindings (i.e., when all of the arguments in the pattern were fixed). Both of these issues have been corrected. (Repeated under SPARQL above.) </p>  <a name='header2-1332' id='header2-1332'></a><h2>AllegroGraph 6.0</h2><a name='header3-1333' id='header3-1333'></a><h3>Server Changes</h3><h4>Use agraph for the Lisp client fasl name</h4><p>AllegroGraph 6.0 now uses <em>agraph.fasl</em> instead of agraph[major-version-number].fasl for the name of the Lisp fasl file. Both the direct Lisp client fasl file and the various remote Lisp client fasl files (on the various platforms suitable for use as remote clients) are named <em>agraph.fasl</em>. Users need to manage the locations of the various individual <em>agraph.fasl</em> files to be sure the correct one is loaded when used. </p><h4>Rfe13969 - Add HDFS input support to agload</h4><p><strong>agload</strong> now supports loading files from HDFS sources.  For this to work, there must be a working "hdfs" program in your PATH and HDFS input files must be specified on the agload command line using the hdfs:// prefix.  For example: </p>
<pre><code>agload repo hdfs:///user/bruce/lubm-50.nt.gz </code></pre><p><strong>agload</strong> is described in the <a href="agload.html">Data Loading</a> document. (This change was also in release 5.1.1, as noted below, but we repeat it here as some users may not have installed version 5.1.1.) </p><h4>Rfe13826 - Improve estimates on federated remote stores</h4><p>Cardinality estimation of query result sets on remote stores has been greatly improved which leads to more efficient query plans on federated remote stores. </p><h4>Rfe13807 - Added deleted triple purge operation</h4><p>When triples are deleted they are not immediately removed from indices. They must remain in all indices until all transactions which may potentially need to see those triples (such as transactions that started before the triples were deleted) have completed (committed or rolled back). A triple that cannot possibly be accessed by any live transaction is referred to as an <em>inaccessible triple</em>. The existence of inaccessible triples in indices wastes space and impacts query performance. Therefore AllegroGraph now provides a facility to purge these triples from indices. See <a href="purging-deleted-triples.html">Purging Deleted Triples</a>. </p><h4>Rfe13806 - Configuration option to control index style</h4><p>AllegroGraph v6.0 adds a new style of index.  The old style is called style 1 and the new style is called style 2.  Style 2 indices are faster than style 1 when performing point queries where all of s/p/o or s/p/o/g are fixed (where the result is typically a single triple), but these indices take longer to construct and to optimize. Style 1 indices are better for queries which end up scanning many triples and typically produce results with many triples. </p><p>The <a href="daemon-config.html#style2indices">Style2Indices</a> catalog configuration directive can be used to control which index flavors should use style 2. The directive value can be a comma- or space-separated list of index flavor names, or the value <em>none</em>.  The default value is <em>none</em>. Configuration options are discussed in <a href="daemon-config.html">Server Configuration and Control</a>. </p><p><strong>Examples</strong> </p>
<pre><code>Style2Indices none  
Style2Indices posgi  
Style2Indices spogi, posgi </code></pre><p>The Lisp API function <a href="lisp-reference.html#add-index" title="description of add-index">add-index</a> and the REST interface command <code>PUT /repositories/[name]/indices/[type]</code> allow for specifying the index style as well. </p><h4>Rfe13641 - Change default for temporaryFileDiskSpace</h4><p>AllegroGraph now defaults to using no more than 25% of the available filesystem space for temporary query files (at the time the query begins). This setting can be changed using the <code>temporaryFilesystemSpaceLimit</code> query option either in the AllegroGraph configuration file or via a PREFIX option to a SPARQL query. If a query attempts to use more space than this limit allows, it will be canceled. <code>temporaryFilesystemSpaceLimit</code> is a new name for the <code>temporaryFileDiskSpace</code> option. The old name has been deprecated. See <a href="daemon-config.html#server-control">agcontrol</a>. </p><h4>Rfe12000 - Minor improvements in how typed string literals are stored</h4><p>AllegroGraph now stores typed string literals like "hello"^^xsd:string more efficiently. </p><h4>Rfe11116 - Support SHA384 digest function in SPARQL</h4><p>In addition to MD5, SHA1, SHA256, and SHA512, AllegroGraph's SPARQL engine now supports SHA384. </p><h4>Rfe11078 - Improve agload verbosity behavior</h4><p>Previously, passing <code>-v</code> or <code>--verbose</code> to <strong>agload</strong> (see <a href="agload.html">Data Loading</a>) could actually decrease its level of verbosity. This has been fixed.  The new verbosity levels are: </p>
<pre><code>0 (-v not supplied): Only report periodic load rate information.  
1 (-v)             : As above, plus print the job option summary  
		 before starting the operation.  
2 (-v -v)          : As above, plus print the name of every file  
		 that has been processed. </code></pre><p>(This change was also in release 5.1.1, as noted below, but we repeat it here as some users may not have installed version 5.1.1.) </p><h4>Bug23660 - AuditEventsToEmail parser too strict</h4><p>Previously the events list in an AuditEventsToEmail configuration directive had to be comma-separated with no intervening whitespace. This has been relaxed. </p><h4>Bug23654 - agraph-backup restore fails if StringTableSize specified</h4><p>An error would occur when trying to restore a database if its StringTableSize did not match the one in the catalog into which it was being restored.  The error was: </p>
<pre><code>Fetching user information failed: String table configuration mismatch:  
Configured number of slots (X) does not match recovered number  
of slots (Y). </code></pre><p>This has been corrected. <strong>agraph-backup</strong> is described in <a href="backup-and-restore.html">Backup and Restore</a>. </p><h4>Bug23604 - Improve bidirectional search speed when no paths are found</h4><p>AllegroGraph's bidirectional search algorithm was expanding more nodes than necessary when no paths between the start and end were found. This has been corrected. </p><h4>Bug23598 - Error when accessing a suspended account</h4><p>Previously, if an account was suspended but AccountUnsuspendTimeout wasn't configured, the following error would be signaled when accessing the suspended account: </p>
<pre><code>nil is not of the expected type number </code></pre><p>This has been corrected. </p><h4>Bug23585 - Audit dialog not showing any results</h4><p>It was possible for the Audit Log query in AGWebView to fail to display results. This has been corrected. </p><h4>Bug23526 - Fixed size deleted triple bitmap</h4><p>Previously an error would occur if a triple with id greater than 34,359,738,367 was deleted.  This has been fixed. </p><h4>Bug23512 - Signal an error when attempting a freetext query and no freetext indices exist</h4><p>Previously, AllegroGraph would simply return no results if a freetext query was executed and there were no freetext indices defined. Now, AllegroGraph will signal an error.  This also modifies the behavior of <a href="lisp-reference.html#list-freetext-indices" title="description of list-freetext-indices">list-freetext-indices</a> for federated triple-stores. Previously, a federated store would return the intersection of its freetext indices. Now, it returns the union. This makes it easier to use the freetext indexing facility with them. </p><h4>Bug23442 - Full filesystems can lead to truncated user files</h4><p>In some cases a full filesystem could cause AllegroGraph user preference files to be truncated. This has been corrected. </p><h4>Bug23441 - Retry tlog creation if filesystem is full</h4><p>Previously, if the filesystem ran out of space while allocating a new tranasction log file during a checkpoint or commit, the instance would crash.  Now the affected process will block, log a message to agraph.log, and periodically retry the operation until it succeeds. To avoid confusing hangs, failure to preallocate transaction log files on database creation will still result in an immediate error. </p><h4>Bug23370 - N-Triple, N-Quad and Turtle parsers should handle UTF8 files with a BOM</h4><p>AllegroGraph's parsers did not correctly parse UTF8 files that started with a byte order marker (BOM). This has been corrected. </p><h4>Bug23270 - flush-in-memory-chunks deadlock</h4><p>Previously, when performing duplicate triple deletion, it was possible for the AllegroGraph instance to become deadlocked and hang.  This has been fixed. </p><h4>Bug23361 - N-Triples parser could incorrectly import non 7-bit ASCII data</h4><p>Unless a UTF-8 encoding was explicitly specified, the AllegroGraph N-Triples parser could fail to handle Unicode N-Triples data correctly. This has been corrected. </p><h4>Bug23238 - Fix 'UPI has not been added to string dictionary' bug</h4><p>Previously, certain queries involving large intermediate result sets could fail with a <code>UPI has not been added to string dictionary</code> error. This bug has been fixed. </p><h4>Bug23233 - Fix bug in agraph-backup progress output.</h4><p>Some garbled output showing a "Printer error" could be produced when running a backup operation using <strong>agraph-backup</strong>. This has been corrected. </p><h4>Bug23231 - Prevent spurious output from agraph-replicate</h4><p>Previously, <strong>agraph-replicate</strong> would emit spurious output when exiting. This output has been suppressed. </p><h4>Bug23229 - agraph-replicate --stop would not stop replication.</h4><p>Previously, <strong>agraph-replicate --stop</strong> would not actually cause replication to stop. This has been corrected. See <a href="replication.html">Replication</a> for information on <strong>agraph-replicate</strong>. </p><h4>Bug22490 - Fix potential deadlock when creating/modifying freetext indexes.</h4><p>With proper timing, it was possible hang the server when adding or updating a freetext index. This has been corrected. </p><h4>Bug22489 - agraph-backup fails due to missing tlog file</h4><p>Under certain circumstances <strong>agraph-backup</strong> could fail to back up a database due to not finding a transaction log file.  This error has been corrected. </p><h4>Bug22165 - commit-time duplicate suppression does not operate under lock</h4><p>Previously, commit-time duplicate triple suppression did not properly consider triples that were added in a concurrent transaction, possibly resulting in duplicate triples being added.  This has been corrected. </p><h4>Bug19831 - xsd:booleans are now stored as encoded UPIs</h4><p>Previously, xsd:booleans were stored as strings. They are now stored as encoded UPIs. This will make some queries slightly more efficient. </p><a name='header3-1404' id='header3-1404'></a><h3>HTTP Client</h3><h4>Rfe13941 - Allow specification of chunk style when adding an index</h4><p>The PUT command </p>
<pre><code>PUT /repositories/[name]/indices/[type] </code></pre><p>now accepts a style query parameter which may be 0, 1, or 2. See <a href="triple-index.html">AllegroGraph Indices</a> for a discussion of index styles. </p><h4>Rfe13750 - Log errors during writing the HTTP response</h4><p>While using the REST API, which most clients do, serving a request usually has a computation phase that's followed by an output phase. If an error happens in the computation phase, the appropriate HTTP status code is returned. The tricky case is with chunked encoding (for example, streaming query results back) when some results were already written to the socket. Then upon encountering an error, it is not possible to change the HTTP status code and return a meaningful error message. For this reason, errors should normally be detected during the computation phase. </p><p>With this change, any errors (except those caused by the client end of the socket being closed) encountered during the output phase are logged to make debugging easier. </p><h4>Rfe13711 - Add query PREFIX option to cancel queries when there are warnings</h4><p>AllegroGraph has a new query PREFIX option: <code>cancelQueryOnWarnings</code>. If true, then a SPARQL query will cancel itself if it encounters any warnings during query planning or execution. Typical warnings include: </p>
<ul>
<li>unknown or out of scope variables in FILTER expressions
<pre><code>SELECT * { ?s ex:Predicate ?o . FILTER( ?missing &gt; 2 ) } </code></pre></li>
<li>constants that are not in the underlying store:
<pre><code>SELECT * { ?s ex:Predicate ex:thisResourceIsNotInTheStore . } </code></pre></li>
<li>unknown variables in an ORDER BY clause:
<pre><code>SELECT * { ?s ?p ?o } ORDER BY ?age </code></pre></li>
<li>cross products:
<pre><code>SELECT * { ?a ?b ?c . ?d ?e ?f } </code></pre></li></ul><p>If the option is set to <code>no</code>, then warnings will be logged but query execution will continue. </p><h4>Bug23546 - Problems adding very long objects with JSON upload</h4><p>An error could occur if triples with very long strings were imported using the REST API and the application/json content-type. This has been corrected. Other content-types were not affected by this bug. </p><h4>Bug23324 - Some text index properties could not be viewed</h4><p>If an AllegroGraph freetext index specified that it should only index literals with one or more particular datatypes, then that index would signal an error when its properties were read using the REST API. This has been corrected. </p><a name='header3-1427' id='header3-1427'></a><h3>SPARQL</h3><h4>Rfe14076 - Optimize RDF serialization of CONSTRUCT and DESCRIBE queries</h4><p>RDF serialization formats like RDF/XML or Turtle were spending more time than necessary trying to find namespace abbreviations. This has been improved. </p><h4>Rfe13998 - agquery can now interact with SPARQL endpoints</h4><p>AllegroGraph's command-line <strong>agquery</strong> tool can now send queries to SPARQL endpoints and retrieve the results. <strong>agquery</strong> is described in the <a href="agquery.html">Querying</a> document. </p><h4>Rfe13975 - Streamline internal AllegroGraph merge operations</h4><p>Query operations that require merging of multiple result streams have been optimized. Examples include the inference of types and properties in the dynamic reasoner and computing distinct SPARQL results. </p><h4>Rfe13519 - General low-level SPARQL query optimizations</h4><p>Modified the low-level cursor operations in the SPARQL query engine so that they perform between 3 and 5% better for most queries. </p><h4>Rfe13387 - Improve performance of SPARQL replace function</h4><p>The SPARQL replace function is now significantly faster when called with a constant regular expression. </p><h4>Rfe13327: Improve parsing of diskChunkRowCount and other query parameters</h4><p>It is now possible to specify query parameters like <code>diskChunkRowCount</code> and other query parameters using <em>sizes</em> like <code>100m</code> or <code>1g</code> rather than needing to write out the numeric value as an integer. </p><h4>Rfe12143 - Improve analysis of constant BIND and VALUES forms</h4><p>AllegroGraph now does a better job of analyzing and using constant BIND values and single variable VALUES forms. When possible, these forms are pulled into the triple-patterns in the BGPs rather than being evaluated at run-time. For example, both of these queries will now run much more efficiently: </p>
<pre><code>select * {  
    bind( 'test' as ?test )  
    ?s :predicate ?test .  
} </code></pre><p>and </p>
<pre><code>select * {  
  values ?test { 'test' 'two' 'three' }  
  ?s :predicate ?test .  
} </code></pre><h4>Rfe12131 - Remove support for the old SPARQL 1.0 query engine</h4><p>AllegroGraph no longer supports the older and long deprecated SPARQL 1.0 query engine. The newer 1.1 engine is to be preferred in all cases. In particular, this means that you can no longer force the use of the 1.0 engine via the queryEngine PREFIX. </p><h4>Bug23696 - Improve query plan for some property path queries in sub-queries</h4><p>AllegroGraph could fail to optimize a simple alternation property path query when it appeared inside of a sub-query. This has been corrected. </p><h4>Bug23653 - Remove spurious cross-product warning for (optional identity A)</h4><p>AllegroGraph was signaling a cross-product warning for SPARQL queries that contained an OPTIONAL with no left hand side. For example: </p>
<pre><code>select * {  
  optional { ?s a :Animal }  
} </code></pre><p>has a query algebra like: </p>
<pre><code>(left-join identity BGP) </code></pre><p>Though the warning is technically correct, the construct above is harmless and the warning is unnecessary. </p><h4>Bug23632 - SPARQL parser has trouble with escaped backslashes at the end of a literal</h4><p>The SPARQL parser would fail to correctly interpret literals with an escaped backslash as their final character, e.g., 'abc\'. This has been corrected. </p><h4>Bug23616 - COUNT aggregation counts unbound values from unknown variables</h4><p>If a COUNT aggregration expression included variables that were not projected from the underlying query, then AllegroGraph was treating them as if they were bound and returning a count. This has been corrected. </p><h4>Bug23582 - SPARQL could lose results when a sub-query used limit and distinct</h4><p>It was possible for solutions to be overwritten and lost when a sub-query used both LIMIT and DISTINCT. This has been corrected. </p><h4>Bug23581 - Optional mis-analysis in sub-queries could drop solutions</h4><p>It was possible for AllegroGraph to mis-analyze whether a variable in a SPARQL sub-query was optional or not and therefore to lose solutions. This has been corrected. </p><h4>Bug23524 - Property path queries could lose results when there is circularity</h4><p>Under some circumstances, a SPARQL query that used property paths could lose results that arose from circular paths through the triple-store. This has been corrected. </p><h4>Bug23519 - SPARQL sub-query and GRAPH clauses could interact badly</h4><p>It was possible for a query that used sub-query and GRAPH clauses to lose solutions. This has been corrected. </p><h4>Bug23489 - Queries that started with a SERVICE clause could lose bindings</h4><p>If a SPARQL query started with a SERVICE clause and contained a cross-product then it was possible for some bindings to be lost. This has been corrected. </p><h4>Bug23452 - Some temporal magic properties could fail to produce results</h4><p>Some of AllegroGraph's temporal magic properties could produce plans that introduced filters that could not succeed. This has been corrected. </p><h4>Bug23448 - Fix problem with SPARQL t:pointBeforeDatetime and t:pointAfterDatetime</h4><p>The two SPARQL magic properties <code>t:pointBeforeDatetime</code> and <code>t:pointAfterDatetime</code> could fail to find bindings if the dateTime supplied was a constant <em>not</em> present in the triple-store. This has been corrected. SPARQL magic properties are listed <a href="magic-properties.html#magic-prop-list">here</a> in <a href="magic-properties.html">SPARQL Magic Properties</a>. </p><h4>Bug23443 - Remote SPARQL queries cannot handle really large results</h4><p>Returning very large query result sets (i.e., Gigabytes) from remote SPARQL endpoints could lead to resource exhaustion. This has been corrected. </p><h4>Bug23373 - Improve SPARQL efficiency for small ORDERed or DISTINCT result sets</h4><p>SPARQL queries with small result sets that use ORDER BY or DISTINCT will now be slightly faster. </p><h4>Bug23344 - SPIN magic properties don't work if they use other SPARQL functions</h4><p>A query-time error would be signaled if a SPIN magic property used other SPARQL functions like CONCAT or SUBSTR in its definition. This has been corrected. </p><h4>Bug23341 - remote-triple-stores handle limit and offset in SPARQL queries incorrectly</h4><p>If a query specified an OFFSET as part of the query string, then any externally imposed OFFSET (i.e., from the HTTP query parameters) was ignored. This has been corrected. If a query specified a LIMIT as part of the query string, then the smaller of that limit and the externally imposed one would be used instead of just using the external one. This has been corrected. Note that this change means that specifying a limit in a query in AGWebView will have no effect as the limit is controlled via the dropbox selection box. </p><h4>Bug23329 - Use SPARQL/JSON for SERVICE calls to avoid problems with embedded control characters</h4><p>AllegroGraph now uses SPARQL/JSON rather than SPARQL/XML to receive results from SPARQL endpoints. This makes it possible to return results that contain control characters like ^Z. The format is also more concise and easier to parse which makes processing the transmissions approximately twice as fast. </p><h4>Bug23321 - Nested sub-queries and BIND forms can fail to compute correct results</h4><p>In rare cases, it was possible for a query involving nested SPARQL sub-queries and BIND expressions to fail. This has been corrected. </p><h4>Bug23311 - Requesting application/nquads from a CONSTRUCT query leads to error</h4><p>If an application requested <code>application/nquads</code> from a CONSTRUCT query via the HTTP interface, a string-table lookup error would result. This has been corrected. Although version 1.1 of SPARQL CONSTRUCT can only return triples, it still makes sense to ask for N-Quads. In this case, the N-Quads will simply have the graph place left off. </p><h4>Bug22674 - DESCRIBE and CONSTRUCT queries on end points could fail</h4><p>SPARQL CONSTRUCT and DESCRIBE queries against remote SPARQL end points could fail when trying to parse the returned results. This has been corrected. </p><h4>Bug22672 - Queries where every FROM NAMED graph did not exist could signal an error</h4><p>If every FROM NAMED graph in the dataset did not exist, then some queries that used the GRAPH clause in their body could signal an error rather than returning results. This has been corrected. </p><h4>Bug22515 - Increase responsiveness of query canceling during result generation</h4><p>AllegroGraph did not check for query canceling or timeouts during result post-processing (e.g., while sorting the final result or removing duplicate entries from a DISTINCT result set) or result generation. This has been corrected. </p><h4>Bug22292 - tripleid magic property should handle fixed triple IDs</h4><p>The SPARQL magic property for AllegroGraph tripleId-based reification would not function for fixed triple IDs. This has been corrected. </p><h4>Bug22268 - Sub-queries that used Aggregation and limit could lose solutions</h4><p>If a sub-query had a limit and used aggregation, then it was possible for some solutions to be lost during processing. This has been corrected. </p><a name='header3-1497' id='header3-1497'></a><h3>AGWebView</h3><h4>Bug23690 - Fixed bug breaking the AGWebView View Statements dialog in IE.</h4><p>A bug in AGWebView that prevented the View Statements dialog from fetching and displaying statements when brought up in Internet Explorer has been fixed. The symptom was a partially loaded page with the spinning "Loading..." icon remaining permanently on the page. </p><h4>Bug23521 - More... button in AGWebView is broken for Prolog select queries</h4><p>The button to show additional results in the AGWebView query window was broken for Prolog <code>select</code> queries. This has been corrected. </p><h4>Bug23358 - AGWebView doesn't always display Unicode consistently</h4><p>Under some conditions, AGWebView would display literals and resources containing Unicode using the \u escaping mechanism of the N-Triples syntax rather than just displaying the characters directly. This has been corrected. </p><h4>Bug23315 - Running backup from within AGWebView does not work</h4><p>The <em>Backup this Store</em> dialog in AGWebView was broken. This has been corrected. </p><a name='header3-1506' id='header3-1506'></a><h3>Changes to the Lisp API</h3><h4>Rfe13941 - Allow specification of chunk style when adding an index</h4><p><a href="lisp-reference.html#add-index" title="description of add-index">add-index</a> now accepts a <em>style</em> keyword argument which can be 0 or nil (either meaning use the default chunk style for the flavor based on the <code>Style2Indices</code> configuration parameter), 1, or 2. See <a href="triple-index.html">AllegroGraph Indices</a> for a discussion of index styles. </p><h4>Bug23600 - remote-triple-stores CONSTRUCT queries now correctly returns cursors</h4><p>In the Lisp client, a SPARQL CONSTRUCT query should return a cursor that yields arrays of bindings but the remote-triple-store was instead yielding lists of bindings. This has been corrected. </p><h4>Bug23597 - remote-triple-store CONSTRUCT queries return nil bindings</h4><p>Many of the programmatic RDF formats (such as :lists or :arrays) for SPARQL CONSTRUCT queries on remote-triple-stores returned <code>nil</code> bindings rather than the actual values.  This has been corrected. Note that this bug did not effect text based output formats like N-Triples or Turtle. </p><h4>Bug23510 - remote-triple-stores did not support load-trig</h4><p>Lisp remote-triple-stores did not support loading the TriG format. This has been corrected. </p><h4>Bug23509 - Altering restriction-reasoning-enabled-p could lead to an internal error</h4><p>Altering the value of <a href="lisp-reference.html#restriction-reasoning-enabled-p" title="description of restriction-reasoning-enabled-p">restriction-reasoning-enabled-p</a> using the <strong>setf</strong> method after the reasoner had been applied and prepared could lead to an error. This has been corrected. </p><h4>Bug23404 - It was impossible to create an anonymous remote session</h4><p>AllegroGraph would signal an error that <code>This session is owned by another user</code> when trying to create an anonymous remote session in the Lisp client. For example, the following would fail: </p>
<pre><code> (open-triple-store "remote"  
    :triple-store-class 'remote-triple-store  
    :server "www.example.com"  
    :specification "&lt;sp2b-5e4&gt;[rdfs++]"  
    :port 9002) </code></pre><p>This has been corrected. </p><h4>Bug23320 - The Lisp direct client now ensures that UPIs are interned when calling add-triple</h4><p>The Lisp direct client was not checking that UPIs were interned which could lead to a UPI-not-in-string-table error when there were bugs in customer code. This has been corrected. The check does add a small cost to programmatic triple insertion. The <code>while-not-validating-that-upis-are-in-string-table</code> macro can be used to temporarily disable the checks once you are sure that the code is correct. </p><h4>Bug22844 - The SPARQL datatype function failed to handle nD-geospatial literals</h4><p>The SPARQL datatype function was unable to handle nD-geospatial literals. This has been corrected. </p><h4>Bug22793 - Problem with remote-reasoning-triple-stores and SNA</h4><p>On the Lisp client only, calling Social Networking (SNA) functions on a remote-reasoning-triple-store instance could lead to a stack overflow. This has been corrected. </p><h4>Bug22791 - get-triple was broken for remote-reasoning-triple-stores</h4><p>On the Lisp client only, calls to get-triple on a remote-reasoning-triple-store could fail to return results. This has been corrected. </p><h4>Bug22587 - copy-triples doesn't support remote triple-stores</h4><p>The <a href="lisp-reference.html#copy-triples" title="description of copy-triples">copy-triples</a> function did not work on remote-triple-stores. This has been corrected. Note that <strong>copy-triples</strong> on remote-triple-stores requires that </p>
<ul>
<li>the triples are all valid RDF</li>
<li>no blank nodes are used.</li></ul><h4>Bug22586 - Improve copy-triples</h4><p>The <a href="lisp-reference.html#copy-triples" title="description of copy-triples">copy-triples</a> function was not behaving correctly with respect to the <code>source-db</code> argument. This has been corrected. </p><h4>Bug22447 - Fix cursor memory management</h4><p>Under rare circumstamces, especially in a multi-threaded environment, cursors used in the Lisp client could end up being used in an unsafe way leading to various errors. With the AllegroGraph server, shared backends experiencing high load were at the risk of such failures. This bug has been fixed. </p><p>Also, in the Lisp client with a direct connection, any code that involved the creation of cursors (such as queries and calls to <a href="lisp-reference.html#get-triples" title="description of get-triples">get-triples</a>) had to be wrapped in a <strong>with-query-environment</strong> form. While that's still the recommended approach to take in production, with this change when there is no enclosing <strong>with-query-environment</strong>, cursors holding critical resources get finalizers which makes it more convenient to experiment at the REPL by reducing the risk of resource exhaustion. </p><h4>Bug20852 - remote-triple-stores do not support SPARQL update</h4><p>Lisp remote-triple-stores now support SPARQL update. </p><a name='header3-1540' id='header3-1540'></a><h3>Prolog</h3><h4>Rfe13968 - Add :offset to Prolog select</h4><p>AllegroGraph's Prolog based select query language now supports an :offset option. This can be used to skip the first <em>offset</em> results. For example, </p>
<pre><code>(select (?class)  
  (:offset 10)  
  (q ?s !rdf:type ?class)) </code></pre><p>would skip the first 10 results and return the rest of the bindings for <code>?class</code>. </p><a name='header3-1545' id='header3-1545'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-1547' id='header3-1547'></a><h3>Python Client</h3><h4>Rfe12828 - Support Python 3</h4><p>AllegroGraph now supports both Python 2 and Python 3. The sources for Python 2 continue to be in the src2 directory whereas those for Python 3 are in the new src3 directory. </p><a name='header3-1550' id='header3-1550'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header3-1552' id='header3-1552'></a><h3>nD Geospatial</h3><h4>Rfe13978 - Validate arguments to ndfn:ordinateValue at parse time when possible</h4><p>AllegroGraph now validates constant arguments to <strong>ndfn:ordinateValue</strong> at parse time. See the <a href="geospatial-nd-tutorial.html">N-dimensional Geospatial Usage Guide and Example</a> document. </p>  <a name='header2-1557' id='header2-1557'></a><h2>AllegroGraph 5.1.2</h2><a name='header3-1558' id='header3-1558'></a><h3>Server Changes</h3><h4>Bug19296 - AllegroGraph can stop responding because all threads seem busy</h4><p>Under rare circumstances it was possible for AllegroGraph to stop responding.  Such a hang was accompanied by "All threads busy, pause" log messages.  This has been corrected. </p>  <a name='header2-1563' id='header2-1563'></a><h2>AllegroGraph 5.1.1</h2><p>Because there are only a few changes in release 5.1.1, only headings with actual changes are listed. </p><a name='header3-1565' id='header3-1565'></a><h3>Server Changes</h3><h4>Rfe13969 - Add HDFS input support to agload</h4><p><strong>agload</strong> now supports loading files from HDFS sources.  For this to work, there must be a working "hdfs" program in your PATH and HDFS input files must be specified on the agload command line using the hdfs:// prefix.  For example: </p>
<pre><code>agload repo hdfs:///user/bruce/lubm-50.nt.gz </code></pre><p><strong>agload</strong> is described in the <a href="agload.html">Data Loading</a> document. HDFS loading is described in the section <a href="agload.html#hdfs">Loading files from HDFS filesystems</a> in that document. </p><p><a name="verbosity"></a> </p><h4>Rfe11078 - Improve agload verbosity behavior</h4><p>Previously, passing <em>-v</em> or <em>--verbose</em> to <strong>agload</strong> could actually decrease its level of verbosity.  This has been fixed. </p><p>The new verbosity levels are: </p><p> 0 (-v not supplied): Only report periodic load rate information.  1 (-v)             : As above, plus print the job option summary                      before starting the operation.  2 (-v -v)          : As above, plus print the name of every file                      that has been processed.w </p><p><strong>agload</strong> is described in the <a href="agload.html">Data Loading</a> document. </p>  <a name='header2-1578' id='header2-1578'></a><h2>AllegroGraph 5.1</h2><a name='header3-1579' id='header3-1579'></a><h3>Server Changes</h3><h4>Rfe13570 - Support the TriG format for serialization</h4><p>AllegroGraph can now serialize data using the TriG format. For example, you can use the output format <code>trig</code> in agexport or an Accept type of <code>application/trig</code> from the REST API. </p><h4>Rfe13501 - Implement HTTPNoProxy configuration directive</h4><p>This change adds a new global configuration directive, HTTPNoProxy. HTTP requests to domains that match one of the suffixes specified with HTTPNoProxy are never proxied. HTTPNoProxy can be specified multiple times. </p>
<pre><code>HTTPNoProxy localhost  
HTTPNoProxy mydomain.com </code></pre><p>Requests to 'localhost' and '127.0.0.1' are never proxied. Top level directives are described in <a href="daemon-config.html#TopLevel">Server Configuration and Control</a>. </p><h4>Rfe12010 - Support the TriG format for data import</h4><p>AllegroGraph now supports the TriG data format for loading data.  See http://www.w3.org/TR/trig/ for details on the format. See <a href="agload.html">Data Loading</a>. </p><h4>Rfe11730 - Update Turtle parser to conform to the specification</h4><p>AllegroGraph's turtle parser now passes the W3C conformance tests (http://www.w3.org/TR/turtle/). The parser is also significantly faster. </p><h4>Bug23077 - Rare thread safety issue in shared back-ends</h4><p>Previously, when multiple requests for the same repository were being executed concurrently on the same shared back-end a very rare thread safety issue could cause the backend to die. This bug has been fixed. </p><h4>Bug22944 - Freetext indexer could mishandle encoded literals</h4><p>AllegroGraph's built-in freetext indexer was trying to index encoded literals (numbers, dates, times and dateTimes) and would sometimes misinterpret them leading to extremely slow indexing. This has been corrected by preventing the indexing of these literals. This means that freetext indices will not include values for encoded literals. </p><h4>Bug20556: Double-fault of trie-full condition</h4><p>Previously, when adding a word with many hits to a text index a "trie-full" error could occur.  This has been fixed. </p><a name='header3-1596' id='header3-1596'></a><h3>HTTP Client</h3><h4>Bug23064 - Post requests to the statements REST API could fail</h4><p>It was possible for POST requests to the statements REST API to corrupt the stream of bytes being sent. This has been corrected. </p><a name='header3-1599' id='header3-1599'></a><h3>SPARQL</h3><h4>Rfe13683 - Improve variable count tracking during query execution</h4><p>AllegroGraph keeps better track of the estimated cardinality of bindings for variables during query execution which improves the execution engine's overall efficiency. </p><h4>Rfe13601 - Improve handling of property path queries that use simple alternation</h4><p>AllegroGraph can now apply its constraint machinery to simple property path queries that use only alternation. For example: </p>
<pre><code>select ?o {  
  ?s :a | :b | :c ?o .  
  filter( ?o &gt; 10 )  
}  
This means that queries like the above can operate significantly faster. </code></pre><h4>Rfe13599 - Improve query pattern constraint logic</h4><p>AllegroGraph now does a better job in choosing how to constrain variables in SPARQL triple-patterns during execution. </p><h4>Rfe13476 - Add more logging information to SPARQL SERVICE queries</h4><p>AllegroGraph now includes more logging during the execution of SPARQL SERVICE queries. </p><h4>Rfe13426 - Provide more control over federated SPARQL queries</h4><p>The new query option <code>serviceRequestSize</code> provides control over the size of the POST requests used during SPARQL federated query. The default size is one megabyte. A smaller size may cause additional trips to the remote server. Some servers may reject requests that are too large. SPARQL query options are listed in the <a href="sparql-reference.html#sparql-queryoptions">SPARQL Query Options</a> of the <a href="sparql-reference.html">SPARQL Reference</a>. </p><h4>Rfe13213 - Allow BIND to float during query analysis</h4><p>AllegroGraph's SPARQL query analyzer now does a better job rewriting query patterns involving BIND. In particular, the BIND clause now floats around JOIN, GRAPH and FILTER clauses. This can help make these queries perform significantly better. </p><h4>Rfe12269 - Improve query planning with respect to cross products</h4><p>AllegroGraph's SPARQL query planner now does a better job of detecting cross products at plan time and modifying the query plan to avoid the cross product when this is possible. </p><h4>Bug23125 - Improve query planning for some property path queries</h4><p>SPARQL Property Path queries using the zero-or-more operator (i.e., <code>*</code>) could sometimes choose a sub-optimal plan because AllegroGraph was misestimating the size of the triple-patterns involved. This has been corrected. </p><h4>Bug23095 - Correct internal error that occurred during some Property Path queries</h4><p>Some Property Path queries could fail to run to completion because of an internal bookkeeping error. This has been corrected. </p><h4>Bug23081 - Certain SPARQL queries could cause cursor data-structure leakage</h4><p>Certain SPARQL queries could fail to correctly clean up all of the cursors that they used which could lead to backends becoming unresponsive if they were under heavy load. This has been corrected. </p><h4>Bug23027 - SPARQL was not ordering reified triple IDs correctly</h4><p>The SPARQL query engine was not correctly sorting URIs representing triple IDs. This has been corrected. </p><h4>Bug23026 - Some SPARQL SERVICE calls could mangle their query</h4><p>It was possible for a SPARQL SERVICE call to lose space characters and thereby send the wrong query to the remote end point. This has been corrected. </p><h4>Bug23005 - RDF/XML serializer could emit an invalid namespace abbreviation</h4><p>If there was a namespace mapping between the empty string and some URI, then the RDF/XML serializer would emit an invalid namespace abbreviation. This could occur, for example, when running a CONSTRUCT query using a PREFIX abbreivation like </p>
<pre><code>PREFIX : &lt;http://example.org#&gt; </code></pre><p>This problem has been corrected. </p><h4>Bug23004 - Sparql XML parser could fail to parse some literals</h4><p>AllegroGraph's SPARQL XML parser is used when making federated queries against remote endpoints. This parser was incorrectly handling literals with ampersands (or other escaped characters) in them. This has been corrected. </p><h4>Bug22999 - When embedded in a GRAPH clause freetext SPARQL queries could fail</h4><p>Depending on the data and the query, a freetext match or matchExpression magic predicate could fail to find all results when it was embedded inside of a GRAPH clause. This has been corrected. </p><h4>Bug22994: Fix bad interaction between SPARQL sub-query and federation</h4><p>If a SPARQL query used a sub-query inside of a federated query, AllegroGraph could lose track of the variables involved and create inadvertant cross-products. This has been corrected. </p><h4>Bug22966 - SERVICE clause in a sub-query could fail</h4><p>Depending on the variables projected, a SPARQL query that used a SERVICE clause inside of a sub-query could fail during execution. </p><h4>Bug22937 - GROUP BY returned an empty row when there are no aggregates projected</h4><p>If a SPARQL aggregation query projects only variables (i.e., it does not use any aggregation functions) and the query has no results, then AllegroGraph would return a single row of unbound bindings rather than returning no results at all. This has been corrected. An example of the query in question would be </p>
<pre><code>select ?anything {  
  ?s &lt;ex://missingPredicate&gt; ?anything .  
} group by ?anything </code></pre><h4>Bug22915 - SPARQL STR function is incompatible with aggregation</h4><p>Queries that used the SPARQL <code>STR</code> function on the result of an aggregation would fail. This has been corrected. An example of such a query would be: </p>
<pre><code>select ( str( count(1) ) as ?count) {  
  ?s :testPredicate ?o .  
}  
</code></pre><h4>Bug22904 - Bad query bookkeeping could cause performance problems</h4><p>Given the right data and the right query, the SPARQL query engine could be led to evaluate triple patterns twice: once with constraints and once without which would lead to severe performance problems. This has been corrected. </p><h4>Bug22899 - Query options could not always be used with SPARQL SERVICE</h4><p>When using the SERVICE clause, AllegroGraph's query PREFIX options were not always being sent to endpoints in a way that they could be read. This has been corrected. </p><h4>Bug22874 - N-Dimensional magic property queries could fail</h4><p>Depending on the data and the query, AllegroGraph could choose an incorrect plan ordering for an n-Dimensional SPARQL magic property. This would lead to the <code>UPI not in string table</code> error. This has been corrected. </p><p><a name="timeout-zero"></a> </p><h4>Bug22845 - A query timeout of <em>zero</em> now means "no timeout"</h4><p>Previously, a query timeout of zero was interpreted literally to mean that the query should terminate immediately. Now, a timeout of zero means that the query should run as if there is no timeout specified. This is especially helpful when a default timeout is included in the AllegroGraph configuration file. </p><h4>Bug22751 - Error using one-or-more property paths in SERVICE clause</h4><p>AllegroGraph was signaling an error if a query tried to use a one-or-more property path query inside of a SERVICE clause. This has been corrected. </p><h4>Bug22680 - Correct SPARQL parsing problem for property paths in object lists</h4><p>The SPARQL Parser was not correctly handling property paths embedded inside object lists like <code>?s &lt;ex:predicate&gt; [ &lt;ex:Path&gt;* ?o ]</code>. This has been corrected. </p><h4>Bug22593 - Use the correct count estimates during query execution</h4><p>Depending on the query and the store, AllegroGraph could sometimes use the wrong variable count estimates which would lead to sub-optimial performance. This has been greatly improved. </p><h4>Bug22388: Chunkprocessingmemory defaults to a larger value than memoryLimit</h4><p>The chunkProcessingMemory size defaulted to a larger size than the memoryLimit which meant that queries could fail when using chunk processing. This has been corrected. </p><h4>Bug22212 - Magic property for t:intervalStarts logic was wrong</h4><p>The magic property for t:intervalStarts was incorrectly behaving the same as t:intervalCotemporal. This has been corrected. </p><a name='header3-1662' id='header3-1662'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-1664' id='header3-1664'></a><h3>Changes to the Lisp API</h3><h4>Rfe13593 - The compiler is needed in direct lisp clients that perform queries </h4><p>This change will likely not affect any users since the compiler is normally in Lisp images, but it is possible to build an image without the compiler and without the compiler being available to load (though, again, it is unusual to do so). Such images serving as direct Lisp clients cannot perform queries. </p><h4>Bug22973 - Fix Lisp direct client sigsegv when rolling back a closed store</h4><p>Previously, in the Lisp client when using a direct connection to a triple store, calling rollback on a closed store would produce a SIGSEGV error. With this fix, an informative error condition is signaled. </p><h4>Prolog</h4><p>No significant changes. </p><h4>Documentation</h4><p>No significant changes. </p><h4>Python Client</h4><p>No significant changes. </p><h4>Java Client</h4><p>No significant changes. </p><a name='header3-1677' id='header3-1677'></a><h3>nD Geospatial</h3><h4>Bug22786, Bug22850: improve nD string writers and parsers</h4><p>nD data encoding and decoding supports various human-readable formats (ISO6709 and ISO8601) when such a format can be applied unambiguously to a particular nD encoding. If a human-readable format applies, it will be preferred on decoding (output) and accepted on input (encoding). Previously some correct externalization formats were rejected on input or not used on output. </p><p>nD now correctly supports encodings with multiple ordinates of the same specialized type, i.e. <code>lat</code>, <code>lon</code>, <code>alt</code>, and <code>time</code>. Ordinates must of course all have different names. Use of such encodings will necessarily suppress human-readable externalizations since they are ambiguous. </p><p>Error detection during nD encoding/decoding is improved along with error message text. </p><a name='header2-1682' id='header2-1682'></a><h2>AllegroGraph 5.0.1</h2><a name='header3-1683' id='header3-1683'></a><h3>Server Changes</h3><h4>Bug23016 - Incorrect triple-count and garbage triples</h4><p>Under certain circumstances (particularly when <a href="lisp-reference.html#delete-duplicate-triples" title="description of delete-duplicate-triples">delete-duplicate-triples</a> is used), crash recovery or replication can result in an incorrect triple count and garbage triples being added to the database. This has been corrected. We recommend that users using replication and duplicate triple deletion recreate their replicas from a fresh backup. Replication is described in the <a href="replication.html">Replication</a> document. </p><a name='header3-1686' id='header3-1686'></a><h3>HTTP Client</h3><h4>Bug23040 - Performing the same ASK query more than once under REST could error</h4><p>Under certain circumstances, if an ASK query that used joins was evaluated more than once under the HTTP REST API, then AllegroGraph would signal an error. This has been corrected. </p><a name='header2-1689' id='header2-1689'></a><h2>AllegroGraph 5.0</h2><a name='header3-1690' id='header3-1690'></a><h3>Server Changes</h3><h4>Rfe13506 - Minor query optimization for triple pattern filters</h4><p>AllegroGraph now performs triple pattern filtering slightly more efficiently when the current set of solutions has only a single member. </p><h4>Rfe13405 - Warn if transparent hugepages are enabled</h4><p>Due to the potential for negative performace impact, AllegroGraph now logs a warning into agraph.log on startup if Transparent Hugepages are enabled. See <a href="performance-tuning.html#THP">this section</a> of <a href="performance-tuning.html">Performance Tuning</a> for information on the transparent hugepage issue and its effect on performance. </p><h4>Rfe13376 - Improve hashing performance</h4><p>AllegroGraph's internal hashing functions have been further optimized leading to small general performance improvements. </p><h4>Rfe13346 - configure-agraph should allow for specification of port</h4><p>The configure-agraph script now prompts for the Port configuration parameter and accepts the <code>--port</code> command line argument. See <a href="server-installation.html#configscript">Running the configuration script</a> in <a href="server-installation.html">Server Installation</a>. </p><h4>Rfe13265 - Update N-Triple and N-Quad parsers</h4><p>AllegroGraph's N-Triple and N-Quad parsers now support the full W3C specifiation and pass all tests. The performance is also slightly improved. Note that this change means that AllegroGraph will no longer load invalid N-Triple and N-Quad source data unless the <code>relax-syntax</code> argument is used. See <a href="agload.html">Data Loading</a>, the Lisp API functions <a href="lisp-reference.html#load-ntriples" title="description of load-ntriples">load-ntriples</a> and <a href="lisp-reference.html#load-nquads" title="description of load-nquads">load-nquads</a>, and [PUT/POST /repositories/<a href="http-protocol.html#put-post-statements">name]/statements</a> in <a href="http-protocol.html">REST/HTTP interface</a>. </p><h4>Rfe13172: Allow setting size of strings hash table at database creation time</h4><p>A new database configuration parameter StringTableSize is now available. It can be used to configure the number of hash table slots used for the string storage hash table and setting it properly can enhance performance. See <a href="performance-tuning.html#CatalogParameters">Catalog Parameters that Improve Performance</a> in <a href="performance-tuning.html">Performance Tuning</a> for more information on performance-enhancing options for details. </p><h4>Rfe13146 - Improve suboptimal index scan performance</h4><p>The efficiency of low-level cursor operations has been improved when an optimal index for the cursor is not available. </p><h4>Rfe12872 - Remove ag3-export / ag4-import</h4><p>The obsolete <em>ag3-export</em> and <em>ag4-import</em> utilities have been removed. Serializing data to nquads in AllegroGraph 3 and loading it into AllegroGraph 4 is the recommended alternative. </p><h4>Rfe11580: Added --no-daemonize flag to agraph binary</h4><p>The <strong>agraph</strong> binary is the actual program which starts AllegroGraph. It is not typically invoked directly, but rather using the <strong>agraph-control</strong> script, but it can be called directly. When it is and <code>--no-daemonize</code> is supplied, the service daemon will remain in the foreground. See <a href="daemon-config.html#server-control">agcontrol</a>. </p><p><a name="text-index-update"></a> </p><h4>Bug22837 - Text index incorrectly indexing the string "nil"</h4><p>Since version 4.13 the text indexer was incorrectly indexing the word "nil" for triples that were ineligible for text indexing.  This resulted in unnecessary work being performed and space being consumed. This has been fixed.  We recommend that you drop and recreate any existing text indexes. </p><h4>Bug22835 - Fix numa info parsing failure</h4><p>At startup, information about numa (<em>non-uniform memory access</em>) topology is collected and logged.  Previously, parsing failed with an error if a cpumap file in /sys/ contained a comma separated list of numbers instead of just a single number. This bug has been fixed. </p><h4>Bug22767 - Use agraph5 for the Lisp client fasl name</h4><p>AllegroGraph 5.0 now uses agraph5.fasl instead of agraph4.fasl for the name of the Lisp fasl file. </p><h4>Bug22754 - Concurrent duplicate triple deletion can result in inaccurate triple count</h4><p>Under some circumstances duplicate triple deletion transactions which occur concurrently with other deletion transactions could result in an inaccurate triple count.  This has been corrected. </p><p>Notes: </p>
<ul>
<li><p>Though the triple count could become inaccurate, the integrity of the triples in the database remained intact. </p></li>
<li><p>The triple count on already-affected databases will remain   inaccurate until they are recreated. </p></li></ul><h4>Bug22566 - Encoded ID validation was too weak</h4><p>In some cases, a URI representing an invalid encoded ID could be accepted by AllegroGraph instead of signaling an error. This has been corrected. </p><h4>Bug22564 - Data import could fail to determine the correct base URI</h4><p>When importing a compressed RDF/XML file, AllegroGraph could fail to determine the correct base URI. This has been corrected. </p><h4>Bug22559 - RDF/XML parser should validate the base URI if supplied</h4><p>Previously, the RDF/XML parser failed to validate the base URI it was given which could lead to invalid data. This has been corrected. </p><h4>Bug21867 - Ensure text index queries are called using strings</h4><p>AllegroGraph sometimes called lower level text index query functions with invalid arguments. This has been corrected. </p><h4>Bug21460 - Polygons data cannot be exported and imported</h4><p>AllegroGraph now converts resources of the form </p>
<pre><code>&lt;http://franz.com/ns/allegrograph/4.14/index#_N&gt; </code></pre><p>(where N is replaced by a whole number) into encoded UPIs rather than hashed ones. These URIs are used to serialize AllegroGraph polygon data which means that polygons can be efficiently exported and imported. Note that the Lisp API <a href="lisp-reference.html#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> will return the numeric representation for the UPI rather than the string representation. Use <a href="lisp-reference.html#part-:3Estring" title="description of part->string">part-&gt;string</a> if the string representation is needed. </p><h4>Bug20497, Rfe11047 - Fix fti too many open files error</h4><p>Previously, when constructing a new text index for a database with existing triples, there was potential for the operation to fail with a "Too many open files" error. This has been fixed. </p><a name='header3-1735' id='header3-1735'></a><h3>HTTP Client</h3><h4>Rfe13304 - Support relaxed load syntax for remote triple-stores</h4><p>The HTTP REST API for loading statements now includes the <code>relaxSyntax</code> argument. When true, N-Triple and N-Quad data are not validated as stringently. For example, blank node names may include underscores. See <a href="http-protocol.html#put-post-statements">PUT/POST statements</a> in <a href="http-protocol.html">REST/HTTP interface</a>. </p><h4>Rfe13249 - Augment optimize-indices API to allow for single index optimization</h4><p>The HTTP API's <code>indices/optimize</code> service now takes an additional <code>index</code> query parameter which can be specified multiple times. If omitted, then all of a store's indices will be optimized. If supplied, each parameter value should be the name of an index whose optimization is being requested. See [POST /repositories/<a href="http-protocol.html#post-indices-optimize">name]/indices/optimize</a> in <a href="http-protocol.html">REST/HTTP interface</a>. </p><h4>Rfe11547 - Support Sesame query timeout parameter in HTTP</h4><p>AllegroGraph's SPARQL HTTP REST interface now supports an optional <code>timeout</code> parameter. If specified, it must be a number greater than zero which denotes the number of seconds to limit SPARQL query execution time. If unspecified, then there is no limit on the length of a time a query may run. See [GET/POST /repositories/<a href="http-protocol.html#get-post-repo">name</a> in <a href="http-protocol.html">REST/HTTP interface</a>. </p><h4>Rfe11221 - General type-mapping improvements</h4><p>The interface for setting up predicate- and datatype-mappings has been simplified.  The same HTTP REST API calls can be used to setup regular XSD datatype mappings and geospatial ones (including cartesian, spherical and n-Dimensional). In each case, the datatype must be specified using its URL. E.g., the 10x10 cartesian mapping with resolution 1 would use the URL: </p>
<pre><code>&lt;http://franz.com/ns/allegrograph/3.0/geospatial/cartesian/0.0/10.0/0.0/10.0/1.0&gt; </code></pre><p>See <a href="http-protocol.html#mapping">Type mappings</a> in <a href="http-protocol.html">REST/HTTP interface</a>. </p><h4>Bug22576 - POST|PUT statements service should not require eval permission</h4><p>AllegroGraph would not allow client-side files to be imported into a store unless the user had <code>eval</code> permission. This has been corrected. Of course, <code>eval</code> permission is still required to import server-side files. </p><a name='header3-1748' id='header3-1748'></a><h3>SPARQL</h3><h4>Rfe13510 - Improve performance of the SPARQL query REST API</h4><p>AllegroGraph now automatically caches query information across REST API calls to improve overall query performance. </p><h4>Rfe13323 - Provide API to retrieve only the ID part of an encoded ID</h4><p>There is now a SPARQL function, <http://franz.com/ns/allegrograph/fn#encodedIdId>, that retrieves the non-prefix portion of an encoded ID. For example, if the encoded ID has IRI <a href="http://example.com/person@@3489a">http://example.com/person@@3489a</a>, then the function will return "3489a". In a query, this would look like: </p>
<pre><code>select * {  
  _:b ex:identifier ?id .  
  bind( &lt;http://franz.com/ns/allegrograph/fn#encodedIdId&gt;(?id) as ?value )  
} </code></pre><h4>Rfe13305 - Deprecate old-style SPARQL GEO syntax</h4><p>Because AllegroGraph's magic properties support a richer range of geospatial features than the old-style SPARQL GEO syntax, the old syntax is being deprecated and will now signal a warning when it is used. See <a href="geospatial-nd.html">N-dimensional Geospatial Overview</a>. </p><h4>Rfe13297 - Reduce memory consumption for distinct aggregation in SPARQL queries</h4><p>AllegroGraph now better manages memory when evaluating distinct aggregation queries like: </p>
<pre><code>select ?dept (count(distinct ?student) as ?sc) where {  
  ?dept a :Department .  
  ?student :memberOf ?dept .  
} group by ?dept  
</code></pre><h4>Rfe13289 - When logging, use query supplied namespaces for abbreviations</h4><p>Previously, AllegroGraph would ignore SPARQL query supplied namespaces when displaying resources during query logging. It now uses these namespaces to improve the readability of the display. </p><h4>Rfe13171 - Improve query checks for unknown variables</h4><p>AllegroGraph now warns more consistently when a valid SPARQL expression uses variables in unreasonable ways. For example, this query is perfectly valid but the ORDER BY variables are not bound by the query so it is unlikely to be what was intended: </p>
<pre><code>select ?a ?year ?label {  
  ?a a :Car .  
  ?a :modelYear ?year .  
  ?a rdfs:label ?label .  
} order by ?autoYear </code></pre><h4>Rfe12470 - Apply multiple constraints to the same triple pattern</h4><p>Previously, AllegroGraph could only apply a single logical FILTER expression to any given triple pattern. This meant that queries like: </p>
<pre><code>select * {  
  ?s ?p ?o .  
  filter( ?p = ex:pred1 &amp;&amp; ?o &gt; 10 )  
}  
would optimize the query plan with either the ?p constraint or the ?o  
constraint but not both. This has now been improved so that queries  
like the above will use both constraints simultaneously and thereby  
run much more efficiently. </code></pre><h4>Bug22803 - Fix bug in authorizationBasic query option</h4><p>The authorizationBasic query option was not being parsed correctly which meant that queries that tried to use it would fail. This has been corrected. </p><h4>Bug22802 - Support userinfo in SPARQL service request URIs</h4><p>URIs used in SPARQL service requests did not allow the inclusion of userinfo information so that queries like this would fail: </p>
<pre><code>select * {  
  service &lt;http://user:password@127.0.0.1:7001/repositories/sp2b-1e4&gt; {  
    ?s ?p ?o  
  }  
} limit 5 </code></pre><p>This has been corrected. </p><h4>Bug22750 - Correct an error in SPARQL property path queries</h4><p>In some circumstances, a SPARQL property path query could signal an error when trying to find paths between fixed endpoints. This has been corrected. </p><h4>Bug22735 - SPARQL federated query could fail to recognize geospatial data</h4><p>SPARQL federated query (via the SERVICE) clause could fail to transform returned results using AllegroGraph geospatial encoding. This would lead to query errors and has been corrected. </p><h4>Bug22735 - SPARQL federated query could fail to recognize geospatial data</h4><p>SPARQL federated query (via the SERVICE) clause could fail to transform returned results using AllegroGraph geospatial encoding. This would lead to query errors and has been corrected. </p><h4>Bug22734 - Query options should be passed along to the HOST of any SERVICE clauses</h4><p>Previously, any custom query options set using the PREFIX notation were not passed along to the remote server when using SPARQL Federated query. Now, these options are passed to the remote server which provides more control when that server is running AllegroGraph. </p><h4>Bug22732 - Correct errors for SERVICE clauses that used blank node labels</h4><p>SERVICE clauses that used blank node labels (or property paths that might be rewritten using blank node labels) could lead to an error when AllegroGraph tried to merge these bindings with the containing query. This has been corrected. </p><h4>Bug22731 - Error when using property paths in a SERVICE query with distinct results</h4><p>If a query asked for DISTINCT results and had a property path query inside of a SERVICE clause, then AllegroGraph would signal an error during query planning. This has been corrected. </p><h4>Bug22730 - Some uses of UNION and VALUES could lead to an error</h4><p>Some uses of UNION clauses and SPARQL in-line data via the VALUES clause could lead to a run-time query error. This has been corrected. </p><h4>Bug22727 - EXISTS filters sometimes performed more computation than necessary</h4><p>SPARQL EXISTS (and NOT EXISTS) filters were performing query computation even when the main result set was empty (and hence had nothing to filter). This has been corrected. </p><h4>Bug22660 - Temporal magic properties introduce new variables</h4><p>Temporal magic properties like <http://franz.com/ns/allegrograph/3.0/temporal/pointBefore> were introducing new variables into queries so that a query like </p>
<pre><code>prefix m: &lt;http://di.uoa.gr/~charnik/music_db#&gt;  
prefix time: &lt;http://franz.com/ns/allegrograph/3.0/temporal/&gt;  
select * {  
  m:p_1939-08-19 time:pointBefore m:p_1980-12-04 .  
} </code></pre><p>was returning bindings instead of empty rows. This has been corrected. </p><h4>Bug22588 - Further improve handling of multiple range filters on the same variable</h4><p>AllegroGraph now handles queries with multiple range filters more efficiently. For example, a query like </p>
<pre><code>select * {  
  ?s ex:test ?age .  
  filter( ( ?age &gt;= 10 &amp;&amp; ?age &lt;= 20 ) ||  
          ( ?age &gt;= 60 &amp;&amp; ?age &lt;= 70 ) ||  
          ( ?age &gt;= 80 &amp;&amp; ?age &lt;= 90 ))  
} </code></pre><p>will now execute as the combination of two range queries rather than a single scan. This change is similar to the change for bug22535 but more general. </p><h4>Bug22569 - Improve canceling of SPARQL SNA generators</h4><p>Previously, neither the administrator jobs list nor the query canceling API functioned properly if a query used an SNA generator that was implemented via a separate SPARQL query. This has been corrected. The SNA generator SPARQL queries will no longer appear in the administrator jobs list and they will now inherit any timeout from the query that they are running in service of. This means that canceling the parent query will cancel these child queries. </p><h4>Bug22541 - Improve handling of invalid typed literals</h4><p>Previously, the SPARQL parser would generate a general error and log a backtrace if a query included illegal XSD datatypes like "2014-Mar-13"^^xsd:date. These are now treated as SPARQL parse errors. </p><h4>Bug22541 - Improve clause reordering for some SPARQL GRAPH queries</h4><p>AllegroGraph's statistical BGP reordering could lead to sub-optimal query plans for certain queries that involved GRAPH queries and FILTERs on ranges. This has been corrected. </p><a name='header3-1803' id='header3-1803'></a><h3>AGWebView</h3><h4>Rfe13530 - Rearrange some of AGWebView's settings</h4><p>The "show long parts" and "show contexts" settings are global to the browser session but they were only available on the query viewer. These settings are now also accessible via the new <strong>Utilities | Settings</strong> menu. See the <a href="agwebview.html">AGWebView</a> document. </p><h4>Rfe13504: Add a "large operations warning" to AGWebView</h4><p><a href="agwebview.html">AGWebView</a>'s site settings now include a place to enter text that will appear before it executes an operation that potentially exposes a large amount of repository data. Note as well that the site settings are now available via the new <strong>Utilities | Settings</strong> menu. </p><h4>Rfe13183 - Agwebview uses Unicode rather than \u escaping to display data</h4><p>AGWebView now presents non-ASCII characters using Unicode instead of their \uXXXX escape sequences. </p><h4>Rfe12523 - Improve data import dialogs in AGWebView</h4><p>The data import dialogs in <a href="agwebview.html">AGWebView</a> now support AllegroGraph's relaxed syntax and continue on error options.  Relaxed syntax allows the RDF importers to accept data that it not strictly correct but is still easily understandable. For example, a blank node label is not allowed to include the <code>-</code> (dash) character but many source files use it regardless. Normally, AllegroGraph will not allow these files to be imported but if relax syntax is turned on, it will.  Continue on error allows AllegroGraph to continue loading data even if it encounters a bad triple or quad. Note, this option only affects line based formats like N-Triples or N-Quads. As ignoring errors is an all or nothing affair, this option should be used with caution: it will not be possible to determine how many triples were skipped or even if any errors were encountered. These new options correspond to the <code>--error-strategy</code> and the <code>--relax-syntax</code> options to <a href="agload.html">agload</a>. </p><h4>Rfe11466 - Use double-clicks to navigate the file picker in AGWebView</h4><p>AGWebView's file picker for selecting files on the server side used single-clicks rather than double clicks to change directories. This has been corrected. </p><h4>Bug22800 - Fix regression in v4.14 that breaks proxying through frontend</h4><p>There was a regression in v4.14 that partially broke the use of AGWebView over https. This is fixed. Additionally support is added for proxying requests to https sessions through an http frontend, or to http sessions through an https frontend. </p><a name='header3-1816' id='header3-1816'></a><h3>Changes to the Lisp API</h3><h4>Rfe13249 - Augment optimize-indices API to allow for single index optimization</h4><p>The Lisp API's <a href="lisp-reference.html#optimize-indices" title="description of optimize-indices">optimize-indices</a> function now takes an additional <code>indices</code> argument. This can be <code>nil</code> (the default) or <code>:all</code> to optimize all of the triple-store's indices, a single index name (like <code>:psogi</code>) to optimize one index or a list of index names to optimize each of them. </p><h4>Rfe13184 - Check for uninterned UPIs when adding triples</h4><p>Previously, AllegroGraph did not ensure that the UPIs in a triple being added were already interned in the triple-store's string-table. This led to the possiblity of adding triples that could not be re-serialized. The default is now to check UPIs unless the code doing the adding is wrapped in the new <a href="lisp-reference.html#while-not-validating-that-upis-are-in-string-table" title="description of while-not-validating-that-upis-are-in-string-table">while-not-validating-that-upis-are-in-string-table</a> macro. </p><h4>Rfe6878 - open-triple-store can take a triple-store instance</h4><p>The <a href="lisp-reference.html#open-triple-store" title="description of open-triple-store">open-triple-store</a> function can now be called using an existing triple-store instance. In this case, it will return a new instance of the same underlying store. </p><h4>Bug22811 - Fix use of direct Lisp client when AllowHTTP is false.</h4><p>Previously, the direct Lisp client would be unable to access an Allegrograph server if it was started with the config directive AllowHTTP set to false. This bug is now fixed. </p><h4>Bug22772 - Include inferred-triple-p in the remote Lisp client</h4><p>The <a href="lisp-reference.html#inferred-triple-p" title="description of inferred-triple-p">inferred-triple-p</a> function was inadvertently left out of the remote Lisp client. This has been corrected. </p><h4>Bug22703 - Add relax-syntax argument to load-nquads|ntriples-from-string</h4><p>The funtions <a href="lisp-reference.html#load-nquads-from-string" title="description of load-nquads-from-string">load-nquads-from-string</a> and <a href="lisp-reference.html#load-ntriples-from-string" title="description of load-ntriples-from-string">load-ntriples-from-string</a> were missing the <code>relax-syntax</code> argument. This has been corrected. </p><a name='header3-1829' id='header3-1829'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-1831' id='header3-1831'></a><h3>N-dimensional geospatial</h3><h4>Rfe13364 - Add automate-nd-datatype-mappings switch to agload</h4><p><strong>agload</strong> now supports AllegroGraph's automatic N-Dimensional geospatial type mappings. If the new <code>--automate-nd-datatype-mappings</code> option is specified on the command-line, then any geospatial datatypes in a source file will be automatically recognized and added to the triple-store. See <a href="agload.html">Data Loading</a>. </p><h4>Rfe13350 - Add additional standard namespace abbreviations</h4><p>The following namespace abbreviations have been added to AllegroGraph: </p>
<ul>
<li><code>nd</code> - &lt;http://franz.com/ns/allegrograph/5.0/geo/nd#&gt;</li>
<li><code>ndfn</code> - &lt;http://franz.com/ns/allegrograph/5.0/geo/nd/fn#&gt;</li>
<li><code>keyword</code> - &lt;http://franz.com/ns/keyword#&gt;</li></ul><p>These are helpful in using the new N-Dimensional geospatial functionality. </p><a name='header3-1840' id='header3-1840'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-1842' id='header3-1842'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-1844' id='header3-1844'></a><h3>Java Client</h3><h4>Rfe12921 - Upgrade to sesame-2.7.11 and jena-2.11.1 jars</h4><p>With this change, the Java Client has been upgraded to use Sesame 2.7.11 and Jena 2.11.1 jars. Previously, the Java Client used Sesame 2.6.8 and Jena 2.7.2 jars. </p><h4>Rfe12920 - Tutorial for connection pooling using Sesame</h4><p>Example24 has been added to the Sesame tutorial examples to create and manage connection pools using Sesame. Java Sesame tutorials in general are discussed in <a href="java-tutorial/java-tutorial.html">Java Sesame Tutorial</a>. Example24 does not have a writeup and is in the file <em>TutorialExamples.java</em> discussed in <a href="java-tutorial/java-tutorial.html">Java Sesame Tutorial</a>. </p><h4>Bug22854 - TutorialExamples.java signals warnings in java client</h4><p>With this change, Tutorial examples run with out any runtime warnings. Also some warnings are fixed in callimachus tests </p><h4>Bug21911 - Implementation of Jena QueryExecution methods</h4><p>Previously, the AGQueryExecution class had no implementation for following methods: </p>
<ul>
<li><strong>execConstructTriples()</strong></li>
<li><strong>execDescribeTriples()</strong></li>
<li><strong>getQuery()</strong></li>
<li><strong>setTimeout(long timeout)</strong>,</li>
<li><strong>setTimeout(long arg0, TimeUnit arg1)</strong></li>
<li><strong>setTimeout(long arg0, long arg1)</strong></li>
<li><strong>setTimeout(long timeout1, TimeUnit timeUnit1, long timeout2, TimeUnit timeUnit2)</strong></li></ul><p>This has been corrected.  An example (example24) for a Jena Graph Union has been added to the Jena examples.  Jena tutorials in general are discussed in <a href="java-tutorial/jena-tutorial.html">Java Jena Tutorial</a>. Example24 does not have a writeup and is in the file <em>JenaTutorialExamples.java</em>. </p><a name='header2-1861' id='header2-1861'></a><h2>AllegroGraph 4.14.1</h2><a name='header3-1862' id='header3-1862'></a><h3>Server Changes</h3><h4>Rfe13193 - Parameterize email notifications</h4><p>This change builds on rfe13104 and makes it possible to specify for which audit events emails should be sent and to what address. The body of the email contains the triples added for the audit event in pretty printed Turtle format. </p><p>The <code>AdminEmail</code> and <code>AdminEmailSMTPHost</code> configuration directive were removed in favor of the new AuditEventsToEmail directive. (<strong>Note this is a backward-incompatible change</strong>. See the <a href="audit.html">Auditing</a> document.) </p><p>The following rule asks for emails to be sent to <code>me@gmail.com</code> via the <code>gmail</code> smtp host (defined with SMTPHost directive) when any of the <code>expirePassword</code>, <code>addUser</code> or <code>deleteUser</code> audit events trigger: </p>
<pre><code>AuditEventsToEmail to="me@gmail.com", smtphost="gmail", \  
  events="expirePassword,addUser,deleteUser" </code></pre><p>If there is only one smtp host defined then it can be omitted: </p>
<pre><code>AuditEventsToEmail to="me@gmail.com", \  
  events="expirePassword,addUser,deleteUser" </code></pre><p>Note that auditing must be enabled for this to work. See the <a href="audit.html">Audit documentation</a> for more information. </p><h4>Rfe13201 - Restrict the range of backend ports</h4><p>This change adds the <code>BackendPorts</code> global configuration directive to restrict the range of ports on the loopback interface to be used by shared back-ends. Note that the maximum number of shared back-ends is limited by the number of ports in the specified range even if the Backends directive is higher. Configuration options are described in <a href="daemon-config.html">Server Configuration and Control</a>. </p><h4>Bug22675 - Simple queries may not show up in the jobs list</h4><p>This is a continuation of the work done for bug22536 and increases the number of queries that can be controlled in the jobs list. </p><h4>Bug22666 - run-fti-merge doesn't fail fast</h4><p>Previously, if the text index merger process encountered an error during merging, it would log the error and a backtrace to agraph.log and then continue operation.  If the error condition persisted, this logging could continue indefinitely, resulting in agraph.log growing to excessive size.  This has been fixed. </p><h4>Bug22641 - Listing and cancelling queries</h4><p>Previously, job management (available via /jobs REST service and also admin/job in AGWebView) had a bug which caused concurrent requests to fail with: </p>
<pre><code>the assertion (endp (intersection  
(db.agraph.spawn::receiver-for db.agraph.spawn::r)  
(db.agraph.spawn::receiver-for db.agraph.spawn::receiver))) failed </code></pre><p>This bug has been fixed. </p><h4>Bug22641 - Listing and cancelling queries</h4><p>Previously, job management (available via /jobs REST service and also admin/job in AGWebView) had a bug which caused concurrent requests to fail with:     the assertion (endp (intersection     (db.agraph.spawn::receiver-for db.agraph.spawn::r)     (db.agraph.spawn::receiver-for db.agraph.spawn::receiver))) failed This bug has been fixed. </p><h4>Bug22636 - Accumulation of datafile mappings during unshuffling</h4><p>For very large databases it was possible for index optimizers to exceed address space limitations and throw errors during large optimization operations.  This has been fixed. </p><h4>Bug22624 - Level 2 optimization should stop after single round</h4><p>Previously, if a level 2 optimization was requested and, while it was running, additional triples were loaded into the database, the level 2 optimization would run again, redoing most of the work that it had done before.  This has been fixed. </p><a name='header3-1887' id='header3-1887'></a><h3>HTTP Client</h3><h4>Rfe12546 - Implement get-duplicate-triples.</h4><p>Add support for retrieving the set of duplicate triples in a repository via the following REST/HTTP service call: </p><p>  GET /repositories/[name]/statements/duplicates </p><p>See <a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a>. </p><a name='header3-1892' id='header3-1892'></a><h3>SPARQL</h3><h4>Bug22692 - Improve error logging for SPARQL update commands</h4><p>AllegroGraph now prints additional information to the query log when errors are encountered during SPARQL update processing. </p><h4>Bug22601 - SPARQL INSERT WHERE could fail to encode typed literals</h4><p>When adding triples using the SPARQL DELETE/INSERT/WHERE update command, it was possible for typed literals to be saved as unencoded UPIs (stored in the string table) rather than as the more efficient encoded UPIs (stored directly with the triples). Depending on other settings, this could lead both to inefficent queries and missing results. The problem has been corrected. </p><h4>Bug22588 - Further improve handling of multiple range filters on the same variable</h4><p>AllegroGraph now handles queries with multiple range filters more efficiently. For example, a query like </p>
<pre><code>select * {  
  ?s ex:test ?age .  
  filter( ( ?age &gt;= 10 &amp;&amp; ?age &lt;= 20 ) ||  
          ( ?age &gt;= 60 &amp;&amp; ?age &lt;= 70 ) ||  
          ( ?age &gt;= 80 &amp;&amp; ?age &lt;= 90 ))  
} </code></pre><p>will now execute as the combination of two range queries rather than a single scan. This change is similar to the change for bug22535 but more general. </p><h4>Bug22540 - Handle failures of WHERE parts of update queries</h4><p>Previously, if the query in the WHERE part of an update query failed (it timed out, ran out of memory, or was cancelled), the update failed with a bus error. This bug has been fixed. </p><h4>Bug22334 - SERVICE doesn't deal with encoded IDs</h4><p>SPARQL Federated query was not working correctly with AllegroGraph encoded IDs. This has been corrected. </p><a name='header3-1905' id='header3-1905'></a><h3>AGWebView</h3><h4>Rfe12546 - Add Export Duplicate Statements link in AG Webview</h4><p>On the Repository Overview page there is now an option to have the browser download the set of duplicate triples in the repository. Use the adjacent dropdown box to choose the method by which duplicates are determined (SPO or SPOG). See <a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a>. </p><a name='header3-1908' id='header3-1908'></a><h3>Changes to the Lisp API</h3><h4>Rfe12546 - Implement get-duplicate-triples.</h4><p>Add support for retrieving the set of duplicate triples in a repository with the following Lisp API <a href="lisp-reference.html#get-duplicate-triples" title="description of get-duplicate-triples">get-duplicate-triples</a>, which returns a cursor of all duplicate triples visible inside the current transaction. See also <a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a>. </p><a name='header3-1911' id='header3-1911'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-1913' id='header3-1913'></a><h3>Documentation</h3><p>New document <a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a> discusses the issue of duplicate triples in a store. </p><a name='header3-1915' id='header3-1915'></a><h3>Python Client</h3><h4>Rfe12546: Add getDuplicateStatements to AGRepositoryConnection</h4><p>Adds a new method to the RepositoryConnection class called getDuplicateStatements, that returns the set of duplicate triples in the repository. The method signature is: </p>
<pre><code>def getDuplicateStatements(mode) </code></pre><p>Duplicate triples are determined by the <code>mode</code> argument, which can be specified as either "spo" (compare as ntriples) or "spog" (compare as nquads). See also <a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a>. </p><a name='header3-1920' id='header3-1920'></a><h3>Java Client</h3><h4>Rfe12546 - Add getDuplicateStatements to AGRepositoryConnection</h4><p>Adds a new method to the RepositoryConnection class called getDuplicateStatements, that returns the set of duplicate triples in the repository. The method signature is: </p>
<pre><code>def getDuplicateStatements(mode) </code></pre><p>Duplicate triples are determined by the <code>mode</code> argument, which can be specified as either "spo" (compare as ntriples) or "spog" (compare as nquads). See also <a href="deleting-duplicate-triples.html">Deleting Duplicate Triples</a>. </p><a name='header2-1925' id='header2-1925'></a><h2>AllegroGraph 4.14</h2><a name='header3-1926' id='header3-1926'></a><h3>Server Changes</h3><h4>Rfe13144 - Add <code>bulk mode</code> switch to agmaterialize command line tool</h4><p><strong>agmaterialize</strong> now supports a <code>--bulk</code> command-line option. If specified, then materialization will be run in <em>bulk</em> mode. This mode provides approximately 30% faster materialization.  Note that bulk mode is global to the store and means that transactions will not be durable (in particular, will not be logged). Therefore, the switch should generally be used only when the store is not being used for other operations.  See the <a href="materializer.html">Materializer</a> document for information on <strong>agmaterialize</strong>. </p><h4>Rfe13116 - Audit events for AGWebView login, logout, timeout</h4><p>With this change, if auditing is enabled, then logIn, logOut, logOutWithTimeout events are added to the audit log whenever a user logs in, logs out, or when a login session times out. See <a href="audit.html">Auditing</a>. </p><h4>Rfe13108 - Allow restricting superuser access to triples data</h4><p>This change adds a new global configuration directive: <code>SuperUserCanAccessAllData</code>. If it is enabled (the default), then users with the Superuser permission will have read/write access to all repositories (just like in previous AllegroGraph versions). If it is turned off, then the superuser needs to be granted access to repositories. This is most useful when auditing is enabled and any change to user permissions is logged, as superusers will be able to grant themselves any permissions they want and auditing must be enabled if the fact that a superuser granted him/herself permission is to be recorded. </p><h4>Rfe13104 - Notify admin by email of user account status changes</h4><p>This change adds three new global configuration directives: <code>SMTPHost</code>, <code>AdminEmail</code>, and <code>AdminEmailSMTPHost</code>. With <code>SMTPHost</code> one can associate login, password, port, etc with a server: </p>
<pre><code>SMTPHost gmail \  
  server="smtp.gmail.com", ssl=true, starttls=false,\  
  from="me@gmail.com", login="me@gmail.com", \  
  password="somepassword" </code></pre><p>If <code>AdminEmail</code> is defined, then emails for user account status changes events are sent to it: </p>
<pre><code>AdminEmail admin@my-ag-installation.com </code></pre><p>If there are multiple SMTPHost definitions, then one can explicitly select one of them: </p>
<pre><code>AdminEmailSMTPHost gmail </code></pre><p>See the documentation in <a href="security.html">Security Implementation</a> for more information. </p><h4>Rfe13094 - Add EvalAllowed configuration directive</h4><p>This change introduces the <code>EvalAllowed</code> global configuration directive.  If it is <code>yes</code> (the default), then the "Evaluate arbitrary code" permission bits are effective. If it is <code>no</code>, then arbitrary code evaluation is disabled for all users (including superusers), regardless of the value of a user's actual "Evaluate arbitrary code" permission. Configuration directives are described in <a href="daemon-config.html">Server Configuration and Control</a>. </p><h4>Rfe13091 - Password and account expiration, suspending, disabling</h4><p>This change introduces a number of parameters to control passwords and accounts. All are described in <a href="daemon-config.html">Server Configuration and Control</a>. The new options are: </p>
<pre><code>PasswordExpiry: The time since the last password change after  
which the password will be expired. One cannot login with an  
expired password, it can only be used to change the password.  
 
PasswordExpiryGrace: The time since password expiry after which  
the account is disabled. Only the administrator can reenable  
accounts. This option does not affect users with superuser  
permission.  
 
MaxFailedLogins: The number of failed logins in a row after which  
the account is suspended.  
 
AccountUnsuspendTimeout: The time after which suspended accounts  
are unsuspended.  
 
AccountExpiry: The time since the last authenticated activity of a  
user after which the account is deleted. This option does not  
affect users with superuser permission. </code></pre><h4>Rfe13058 - Control password complexity</h4><p>This change adds four new global configuration directives: <code>PasswordMinLength</code>, <code>PasswordMinUppercaseChars</code>, <code>PasswordMinDigitChars</code>, <code>PasswordMinSpecialChars</code> to allow the administrator to specify password complexity thresholds. All are described in <a href="daemon-config.html">Server Configuration and Control</a>. </p><h4>Rfe12941 - Allow use of more than 64GiB of query memory</h4><p>Previously, the start address of the heap holding the query data structures has been such that when the heap grew beyond 64GiB it was likely to collide with shared libraries mapped there which made allocations fail. This change moves the heap so that collision is less likely and much larger heaps are possible. </p><h4>Rfe12929 - Add changePassword audit event</h4><p>With this change, when a user's password is changed and auditing is enabled, an audit event of type <code>&lt;http://franz.com/allegrograph/4.11/audit-log#changePassword&gt;</code> is logged. </p><h4>Rfe12915 - Improve reporting of shared memory allocation errors</h4><p>Previously, if allocation of shared memory used by processes serving a database instance failed, the error message was an opaque 'end-of-file'. With this change, the error message expicitly mentions the allocation failure. </p><h4>Rfe12884 - Include failed login attempts in the audit log</h4><p>With this change, when auditing is enabled, a failedLogin event is written to the audit log on authentication failures. </p><h4>Rfe12848 - Removal of query temporary files</h4><p>Sometimes queries write intermediate results to disk when they will not fit in memory, for instance with an ORDER BY query. If a query failed, some of its temporary files were not removed in a timely manner. With this change, temporary files are always deleted whether the query finishes or fails. </p><h4>Bug22527 - Sorting UPI maps</h4><p>Previously, on certain filesystems sorting of UPI maps could fail, which broke the repository instance. The only indication of this bug was the log message "Sort command failed". This bug has been fixed. </p><h4>Bug22507 - Include id of deleted user in audit report</h4><p>Previously, the audit report did not include the user id of the affected user associated with <code>deleteUser</code> events. This bug has been fixed. </p><h4>Bug22466 - Setting geospatial type mappings did not register the subtype</h4><p>Previously, setting a geospatial datatype or predicate mapping did not also add the geospatial subtype to the triple-store. This has been corrected. </p><h4>Bug22465 - In the turtle format, QNames are a superset of XML QNames</h4><p>AllegroGraph's turtle parser required QNames (like <code>rdf:type</code>) to be XML QNames but the turtle standard approved in February 2014 allows additional flexibility. In particular, the first character of the local part of a QName may start with a digit. Previously, a QName like <code>rdfs:0</code> would have signaled a parse error. Now, it will be accepted. </p><h4>Bug22450 - RDF/XML serializer could re-use node abbreviations</h4><p>For efficiency, the RDF/XML and RDF-N3 serializers maintain a mapping from URI to prefix abbreviation (e.g., from <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> to rdf:type). It was possible for the map to become corrupted during serialization leading to different nodes being printed as if they were the same. This has been corrected. </p><h4>Bug22422 - Federated triple-stores cannot use geospatial magic properties</h4><p>The check for whether or not a triple-store could use a geospatial magic property was too stringent. This has been corrected so that federated triple-stores can be queried with geospatial magic properties. Note that every store in the federation must agree on any geospatial predicate type mappings used in the query. If they do not, then an error will be signaled during query planning. </p><h4>Bug22371 - Fix race condition when using free-text indices.</h4><p>Previously, a race condition existed where a client A would fetch the list of free-text indices on a repository, but have the set of indices modified by a client B, thus rendering client A's list out of sync. This could result in unexpected errors in certain situations, such as when opening repositories. Now, attaching to free-text indices is synchronized so that this race condition is avoided. </p><h4>Bug22363 - Fix log rotation</h4><p>A bug was introduced in v4.13 where a SIGHUP sent to the Service Daemon would not cause the log file to be closed and reopened. This is now fixed. </p><h4>Bug22345 - Use customer namespaces in remote clients</h4><p>Similar to rfe12679 (under SPARQL below), AllegroGraph now uses customer namespaces when serializing output in RDF/XML for all clients. Previously, temporary namespaces were used. </p><h4>Bug22319 -  Materializer not inferring rdfs:subClassOf reflexivity</h4><p>The materializer was not always correctly inferring that classes were rdfs:subClasses of themselves. This has been corrected. This change also improves the performance of AllegroGraph's OWL 2 RL materializer significantly. </p><h4>Bug22300 - Fix error when system time is in the past</h4><p>Previously, if the system time in the environment of deployment was before the build time of the AllegroGraph, then queries would fail with an error saying: </p>
<pre><code>Attempt to do an array operation on nil which is not an array. </code></pre><p>This bug has been fixed. </p><h4>Bug22297: ensure-not-lingering should latch</h4><p>Previously, if a request to delinger a store could not be honored because it was still in use by another process, the request would be ignored.  Now, the request is deferred until the store is no longer in use. </p><h4>Bug22293 - Make agraph-backup support dynamic catalogs.</h4><p>Previously, backup and restore operations would fail when operating on repositories in dynamic catalogs. Backup operations were unable to locate the main directory of the repository. Restore operations were unable to locate the main directory of dynamic catalogs. </p><p>Now, backup and restore operations support repositories created in dynamic catalogs. They follow the same rules as other repositories, most notably that when performing a restore operation, all dynamic catalogs must already have been created, or the restore will fail. </p><p>See <a href="daemon-config.html#catalog">Catalog definitions</a> in <a href="daemon-config.html">Server Configuration</a> for a description of dynamic catalogs. </p><h4>Bug22259 - Ensure proper transaction log stream alignment on restart</h4><p>Previously, under certain unusual circumstances, the transaction log stream could be left in a state that prevented a database from reopening properly. This has been fixed. </p><h4>Bug22243 - Less fragmentation in the shared memory</h4><p>With this change, the shared memory allocator is more aggressive about coalescing freed regions which reduces the tendency of shared memory to fragment. </p><h4>Bug22229 - Geospatial type mappings could cause duplicate triples</h4><p>If a triple-store registered a predicate and a datatype geospatial type mapping that applied to the same triple, then that triple would be added to the store twice. This has been corrected. </p><h4>Bug22228 - Rare error when opening a triple store</h4><p>Under extremely rare circumstances, opening a triple store could result in the following error: </p>
<pre><code>The assertion (integerp db.agraph.storage::chunk-size) failed. </code></pre><p>This has been fixed. </p><h4>Bug22226 - More efficient memory usage</h4><p>With this fix, the query engine does a more thorough job of giving freed memory back to the operating system which enables more efficient operation under high concurrency workloads. </p><h4>Bug22211 - Trix parser did not treat Return (ASCII 13) as whitespace</h4><p>The TriX parser was not treating Return characters (ASCII 13) as whitespace which sometimes led to parse errors. This has been corrected. </p><h4>Bug22208 - Concurrent queries in shared backends</h4><p>When the system is under load, a shared backend may execute several queries concurently. Under rare circumstances, the queries involved could change each other's query options and produce incorrect results. This bug has been fixed. </p><h4>Bug22198 - Listing freetext indices should not error for federated triple-stores</h4><p>Previously, federate-triple-stores would signal an error when asked to list their freetext indices. They now return an empty list. </p><h4>Bug22141 - Attempt to close instance during agraph-backup --supersede restore operations.</h4><p>Previously, using <strong>agraph-backup</strong> to restore into an open triple-stores would fail. Now, when the --supersede option is specified, such restores can succeed. <strong>agraph-backup</strong> is described in <a href="backup-and-restore.html">Backup and Restore</a>. </p><a name='header3-2008' id='header3-2008'></a><h3>HTTP Client</h3><h4>Rfe12963 - SERVICE URIs with query strings</h4><p>Previously, AllegroGraph dropped the query string in a SERVICE URI when making a request. In this example: </p>
<pre><code>SERVICE &lt;http://sparql.bioontology.org/ontologies/sparql?apikey=XXX&gt; </code></pre><p>the 'apikey' was not sent to the remote web server. This has been fixed. </p><h4>Rfe12952 - Add global configuration directive UseMainPortForSessions</h4><p>Normally, HTTP requests to a dedicated session go directly to the process serving that particular session. This has low overhead, but it can make firewall management more difficult because more ports have to be open. With this change, the new UseMainPortForSessions directive may be enabled in the configuration file which makes all communication be proxied through the front-end. Previously, similar functionality existed only in the Java client controlled by the UseMainPortForSessions property. </p><p><a name="RepoScripts"></a> </p><h4>Rfe12798: Implement repo-specific scripts</h4><p>The existing scripting HTTP API (sitescripts) manages scripts that can be used with any repository.  An HTTP API has been added for managing scripts that are local to a given repository, called "reposcripts". Reposcripts can only be loaded and run against the repository under which the script was loaded.  See <a href="http-protocol.html#scripting">Scripting the server</a> in <a href="http-protocol.html">HTTP Protocol</a> for more information. </p><h4>Bug22524 - HTTP protocol should not send partial responses</h4><p>Previously, queries that used Chunk-at-a-Time (CaaT) processing over the HTTP REST interface would begin streaming results back as soon as the first chunk was processed. If a query timeout was in effect, this meant that AllegroGraph could issue a 200 (OK) response and then only send back only a partial response body. To prevent this, AllegroGraph now computes the entire query result before sending any HTTP response when there is a time out active. </p><h4>Bug22476 - Unauthorized response for javascript eval</h4><p>Previously, if the user had no eval permission, attempts to execute javascript failed with HTTP status 400 and a "MALFORMED PROGRAM" message. With this change, the coreect HTTP status 401 'unauthorized' is returned. </p><h4>Bug22445 - Don't percent-decode path component of HTTP requests twice.</h4><p>Previously, path components of HTTP requests sent to AllegroGraph were sometimes being percent-decoded twice. For example, the URI </p>
<pre><code>http://localhost:10035/repositories/test%252frepo/statements </code></pre><p>could be seen by AG as either </p>
<pre><code>http://localhost:10035/repositories/test%2frepo/statements </code></pre><p>or </p>
<pre><code>http://localhost:10035/repositories/test/repo/statements </code></pre><p>depending on the URI being requested. This bug isn't likely to have been encountered unless you were attempting to include special characters in repository or catalog names. It is now fixed. Users with applications that make direct HTTP requests should check their request URIs to ensure that they do not double-percent-encode any path components, as these may stop working or have unexpected behavior. Percent-decoding of URI query arguments is not affected. </p><h4>Bug22369 - Fix server-side javascript http-request property values.</h4><p>Previously, the property values of javascript http-request objects (method, url, body, etc.) could raise errors due to returning invalid objects. This bug has been fixed, and return values should match what is described in <a href="javascript.html#defineService">the documentation</a>. </p><h4>Bug22329 - Fix handling of HTTP 'Expect: 100-Continue'</h4><p>Previously, AllegroGraph did not send the '100 Continue' response to requests with 'Expect: 100-Continue' headers when the request was forwarded internally to another component. This happened, for instance, when a request to a shared backend or a dedicated session was forwarded via the frontend and also when a requested made directly to a dedicated session was forwarded to the frontend. With this change, '100 Continue' is sent as appropriate. </p><a name='header3-2034' id='header3-2034'></a><h3>SPARQL</h3><h4>Rfe13029 - Use POST instead of GET for remote SPARQL queries</h4><p>AllegroGraph now uses HTTP POST requests instead of HTTP GET requests when talking to remote SPARQL endpoints. This allows for larger query strings to be sent. </p><h4>Rfe13028: Improve use of partial results when making SERVICE queries</h4><p>AllegroGraph now makes more use of partially computed results when making federated SPARQL queries using the SERVICE clause. This results in more efficient queries against SPARQL endpoints. </p><h4>Rfe12911 - Improve estimates for <em>magic</em> geospatial properties</h4><p>AllegroGraph's size estimates for geospatial queries that use SPARQL <em>magic</em> properties are now more accurate. This improves query clause reordering and can greatly improve query performance. </p><h4>Rfe12891 - Improve efficiency of some SPARQL geospatial queries</h4><p>Some queries that use SPARQL <em>magic</em> properties to use AllegroGraph's geospatial engine will now operate more efficiently. </p><h4>Rfe12822 - Add temporaryFileDiskSpace query option</h4><p>Sometimes queries write intermediate results to disk when they will not fit in memory, for instance with an ORDER BY query. With a huge query it is possible for a such temporary files to fill the filesystem. In order to prevent this, the temporaryFileDiskSpace query option may be set. For example: </p>
<pre><code>PREFIX franzOption_temporaryFileDiskSpace: &lt;franz:10G&gt; </code></pre><p>As with all query options, it is also possible to change the default value globally in the AllegroGraph configuration file. For example: </p>
<pre><code>QueryOption temporaryFileDiskSpace=10G </code></pre><p>The default is to have no limit. Query options are described <a href="sparql-reference.html#sparql-queryoptions">here in the SPARQL Reference</a>; the AllegroGraph configuration file is described in <a href="daemon-config.html">Server Configuration</a>. </p><h4>Rfe12788 - Raise error for invalid use of SPARQL geospatial functions</h4><p>AllegroGraph now signals an error at parse time when a geospatial function is used with a predicate that is not associated with a geospatial type-mapping. </p><h4>Rfe12750: SPARQL Property Path cache improvements</h4><p>SPARQL Property Path computations use a cache to improve the efficiency of transitive closure calculations. The data structures for this cache have been rewritten to be more memory and time efficient. Secondly, the heuristic that the query engine uses to determine whether or not the cache should be aggressively or lazily filled have been improved. </p><h4>Rfe12284 - Signal an error if a SPARQL GEO pattern uses a constant object or graph place</h4><p>The SPARQL GEO Clause uses its first pattern to link with AllegroGraph's geospatial system. The object place of this pattern must be left unbound. Previously, AllegroGraph would silently return no results when the place was bound. Now, it will signal an error. For example, the following query would have previously run but returned incorrect results but now it will signal an error. </p>
<pre><code>prefix s: &lt;http://franz.com/ns/allegrograph/3.0/geospatial/spherical/km/-180.0/180.0/-90.0/90.0/&gt;  
select distinct ?event ?coord ?date ?platform ?EventType {  
  GEO SUBTYPE s:1.0  
  BOUNDINGBOX( POINT(-084,34), POINT(-082,36)) {  
    # this is an error because the first clause is the one  
    # that connects the query with AllegroGraph's geospatial  
    # sub-system  
    ?event a &lt;http://UCore-SL-Taxonomy-OWL-DL#ObservationEvent&gt; .  
    ?event mo:hasGeospatialCoordinate ?coord .  
  }  
  WHERE { }  
}  
</code></pre><h4>Rfe12240 - Improve bound variable analysis when using <em>magic</em> properties</h4><p>The SPARQL 1.1 query planner now recognizes that variables set via assignment using the BIND clause can be treated as bound when determining whether or not a <em>magic</em> property can be used. This means that queries like </p>
<pre><code>select ?event ?coord {  
  bind(44.30 as ?xMin) .  
  bind(33.40 as ?yMax) .  
  (?event ?coord) franzGeo:inBoundingBoxXY (swp:startLatLong ?xMin 44.50 33.30 ?yMax)  
} </code></pre><p>can now be used. </p><h4>Rfe11880 - Improve handling of some SPARQL GRAPH clauses</h4><p>AllegroGraph's analysis of when and how it can execute SPARQL GRAPH clauses has been improved. Depending the query, this enhancement can speed execution by a factor of 10 or more. </p><h4>Rfe10132 - Improve performance of find unique values for a column queries</h4><p>SPARQL queries that ask for the DISTINCT values of a particular column are now sometimes significantly faster. Previously, they performed linearly in the size of the triple-store; now, they perform linearly in the size of the number of values returned. In particular, for stores with a small number of predicates or graphs (relative to the size of the store), queries like these will be much, much faster: </p>
<pre><code>SELECT DISTINCT ?p { ?s ?p ?o }  
SELECT DISTINCT ?g { graph ?g { ?s ?p ?o } }  
SELECT DISTINCT ?class { ?s a ?class } </code></pre><p>Note that aggregate queries still require a full-scan of the store, so a query like: </p>
<pre><code>SELECT ?p (count(1) as ?pCount) {  
  ?s ?p ?o .  
} </code></pre><p>will still be expensive. </p><h4>Bug22529 - Improve use of intermediate information during query</h4><p>AllegroGraph's set based SPARQL 1.1 query engine sometimes used an intermediate result set when it would have been more efficient to compute the solutions directly. This has been corrected. </p><h4>Bug22535 - Improve handling of multiple range filters on the same variable</h4><p>AllegroGraph now handles queries with multiple range filters more efficiently. For example, a query like </p>
<pre><code>select * {  
  ?s ex:test ?age .  
  filter( ( ?age &gt;= 10 &amp;&amp; ?age &lt;= 20 ) ||  
          ( ?age &gt;= 60 &amp;&amp; ?age &lt;= 70 ))  
} </code></pre><p>will now execute as the combination of two range queries rather than a single scan. </p><h4>Bug22485 - Improve pattern size estimation logic</h4><p>AllegroGraph's estimation of the size of triple-patterns in a BGP has been improved. This in turn improves the automatic BGP re-ordering and leads to better query plans when using the statistical clauseReorderer. </p><h4>Bug22430 - Cross products with unbound variables could lose results</h4><p>Depending on the query algebra and the order in which clauses were evaluated, it was possible for AllegroGraph to lose some solutions with unbound variables when computing a cross product. This has been corrected. </p><h4>Bug22391 - Make SPARQL rand() results more independent</h4><p>Due to an unintended sharing of random number generator state, SPARQL rand() calls in queries running on the same backend can be produce the same stream of pseudo random numbers. </p><h4>Bug22389 - The chunkProcessingMemory query option could not be specified in a query</h4><p>The chunkProcessingMemory could only be set using the AllegroGraph config file rather than being able to also specify it in using the PREFIX notation in a SPARQL query. This has been corrected. </p><h4>Bug22480 - Range queries could cause other filters to be ignored</h4><p>If a query had multiple FILTERs that applied to a single pattern and one of these FILTERs created a range query, then it was possible for the other FILTERs to be ignored. This has been corrected. </p><h4>Bug22372 - SPARQL JSON results format was using literal-typed instead of typed-literal</h4><p>The SPARQL JSON results serializer was emitting literals that had an associated datatype as </p>
<pre><code>"name" : {"type":"literal-typed", "datatype":" D ", "value":" S "} </code></pre><p>rather than </p>
<pre><code>"name" : {"type":"typed-literal", "datatype":" D ", "value":" S "} </code></pre><p>This has been corrected. </p><h4>Bug22348: EXISTS and NOT EXISTS FILTERs could fail</h4><p>If an EXISTS or NOT EXISTS FILTER used variables from the outer query in a FILTER (rather than a BGP), then too many solutions could be returned. E.g., a query like: </p>
<pre><code>PREFIX : &lt;http://example.com/&gt;  
SELECT ?x ?n WHERE {  
  ?x :p ?n  
  FILTER NOT EXISTS {  
    ?x :q ?m .  
    FILTER(?n = ?m)  
  }  
} </code></pre><p>uses the bindings for <code>?n</code> in the NOT EXISTS FILTER <em>and</em> <code>?n</code> is not one of the variables that the NOT EXISTS FILTER binds itself. Previously, AllegroGraph will leave <code>?n</code> <em>unbound</em> and therefore return too many results. This has been corrected. </p><h4>Bug22336 - Allow the use of magic properties in more situations</h4><p>The SPARQL 1.1 query planner ensures that a magic property can only be used when all of its required variables are bound. Previously, however, the test for bound variables was overly strict and did not, for example, take BIND or VALUES into account. This has been corrected. For example, this query would previously have been disallowed: </p>
<pre><code>prefix sna: &lt;http://franz.com/ns/allegrograph/4.11/sna/&gt;  
prefix pred: &lt;http://www.testData.com/predicate/&gt;  
prefix : &lt;http://ex#&gt;  
select * {  
  values ?start { &lt;http://www.testData.com/graph/10444&gt; }  
  ?graph sna:nodalNeighbors (:graphSubClass ?start) .  
} </code></pre><p>because AllegroGraph would not have seen that <code>?start</code> is bound by the VALUES clause. Now this query will function as expected. </p><h4>Bug22347 - Query options were sometimes ignored in SPARQL update commands</h4><p>Previously, AllegroGraph PREFIX options were ignored during the WHERE clause of a SPARQL DELETE/INSERT/WHERE command. This has been corrected. </p><h4>Bug22321 - Use other sets more in many more cases</h4><p>The set-based SPARQL query engine now makes better use of partially computed result-sets during query execution. This can greatly accelerate many queries. </p><h4>Bug22272 - Correct unbound variable handling in MINUS</h4><p>In rare circumstances variables that were unbound in the right-hand side of a SPARQL MINUS clause could be incorrectly matched with bound variables on the left hand side. This has been corrected. </p><h4>Bug22270 - Correct BGP estimation for predicates not in the store</h4><p>If a query clause had either a fixed subject or object and a predicate that was not in the triple-store, then AllegroGraph's statistical estimator could return a positive number rather than zero. This has been corrected. </p><h4>Bug22253 - Combining reorderDuringExecution and Property Path queries could lose filters</h4><p>Under rare circumstances, the query engine could lose track of FILTERS in queries that used SPARQL Property Paths and the AllegroGraph reorderDuringExecution option. This has been corrected. </p><h4>Bug22246 - Catch argument count mistakes in query functions</h4><p>SPARQL queries that contained functions being called with an incorrect number of arguments would silently fail. These errors are now detected and reported at query time. For example, a query like: </p>
<pre><code>prefix gf: &lt;http://franz.com/ns/allegrograph/3.0/geospatial/fn/&gt;  
select * {  
  bind( gf:cartesianDistance(1, 2, 3, 4) as ?b )  
}  
would have previously returned a single unbound result because the  
`cartesianDistance` function should only be given two arguments. Now,  
AllegroGraph will signal an error. </code></pre><h4>Bug21941 - Magic properties could lose track of FILTERs</h4><p>In rare circumstances a query that used magic properties and FILTER on some of the variables in the properties could incorrectly filter out too <em>many</em> solutions. This has been corrected. </p><a name='header3-2113' id='header3-2113'></a><h3>AGWebView</h3><h4>Rfe13159 - Enhance AGWebView query GUI</h4><p>AGWebView's SPARQL query user interface now supports query log viewing, query plan inspection and reports additional details about query execution such as query time and warnings. The HTTP REST API for query has a new parameter, <code>returnQueryMetadata</code>. If supplied and true, then the HTTP response will include a JSON payload containing information about the query in an HTTP header named <code>x-query-info</code>. The revised query page is described <a href="agwebview.html#NewQueryPage">here</a>. </p><h4>Rfe13103 - Reposcripts added to AGWebView</h4><p>Access to the new Reposcripts API has been added to AGWebView (see the <a href="#RepoScripts">Rfe12798 release notes entry</a>, which has links to other documentation). </p><h4>Rfe13068 - Login timeout for AGWebView</h4><p>The new global configuration directive <code>LoginTimeout</code> controls the expiry of inactive AGWebView login sessions. See the description of that option in <a href="daemon-config.html">Server Configuration and Control</a> for the details. </p><h4>Rfe12925 - Only run AGWebView queries when the Execute button is pushed</h4><p>Previously, AGWebView executed recent and saved queries as soon as they were selected. Now AGWebView only executes queries when the execute button is clicked. </p><h4>Rfe12579 - Allow users to change their own passwords</h4><p>This change introduces the <code>PasswordChangeAllowed</code> global configuration directive.  If it is <code>yes</code> (the default), then users can change their own passwords via AGWebView. This is a change in default behavior (there was no facility to allow users to change their own passwords in earlier releases). If you set the value of the option to <code>no</code>, the old behavior will be restored. Configuration directives are described in <a href="daemon-config.html">Server Configuration and Control</a>. User passwords are described in <a href="security.html#ManagingUsers">Security</a>. </p><h4>Rfe12275 - Add query cancellation interface to AGWebView's query pane</h4><p>In addition to the existing job canceling screen, AGWebView now provides query cancellation directly from the SPARQL query interface. The revised query page is described <a href="agwebview.html#NewQueryPage">here</a>. </p><h4>Bug22536 - Simple queries may not show up in the jobs list</h4><p>Previously, simple queries like </p>
<pre><code>select  { ?s ?p ?o . filter( fn(?o) ) } </code></pre><p>could fail to appear on the query jobs list in AGWebView. AllegroGraph now checks for query timeout more often which means that even these queries will appear and be cancelable. </p><h4>Bug22260 - Fix AGWebView audit log date range</h4><p>Previously, when the start date or the end date was specified in the audit log query (at /#audit), then the query failed with a type error. This bug has been fixed. </p><h4>Bug20820 - AGWebView's multi-core data import could not specify a graph</h4><p>When using <em>multi-core</em> loading, AGWebView was incorrectly formatting the graph it sent to AllegroGraph's parallel data import tool. This meant that it was impossible to specify a graph. This has been corrected. </p><a name='header3-2134' id='header3-2134'></a><h3>Changes to the Lisp API</h3><h4>Rfe12862 - Extend Lisp geospatial functions with subject, object and graph arguments</h4><p>Add <code>s</code>, <code>o</code> and <code>g</code> arguments to the Lisp API geospatial functions: </p>
<ul>
<li><a href="lisp-reference.html#get-triples-haversine-miles" title="description of get-triples-haversine-miles">get-triples-haversine-miles</a></li>
<li><a href="lisp-reference.html#get-triples-haversine-km" title="description of get-triples-haversine-km">get-triples-haversine-km</a></li>
<li><a href="lisp-reference.html#get-triples-geospatial-bounding-box" title="description of get-triples-geospatial-bounding-box">get-triples-geospatial-bounding-box</a></li>
<li><a href="lisp-reference.html#get-triples-geospatial-radius" title="description of get-triples-geospatial-radius">get-triples-geospatial-radius</a></li></ul><p>The new arguments act as additional filters on the triples returned by the functions. <code>g</code> can only be used when the <code>use-g</code> argument is <em>nil</em> and <code>o</code> can only be used when the <code>use-g</code> argument is non-<em>nil</em>. </p><h4>Rfe12830 - Warn when a query has constants that are not in the store</h4><p>In the Lisp API, the fourth return value of <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> now contains information about any warning that occurred during query planning and execution. This includes a warning when a query contains a constant that is not in the store. For example: </p>
<pre><code>select * { ?s &lt;ex://#notHere&gt; ?o } </code></pre><p>would generate a warning regarding <code>&lt;ex://#notHere&gt;</code>. Additional warnings will be added in the future. </p><h4>Bug22322 - remote-triple-store does not honor default-prefixes argument to run-sparql</h4><p>The <code>default-prefixes</code> argument to the Lisp <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> function was being ignored for remote-triple-stores. This has been corrected. </p><h4>Bug22225 - Memory corruption in the Lisp direct client</h4><p>Previously, if an unclosed database object became garbage, memory corruption could occur which lead to unpredictable errors such as segmentation faults under extremely rare circumstances. </p><h4>Bug22167 - Fix flaws in delete-duplicate-triples.</h4><p><a href="lisp-reference.html#delete-duplicate-triples" title="description of delete-duplicate-triples">delete-duplicate-triples</a> is documented as preserving the triple with the lowest possible triple-id from a group of duplicate triples. Flaws in the algorithm used to delete duplicate triples made it possible that the triple preserved would not necessarily have the lowest possible triple-id, and could depend on the order in which the duplicates were sorted. This change corrects that problem. </p><a name='header3-2152' id='header3-2152'></a><h3>Prolog</h3><h4>Bug22179 - Allow safe Prolog query requests in shared backends</h4><p>Previously, AllegroGraph only allowed Prolog queries when a user had <code>eval</code> privileges for the store. Now, <code>eval</code> privileges are required only for Prolog queries that make use of functors that escape to Lisp. </p><a name='header3-2155' id='header3-2155'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-2157' id='header3-2157'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-2159' id='header3-2159'></a><h3>Java Client</h3><h4>Rfe12952 - Update Java client for handling of useMainPortForSessions</h4><p>When the server configuration option <code>UseMainPortForSessions</code> is enabled, all requests to sessions are multiplexed through the frontend port. In this case, the Java system property <code>useMainPortForSession</code> is redundant and its value is not consulted. This means that one can turn on this feature on the client if it's not enabled in the server config, but cannot turn it off. </p><h4>Bug22392 - Hang with useMainPortForSessions</h4><p>Previously, when the Java client's useMainPortForSessions feature was enabled, a request returning a large response could hang. This bug has been fixed. </p><h4>Bug22323 - Fix UseMainPortForSessions when using SSL</h4><p>Previously, when the com.franz.agraph.http.useMainPortForSessions property was set to true, the Java client arranged for all communication with a session be funneled through the front-end. This fix makes this feature work with SSL connections. Also, with this change it is required that SSLPort is set in the configuration file, otherwise using SSL connections to dedicated sessions with fail. </p><a name='header2-2166' id='header2-2166'></a><h2>AllegroGraph 4.13.2</h2><p>The only change was to replace the SSL library with one that avoided the heartbleed bug. </p><a name='header2-2168' id='header2-2168'></a><h2>AllegroGraph 4.13.1</h2><a name='header3-2169' id='header3-2169'></a><h3>Server Changes</h3><h4>Bug22255 - Concurrent full index optimization requests</h4><p>Previously, if index optimization was requested with a full index optimization already in progress, the database instance would log an error and hang. This bug has been fixed. </p><a name='header2-2172' id='header2-2172'></a><h2>AllegroGraph 4.13</h2><a name='header3-2173' id='header3-2173'></a><h3>Server Changes</h3><h4>Rfe12645 - Add a command line interface to AllegroGraph's materializer</h4><p>AllegroGraph now includes a command line tool to materialize the inferred triples in a triple-store. The tool is named <code>agmaterialize</code>. It can currently be run only on the same machine where the AllegroGraph server is running. The command line interface is described in the <a href="materializer.html">Materializer</a> documentation. </p><h4>Rfe12642: Improve handling of datafile free space information</h4><p>Previously, datafile free space information was maintained in a fixed sized data structure which could run out of room after a certain level of datafile fragmentation was reached.  This has been corrected. </p><h4>Rfe12590 - Shared backend scheduling improvements</h4><p>Previously, when all shared backends were busy, further requests were held until a backend became available. Such pending requests were scheduled for execution in basically random order with latency up to 1s. </p><p>With this change, pending requests are scheduled rather than essentially random. The scheduling is basically FIFO (first in, first out, meaning the oldest request is processed first), but FIFO may be violated for efficiency reasons. (Strict FIFO behavior is undesirable, because it greatly reduces AllegroGraph's ability to schedule requests optimally under stress.) </p><p>Also with this change, scheduling latency is now minuscule and shared backends are now allowed to execute slightly more queries in parallel if all backends are busy, which allows greater efficiency in most cases. </p><h4>Rfe9523 - Logging improvements</h4><p>This change adds a centralized logging facility to the AllegroGraph daemon. The new logger guarantees no interleaving of messages and is able to deal with full filesystem conditions gracefully. Lisp direct clients have now the option of sending log messages to an AllegroGraph server with the <a href="lisp-reference.html#with-log-routed-to-server" title="description of with-log-routed-to-server">with-log-routed-to-server</a> macro. See the documentation for more. Previously, log messages were sent to the AllegroGraph server belonging to the first direct connection opened in the client. </p><h4>Bug22220 - Race condition while determining last written transaction log id</h4><p>Previously, a rare error could be encountered when starting replication or while switching roles, indicating that replication failed due to a missing transaction log that had not yet been written to disk. This problem has been fixed. Now, only transaction logs on disk are used to start replication. </p><h4>Bug22184 - Instance shutdown and replication</h4><p>In rare circumstances, when the instance belonging to a replicated repository was shut down, writing the transaction log could fail. This bug has been fixed. </p><h4>Bug22156 - date-string-to-upi doesn't handle zero time zones consistently</h4><p>The <code>date-string-to-upi</code> functor was not treating a Zulu time zone specified as "Z" consistently with the rest of AllegroGraph's date and time parsers. This has been corrected. </p><h4>Bug22111 - Database names may not contain special characters</h4><p>Because it is impossible to reliably use databases (also called repositories) in session specifications if their names contained characters that are used in those specifications, the list of characters which must not be used in names has been expanded. The following characters are now disallowed in database (repository) names: </p>
<pre><code>\ / ~ : Space $ { } &lt; &gt; * + [ ] | </code></pre><p>Previously, only the following four characters were disallowed in database (repository) names: </p>
<pre><code>\ ~ / : </code></pre><p>Note that this change only effects new databases (repositories); existing databases (repositories) with any of the newly invalid characters in their names will continue to be accessible. It may, however, result in difficulties when attempting to use them in more complex session specifications. </p><h4>Bug22100 - More strict, faster parsing of some xsd datetimes</h4><p>The parsers for xsd:date, xsd:dateTime and xsd:time used to be lenient and accept things like: </p>
<pre><code>20131118         # missing separator  
2013-11-18T12:27 # missing seconds </code></pre><p>and many other convenient but non-standard formats. The new parser only accepts what the XML Schema specification mandates which also allows it to be faster. See <a href="datatypes.html#date-time">XSD Date and Time datatypes</a> for more information on these datatypes. </p><h4>Bug22086 - Materializer deletes triples with the same subject, predicate and object</h4><p>The initial version of AllegroGraph's materializer deleted all triples with the same subject, predicate and object. This limitation has now been lifted: the materializer now only deletes triples with matching subject, predicate, object and graph. </p><h4>Bug22032 - Control whether or not external references are followed during RDF/XML import</h4><p>Previously, AllegroGraph ignored external references in RDF/XML source files. The Lisp API now includes a new keyword argument to <a href="lisp-reference.html#load-rdf:2Fxml" title="description of load-rdf/xml">load-rdf/xml</a>: </p>
<ul>
<li>:resolve-external-references : if true, the external references will be followed. The default continues to be <code>nil</code>.</li></ul><p><strong>agload</strong> also has a new command-line switch. Supplying either of <code>-x</code> or <code>--external-references</code> will cause <strong>agload</strong> to follow external references. See <a href="agload.html">Data Loading</a>. </p><h4>Bug21953 - Allow import of triples to reasoning-triple-store</h4><p>A bug was introduced in v4.12 that prevented import of triples via load-* routines (e.g. load-rdf/xml) on reasoning-triple-stores, when the source argument was passed a URI. This problem has been fixed. This change also provides a better error message when attempting to import statements to a federated-triple-store, which is not allowed. </p><h4>Bug21656 - Cleaner daemon shutdown</h4><p>When the AllegroGraph daemon was stopped, despite the claim of doing a 'clean shutdown' in agraph.log, the shutdown of the instances was not clean and the corresponding repositories would potentially require crash recovery the next time they were opened. Also, such a shutdown lost any index optimization work performed since the most recent checkpoint. </p><p>With this change, instance processes perform a checkpoint if necessary which makes shutdown slower, but startup faster and it makes sure the index optimization results persist. </p><h4>Bug20773 - Support federations of RDFS++ stores</h4><p>Previously, queries against a federation of RDFS++ stores would cause an error during query planning. This has been corrected. </p><a name='header3-2213' id='header3-2213'></a><h3>HTTP Client</h3><h4>Rfe12763 - Update HTTP API for the materializer</h4><p>The REST API for materializeEntailed now includes an <code>inferredGraph</code> argument that can be used to specify which graph newly entailed triples are added to (or deleted from). The materializer is described in <a href="materializer.html">Materializer</a>. </p><a name='header3-2216' id='header3-2216'></a><h3>SPARQL</h3><h4>Rfe12767 - Improved the efficiency of single group aggregate queries</h4><p>The code generated for single group aggregate queries is now slightly more efficient. </p><h4>Rfe12762 - Optimizing level 2 index optimization</h4><p>With this change, level 2 index optimization (the default) no longer tries to optimize access for triples added since optimization was started. This allows index optimization to finish even if triples are added continuously at a high rate. The new code is faster on average, has the same worst case disk usage (about two times the original size), but it has a higher average disk usage. </p><h4>Rfe12760 - Improve efficiency of some SPARQL Property Path queries</h4><p>AllegroGraph now builds some property path data structures as needed rather than computing all of them up front. Depending on the data, this can greatly enhance the efficiency of some queries. </p><h4>Rfe12757 - Improve efficiency of some property path queries</h4><p>In some circumstances, AllegroGraph could choose the <em>less</em> efficient of two strategies when evaluating a property path query. AllegroGraph now ensures that it makes the better choice. </p><h4>Rfe12717 - Handle RDFterm-equality of strings consistently</h4><p>Previously, AllegroGraph implemented <code>sameTerm()</code> using a strict interpretation of RDF literal equality when comparing plain literals and typed literal strings but implemented <code>=</code> using a more relaxed interpretation. These tests are now done consistently using the relaxed interpretation. In particular, </p>
<pre><code>'hello' is RDFterm-equal to 'hello'^^xsd:string </code></pre><p>This is in accordance with both common usage and the RDF 1.1 specification. </p><h4>Rfe12699 - Improve efficiency of SPARQL equality tests on resources</h4><p>The efficiency of equivalency tests in SPARQL filter expressions has been improved. </p><h4>Rfe12681 - Optimize interprocess communication</h4><p>The performance of message passing between different AllegroGraph server processes has been slightly improved. </p><h4>Rfe12679 - Use query local namespace abbreviations in result serialization</h4><p>AllegroGraph now uses the namespaces defined by a SPARQL query's prefixes when serializing output in RDF/XML. Previously, temporary namespaces were used instead. </p><h4>Rfe12670 - Allow /SPARQL access to AllegroGraph as a SPARQL endpoint</h4><p>Previously, access to an AllegroGraph triple-store as a SPARQL endpoint was via sending a query to </p>
<pre><code>SERVER:PORT/respositories/NAME?query=... </code></pre><p>This REST API has been augmented so that sending a query to the triple-store's URL with a trailing <code>/sparql</code> also works. E.g., </p>
<pre><code>SERVER:PORT/respositories/NAME/sparql?query=... </code></pre><p>This is not required by the SPARQL standard but is in conformance with many other existing endpoints. </p><h4>Rfe12657 - More efficient handling for the VALUES clause</h4><p>AllegrGraph now rearranges queries so that VALUES clauses are evaluated first when possible. This improves query efficiency as VALUES clauses are generally small. </p><h4>Rfe12656 - Improve execution of some nested joins</h4><p>AllegroGraph now evaluates nested joins more efficiently. </p><h4>Rfe12498 - Improve full-scan warning heuristics</h4><p>AllegroGraph warns when a SPARQL query executes a full-scan. Heretofore, this meant that a query like </p>
<pre><code>select * { ?s ?p ?o } limit 100 </code></pre><p>could have produced a full-scan warning even though it is benign. AllegroGraph now saves its warnings for when they may actually indicate a problem with the query. </p><h4>Rfe11981 - New query option chunkProcessingMemory</h4><p>Previously when chunk-at-a-time processing was enabled (see query option chunkProcessingAllowed), the query option chunkProcessingSize controlled memory consumption by limiting the number of intermediate results stored in memory. The total memory consumption depended on the number of variables and the complexity of the query, so it was rather difficult to know how much a query will actually use. With this change, chunkProcessingSize is deprecated and chunkProcessingMemory can be specified instead. The unit of chunkProcessingMemory is a byte but the usual abbreviations are also accepted ("8G" (the default), "2M"). </p><h4>Rfe11515 - Fully support the SPARQL 1.1 HTTP Protocol</h4><p>AllegroGraph now fully supports the five different HTTP request types specified in the SPARQL 1.1 HTTP Protocol. These are: </p>
<ul>
<li>Query
<ul>
<li>via GET with query parameters</li>
<li>via POST with urlencoded parameters</li>
<li>via POST with a plain query string (using the content-type of   application/sparql-query). </li></ul></li>
<li>Update
<ul>
<li>via POST with urlencoded parameters</li>
<li>via POST with a plain update request string (using the content-type   of application/sparql-update). </li></ul></li></ul><p>In addition, AllegroGraph continues to support SPARQL update using POST where the update command is encoded in the query portion of the HTTP request. </p><h4>Bug22350 - Distinct queries could produce duplicate results in rare cases</h4><p>Under rare circumstances it was possible for the query engine to produce duplicate results when using chunk-at-a-time (CaaT) processing. This has been corrected. </p><h4>Bug22214 - Encoded IDs failed to compare properly in SPARQL queries</h4><p>Inequality comparisons between encoded IDs were always returning true. This has been corrected. </p><h4>Bug22204 - decimal to decimal cast loses precision</h4><p>When in a SPARQL query an xsd:decimal was cast to xsd:decimal it lost precision as it was converted to a single float internally. This bug has been fixed. </p><h4>Bug22203 - Fix decimal parsing in SPARQL queries</h4><p>In SPARQL query strings, decimals in the (-1,0) interval were parsed with the wrong sign. For example, -0.9 was parsed as 0.9. This bug has been fixed. </p><h4>Bug22153 - Some wild card property path queries could generate incorrect paths</h4><p>In rare circumstances, the data structures used to cache property path information could be invalidated leading to too many path results. This has been corrected. </p><h4>Bug22147 - Add support for ObjectId's in the _id field.</h4><p>The SPARQL MongoDB <em>magic</em> predicate now works with documents containing ObjectId's in the _id field. </p><h4>Bug22142 - Expressions on aggregates fail for empty group</h4><p>If a query wrapped an aggregate with an expression like </p>
<pre><code>select (xsd:float(avg(?age)) as ?avgAge) ... </code></pre><p>and the result set contained an empty group (i.e., a group with no members), then AllegroGraph would signal error. This has been corrected. </p><h4>Bug22134 - SPARQL aggregates on expressions with errors could compute incorrect results</h4><p>Other than COUNT, a SPARQL aggregate on an expression should return unbound if that expression evaluates to a type error during computation. AllegroGraph was incorrectly returning the aggregate of any bindings produced after the last type error. This has been corrected. </p><p>As an example, if AllegroGraph needed to compute the MIN( ?p * 2 ) and ?p was bound to 4, 7, 15, "hello", 6, and 1, then AllegroGraph would previously have returned 2 (the minimum of 12 and 2). Now, it will return no binding for that expressions. </p><h4>Bug22123: Empty construct template will cause an error</h4><p>If a SPARQL CONSTRUCT had an empty template like </p>
<pre><code>CONSTRUCT {} WHERE { ?s a ?o } </code></pre><p>then AllegroGraph would signal an error. This has been corrected. </p><h4>Bug22094 - Correct <code>sparql&lt;</code> and <code>sparql&gt;</code> for date and dateTime comparisons</h4><p>Because there is no defined operator mapping for inequality comparisons between xsd:date and xsd:dateTime, comparing them should throw a SPARQL type-error. AllegroGraph was incorrectly returning nil instead. This has been corrected.  See <a href="datatypes.html#date-time">XSD Date and Time datatypes</a> for more information on these datatypes. </p><h4>Bug22074 - DELETE templates with unknown variables caused an error</h4><p>AllegroGraph would signal an error if a SPARQL DELETE/WHERE command's DELETE clause contained variables that were not bound by the WHERE clause.  This has been corrected. An example of such a command would be: </p>
<pre><code>DELETE { graph ?unknownGraph { ?s ?p ?o } }  
WHERE { ?s ?p ?o }  
 
</code></pre><h4>Bug21561 - Remote-triple-stores do not support the table results format</h4><p>Remote-triple-stores did not support returning tables from SPARQL queries. This has been corrected. </p><a name='header3-2291' id='header3-2291'></a><h3>AGWebView</h3><h4>Bug22161 - Adding security filters in Firefox</h4><p>Previously, with Firefox, clicking the 'add' button in the security filters table of the user management page (Admin/users in the menu) of AGWebView did not submit the form. This bug has been fixed. </p><a name='header3-2294' id='header3-2294'></a><h3>Changes to the Lisp API</h3><h4>Rfe12632: Improvements in Lisp API to AllegroGraph materializer</h4><p>Materialization previously occurred only for triples in the default-graph of the triple-store. It now occurs for all of the graphs in the store. Materialization on subsets of the graphs can be accomplished by creating a graph-filtered triple-store and calling <a href="materializer.html#materialize-entailed-triples" title="description of materialize-entailed-triples">materialize-entailed-triples</a> on it. </p><p>Materialization previously placed inferred triples into a special graph that could not be utilized by the rest of AllegroGraph (the special graph behaved similarly to but not exactly like the usual AllegroGraph default-graph). It now places inferred triples into a graph that can be specified in the call to materialize-triples using the <code>materialized-graph</code> argument. It defaults to <a href="http://franz.com/ns/allegrograph/4.12/materializer/defaultGraph">http://franz.com/ns/allegrograph/4.12/materializer/defaultGraph</a>. </p><p>Two new arguments were added to <code>delete-materialized-triples</code>. These are: </p>
<ul>
<li><code>db</code> - which controls the triple-store that is modified.</li>
<li><code>materialized-graph</code> - which controls the triples that are deleted. It defaults to <a href="http://franz.com/ns/allegrograph/4.12/materializer/defaultGraph">http://franz.com/ns/allegrograph/4.12/materializer/defaultGraph</a>. </li></ul><p>Materialization now logs its start and end to the AllegroGraph log file. The overall efficiently of the materializer has also been improved. </p><h4>Bug22132 - calling run-sparql with the :with-variable argument with a timezoned upi</h4><p>When the Lisp function <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> was used in conjunction with a :with-variable argument that bound a variable to an encoded xsd:dateTime or xsd:time, then in some cases comparisons involving that variable failed to match equivalent representations of the same xsd:dateTime or xsd:time with a different timezone. This bug has been fixed. </p><a name='header3-2304' id='header3-2304'></a><h3>Prolog</h3><h4>Bug22171: Select0 should return UPIs when it can</h4><p>Previously, the Prolog <code>select0</code> query macro could return future-parts rather than UPIs. For example, this query would return a future-part. </p>
<pre><code>(select0 (?a) (= ?a !rdf:type)) </code></pre><p>This could cause problems in the unlikely event that namespace abbreviations changed when running the same query multiple times. <code>select0</code> now returns UPIs so that the above behavior is not possible. Note that if a future-part represents a triple that is not currently in the triple-store, then a query can return UPIs that cannot be printed (because the UPI will not be in the string dictionary). </p><h4>Bug22157 - Temporal functors could signal an error when used with all bound values</h4><p>Previously, AllegroGraph used real numbers to represent times, dates and dateTimes. Now, the internal representation includes time-zone information which means that comparing two values can no longer use simple inequalities. The Prolog temporal functors like <code>point-before-datetime</code> had not been updated to reflect these changes. This oversight has been corrected. This change means that the Prolog functors will use the same XSD logic used by the SPARQL date and time functions. </p><a name='header3-2311' id='header3-2311'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-2313' id='header3-2313'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-2315' id='header3-2315'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header2-2317' id='header2-2317'></a><h2>AllegroGraph 4.12.2</h2><a name='header3-2318' id='header3-2318'></a><h3>Server Changes</h3><h4>Rfe12734 - More aggressive level 2 index optimization</h4><p>In some cases, level 2 index optimization (the default) left a small part of the index unoptimized. With this change, the entire index is optimized in all cases. </p><h4>Rfe12726 - Index optimization increasing database size on disk</h4><p>Space in some garbage on-disk data structures is now reclaimed in a more timely manner which makes the increase in database size during index optimization less severe. </p><h4>Rfe12725 - Faster level 2 index optimization</h4><p>Level 2 index optimization (which is the default level) has been made faster. </p><h4>Rfe12636 - Make config-file argument to agraph-backup backup-settings optional.</h4><p>Previously, the <strong>agraph-backup backup-settings</strong> command required a <em>config-file</em> argument. This argument has been eliminated in favor of an optional --config option that can be used in place of the --port argument. If both --port and --config are supplied, then the port argument takes precedence. Also, <strong>agraph-backup</strong> could fail in the past if there were discrepencies between a --port argument specified on the command line, and a Port directive contained in a config file. Now, if the --port argument is specified, it will take precedence over any Port directives read from a config file. See <a href="backup-and-restore.html">Backup and Restore</a>. </p><h4>Rfe12635 - Major revision to agraph-backup operating modes.</h4><p>The various backup and restore modes of agraph-backup have been overhauled. </p><p>Previously, backup mode created an archive file containing only repository data. Now, it creates an archive directory that contains both repository data and settings. This archive can be restored via restore or restore-all. The --ext-backup-command option is supported. Previously, restore mode operated on an archive file. Now, it can also operate on an archive directory created by backup or backup-all. In either case, it will restore a single repository (data and settings) from the archive. </p><p>The layout of archive directories created by backup-all are slightly changed, and support for the --ext-backup-command option is added. The restore-all mode will now fail if repositories being restored to already exist. Use the --supersede option to force an overwrite of any such repositories. </p><p>Previously, the backup-settings mode created an archive containing both repository and system settings. It also supported the --ext-backup-command option. Now, it only archives system settings and the --ext-backup-command option is no longer supported. Adds a restore-settings option that restores system settings, overwriting any existing settings. It operates on any valid archive directry (though ones created by backup will likely not have any system settings data). </p><p>Please refer to the updated <a href="backup-and-restore.html">Backup and Restore</a> documentation for full details. </p><h4>Rfe12621 - xsd:time improvements</h4><p>Zoneless xsd:times are no longer converted to zero timezone when added, and timezone offsets roundtrip to and from the database. Also, with this change xsd:times and xsd:dateTimes are no longer comparable. This puts xsd:time on equal footing with xsd:dateTime. See <a href="datatypes.html#date-time">the date and time documentation</a> for more information. </p><h4>Rfe12580 - Don't create repo if client/server uids don't match</h4><p>Previously, if the uid of the direct Lisp client and the AllegroGraph server differed, then a <a href="lisp-reference.html#create-triple-store" title="description of create-triple-store">create-triple-store</a> call would fail with a `server-pid-and-client-pid-must-match-error` indicating that the creation failed. However, the repository would actually be created, possibly overwriting an existing repository. Now, the uid check is performed earlier in the create repository process, so that the repository is not created when the uids do not match.<br />
</p><h4>Rfe12456 - Time zone roundtrip for xsd:dateTime and xsd:time</h4><p>AllegroGraph previously represented xsd:times and xsd:dateTimes with Zulu (i.e. Greenwich Mean) time internally and converted data to that time zone as it was imported. On output, any xsd:time or xsd:dateTimes would be displayed in Zulu time and would lose the original time zone information.  For example, </p>
<pre><code>"2014-02-23T08:18:59+05:00"^^xsd:dateTime </code></pre><p>would become </p>
<pre><code>"2014-02-23T03:18:59Z"^^xsd:dateTime </code></pre><p>AllegroGraph now keeps the original data's time zone information. Note that the additional computation involved with coercing time information during query means that queries involving xsd:dateTimes or xsd:times may run slightly (a few percentage points) more slowly. There is also a new query option, <code>presentationTimeZone</code>, that controls the display of time zones in the output of SPARQL queries. For example, adding </p>
<pre><code>PREFIX franzOption_presentationTimeZone: &lt;franz:-04:00&gt; </code></pre><p>will cause all xsd:times and xsd:dateTimes to be printed at the -04:00 time zone. See the <a href="datatypes.html#date-time">documentation</a> for more information.  Since the database format has been changed, the usual upgrade process involving a backup/restore cycle (see <a href="backup-and-restore.html">Backup and Restore</a>) is required. Please note the following: </p><p>1: There are no changes for xsd:dates. They still support what the XML Schema describes as 'recoverable timezone'. </p><p>2: "2014-02-23T08:18:59+08:00"^^xsd:dateTime is DISTINCT from "2014-02-23T00:18:59Z"^^xsd:dateTime. </p><p>3: Joins can be made over dates that represent the same point on the same timeline even if they have different timezones. Which (equivalent) representation is returned by the join is  unspecified. </p><p>See <a href="datatypes.html#date-time">the date and time documentation</a> for more information. </p><h4>Rfe11303 - Fix partial repo creation on agraph-backup restore operations</h4><p>When performing an <strong>agraph-backup restore</strong> operation, if you passed a directory name as the archive argument, the restore would fail, but not before a repository was created. Further, the repository would remain in 'restore' mode, so it could not be opened, and its existence would prevent a subsequent valid <strong>agraph-backup restore</strong> operation from succeeding. <strong>agraph-backup now first checks that the argument filename names an existing file which is not a directory before creating any repositories. Also, error messages when </strong>agraph-backup** is passed invalid archive file arguments have been improved. See <a href="backup-and-restore.html">Backup and Restore</a>. </p><h4>Rfe11044 - Add -p short form of --port to agraph-backup.</h4><p>With <strong>agraph-backup</strong>, users may use either <strong>-p</strong> or <strong>--port</strong> to specify the port on which an AllegroGraph server is running. See <a href="backup-and-restore.html">Backup and Restore</a>.<br />
</p><h4>Rfe10629 - Add --supersede argument to agraph-backup</h4><p><strong>agraph-backup</strong> now accepts a --supersede option, which (if specfied) allows overwriting of existing archives (for the <strong>backup</strong> command) and directories (for the <strong>backup-all</strong> command), and databases (for the <strong>restore</strong> and <strong>restore-all</strong> commands).  See <a href="backup-and-restore.html">Backup and Restore</a>. </p><h4>Bug22099 - Ensure UUIDs are unique during agraph-backup restores.</h4><p>Previously, when restoring archive backups to an AllegroGraph server, it was trivially possible to create multiple repositories with the same uuid. Now, <strong>agraph-backup</strong> will error if a restore operation will cause a uuid conflict. See <a href="backup-and-restore.html">Backup and Restore</a>. </p><h4>Bug22090 - Timezone minutes in xsd types</h4><p>Specifying timezone minutes is no longer optional in xsd:dateTimes and xsd:times, so the following examples are invalid: </p>
<pre><code>"1978-01-03T00:00:00+05"^^xsd:dateTime INVALID  
   Correct form: "1978-01-03T00:00:00+05:00"^^xsd:dateTime  
"00:00:00+05"^^xsd:time INVALID  
   Correct for: "00:00:00+05:00"^^xsd:time </code></pre><p>Previously, only xsd:dates checked for the presence of timezone minutes. See <a href="datatypes.html#date-time">the documentation</a> for more information. </p><h4>Bug22083 - xsd:date and xsd:dateTime years</h4><p>AllegroGraph now correctly parses both positive and negative dates with more than four digit years. It also signals an error if the date is too large to be encoded into a UPI. Previously, dates like these were silently truncated. See <a href="datatypes.html#date-time">the date and time documentation</a> for more information. </p><h4>Bug22073 - ORDER BY and non-encoded decimals</h4><p>When non-encoded decimals were being ordered, they were first converted to IEEE 54 double floats (which have a precision of 15-17 significant digits) which potentially caused them to be sorted incorrectly. This bug has been fixed. </p><h4>Bug22072 - Validate xsd:decimals</h4><p>AllegroGraph now signals an error if an xsd:decimal's exponent in scientific notation is outside of the range [-63, 63] because these values cannot be encoded into a UPI. Previously, xsd:decimals like these were silently truncated. </p><h4>Bug22068 - Reasoning and constant triple patterns</h4><p>With reasoning enabled, some queries involving triple patterns without variables failed with 'Bus error'. This has been corrected. </p><h4>Bug22066 - Printing of NaN, INF and -INF</h4><p>Serialization of xsd single and double float NaN, INF and -INF was broken (for instance, INF became "#.<em>inEinity-double</em>"). This bug has been fixed. </p><h4>Bug22057 and Bug22054- agraph-backup backup-settings works as documented.</h4><p>The <strong>agraph-backup backup-settings</strong> command was incorrectly backing up data as well as settings rather than just backing up settings. Now it just backs up settings. Also, the backup-settings command now can work by finding the settings location from the config file (so the server need not be running). See <a href="backup-and-restore.html">Backup and Restore</a> where a note describes all the <strong>agraph-backup</strong> revisions. </p><h4>Bug22045 - 14 hour datetime comparison logic</h4><p>For two xsd:dateTimes, one with and one without a timezone, all comparisons must return false if they differ by less than 14 hours. Similar logic applies to xsd:dates and xsd:times. Previously, support for this 14 hour comparison logic was spotty. It worked for some combinations (such as comparisons in a FILTER with a literal) but didn't work for others. With this fix, comparisons for all three types follow the XML Schema specification. See <a href="datatypes.html#date-time">the date and time documentation</a> for more information. </p><h4>Bug22044 - Fix xsd:date xsd:dateTime comparisons</h4><p>AllegroGraph previously compared xsd:dates and xsd:dateTimes by converting the date to a dateTime at its first instance. Because dates are actually 24-hour intervals, this logic is suspect so AllegroGraph now signals a type error if this comparison is made (i.e., FILTERs will not longer match and BIND would leave its variable unbound). The previous behavior can still be had by using an explicit cast from date to dateTime. See <a href="datatypes.html#date-time">the date and time documentation</a> for more information. </p><h4>Bug22041 - Comparisons to decimal zero</h4><p>Due to a bug in the encoding, decimal 0 appeared to be greater than all decimals less than 1.0. The usual upgrade process involving a backup/restore cycle (see <a href="backup-and-restore.html">Backup and Restore</a>) is required. All misencoded decimal 0s will be converted to the correct value. If any such corrections are made during the upgrade, then indices are resorted and background index optimization is begun. The index optimization may continue even after the upgrade process has completed. The resulting indices are then as optimized as if all the triples were just imported into the database. This means if the backup was of a fully optimized repository, then after the upgrade running level 2 (the default) index optimization is necessary to get back to that state. </p><h4>Bug22039 - agload character encoding fixes</h4><p>Previously, the --encoding argument to <strong>agload</strong> was ignored. This has been corrected. See <a href="agload.html">Data Loading</a> for information on <strong>agload</strong>. </p><h4>Bug22034 - part-&gt;concise on encoded dates and decimals</h4><p>For xsd:dates, xsd:dateTimes, xsd:times and xsd:decimals, the Lisp functions <a href="lisp-reference.html#part-:3Econcise" title="description of part->concise">part-&gt;concise</a> and <a href="lisp-reference.html#part-:3Eterse" title="description of part->terse">part-&gt;terse</a> returned the stringified internal representation (like "172839/500" for decimals, and "(<universal-time>  . <has-time-zone?> )" for datetimes) which didn't fulfill the promise of being in a "human readable form". With this change, the above functions will return the value in a readable string format without the type. An example: </p>
<pre><code>(part-&gt;concise (value-&gt;upi "2013-01-03T10:34:00-05:00" :date-time))  
=&gt; "2013-01-03T10:34:00-05:00" </code></pre><p>See <a href="datatypes.html#date-time">XSD Date and Time datatypes</a>. </p><a name='header3-2385' id='header3-2385'></a><h3>HTTP Client</h3><p>No significant changes. </p><a name='header3-2387' id='header3-2387'></a><h3>SPARQL</h3><h4>Rfe12624 - Standardize some low-level SPARQL equality tests</h4><p>The efficiency and conformance of low-level tests used to compute RDFterm-equality and SPARQL ordering has been improved. One non-backwards compatible change is that AllegroGraph previously allowed ordered comparisons between plain literals that <em>looked</em> like numbers and typed numeric literals (e.g., "6.21" and "6.23"^^xsd:integer). This comparison now correctly throws a SPARQL type error. </p><h4>Bug22092 - Fix for SPARQL queries that use the STR() function with a constant</h4><p>If a SPARQL query contained a FILTER that used the STR() function applied to a constant, then the query could signal an error at planning time. For example, a FILTER like </p>
<pre><code>FILTER( STR( &lt;http:://example.com&gt; ) = ?var ) </code></pre><p>would not succeed. This has been corrected. </p><h4>Bug22078 - SPARQL insert did not always encode typed literals</h4><p>Triples added to a triple-store using SPARQL inserts that used computed values did not always have their typed literals encoded into UPIs. For example, an insert like: </p>
<pre><code>insert { &lt;ex:a&gt; &lt;ex:b&gt; ?c . } where { bind( '1'^^xsd:byte as ?c ) } </code></pre><p>would store the literal in string form rather than encoding it directly. This has been corrected. </p><h4>Bug22077 - Improve efficiency of certain SPARQL sub-queries</h4><p>Bound variable information could be lost while processing certain SPARQL sub-query forms which would then result in less efficient query execution. This has been corrected. </p><a name='header3-2400' id='header3-2400'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-2402' id='header3-2402'></a><h3>Changes to the Lisp API</h3><h4>Bug21608 - Include ag-call in remote Lisp client.</h4><p>Previously <strong>ag-call</strong> was omitted from the remote Lisp client. This has been corrected. </p><a name='header3-2405' id='header3-2405'></a><h3>Prolog</h3><p>No significant changes. </p><a name='header3-2407' id='header3-2407'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-2409' id='header3-2409'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-2411' id='header3-2411'></a><h3>Java Client</h3><p>No significant changes. </p><a name='header2-2413' id='header2-2413'></a><h2>AllegroGraph 4.12</h2><a name='header3-2414' id='header3-2414'></a><h3>Server Changes</h3><h4>Rfe12576 - Improve RDF/XML parser efficiency</h4><p>Improve the lower-level efficiency of AllegroGraph's RDF/XML parser so that it is between 5 and 10% faster. </p><h4>Rfe12522 - Global configuration directive for query options</h4><p>A new global configuration directive named <code>QueryOption</code> was added. It can be used multiple times. Each specification is equivalent to a query prefix option. The global configuration directive "QueryOption NAME=VALUE" is the same as the query prefix option "PREFIX franzOption_NAME: <franz:VALUE>". See <a href="daemon-config.html">Server Configuration</a> for information on configuration directives. </p><h4>Rfe12429 - More flexible parsing for InstanceTimeout</h4><p>With this change, <code>InstanceTimeout</code> configuration parameter values in the configuration file can be specified as times rather than only as a number of seconds. For example, you can use <code>12s</code>, <code>2m</code> or <code>3h</code> to specify 12, 120 or 10,800 seconds. The configuration file is described in <a href="daemon-config.html">Server Configuration</a>. </p><h4>Rfe11010 - Require the <code>i</code> index for freetext queries</h4><p>AllegroGraph's native freetext index requires the presence of the triple-id (i) index in order to operate efficiently. A common problem was to try to use freetext queries when there was no <code>i</code> index. This change automatically adds an <code>i</code> index whenever a freetext index is created <em>and</em> also signals an error if a freetext query is attempted when there is no such index. </p><h4>Bug22024 - Serialization of decimals</h4><p>xsd:decimals with zeroes right before the decimal point were serialized with the decimal point misplaced. This bug has been fixed. The database contents were not affected. </p><h4>Bug21978 - serialize-* functions in Lisp client default to UTF-8.</h4><p>Use UTF-8 as the external-format when a filename is passed to one of the serialize-* functions in the Lisp client instead of the default external format, which can vary depending on the system's locale. </p><h4>Bug21976 - Complex GRAPH queries could produce incorrect graph bindings</h4><p>Depending on the dataset, queries with deeply nested structure that used EXISTS or NOT EXISTS FILTERS with embedded GRAPH clauses could generate incorrect bindings for the graph variable.  This has been corrected. </p><h4>Bug21975 - Increase AllegroGraph Load speed</h4><p>Low-level efficiency enhancements improve AllegroGraph load speed by roughly 10%. </p><h4>Bug21966 - Possible "UPI not in string table" problem with remote-triple-stores</h4><p>It was a possible for a remote-triple-store to lose track of the strings cached on the client after a rollback operation. This could lead to a "UPI not in string table" error. This has been corrected. </p><h4>Bug21956 - Improve memory usage for zero-length property path queries</h4><p>A zero-length property path query connects all subjects and objects on the right and left hand sides of the path to themselves. If the store is large and the path produces many matches on one or both sides, AllegroGraph was using more memory than necessary. This has been greatly improved though some queries may experience a slight performance degradation. </p><h4>Bug21954 - Problem generating soundexes for phrases in Callimachus</h4><p>If a store was operating in Callimachus mode and a phrase was soundexed that had words in it with no soundex (e.g., a number) then AllegroGraph would generate garbage soundex data. This has been corrected </p><h4>Bug21949 - Improve bookkeeping of already processed variables during query execution</h4><p>AllegroGraph was not updating the list of bound variables when evaluating a BIND clause during query execution. This did not change the final results of a query but did mean that AllegroGraph would not always evaluate the query in the most efficient manner. This has been corrected. </p><h4>Bug21937 - Zoneless xsd:dateTime roundtrip</h4><p>Adding a triple with an <code>xsd:dateTime</code> without a timezone (e.g. "2013-07-30T23:59:59") was stored as if it had a timezone of zero. With this bug fix, zoneless dateTimes are stored and serialized without timezone.  This is in agreement with the XML schema specification and similar to how xsd:dates behave. </p><h4>Bug21934 - String table mutex not reinitialized after recovery</h4><p>A mutex used in the string table data structure was not being reinitialized after database restart. Under certain circumstances this could result in a database hanging after restart. This problem has been corrected. </p><h4>Bug21920 - Soundex should ignore punctuation</h4><p>AllegroGraph's soundex function (which is used by Callimachus) was not ignoring punctuation properly. This has been corrected. </p><h4>Bug21915 - Make upi-&gt;value on xsd:dates return integers</h4><p>Due to an undocumented change in v4.11, <a href="lisp-reference.html#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> on a upi encoded as :date returned a cons of the integer representing the instant and a flag indicating whether the timezone was present. With this change only the integer part is returned (like before v4.11). The flag is returned as the second value by <a href="lisp-reference.html#upi-:3Evalues" title="description of upi->values">upi-&gt;values</a>. </p><h4>Bug21914 - xsd:dates on the first day of the month</h4><p>Adding a triple with an <code>xsd:date</code> with a positive timezone that falls on the first day of a month resulted in error "illegal date 0". This bug has been fixed. </p><h4>Bug21909 - agraph-backup could fail to generate unique UUID on restore</h4><p>When using the <code>--newuuid</code> option, it was possible for <strong>agraph-backup</strong> to create multiple triple-stores with the same UUID. This has been corrected. See <a href="backup-and-restore.html">Backup and Restore</a> for information on <strong>agraph-backup</strong>. </p><h4>Bug21903 - Free text indexing with chunk-at-a-time processing</h4><p>Depending on the execution plan, a query that used both <code>fti:match</code> and chunk-at-a-time processing (see <code>franzOption_chunkProcessingAllowed</code>) could produce too few results. This bug has been fixed. </p><h4>Bug21899 - Shared memory server fails to clean up</h4><p>Under low memory conditions, the shared memory server can fail to allocate blocks of shared memory on behalf of a database instance. Under certain circumstances the shared memory server would fail to clean up from partial allocations, thereby exacerbating the low memory condition.  This problem has been fixed. </p><h4>Bug21873 - Link to docs in rpm install</h4><p>When AllegroGraph was installed from an rpm package, the documentation links in AGWebView were broken. This bug has been fixed. </p><h4>Bug21872 - agload will write output to agload.log when in --debug mode</h4><p>Along with the other effects of using the --debug command line argument to <strong>agload</strong>, all output will be logged to agload.log. See <a href="agload.html">Data Loading</a>. </p><h4>Bug21869 - Fix problem with registering cartesian predicate mappings</h4><p>There was a problem which prevented the shortened form of cartesian predicate mappings from working. This has been corrected. </p><h4>Bug21853 - Connection Pool session port connection failure</h4><p>Under certain circumstances, the AllegroGraph Java client would throw an exception like the following: </p>
<pre><code>com.franz.agraph.http.exception.AGHttpException:  
Possible session port connection failure </code></pre><p>Setting the <code>SessionPorts</code> configuration parameter is discussed <a href="server-installation.html#sessionport">here</a> in <a href="server-installation.html">Server Installation</a> and also in <a href="daemon-config.html">Server Configuration</a>. But this exception could occur even with a proper <code>SessionPorts</code> setting. This problem has been resolved. </p><h4>Bug21846 - Long running federated queries could fail</h4><p>The query canceling interface introduced in AllegroGraph 4.11 could lead to query failures when using federated triple-stores. This has been corrected. Note that it is not currently possible to cancel queries running on a federated store. This will be improved upon in a future release of AllegroGraph. </p><h4>Bug21816 - Fix session multiplexing file descriptor leak</h4><p>When requests to sessions are multiplexed through the server's main port, the frontend didn't close the http socket used to communicate with the session process. This bug has been fixed. Note that session multiplexing can be enabled for the java client by setting the system property: </p>
<pre><code>com.franz.agraph.http.useMainPortForSessions=true  
 
 
</code></pre><h4>Bug21784 - Safer auto-close for garbage db's in the Lisp direct client</h4><p>The db's are now marked for closure when it is noticed they are no longer used and closed at a later specific time. </p><h4>Bug18813 - Reasoning and subclasses of owl:TransitiveProperty</h4><p>With this fix the reasoner is able to infer that a property whose type is a subclass of owl:TransitiveProperty is a transitive property. That is, </p>
<pre><code>:p rdfs:subClassOf owl:TransitiveProperty .  
:q rdf:type :p .  
:a :q :b .  
:b :q :c . </code></pre><p>entails </p>
<pre><code>:a :q :c .  
</code></pre><a name='header3-2477' id='header3-2477'></a><h3>HTTP Client</h3><p>No significant changes. </p><a name='header3-2479' id='header3-2479'></a><h3>SPARQL</h3><h4>Rfe12537 - Improve zero length property path clause estimation</h4><p>This change improves the heuristics AllegroGraph uses to estimate the number of rows that a zero length property path query can generate which improves the way AllegroGraph processes a BGP. </p><h4>Rfe12520 - The SNA members and size <em>magic</em> properties work with RDF lists</h4><p>You can now use the <a href="http://franz.com/ns/allegrograph/4.11/sna/members">http://franz.com/ns/allegrograph/4.11/sna/members</a> and <a href="http://franz.com/ns/allegrograph/4.11/sna/size">http://franz.com/ns/allegrograph/4.11/sna/size</a> <em>magic</em> Properties to query RDF lists stored in your triple-store. For example, if <ex:list> points to the head of the RDF list "1", "2", "3", then this query would return the three elements: </p>
<pre><code>prefix sna: &lt;http://franz.com/ns/allegrograph/4.11/sna/&gt;  
select ?item {  
  &lt;ex:list&gt; &lt;ex:pointsTo&gt; ?list .  
  ?item sna:members ?list .  
} </code></pre><p>Would return "1", "2" and "3". See <a href="magic-properties.html#sparql-magic-sna">SPARQL Magic Properties for SNA</a>. </p><h4>Rfe12506 - Improve handling of some queries that use GRAPH clauses</h4><p>SPARQL is defined such that a query like </p>
<pre><code>GRAPH ?g { A } </code></pre><p>should behave as if A was evaluated with <code>?g</code> bound to each graph in the dataset in turn and then the results of all of these evaluations were unioned together. While correct, this implementation can be very inefficient. AllegroGraph uses various heuristics to determine if a given GRAPH clause can be evaluated more directly and does so when it can. This change improves these heuristics so that more queries will be able to use the more efficient implementation. </p><h4>Rfe12481 - Improve SPARQL DELETE efficiency</h4><p>This change greatly increases the efficiency of the DELETE portion of a SPARQL DELETE... INSERT... WHERE... command. The actual increase is dependent on the data and the delete template but it can be more than 40 times faster. </p><h4>Rfe12442 - Efficiency improvements for SPARQL aggregation</h4><p>Optimize the code used for SPARQL aggregate queries in general and for <code>count</code> aggregates in particular. </p><h4>Rfe12400 - Minor property-path query optimization</h4><p>Improve the underlying efficiency of some property-path queries. </p><h4>Rfe12398 - Clarify semantics of the identity clause reorderer</h4><p>AllegroGraph has two clause reorderers which try to preserve the ordering of triple-patterns in a BGP (basic graph pattern). Previously, these were named: </p>
<ul>
<li><p>:identity - try to preserve ordering but still prefer to augment the current set of bindings rather than start a new set. </p></li>
<li><p>:strict-identity - use the given ordering directly without changing it. </p></li></ul><p>To avoid future confusion, these options are being renamed such that the first method is called <code>:weak-identity</code> and the second is called <code>:identity</code>. </p><p>The default query clause reorderer continues to be <code>statistical</code> so queries that do not specify a reorderer will behave exactly as they did before this change. </p><h4>Rfe12392 - Optimize certain complex join combinations</h4><p>The query optimizer now converts a query with an algebra like: </p>
<pre><code>(:join (:join A :bgp1) :bgp2) </code></pre><p>into the equivalent: </p>
<pre><code> (:join A :bgp1-and-bgp2) </code></pre><p>This BGP (basic graph pattern) merger improves AllegroGraph's ability to reorder queries for efficient execution. AllegroGraph also converts the expression: </p>
<pre><code>(:join (:join :bgp1 A) :bgp2) </code></pre><p>into </p>
<pre><code>(:join :bgp1-and-bgp2 A) </code></pre><p>unless the two BGPs do not overlap (in which case the transform would produce a cross-product). </p><h4>Rfe12385 - Improve BGP reordering in some cases</h4><p>In some cases, the SPARQL query planner now does a better job reordering the triple-patterns in a BGP (basic graph pattern). </p><h4>Rfe12380 - Improve efficiency of some DISTINCT or REDUCED queries</h4><p>AllegroGraph now collects fewer intermediate results for some DISTINCT or REDUCED queries. </p><h4>Rfe12377 - Add intervalContainsTime <em>magic</em> property</h4><p>Added an additional temporal <em>magic</em> property that can be used to determine if a time is contained within an interval. See <a href="magic-properties.html">SPARQL Magic Properties</a>. </p><h4>Rfe12372 - Make BGP reordering more intuitive</h4><p>Previously, AllegroGraph would switch the execution of patterns in a BGP when the BGP contained only two patterns and these patterns had the same statistical clause estimates. E.g., in a query like: </p>
<pre><code>?a ?b ?c .  
?c ?d ?e . </code></pre><p>AllegroGraph would execute the second pattern first. AllegroGraph now executes the first pattern first in the case of ties which is more intuitive. </p><h4>Rfe12368 - Use constraints to limit bindings for GRAPH queries</h4><p>Improve AllegroGraph's use of FILTERs in limiting the graphs considered in GRAPH clauses with variable graphs. For example, </p>
<pre><code>GRAPH ?g { A }  
FILTER( ?g = &lt;ex:test&gt; ) </code></pre><p>will now be evaluated more efficiently since AllegroGraph will only consider the graph <code>&lt;ex:test&gt;</code> rather than every graph in the dataset. </p><h4>Rfe12352 - Provide a sort order for SNA path and group gensyms</h4><p>Social Network Analysis (SNA) Magic Properties can create node identifiers to keep track of paths and groups. These act like blank nodes and so had no sort order defined for them. This was inconvenient because it made it impossible to, for example, list all of the nodes of a path together. This change adds a sort order to these node identifiers so that they are easier to use in queries. </p><h4>Rfe12192 - Optimize some wild-card property-path queries</h4><p>AllegroGraph now computes property-path queries that use the <code>*</code> or <code>+</code> operators more efficiently. </p><h4>Rfe12032 - Improve property-path expansion</h4><p>AllegroGraph now expands more property-path queries into their equivalent BGPs (basic graph patterns). This can improve the performance of the query optimizer. For example, AllegroGraph previously expanded </p>
<pre><code>?s :a/:b ?o .  
into <p>?s   :a <em>:b0 . </em>:b0 :b ?o . </p></code></pre><p>but did not expand paths with non-simple operators like wild-cards or alternation. It now expands these as well so that a path like </p>
<pre><code>?s :a/:b/(:c|:d)/:e/:f ?o </code></pre><p>becomes </p>
<pre><code>?s   :a _:b0 .  
_:b0 :b _:b1 .  
_:b1 (:c|:d) _:b2 .  
_:b2 :e _:b3 .  
_:b3 :f _?o .  
</code></pre><h4>Rfe11948 - Add PREFIX option for enabling reasoning in a SPARQL query</h4><p>AllegroGraph's SPARQL 1.1 engine now supports the <code>inferenceMode</code> query option to control the kind of inference used by an individual query. The mode is selected using the query option PREFIX notation. For example, the following PREFIX would cause a query to be evaluated using AllegroGraph's RDFS++ reasoner: </p>
<pre><code>PREFIX franzOption_inferenceMode: &lt;franz:rdfs++&gt; </code></pre><p>The following modes can be supplied: </p>
<ul>
<li><code>rdfs++</code> - use RDFS++ reasoning,</li>
<li><code>false</code> - use no inference,</li>
<li><code>restriction</code> - use RDFS++ and the restriction reasoner.</li></ul><h4>Rfe11625 - Improve algebraic optimizations of joins and left-joins</h4><p>Improve the logic used in the algebraic transform of </p>
<pre><code>(:join (:left-join A B) C) into (:left-join (:join A B) C) </code></pre><p>Which is the textual equivalent of moving the optional clause down in a query like </p>
<pre><code>A  
optional { B }  
C </code></pre><p>so that it becomes </p>
<pre><code>A  
C  
optional { B } </code></pre><p>which can be evaluated more efficiently unless A and C share no bindings. </p><h4>Rfe11146 - Handle simple OPTIONAL clauses more efficiently</h4><p>AllegroGraph now handles OPTIONAL clauses that contain only a single triple-pattern more efficiently. This means that queries with clauses that look like </p>
<pre><code> ?s :predicateA ?o .  
 OPTIONAL { ?s :predicateB ?b }  
 OPTIONAL { ?s :predicateC ?c } </code></pre><p>will be processed more efficiently. </p><h4>Rfe11068 - Improve literal equality constraint handling</h4><p>AllegroGraph now handles filter expressions involving literal equality more efficiently. For example, in a query like </p>
<pre><code>select * {  
  ?a :predicate ?b .  
  filter( ?b = 'literal' )  
} </code></pre><p>AllegroGraph previously would scan all triples with the given predicate and apply the filter afterwards. Now AllegroGraph determines the set of possible matches for 'literal' and queries for them directly. </p><p>In addition, AllegroGraph now performs a similar operation if the filter is a literal equality on an expression using the SPARQL <code>str</code> function. For example: </p>
<pre><code>filter( str(?variable) = 'searching' ) </code></pre><p>As with regular literal equality constraints, such an expression is converted into the equivalent tests for specific values. </p><h4>Bug22030 - ORDER BY expressions with non-query variables could cause errors</h4><p>If a SPARQL query used an ORDER BY expression that contained variables that were not found anywhere in the query, then an error could result. An example of this would be a query like: </p>
<pre><code>select * {  
  ?s a ?o .  
} order by desc( str( ?notFoundInQuery )) </code></pre><p>This issue has been corrected. </p><h4>Bug22021: Correct SPARQL TSV printing problem for encoded UPIs</h4><p>When encoded UPIs were serialized from a SPARQL query using the SPARQL TSV (tab sepated values) output format, they were printing without the enclosing quotes. This has been corrected. </p><h4>Bug22016 - Correct SPARQL 1.1 bug with IN FILTERs</h4><p>It was possible for the query engine to produce incorrect results when using FILTER with either the SPARQL IN operator or multiple equality filters on the same variable. This has been corrected. </p><h4>Bug22015 - Fix possible error when using the SPOGI cache and SPARQL 1.1</h4><p>In rare circumstance it was possible for a SPARQL 1.1 query to signal an error when the SPOGI cache was enabled. This has been corrected. </p><h4>Bug21986 - Using distinct aggregation with GROUP_CONCAT and a separator could fail</h4><p>If a SPARQL query used the GROUP_CONCAT aggregator along with both the DISTINCT and SEPARATOR modifiers, then the solution bindings for that variable could be left empty. This has been corrected. </p><h4>Bug21980 - Too many results in DISTINCT and REDUCED queries</h4><p>Under extremely rare circumstances, queries involving DISTINCT or REDUCED could return too many results. This bug has been fixed. </p><h4>Bug21974 - Assertion failure involving 'n-valid-partials'</h4><p>When chunk-at-a-time processing was enabled (see query prefix franzOption_chunkProcessingAllowed, described <a href="sparql-reference.html#sparql-queryoptions">here</a> in the <a href="sparql-reference.html">SPARQL Reference</a>), the code keeping track of the number of intermediate results used to run into an assertion failure under very rare circumstances (when two consecutive intermediate results were the same). This bug has been fixed. </p><h4>Bug21962 - Improve estimates for certain query patterns</h4><p>AllegroGraph was mis-estimating the sizes of query patterns that resulted from the inlining of filters that used the IN expression. For example, </p>
<pre><code>?s ?predicate ?object .  
FILTER( ?predicate IN ( ex:a, ex:b, ex:c ) </code></pre><p>This could result in sub-optimal BGP re-ordering. This has been improved. </p><h4>Bug21961 - Incorrect results with EXISTS and NOT EXISTS</h4><p>Some queries involving EXISTS or NOT EXISTS filter expressions returned too few results. This bug has been fixed. </p><h4>Bug21955 - Sorting on unbound variables could lead to a string dictionary error</h4><p>If a query used an ORDER BY expression involving a computation and some of the variables in the expression were unbound, then the expression could signal a UPI not in string dictionary error. This has been corrected. </p><h4>Bug21948 - Improve bookkeeping of bound variables during sub-query</h4><p>When executing a sub-query with a limit, AllegroGraph failed to update the list of variables known to be bound. This prevented some queries from executing as efficiently as possible. This has been corrected. </p><h4>Bug21947 - Improve efficiency of VALUES in some cases</h4><p>AllegroGraph now does a better job of using the information in a VALUES clause to restrict alternate solutions. This can greatly increase the speed of some queries. </p><h4>Bug21941 - Queries with magic properties could fail in a remote-triple-store</h4><p>Queries that used magic properties could cause an error when run from a remote-triple-store. This has been corrected. </p><h4>Bug21940 - Using magic properties with filters could lose solutions</h4><p>If the circumstances were just right, a query that used a magic property that produced multiple bindings <em>and</em> that used a filter on those bindings could fail to return all solutions. This has been corrected. </p><h4>Bug21933 - Externally introduced variables could fail in nested sub-queries</h4><p>If a query used externally introduced variables (e.g., via the Lisp APIS's <strong>with-variables</strong> argument or via the variable bindings in an HTTP REST request), and these variables were used in FILTER clauses in a nested sub-query, then the query could fail to find any matches. This has been corrected. </p><h4>Bug21921 - BGP triple filters with Chunk-at-a-Time processing</h4><p>In rare cases, a filtering triple-pattern could fail to remove some solutions when using Chunk-at-a-Time query processing. This has been fixed. </p><h4>Bug21902 - Fix incompatibility between magic predicates and the identity reorderer</h4><p>If the identity BGP clause reorderer was being used in a query with magic predicates, then the magic predicates were being sent to the end of the BGP. This has been corrected. </p><h4>Bug21901 - Minor improvements to some range query clause orderings</h4><p>Improve the statistical estimates used to reorder BGP patterns that use range queries. </p><h4>Bug21892 - Query engine selection failed to take OFFSET into account</h4><p>AllegroGraph's decision on whether to use the single-set or the chunk-at-a-time query execution engine relied only on the LIMIT of the query rather than the LIMIT and the OFFSET. This has been corrected. </p><h4>Bug21880 - Using with-variables in SPARQL describe caused an error</h4><p>Using SPARQL describe with an external variable binding would lead to an error at query execution time. For example, this query would fail: </p>
<pre><code> describe ?x </code></pre><p>(where ?x was bound externally). This has been corrected. </p><h4>Bug21865 - Comparisons of xsd:dateTimes with fractional seconds</h4><p>Comparisons (including ORDER BY) of xsd:dateTimes with fractional seconds were broken. This bug has been fixed. </p><h4>Bug21862 - Some FILTERs and BGP orderings could lead to empty bindings</h4><p>In rare cases, AllegroGraph could fail in its bookkeeping of which variables were bound while it executed a query. This could lead to the introduction of spurious rows with null bindings. This has been corrected.<br />
</p><h4>Bug21858 - Distinct, SERVICE and sub-query could lead to planning failure</h4><p>If a query used a sub-query in a SERVICE clause and asked for unique results, then AllegroGraph would signal an error during query planning. This has been corrected. </p><h4>Bug21852 - Improve bound variable tracking</h4><p>AllegroGraph should assume that any variable supplied via external settings (e.g., via the <code>with-variables</code> parameter to run-sparql) is bound. Failure to do so could cause some queries to fail. This has been corrected. </p><h4>Bug21828 - VALUES could fail to correctly handle OPTIONAL bindings</h4><p>Using the VALUES clause could incorrectly drop solutions whose rows contained unbound values. This has been corrected. </p><h4>Bug21815 - Fix property-path memory leak</h4><p>Some queries involving property-path expressions could run out of memory, because the intermediate result set was not freed as soon as it was consumed. This bug has been fixed. </p><h4>Bug21803 - Exclusive ranges of encoded non-integer types</h4><p>Previously, filter expressions on all non-integer types (floats, decimals, etc, excluding xsd:date and xsd:dateTime) involving exclusive ranges ('<' and '> ') behaved as if an inclusive range ('<=', '> =') had been specified. This bug has been fixed. </p><h4>Rfe12591: Improve efficiency of some Basic Graph Pattern evaluations</h4><p>AllegroGraph now makes better use of intermediate result sets when evaluating basic graph patterns (BGPs) in nested groups of joins and left-joins. </p><a name='header3-2626' id='header3-2626'></a><h3>AGWebView</h3><h4>Bug21997 - Agwebview and sessions</h4><p>Due to a thread safety issue, AGWebView's 'Create Session' or any subsequent action in that session could produce garbage results ranging from 'Not found' to garbled output. This bug has been fixed. </p><a name='header3-2629' id='header3-2629'></a><h3>Changes to the Lisp API</h3><h4>Rfe12562 - upi-&gt;value round-trip</h4><p>For dates and date-times a complete representation is a <code>(&lt;universal-time&gt; . &lt;timezone-information&gt;)</code> cons. While this would make a good candidate for the return value of <a href="lisp-reference.html#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a>, to maintain backward compatibility by default <a href="lisp-reference.html#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> must return a single number representing the universal time. </p><p>However, this means that during the <a href="lisp-reference.html#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a>/<a href="lisp-reference.html#value-:3Eupi" title="description of value->upi">value-&gt;upi</a> round-trip the timezone information is lost. </p><p>This change adds a new keyword argument <code>:complete?</code> (defaults to <code>nil</code>). With <code>:complete? t</code>, <a href="lisp-reference.html#upi-:3Evalue" title="description of upi->value">upi-&gt;value</a> returns the complete representation and the roundtrip works in the sense of: </p>
<pre><code>(upi= (value-&gt;upi (upi-&gt;value upi :complete? t) (upi-type-code upi))  
      upi) </code></pre><p>Currently, for UPIs other than dates and date-times, <code>:complete?</code> has no effect. </p><h4>Rfe12557 - run-sparql can now use a UPI or future-part for the default base</h4><p>Previously the Lisp function <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> only allowed a string to specify the default-base. It can now take a string or a UPI or future-part. </p><h4>Rfe12508 - normalizing with-variables should convert $var to ?var</h4><p>The <code>with-variables</code> parameter in the Lisp API to <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> allows for variable names to be identified as strings or symbols. The name can be a plain string like <code>"person"</code> or a string whose first character is #\? or #\$ like <code>"?person"</code> or <code>"$person"</code>. All three of these representations refer to the same query variable: <code>?person</code>. Prior to this change, AllegroGraph could misinterpret variable names that used <code>$</code> as the first character. This has been corrected. </p><h4>Bug21953 - Support server-side loading via the Lisp client.</h4><p>When using the Lisp client and connected to a remote-triple-store, passing a URI or URI-like string to one of the bulk-load functions (e.g. <a href="lisp-reference.html#load-ntriples" title="description of load-ntriples">load-ntriples</a>) will cause the resource to be loaded directly by the server instead of being delivered via the client. </p><h4>Bug21891 - db.agraph.log:<em>log-output</em> captured in dumplisp</h4><p>If <strong>dumplisp</strong> (a function used to save a running image) was used after opening a triple store, the stream used for logging would be captured.  Upon restore of the dumped image, subsequent logging attempts (performed by internal AllegroGraph code) could result in confusing errors or file corruption.  This has been fixed. </p><h4>Bug21860 - Make Lisp clients find bundled liblzo2.so.2</h4><p>Previously, Lisp clients resorted to using the liblzo library located in the acl directory ("sys:") or somewhere the OS dynamic library loader can find it. With this change the bundled liblzo2.so.2 is loaded. </p><h4>Bug21841 - db-get-triple leaks sockets</h4><p>The Lisp function <strong>db-get-triple</strong> didn't close the socket it used for communication with a remote triple store which resulted in leaking sockets in CLOSE_WAIT state. This bug has been fixed. </p><h4>Bug21848 - load-turtle could use the wrong triple-store</h4><p>The <code>load-turtle</code> command could fail to respect the value of the <code>db</code> parameter and instead load triples into the store currently bound to <em>db</em>. This has been corrected. </p><h4>Bug21810 - Polygon-vertexes did not work with future-parts</h4><p>If called with a future-part rather than a UPI, the <code>polygon-vertexes</code> function would return no results. This has been corrected. </p><h4>Bug21611 - Load patches in Lisp remote client</h4><p>With this fix the Lisp remote client loads patches and enables pretty printing of parts and triples just as the direct client does. </p><h4>Bug21070 - Fix corruption hazard in direct Lisp client.</h4><p>Prevent possible database corruption that could occur when interrupting a direct Lisp client app that is modifying the transaction log. </p><h4>Bug21045 - create-freetext-index function failed when called with UPIs</h4><p>The <a href="lisp-reference.html#create-freetext-index" title="description of create-freetext-index">create-freetext-index</a> function (in the Lisp API) would fail if called with UPIs (rather than, e.g., future-parts). This has been corrected. </p><a name='header3-2658' id='header3-2658'></a><h3>Prolog</h3><h4>Rfe12222 - AllegroGraph Prolog unifies UPIs and future-parts</h4><p>When AllegroGraph is loaded, the semantics of Prolog unification is extended such that: </p>
<ul>
<li><p>Non-eq UPIs that are equivalent (byte-for-byte the same) will unify.</p></li>
<li><p>Non-eq future-parts that resolve to the same UPI will unify.</p></li>
<li><p>Similarly, a UPI and a future-part that resolves to that UPI will unify with each other.</p></li></ul><p>This enhancement does not change the capabilities of Prolog queries in AllegroGraph, but allows simpler, less-verbose coding that looks a little more declarative and less procedural.  For example, the following </p>
<pre><code>(select (?manager ?employee)  
  (member ?employee (!acme:joe !acme:jill !acme:jim !acme:jerry))  
  (q ?employee !acme:hasManager ?manager)  
  (member ?manager (!acme:bill !acme:bob !acme:betty !acme:benjamin))) </code></pre><p>would not work as intended before this change because <code>?manager</code> would be unified with a UPI, and a UPI would not unify the future-parts in the last clause.  The last clause would have had to be coded as something like </p>
<pre><code>(member ?manager1 (!acme:bill !acme:bob !acme:betty !acme:benjamin))  
(part= ?manager manager1) </code></pre><p>Using Prolog is AllegroGraph is documented <a href="lisp-reference.html#ref-prolog">here in the Lisp Reference</a>. </p><a name='header3-2669' id='header3-2669'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-2671' id='header3-2671'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-2673' id='header3-2673'></a><h3>Java Client</h3><h4>Bug21953. Fix generation of some POST method requests.</h4><p>AGHTTPClient would write query parameters to the body of POST requests when the content-type was not application/x-www-form-urlencoded. This can result in http servers not finding the query parameters and processing the request incorrectly. This bug corrects the problem by writing POST request query parameters to the URL, unless the request has no body and the content type is application/x-www-form/urlencoded. AGRepositoryConnection.load() (see <a href="javadoc/index.html">Javadocs</a>) now works for importing server-side statements. </p><a name='header2-2676' id='header2-2676'></a><h2>AllegroGraph 4.11</h2><a name='header3-2677' id='header3-2677'></a><h3>Server Changes</h3><h4>Rfe12309 - Improve algebraic query manipulation</h4><p>AllegroGraph now notices patterns of the form </p>
<pre><code>(:join (:join A (:bgp B)) (:bgp C)) </code></pre><p>and transforms them into the equivalent </p>
<pre><code>(:join A (:bgp B C)) </code></pre><p>(I.e., it merges the two BGPs). This transform brings more triple-patterns together which lets AllegroGraph order the query operations better. </p><h4>Rfe12305 - Relative paths in the configuration file</h4><p>Relative file or directory paths in the configuration file were always interpreted relative to the directory containing the configuration file. In this rfe, a BaseDir configuration directive was added that allows another path to be specified for this purpose. See the documentation in <a href="daemon-config.html">Server Configuration</a> for more. </p><h4>Rfe12280 - Simplify geospatial type-mapping API</h4><p>Geospatial subtype mappings can now be set up with the regular datatype and predicate mappings rather than needing to use the specialized functions. The old functions still work but are now unnecessary. They will be removed in some future release. </p><h4>Rfe12260 - Automatically map temporal predicate data to xsd:dateTimes</h4><p>Triple-stores created in this version of AllegroGraph will include the three AllegroGraph temporal predicates in the list of automatically mapped predicates. I.e., the objects in triples with these predicates: </p>
<ul>
<li>&lt;http://franz.com/ns/allegrograph/3.0/temporal/endpoint&gt;</li>
<li>&lt;http://franz.com/ns/allegrograph/3.0/temporal/startpoint&gt;</li>
<li>&lt;http://franz.com/ns/allegrograph/3.0/temporal/time&gt;</li></ul><p>will be converted into encoded xsd:dateTime literals. This encoding makes range queries against them faster and makes it easier to use AllegroGraph's temporal functionality. </p><h4>Rfe12259 - Optimize certain combinations of JOINs and FILTERs</h4><p>The query engine now recognizes certain patterns of JOINs and FILTERs and rewrites them to be more efficient. For example, a pattern like </p>
<pre><code>(:join A (:filter B f)) </code></pre><p>can often be better evaluated as </p>
<pre><code>(:filter (:join A B) f)  
</code></pre><h4>Rfe12182 - More restrictive umask</h4><p>With this change, users who aren't the owner of the file, or a member of the group of the file (that is, "other" users in chmod manpage terms) have no read, write or execute permission on files created by AllegroGraph. </p><p>On existing installations, it's recommended, but in no way enforced, to change permissions the same way with 'chmod -R o-rwx &lt;directories&gt;' where &lt;directories&gt; is the list of directories holding AllegroGraph data (LogDir, SettingsDirectory, catalog directories, etc). </p><h4>Rfe12175 - Audit log</h4><p>When the 'Auditing' global configuration directive is set to 'yes' (it defaults to 'no'), events that have implications on security or performance will be logged to the new system database in the new system catalog. Note that regardless of permissions only superuser can read or write the system catalog. </p><p>See <a href="audit.html">Auditing</a> for more information. </p><h4>Rfe12151 - Remove support for loading N-Triples into a federated triple-store</h4><p>AllegroGraph 3 introduced some techniques that optimized loading of N-Triples into a federated-triple-store. These have been superseded in AllegroGraph 4 because <code>agload</code> is significantly faster and easy to use. </p><h4>Rfe12147 - Better manage memory especially for large solutions</h4><p>AllegroGraph now manages large query result sets (with or without DISTINCT or ORDER BY) more efficiently. </p><h4>Rfe12138 - Agload: reduced memory footprint and other enhancements</h4><p>Reduced memory consumption of agload processes. Particularly in the case where there are many input sources. </p><p>Agload now analyzes input sources on the fly. This means you will not necessarily encounter errors about invalid input sources prior to modification of a triple-store.  Use --dry-run command line argument if you wish to pre-analyze an agload job. </p><h4>Rfe12125 - Improve performance of unordered queries with small limits</h4><p>AllegroGraph now uses chunk-at-a-time query processing for queries with small LIMITs that do not use ORDER BY more frequently. In particular, the chunkProcessingAllowed query option can now take three values: </p>
<ul>
<li>yes - use chunk-at-a-time mode whenever possible,</li>
<li>no - always use single-set mode, or</li>
<li>possibly - choose the execution mode that makes the most   sense for the current query. </li></ul><p>The default value for chunkProcessingAllowed has been changed from <code>no</code> to <code>possibly</code>. </p><h4>Rfe12111 - Improve memory checking efficiency</h4><p>Improve the efficiency of AllegroGraph's memory tracking code slightly. </p><h4>Rfe12089 - Improve cursor resource management</h4><p>Improve AllegroGraph's low-level cursor memory management. </p><h4>Rfe12063 - Allow in-memory-triple-stores to use blank nodes</h4><p>The in-memory-triple-store implementation for the remote-lisp-client was missing several methods required for full blank node support. This has been corrected. </p><h4>Rfe11973 - Improve usage of UPI-map</h4><p>Improved the way AllegroGraph manages the use of secondary indices (UPI-maps). </p><h4>Rfe11955 - :commit argument added to delete-duplicate-triples</h4><p>The :commit argument was added to delete-duplicate-triples to allow for the deleting a very large number of duplicates. </p><h4>Rfe11886 - Use statistics more often when reordering query clauses</h4><p>The query engine now uses store statistics in more places when working to reorder the clauses in a query's basic graph patterns (BGPs). This should produce better plans more often with less need for customer query tweaking. </p><h4>Rfe11585 - Some queries unnecessarily accumulated partial results</h4><p>AllegroGraph was sometimes accumulating results unnecessarily. For example, the query </p>
<pre><code>select (count(*) as ?total) where {?s ?p ?o} </code></pre><p>was accumulating the actual results even though only the summary was necessary. </p><h4>Rfe11511 - Encode xsd:decimals</h4><p>xsd:decimals used to be stored as strings. With this change, they are automatically encoded directly in the UPI which potentially brings significant savings in storage space and computation in queries. The most significant 20 digits are preserved by the encoding. </p><p>Note that this change only affects the encoding of new triples. To convert old triples and take advantage of the more efficient storage, the database contents must be reloaded from a serialized format. We recommend exporting in nquad format and then reimporting it with agload. Restoring from a backup is not sufficient. </p><h4>Rfe11197 - Serialize triple IDs as resources rather than literals</h4><p>Previously, a triple ID would have been serialized as a typed literal like </p>
<pre><code>"13"^^&lt;http://franz.com/ns/allegrograph/4.0/triple-id&gt; </code></pre><p>This format prevented the use of triple IDs in the subject of a triple so we have changed the serialization to a URI like </p>
<pre><code>&lt;http://franz.com/ns/allegrograph/4.0/tripleId#13&gt; </code></pre><p>Any triple IDs already in a triple-store will remain the same (though they will print differently). This change does mean, however, than any files that contain triple IDs in the old format will need to be converted in order to be re-loaded (note, however, that the IDs assigned to triples are not part of any serialization format which means that they cannot reliably round-trip in any case). </p><h4>Rfe10292 - Handle filename limit for unix domain sockets</h4><p>Linux has a limit of 107 characters for filenames of UNIX domain sockets. With this change, when bumping into that limit, a meaningful error message is printed and the workaround of setting the UnixDomainSocketDirectory or the SettingsDirectory configuration directive to a shorter path is suggested. </p><h4>Bug21793 - Fix race in inter process communication</h4><p>Under extremely rare circumstances, multiple threads could end up listening on the same communication channel which can lead to errors and deadlocks. This was duly detected by an assertion that appeared in the log as: </p>
<pre><code>the assertion (endp (intersection  
                     (db.agraph.spawn::receiver-for  
                      db.agraph.spawn::r)  
                     (db.agraph.spawn::receiver-for  
                      db.agraph.spawn::receiver)))  
failed. </code></pre><p>This bug has been fixed. </p><h4>Bug21782 - Potential double close of cursors</h4><p>An inadvertent double close of cursors was discovered that could potentially result in improper sharing of a data structure. This has been corrected. </p><h4>Bug21779 - Fix low-level cursor resourcing bug</h4><p>Under heavy load, the secondary index (UPI-map) creation function could leak a cursor leading to potential resource problems. This has been corrected. </p><h4>Bug21761 - Prolog <code>q-</code> functor could be treated as <code>q</code></h4><p>If a reasoning triple-store can use secondary indices (UPI-maps) then it was possible for AllegroGraph to treat some <code>q-</code> functors as <code>q</code> functors in a given Prolog select query. This has been corrected. </p><h4>Bug21745 - Fix crash related to aggregate functions</h4><p>Under rare circumstances, queries involving aggregate functions may cause the backend to crash. This bug has been fixed. </p><h4>Bug21744 - Some Prolog select queries could return duplicate results</h4><p>If using secondary indices (i.e., UPI-maps), it was possible for Prolog select queries that returned <code>raw</code> UPIs to overwrite one solution with another. This problem could only occur with UPI only queries and never with queries that returned strings. The problem is now fixed. </p><h4>Bug21740 - Rare hangs under high load</h4><p>The message broker (called the "Hub" process) may get into a state where forwarding a message blocks, preventing all other messages from being handled. This bug has been fixed. </p><h4>Bug21735 - Corrupted distinct results</h4><p>Under rare circumstances, queries involving DISTINCT could produce results with the bindings assigned to the wrong variables. This bug has been fixed. </p><h4>Bug21702 - XSD casting in a BIND could convert to xsd:integer incorrectly</h4><p>Using an XSD cast in a BIND could loss the datatype and switch it to xsd:integer. E.g., </p>
<pre><code>BIND(xs:long(?test) AS ?testLong) </code></pre><p>would bind ?testLong to a value whose datatype was xsd:integer rather than xsd:long. This has been corrected. </p><h4>Bug21693 - Avoid forking too many blank node servers in agload.</h4><p>Improves agload performance under default conditions when loading ntriples or nquads files which are small and numerous. </p><h4>Bug21691 - Reasoning over subproperties of symmetric properties</h4><p>AllegroGraph's RDFS++ reasoner partially failed to infer triples from sub-properties of a symmetric property. This has been corrected. </p><h4>Bug21680 - Some BIND forms could be evaluated incorrectly.</h4><p>A BIND form at the start of a BGP could fail to get values from earlier in the query evaluation. </p><p>For example, this form </p>
<pre><code>?a a ?b .  
{ BIND( ?b as ?otherB  
  ?otherB a ?c .  
} </code></pre><p>could lose the binding for ?otherB. This has been corrected. </p><h4>Bug21670 - FILTER and EXISTS could interact incorrectly.</h4><p>Depending on the shape of the rest of the query, it was possible for a FILTER clause to be applied to the inside of an EXISTS or NOT EXISTS filter <em>rather</em> than being applied to the main body of the query. This has been corrected. </p><h4>Bug21663 - Redo of new index creation confuses instance process</h4><p>If a database with a newly-created index has been shut down uncleanly, restart of the database may crash.  This has been corrected. </p><h4>Bug21651 - Prolog ?? and reasoning</h4><p>On a reasoning triple store, the prolog ?? construct in the predictate position used to fail with a type error. This bug has been fixed. </p><h4>Bug21642 - Agload buffer overflow</h4><p>Due to a buffer overflow, agload could corrupt memory and potentially crash.  This has been fixed. </p><h4>Bug21640 - Race condition when reaping abandoned sessions</h4><p>Previously, if concurrent processes performed the operation to reap abandoned sessions, shared memory state could be corrupted, resulting in hangs or crashes.  This has been fixed. (This bug was actually fixed in version 4.10.) </p><h4>Bug21625 - Large result sets could produce bogus triples with INSERT and CONSTRUCT</h4><p>In cases where there were more than 100,000 results, the machinery that prevents INSERT and CONSTRUCT queries from producing duplicate results could create invalid answers. This has been corrected. </p><h4>Bug21596 - Serialize-rdf/xml could fail on some predicates</h4><p>AllegroGraph's RDF/XML serializer would fail if a predicate ended with something other than a letter, a digit, an underscore or a dash. This conformed to an older version of the Extensible Markup Language but not to the most recent version. This has been corrected. </p><h4>Bug21586 - Possible divide by zero error in index optimizer</h4><p>Under some circumstances an index optimizer could attempt to perform a division by zero when logging statistics to agraph.log.  This would result in a non-fatal error message being logged instead of the statistics.  This has been corrected. </p><h4>Bug21580 - Improve external variable binding bookkeeping</h4><p>The values for externally supplied variables could be lost for some complex interactions of EXISTS (or NOT EXISTS) filters and UNIONS. </p><p>This has been corrected. </p><h4>Bug21570 - Fix 'No session ports available' error message</h4><p>When trying to start a dedicated session and no more free ports were available, AllegroGraph failed with an internal error (calling @UUID on NIL) instead of producing an informative error message. This bug has been fixed. </p><p>Also, the http error code was changed from 400 ("Bad request") to 503 ("Service unavailable") to indicate a temporary condition. </p><h4>Bug21553 - Fix MemoryCheckWhen without MemoryReleaseThreshold</h4><p>If the memoryReleaseThreshold configuration directive was not specified but memoryCheckWhen was, then query execution failed with type errors trying to compare memory footprint to NIL. With this fix, AllegroGraph refuses to start in these circumstances. </p><a name='header3-2800' id='header3-2800'></a><h3>HTTP Client</h3><h4>Rfe12136 - Optimize front-end http server</h4><p>The timeout for reading headers was lowered to 5s which makes the front-end http server make better use of its available resources and more resilent when clients with http keep-alive don't close the connection in a timely manner. </p><p>Also, a warning is logged if the number of idle http worker threads falls below 2, because it can easily cause a performance drop. </p><a name='header3-2804' id='header3-2804'></a><h3>SPARQL</h3><h4>Rfe12296 - Support AllegroGraph direct reification in SPARQL</h4><p>AllegroGraph now supports direct reification in SPARQL queries using the &lt;http://franz.com/ns/allegrograph/4.0/tripleId&gt; magic property. This property allows you to bind the ID of a triple to a SPARQL variable which can then be used in reification. For example, the following query first adds two triples and then adds four additional triples that describe the first two: </p>
<pre><code>prefix : &lt;eh://&gt;  
prefix franz: &lt;http://franz.com/ns/allegrograph/4.0/&gt;  
insert data {  
  :gary :likes :dogs .  
  :gary :likes :cats .  
} ;  
 
insert {  
  ?id :mentioned ?now .  
  :gary :believes ?id .  
} where {  
  ?id franz:tripleId (:gary :likes ?what) .  
  bind( now() as ?now )  
} </code></pre><p>See the documentation for additional details on direct reification and its advantages and limitations. </p><h4>Rfe12246 - Enhancements to SPARQL freetext queries</h4><p>The <code>fti:match</code> and <code>fti:matchExpression</code> predicates can now optionally retrieve the object of the matching triples and select the freetext index to use. (These enhancements are currently available only for AllegroGraph's native freetext indices. Support for Solr and MongoDB will be forthcoming). </p><p>The new features rely on SPARQL <em>magic</em> properties to provide a syntactic shortcut for list patterns. As an example, this query retrieves the subject (into ?subject) and text (into ?text) for the freetext query that matches "nepal": </p>
<pre><code>select ?subject ?text {  
  (?subject ?text) fti:match 'nepal' .  
} </code></pre><p>This query retrieves only subjects and uses only the freetext index named <code>comments</code>. </p>
<pre><code>select ?item {  
  ?item fti:match ('upgrade' 'comments')  
} </code></pre><p>More examples and information can be found in the documentation. </p><h4>Rfe12243 - Support AllegroGraph Social Networking Analysis in SPARQL</h4><p>AllegroGraph's SPARQL engine now supports a set of magic properties to enable Social Networking Analysis including centrality measures, path finding and cliques. See <a href="magic-properties.html">SPARQL Magic Properties</a> for more details. </p><h4>Rfe12231 - Improve SPARQL geospatial integration</h4><p>AllegroGraph now supports several <em>magic properties</em> to make SPARQL / geospatial integration easier. For example, this query finds all of the points within a circle centered at 10, 2: </p>
<pre><code>select ?who ?where {  
  (?who ?where) geo:inCircleXY ( ex:location 10 2) .  
} </code></pre><p>The following magic properties are provided: </p>
<pre><code>geo:inBoundingBoxXY  
geo:inBoundingBox  
geo:inCircle  
geo:inCircleKilometers  
geo:inCircleMiles </code></pre><p>(where <code>geo</code> is the usual Geospatial namespace abbreviation for &lt;http://franz.com/ns/allegrograph/3.0/geospatial/&gt;). See <a href="magic-properties.html">SPARQL Magic Properties</a> for additional details on using these properties. </p><h4>Rfe12171 - Improve variable GRAPH clause handling in some situations</h4><p>SPARQL specifies that a graph clause like </p>
<pre><code> GRAPH ?g { ... } </code></pre><p>must be implemented as if it iterated over each graph in the dataset and took the union of the resulting bindings. There are sometimes more efficient ways to get the same results and AllegroGraph uses these when it can. AllegroGraph was not, however, using information about any constraints on the variable <code>?g</code> that were provided by other parts of the query. For example, a query like: </p>
<pre><code>?s :p ?g .  
GRAPH ?g { ... } </code></pre><p>might produce a single binding for <code>?g</code> but AllegroGraph was still iterating over all of the named graphs of the dataset. This has been optimized so that AllegroGraph will use the additional information when it can determine that the number of bindings for <code>?g</code> are smaller than the number of graphs in the dataset. </p><h4>Rfe12057 - Manage disk and memory resources better for CONSTRUCT queries</h4><p>When there are many results, SPARQL CONSTRUCT queries buffer their results to disk to conserve memory. The cutoff value for when to buffer to disk was unnecessarily small which meant that CONSTRUCT went to disk more often then necessary. This has been corrected. </p><h4>Rfe12035 - Improve handling of some SPARQL queries with a GRAPH clause</h4><p>By definition, SPARQL must handle a GRAPH clause as if the query engine evaluated the clause once for each graph in the dataset. However, it is often possible to evaluate the clause more efficiently. </p><p>This change improves the heuristics AllegroGraph uses to determine when the more efficient approach will achieve the correct results which means that some queries with a GRAPH clause will be executed more quickly. </p><h4>Rfe11319 - Support SPARQL federated queries (the SERVICE clause)</h4><p>AllegroGraph now supports SPARQL federated query using the SERVICE clause. The initial implementation is functional but not highly optimized. </p><h4>Rfe8063 - Support AllegroGraph temporal reasoning in SPARQL</h4><p>AllegroGraph's SPARQL engine now supports a set of magic properties to enable temporal reasoning. See <a href="magic-properties.html">SPARQL Magic Properties</a> for more details. </p><h4>Bug21757 - SPARQL geospatial queries could fail</h4><p>Depending on the set up of a triple-store's geospatial subtype mappings, it was possible for a SPARQL query using geospatial extensions to fail to find results. This has been corrected. </p><h4>Bug21742 - SPARQL parser failed on quad patterns with collections</h4><p>The SPARQL parser could lose track of triple-patterns that arose from abbreviations using either nested blank nodes or collections. This has been corrected. </p><h4>Bug21725 - Correct potential error when SPARQL Update touches too many rows</h4><p>If a SPARQL <code>DELETE ... INSERT ... WHERE</code> request changes many rows, then AllegroGraph caches the results of the WHERE expression to disk to reduce memory pressure. In some cases, this could result in a error when the cached results were re-read. This only occurred for Update requests that touched more than 100,000 rows. This has been corrected. </p><h4>Bug21718 - Unused variable optimization could produce incorrect results</h4><p>AllegroGraph analyzes SPARQL queries that use DISTINCT in order to remove the collection of bindings for variables that are not needed to produce the final result. In some cases, it was possible for this analysis to cause the execution of a code path that added solutions incorrectly. This has been corrected. </p><h4>Bug21573 - SPARQL queries could intern strings unnecessarily</h4><p>SPARQL queries that used the FROM or FROM NAMED clause always tried to intern the graphs into the triple-store's string table. This was both unnecessary and could cause an error if the triple-store was read-only or a federation. </p><p>This has been corrected. </p><h4>Bug21011, Bug21571 - handle nested SPARQL BGP syntactic sugar correctly</h4><p>Some SPARQL triple-patterns that involved nested brackets and object lists were being parsed incorrectly. This has been corrected. Some examples of queries that work correctly now but that failed without this change include: </p>
<pre><code>PREFIX : &lt;ex:&gt;  
SELECT * {  
    :x :y [:z (:b [:d (:e :f),(:g :h)])]  
}  
 
PREFIX : &lt;ex:&gt;  
SELECT * {  
    ?psi :a :b, [:c :d], [:e :f] .  
} </code></pre><p>and </p>
<pre><code>PREFIX : &lt;ex:&gt;  
SELECT * {  
    ?psi :a :b, [:c [:d :e]] .  
} </code></pre><h4>Improve Pattern estimation where there is no :p index</h4><p>Improved query pattern estimators for triple-stores with no predicate index (e.g., :posgi, :psogi, etc.). This will help reorder query clauses more intelligently. </p><a name='header3-2857' id='header3-2857'></a><h3>AGWebView</h3><h4>Rfe12325 - Add audit log query interface to AGWebView</h4><p>There is now an audit menu item in the admin menu. This provides access to the audit log query page which lets you filter audit log events by user, class and date. </p><a name='header3-2860' id='header3-2860'></a><h3>Changes to the Lisp API</h3><h4>Bug21708 - Fix some low-level Lisp API geospatial functions</h4><p>Some low-level Lisp API functions had not been enhanced to account for AllegroGraph's  geospatial encoding. This has been corrected. </p><h4>Bug21689 - Lisp client printer variable leakage</h4><p>On a remote store, the run-sparql function failed with an 'Illegal sharp character' error if <em>print-length</em> was set to a small value. This bug and more generally the leakage of printer variables into run-sparql has been fixed. </p><a name='header3-2865' id='header3-2865'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-2867' id='header3-2867'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-2869' id='header3-2869'></a><h3>Java Client</h3><h4>Rfe12118 - AGRepository with connection pooling</h4><p>With this change, an AGRepository can now be configured to use a connection pool via the setConnPool method, enabling Sesame apps to transparently benefit from connection pooling.  See the javadoc for setConnPool for details. </p><h4>Rfe10513 - Configurable blankNodesPerRequest</h4><p>With this change, the Java client supports configuring the number of blank nodes automatically fetched per request to the server by the AGRepository's AGValueFactory.  The default remains at 100, but it can be configured by setting the property: </p><p>  com.franz.agraph.repository.blankNodesPerRequest </p><p>Applications can also configure it directly, see the javadoc for AGValueFactory#setBlankNodesPerRequest for details. </p><h4>Rfe9869 - Support SPARQL/Update from Jena</h4><p>With this change the Jena adapter supports an execUpdate method in AGQueryExecution for executing SPARQL Updates. Jena Tutorial example13 has been augmented to demonstrate its use. </p><a name='header2-2878' id='header2-2878'></a><h2>AllegroGraph 4.10</h2><a name='header3-2879' id='header3-2879'></a><h3>Server Changes</h3><h4>Rfe12004 - Ag4 plugins for TBC 4.0.0</h4><p>With this change, the AG plugins have been updated to work with TBC 4.0.0.  For installation details, see <a href="TBCplugin.html">Top Braid Composer Plugin</a>. </p><h4>Rfe11986 - Improve efficiency of some property-path queries</h4><p>AllegroGraph now evaluates property path queries whose initial or final endpoints come from a small set of values more efficiently.  For example, a query like </p>
<pre><code>prefix gnO:&lt;http://www.geonames.org/ontology#&gt;  
select ?id ?par ?parname {  
  bind (URI('http://sws.geonames.org/104515/') as ?id)  
 
  ?id rdf:type gnO:Feature .  
  ?id gnO:parentFeature+ ?par .  
  optional {  
    ?par gnO:name ?parname  
  }  
} </code></pre><p>will be evaluated much more quickly than before because the subject of the path query is fixed. </p><h4>Rfe11937 - Agload: remove blank node cache size guessing code</h4><p>In <strong>agload</strong>, blank node cache size guessing code did not work very well. It was removed and the blank node cache size defaults to 1,000,000 which works reasonably well on small and large memory machines. </p><p>This change will only be noticed when loading ntriple or nquad files with blank nodes. </p><h4>Rfe11839 - Improve eager evaluation of impossible query constraints</h4><p>AllegroGraph tries to evaluate FILTER constraints as early as possible. In particular, a constraint may become impossible or a tautology before the query even runs if external variable bindings are supplied. AllegroGraph was already handling tautologies eagerly but was not doing the same for impossible constraints. This has now been remedied. </p><h4>Rfe11827 - Improved memory footprint of joins with unbound variables</h4><p>Previously, queries involving joins had a worst case memory footprint of O(2^N) where N is the number of join variables. This is now O(1), but the time complexity is O(N). In practice, this means that the client gets a timeout instead of a memory exhaustion warning. </p><h4>Rfe11233 - Simplify property path queries when possible</h4><p>Property path queries that do not use the <code>zero or more</code> or <code>one or more</code> operators and that do not have complex alternation can be expanded directly into simpler forms. This lets them be executed using the regular query machinery which can often be faster than the specialized path query machinery. </p><h4>Rfe9699 - Dynamically grow string table files</h4><p>Prior to this change string tables files were large sparse files. The apparent size of these files frequently led to user confusion. In addition, full filesystem errors were not handled gracefully when modifying the sparse files. Now string table files start at a minimum size and grow as needed. If growth of a string table fails due to a full filesystem error, a complaint will be logged to agraph.log and the operation will be retried periodically until it succeeds. </p><h4>Bug21592 - Improve cursor resource management</h4><p>Some cursors were failing to close all of their file handles which could lead to errors. This has been corrected. </p><h4>Bug21583 - see Bug21575 below.</h4><h4>Bug21582 - Complex nested unions could fail to return some bindings</h4><p>Given the right data, a complex query involving multiple nested unions could misapply an optimization meant for one part of the union to a different part. This could lead to some variables in the query being unbound. </p><p>This has been corrected. </p><h4>Bug21575, Bug21583 - property path optimizations and better bookkeeping</h4><p>Improve the way that AllegroGraph implements some property path queries. </p><p>Correct a problem with property path queries and over-zealous resource management. </p><p>Improve the bookkeeping of unused variables when using external bindings. </p><h4>Bug21570 - Fix 'No session ports available' error message</h4><p>When trying to start a dedicated session and no more free ports were available, AllegroGraph failed with an internal error (calling @UUID on NIL) instead of producing an informative error message. This bug has been fixed. </p><h4>Bug21550 - Complex FILTER EXISTS expressions could cause parsing errors</h4><p>Complex FILTERs that used EXISTS (or NOT EXISTS) could signal errors during parsing. This has been corrected. </p><h4>Bug21549 - Nested sub-queries could fail to project variables correctly</h4><p>A query with nested sub-queries that used <code>*</code> to return all variables in some of the sub-queries could incorrectly reason about variable scope which could cause queries to fail. This has been corrected. </p><h4>Bug21534 - Garbled error message on memoryCheckWhen parsing failure</h4><p>When the memoryCheckWhen configuration directive had an unsyntactic value ("memoryCheckWhen junk:1"), the error message was wrong. This bug has been fixed. </p><h4>Bug21506 - Correct possible error when mixing UNION and GRAPH</h4><p>Under some circumstances, a query with both UNION and GRAPH clauses could signal an error during execution. This has been corrected. </p><h4>Bug21505 - Unused variables from a sub-query could confuse AllegroGraph</h4><p>AllegroGraph removes query variables that are not used if a query has either the DISTINCT or REDUCED modifiers.  The unused variables logic was not correctly handling the case of a sub-query whose projected variables were not used elsewhere. This could lead to an error during query processing. This has been corrected. </p><h4>Bug21498 - Do not signal error when all ORDER BY expressions are redundant</h4><p>AllegroGraph removes ORDER BY expressions that do not depend on the bindings of a row because they cannot have any bearing on the outcome. For example, the query: </p>
<pre><code>SELECT * { ?s a ?o } ORDER BY ?pineapple </code></pre><p>is equivalent to the query </p>
<pre><code>SELECT * { ?s a ?o } </code></pre><p>Unfortunately, AllegroGraph was incorrectly signaling an error when all of the expressions in an ORDER BY clause were irrelevant and therefore removed. </p><p>This has been corrected. </p><h4>Bug21497 - Filters could be misapplied in some situations</h4><p>AllegroGraph attempts to move FILTERS closer to where they apply in order to increase query speed. If a FILTER was applicable on both sides of a UNION and also applied to single triple-patterns then it was possible for AllegroGraph to think that the FILTER only needed to be used on the left-hand side of the UNION. For example, a query like this could fail to apply the FILTER to <code>?c</code> on the right-hand side: </p>
<pre><code>select * {  
  { ?a ex:b ?c . } union { ?a ex:c ?c . }  
  filter (?c*2 = 2)  
 } </code></pre><p>This has been corrected. </p><h4>Bug21496 - Improve memory management for CONSTRUCT queries</h4><p>AllegroGraph now tracks memory more accurately and manages it more efficiently for CONSTRUCT queries. </p><h4>Bug21493 - Bind is too aggressive in assuming single values</h4><p>AllegroGraph was over-optimizing assignment (BIND) such that assignments to the same variable name in different pieces of a UNION could fail to work correctly. For example, a query like </p>
<pre><code>SELECT * {  
  { BIND( :person1 as ?person ) }  
  UNION  
  { BIND( :person2 as ?person ) }  
} </code></pre><p>would return only <em>one</em> binding for ?person rather than two. </p><p>This has been corrected. </p><h4>Bug21486 - Correct handling of some IN LINE data syntax</h4><p>AllegroGraph was not correctly reading all of the supplied values when using the abbreviated simple-variable syntax. E.g., a query like </p>
<pre><code>select ?person (concat(?first, ' ', ?last) as ?name) {  
  values ?person { ex:person1 ex:person2 ex:person10 }  
  ?person ex:first-name ?first .  
  ?person ex:last-name ?last .  
} </code></pre><p>was processing only the first supplied value. This has been corrected. </p><h4>Bug21476 - Some blank nodes could fail to print in a 32-bit Lisp client</h4><p>It was possible for blank-nodes to raise an error when AllegroGraph tried to print them in N-Triples format. This has been corrected. </p><h4>Bug21470 - Corrected Turtle parser relative URI normalization</h4><p>AllegroGraph was incorrectly applying sections 6.2.2 and 6.2.3 of RFC3986 when it merged a base URI with a relative one. This has been corrected. </p><h4>Bug21458 - Standardize AllegroGraph exit code</h4><p>AllegroGraph's license check can be resolved in three ways: </p>
<ol>
<li><p>Normal start up - a license is present and correct. </p></li>
<li><p>Free start up - no license is present so the free limit is used. </p></li>
<li><p>Limited start up - only partial license information is present    so AllegroGraph runs in free mode. </p></li></ol><p>In all of these cases, the exit code returned will be zero (0). </p><p>If the license code is invalid or if there are any other problems with server start up, then AllegroGraph will fail to start and return a non-zero exit code. </p><h4>Bug21454 - URI parsing was too strict</h4><p>AllegroGraph was being stricter than necessary when parsing BASE URIs such as <code>foo:bar:/baz</code>. This has been corrected. </p><h4>Bug21379 - Reasoning triple-store confusion about unspecified graph fixed</h4><p>A reasoning triple-store failed to distinguish between a query where the graph was left off (i.e., left as a wild card) and a query where the graph was explicitly set to the default-graph of the current triple-store. This could cause it to infer incorrect triples. </p><p>This has been corrected. </p><h4>Bug21365 - Fix lookup of user access rights when authorizing access to repositories in the root catalog. </h4><p>AllegroGraph would deny authorization requests on repositories in the root catalog under some conditions, despite specific user access right allowing such (read/write access on catalog "/", repository "<em>"), or global rights (read/write access on catalog "</em>", repository "*"). This has been corrected. </p><h4>Bug21353 - Correctly handle aggregation on empty datasets</h4><p>AllegroGraph was failing the Data Access Working Group (DAWG) "agg empty group" test because it was not returning a row for a query asking for aggregation on an empty dataset. This has been corrected. </p><h4>Bug21158 - Catch errors during filter analysis</h4><p>AllegroGraph was signaling an error during query planning if the eager analysis of a FILTER expression resulted in a error. The correct behavior is to treat the FILTER as an impossible constraint. </p><p>This is now handled correctly. </p><a name='header3-2964' id='header3-2964'></a><h3>HTTP Client</h3><h4>Rfe11609 - Support text/table content-type in the HTTP protocol</h4><p>AllegroGraph will now return a simple ASCII table if an HTTP request uses the content-type <code>text/table</code>. For example, a query might return a table like: </p>
<pre><code>  -----------------------------------  
  | person    | name     | location |  
  ===================================  
  | mo:Bob    | "Bob"    | ---      |  
  | mo:Robert | "Robert" | 23       |  
  -----------------------------------  
 
</code></pre><h4>Bug20622 - "Mode" was not optional for DELETE /statements/duplicates</h4><p>The mode parameter, which is used to indicate which components of each triple must be equivalent to count as duplicates of each other, is now optional and defaults to "spog" for the DELETE /repositories/[name]/statements/duplicates HTTP protocol request. </p><a name='header3-2970' id='header3-2970'></a><h3>SPARQL</h3><h4>Rfe11920 - Signal error when aggregate expressions are used in the wrong place</h4><p>AllegroGraph did not signal a useful error when aggregate expressions were used incorrectly in a SPARQL query. E.g., </p>
<pre><code>SELECT * {  
  ?a ex:foo ?value .  
  BIND( SUM(?value) AS ?sumValue )  
} </code></pre><p>This has been corrected. </p><h4>Rfe11494 - Update semantics of SPARQL property path queries</h4><p>AllegroGraph's property path queries now match the updated semantics of the SPARQL 1.1 specification. In particular, wild-card operators like <code>*</code> and <code>+</code> no longer count their matches. AllegroGraph still supports the now deprecated counting operations, e.g., </p>
<pre><code>{2,4} </code></pre><p>but no longer counts the unique paths found. I.e., you can use these non-standard operators to find if there is a path but not to count the number of paths. </p><p>Note that AllegroGraph now passes all of the Data Access Working Group (DAWG) tests with the exception of </p>
<pre><code> (pp37) Nested (*)* </code></pre><p>This test uses the path </p>
<pre><code>((:p)*)* </code></pre><p>and AllegroGraph incorrectly returns some duplicate results. </p><h4>Bug21599 - Variable GRAPH queries that used the graph could lose results</h4><p>A SPARQL GRAPH query that used a variable graph and included the graph variable in the body of the query could under some circumstances lose results. For example, a query like </p>
<pre><code>SELECT * {  
  GRAPH ?g {  
    ?g a &lt;FoodGroup&gt; .  
    ?g &lt;covers&gt; ?r .  
  }  
} </code></pre><p>could possibly have returned too few results depending on the data in the store. </p><p>This has been corrected. </p><h4>Bug21581 - Improve bookkeeping when using property paths</h4><p>If AllegroGraph can determine that a variable in a SPARQL query is not used, then it will enable certain optimizations. For example, if a query is returning DISTINCT results and a variable is not used in any joins nor returned by the query, then its values do not matter. </p><p>This logic was not correctly rewriting property paths to account for the unused varaibles. </p><p>This has been corrected. </p><h4>Bug21562 - Insert &amp; remove-graph-uri(s) should <em>not</em> override WITH</h4><p>If insert-graph-uri(s) or remove-graph-uri(s) were passed as query parameters to a SPARQL DELETE...INSERT...WHERE statement, then AllegroGraph was using these parameters even if the statement used WITH to specify a GRAPH. This is now corrected. SPARQL Update statements that use WITH will not be overridden via insert or remove graph URI(s). </p><h4>Bug21551 - Deletes via SPARQL Update did not correctly handle encoded UPIs</h4><p>SPARQL DELETE DATA and DELETE...INSERT...WHERE commands could fail to remove some triples due to AllegroGraph's internal representation of typed literals. The failure would occur only if the literal was specified directly (i.e., when the literal was a variable, AllegroGraph behaved correctly). </p><h4>Bug21548 - Nested unions with fixed patterns could miss results</h4><p>If a SPARQL query contained nested unions and these unions contained fixed triple-patterns (i.e., patterns with no variables or patterns where all of the variables are bound via some external binding), then some results from these unions could be lost. This has been corrected. </p><h4>Bug21546 - Correct off-by-one error in some SPARQL constraints</h4><p>Depending on the data and the query, some SPARQL constraint analysis could lead to a range error. This has been corrected. </p><h4>Bug21515 - Improve SPARQL parser speed</h4><p>Compliance changes in the SPARQL parser of AllegroGraph v4.9 reduced the speed of parsing significantly for very large queries and update requests. </p><p>This has been corrected so that parse speed is now equivalent to what it was in AllegroGraph v4.8. </p><h4>Bug21514 - Fix possible error caused by nested sub-query</h4><p>The data structures used for SPARQL sub-queries were sometimes being cleaned up too early which could lead to a bus error. This has been corrected. </p><h4>Bug21507 - Fix problem with property path query clause estimation</h4><p>AllegroGraph was incorrectly estimating the size of clauses involving property paths in SPARQL queries which could lead to poor plans. This has been corrected. </p><h4>Bug21478 - Fix spurious parsing error when mixing sub-query and aggregation</h4><p>AllegroGraph's SPARQL parser could become confused if a query mixed sub-query and aggregation and the sub-query used <code>*</code> to refer to all variables. </p><p>This has been corrected. </p><h4>Bug21469 - Relative URIs were not being correctly normalized by the SPARQL parser</h4><p>Section 5.2 of RFC3986 specifies how "." and ".." path components of relative URIs should be normalized when merging with a BASE URI.  The original SPARQL parser implementation skipped this step in the interests of efficiency.  This has now been corrected. </p><h4>Bug21464 - Some combinations of nested UNION and OPTIONAL could fail</h4><p>The SPARQL 1.1 engine could fail to correctly keep track of solution bindings for queries with certain patterns of UNIONs and OPTIONALs. This has been corrected. #### Bug21501 - Queries with cross-products and empty RHS could emit incorrect solutions </p><p>If a query had a cross-product and the right-hand side of the cross-product was empty, then it was possible for AllegroGraph to not discard the solutions on the left-hand side. This has been corrected. </p><a name='header3-3016' id='header3-3016'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-3018' id='header3-3018'></a><h3>Changes to the Lisp API</h3><h4>Bug21535 - Db registry memory leak in the Lisp client</h4><p>If a triple store object isn't closed properly and becomes garbage, the finalizer is supposed to close it. Fixed a bug that rendered this mechanism ineffective, causing leakage of memory. </p><h4>Bug21512 - With-variables not handled consistently with sub-queries</h4><p>In some cases, external bindings imposed from <code>with-variables</code> could be lost when using sub-queries. This has been corrected. </p><a name='header3-3023' id='header3-3023'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-3025' id='header3-3025'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-3027' id='header3-3027'></a><h3>Java Client</h3><h4>Rfe11527 - Support sessions that use the main server port</h4><p>With this change, the Java client can now be configured to have sessions use the main server port rather than a dedicated port. By default, a dedicated port will be used.  Setting the system property com.franz.agraph.http.useMainPortForSessions=true will configure the client to use the main port for sessions. </p><h4>Rfe8384 - Limiting the duration of a query</h4><p>With this change, the Java client now supports limiting the duration of a query.  When Sesame applications use the AGQuery#setMaxQueryTime method, the AG server will timeout the query appropriately during evaluation and clean up server resources, and the client library will throw a QueryInterruptedException back to the client application. </p><a name='header2-3032' id='header2-3032'></a><h2>AllegroGraph 4.9</h2><a name='header3-3033' id='header3-3033'></a><h3>Server Changes</h3><h4>Rfe11922 - Add materiazer. See <a href="materializer.html">Materializer</a> for details. </h4><h4>Rfe11879 - Improve error message on invalid license</h4><p>AllegroGraph now prints information to the console when there are problems with the license settings in the configuration file. </p><p>For example, if the configuration file is missing the <code>LicenseExpires</code> parameter, then AllegroGraph will print: </p>
<pre><code>AllegroGraph Server Edition 4.9, built on October 01, 2012 10:04:33 GMT-0700  
Copyright (c) 2005-2012 Franz Inc.  All Rights Reserved.  
current-time: Monday, October 01, 2012 10:43:09 AM  
 
Daemonizing...  
Server started: LicenseExpires parameter missing. Running with triple-limit of 5,000,000.  
 
</code></pre><h4>Rfe11845 - Optimize blank node printing</h4><p>Blank nodes now print slightly faster and more efficiently than they did before. </p><h4>Rfe11827 - Reduce memory footprint a bit</h4><p>Result arrays are now freed right when they become unused. Previously, garbage accumulated until a certain limit was reached. This should have a small positive effect on high water-mark memory footprint. </p><h4>Rfe11784 - Release memory back to the operating system after query failure</h4><p>Prior to this change, AllegroGraph would continue to claim memory used for queries even after the query would complete. AllegroGraph will now return unused memory back to the OS when a query memory failure occurs. </p><h4>Rfe11762 - Improve the efficiency of queries with unbound results</h4><p>Queries that use UNION or OPTIONAL can have unbound columns in the result set. This change improves the way AllegroGraph does joins when there are unbound columns in a result set. </p><h4>Rfe11756 - Improve the chunk processing behavior of ORDER BY and LIMIT queries</h4><p>The chunk-at-a-time processor automatically reduces the size of the chunks being processed based on the limit (it makes no sense to process a chunk of 500,000 rows if you are only interested in the first one!). In the case of ORDER BY queries, however, it makes sense to keep the larger limit since all of the results must be examined. This is now the case. </p><h4>Rfe11728 - Improve handling of large DISTINCT or ORDERed results</h4><p>This enhancement improves the efficiency of the on-disk merging operations so that the size of ORDERed or DISTINCT result sets is limited only by disk space and not by available RAM. </p><h4>Bug21531 - Non-simple EXISTS FILTERs could cause query failure</h4><p>AllegroGraph was incorrectly processing non-simple graph patterns in an EXISTS or NOT EXISTS FILTER. This meant that queries like </p>
<pre><code>SELECT * {  
   ...  
   FILTER( EXISTS { ... } ||  
           EXISTS { ... FILTER( ... ) } )  
} </code></pre><p>could cause an error rather than being correctly processing. This has been corrected. </p><h4>Bug21415 - Queries could return invalid solutions</h4><p>It was possible for solutions with no bindings for some of their variables to escape from the right-hand side of a join. This would cause too many solutions to be returned from the query. </p><p>This has been corrected. </p><h4>Bug21410 - Duplicate suppression not handling deleted triples correctly</h4><p>AllegroGraph was handling deleted triples improperly when duplicate suppression was enabled.  This has been corrected. </p><h4>Bug21407 - An error in a SELECT expression prevented processing of subsequent ones</h4><p>An error in a SELECT expression would prevent processing of the rest the expressions in the query for the current solution. For example, depending on the data, in a query like: </p>
<pre><code>SELECT  
        ?s  
        ?str  
        (STRAFTER(?str,"b"@cy) AS ?abcy)    # could cause a type error  
        (STRAFTER(?str,"ab") AS ?aab)  
WHERE {  
        ?s :str ?str  
} </code></pre><p>The evaluation of <code>STRAFTER()</code> with a second argument of "b"@cy could signal a type-error. AllegroGraph was stopping further computation at that point which meant that the binding for <code>?aab</code> could be left empty when it should not have been. </p><p>This has been corrected: now, each expression is computed separately. </p><h4>Bug21404 - Config file EOL format</h4><p>Previously, non-unix newlines (CR+LF, LF+CR) in the license section of the config file could prevent the server from starting up. This has been fixed and any mix of Unix, Mac and DOS style newlines is accepted. </p><h4>Bug21398 - Variables in EXISTS filter could be incorrectly bound</h4><p>It was possible for variables that appeared only in an EXISTS (or NOT EXISTS) filter to be incorrectly bound during query evaluation which could lead to incorrect results. </p><p>This has been corrected. </p><h4>Bug21390 - N-Triples serializer does not handle embedded angle brackets</h4><p>Even though valid URIs are not allowed to contain embedded angle brackets, it is still possible to add them to a triple-store. For example, the valid N-Triples file: </p>
<pre><code>&lt;ex://h&gt; &lt;ex://p&gt; &lt;ex://invalid\u003E&gt; </code></pre><p>would add a triple whose object is <code>ex://invalid&gt;</code>. </p><p>AllegroGraph was serializing such URIs without performing the necessary \u escaping which meant that the data exported could not be re-read by AllegroGraph's parsers. </p><p>This has been corrected. </p><p>Note that this was only a problem for data with invalid URIs. </p><h4>Bug21377 - Updates with both DELETE and INSERT</h4><p>Due to a race condition in a shared backends, updates that involved both DELETE and INSERT could produce bogus results. This bug has been fixed. </p><h4>Bug21376 - Wrong results with ORDER BY</h4><p>Due to a rare race, in shared backends, queries with ORDER BY could produce bogus results. This has been fixed. </p><h4>Bug21367 - Expressions in ORDER BY could cause query failure</h4><p>Queries with expressions in an ORDER BY could cause query failure during string look up. This bug was introduced in AllegroGraph v4.8 and is now corrected. </p><h4>Bug21349 - Eager evaluation of boolean FILTERS could lead to failures</h4><p>If a query used FILTERS consisting of boolean combinations of simpler filters and also used external variable bindings such that some of the FILTER clauses could be evaluated immediately, then it was possible for the FILTER evaluator to signal an error. </p><p>This has been corrected. </p><p>Note that bug21342 corrected this problem for the simpler case of negation. This bug fixes the more general case. </p><h4>Bug21345 - Possible problem with BIND inside of an OPTIONAL</h4><p>If a query included a BIND clause that stood by itself and there was a join, it was possible to lose the value of the binding. In particular, a query like </p>
<pre><code>SELECT * { ?a ?b ?c . OPTIONAL { bind('hello' as ?x } } </code></pre><p>could leave <code>?x</code> unbound. This has been corrected. </p><h4>Bug21344 - Bind could fail to use external variable bindings</h4><p>If a query used the BIND form and the value of the expression depended on variables set via an external binding (e.g., via the <code>with-variables</code> argument in the Lisp API or via HTTP parameters in the HTTP interface), then it was possible for the BIND expression to ignore those values. This has been corrected. </p><h4>Bug21342 - Eager evaluation in FILTERs can lead to problems using variables</h4><p>If a query uses a FILTER and also variable bindings such that an expression in the FILTER could be evaluated before actually running the query and if the expression was used in other boolean combinations (e.g., with <code>not</code>, <code>and</code>, or <code>or</code>), then it was possible for AllegroGraph to signal an error. For example, if the query was </p>
<pre><code>select * { ?a ?b ?c . FILTER( ! bound( ?d )) } </code></pre><p>and if <code>?d</code> was bound using a variable binding, then AllegroGraph would signal an error instead of correctly realizing that the FILTER could never succeed. </p><p>This has been corrected. </p><h4>Bug21341 - Non-simple IF statements could cause an error</h4><p>It was possible for non-simple IF statements in an expression to lose track of their variables which led to an error at query planning time. </p><p>This has been corrected. </p><h4>Bug21326 - Geospatial query failure</h4><p>Fixed a bug that, under rare circumstances, caused geospatial queries to fail with bus error. </p><h4>Bug21325 - Lost results in sub-queries and some joins</h4><p>When an internal buffer holding intermediate results was grown in a sub-query or in some joins, results could have been lost. This bug has been fixed. </p><h4>Bug21272 - No results with BIND</h4><p>Sometimes, as in the query below, instead of no results, a single result was returned when BIND was involved. </p>
<pre><code>select * {  
  bind('o' as ?c)  
  ?a ?b ?c .  
  ?d ?e ?f .  
  filter( ?a &lt; ?d &amp;&amp; ?d &lt; ?a )  
} </code></pre><p>This bug has been fixed. </p><h4>Bug21270 - Sub-queries with ORDER BY can fail to bind results</h4><p>Depending on the data and what other queries have been evaluated, a query that used an ORDER BY clause in a sub-query could fail to correctly bind the result variables. For example, a query like: </p>
<pre><code>select ?age {  
  { select ?age {  
        ?who &lt;http://people.example/age&gt; ?age .  
    } order by ?age  
  }  
} </code></pre><p>could return results but leave the bindings for <code>?age</code> unbound. </p><p>This has been corrected. </p><h4>Bug21260 - XPath Constructor Functions fail on strings to numbers</h4><p>The XPath Constructor Functions should convert typed string literals into the requested numeric type when the value of the string can be so coerced. For example: </p>
<pre><code>xs:int('2'^^xsd:string) ==&gt; 2 </code></pre><p>AllegroGraph was raising a type error in this case. This has been corrected. </p><h4>Bug21256 - Parser problem with some queries that mixed aggregation and sub-query</h4><p>AllegroGraph was incorrectly signaling a parser error on some queries that mixed aggregation and sub-query. For example, </p>
<pre><code>select (max(?a) as ?foo) {  
  select distinct ?a ?b {  
    ?a a ?c .  
    ?c a ?b .  
  }  
} </code></pre><p>This has been corrected. </p><h4>Bug21245 - Allegrograph's turtle parser performs URI normalization incorrectly</h4><p>Percent encoded URIs should not be unescaped when loading data in the Turtle format. AllegroGraph was incorrectly doing so. This has been corrected. </p><h4>Bug21243 - Non-QNameable URIs cause turtle serializer error</h4><p>If a triple contained a URI that could not be expressed as a QName, then the turtle serializer would signal an error that it could not split the URI rather than just emitting the entire URI and continuing. For example, a triple containing the URI &lt;&lt;ttp://example/&gt; would cause this error: </p>
<pre><code>Cannot split &lt;http://example/&gt; into XML QName. </code></pre><p>This has been corrected. </p><h4>Bug21226 - agload max blank node cache size not obeyed in all cases</h4><p>Agload could over-allocate memory in a certain case.  This has been fixed. </p><h4>Bug21215 - Improve cursor resource usage of Prolog SELECT queries</h4><p>AllegroGraph previously closed some of the cursors created while running a Prolog query lazily. It now closes them when the query completes which improves overall resource utilization. </p><h4>Bug20906 - Remove duplicate triples fails on a store with zero triples</h4><p>An error would be raised if duplicate deletion was attempted on a store with zero triples. </p><p>This has been corrected. </p><a name='header3-3135' id='header3-3135'></a><h3>HTTP Client</h3><h4>Rfe11755 - Add support for insert-graph-uri, remove-graph-uri, etc.</h4><p>Version 6 of the Sesame HTTP Protocol includes several graph parameters that can be used to control the behavior of SPARQL Update statements. These are: </p>
<ul>
<li><p>remove-graph-uri - the graph from which triples are deleted in a DELETE/INSERT/WHERE clause. </p></li>
<li><p>insert-graph-uri - the graph into which triples are added in a DELETE/INSERT/WHERE clause </p></li>
<li><p>using-graph-uri and using-named-graph-uri - these specify the dataset (similar to using-graph-uri and named-graph-uri in the HTTP protocol and to the from and from-named keyword arguments in the Lisp API's <code>run-sparql</code> command. </p></li></ul><p>These four parameters are now supported by AllegroGraph </p><h4>Rfe11743 - Add baseURI to the SPARQL HTTP Protocol</h4><p>The SPARQL HTTP protocol now accepts <code>baseURI</code> as an HTTP query request parameter. This can be used to shorten the rest of a SPARQL query. </p><h4>Bug21408 - Retrieving JSON statements over HTTP</h4><p>Fixed a bug that caused the statement list to be truncated when an 'application/json' encoded response was requested via the HTTP protocol. </p><h4>Bug21280 - Query failures cause spurious errors</h4><p>AllegroGraph 4.8 modified the internal API used to signal query failures (e.g., due to timeout or memory limits). Unfortunately, the code in the HTTP layer of AllegroGraph was not modified to accommodate the change which led to spurious bus errors when a query failed. This has been corrected. </p><a name='header3-3148' id='header3-3148'></a><h3>SPARQL</h3><h4>Rfe11862 - Match default dataset behavior for SPARQL Update and Query</h4><p>SPARQL Update was using a default dataset that contained only triples with unnamed graphs (the default graph in AllegroGraph terminology) in the FROM portion and put triples with graphs into each of their graphs in the FROM NAMED. This was different from the default dataset for SPARQL Query which put <em>all</em> of the triples into the FROM portion and treated the FROM NAMED portion similarly. </p><p>AllegroGraph now uses the same default dataset behavior for both Query and Update. This dataset is as described for query above. Note that this means that an Update command like </p>
<pre><code>DELETE DATA { &lt;eh://a&gt; &lt;eh://b&gt; &lt;eh://c&gt; } </code></pre><p>will delete the triples </p>
<pre><code>{ &lt;eh://a&gt; &lt;eh://b&gt; &lt;eh://c&gt; } </code></pre><p>from <em>every</em> graph in which it appears whereas the previous behavior would have been to delete it only from the default graph. </p><p>Note that triples added during an Update command which do not specify a graph will be added to the triple-store's default graph. </p><h4>Rfe11817 - SPARQL parser should signal an error on badly formed requests</h4><p>Previously, the SPARQL parser would silently accept nonsense queries like: </p>
<pre><code>&lt;http://www.foo.com&gt; &lt;http://www.bar.com&gt; 'banana' . </code></pre><p>because it would silently ignore tokens that came before the SPARQL prologue (i.e., before PREFIX and BASE) and convert such a query into an empty UPDATE request (i.e., a non-operation). </p><p>These queries will now signal a SPARQL parse error. Because the parser is now more strict, some queries that previously parsed may now signal an error.  For example, this invalid query was previously accepted and now will not be: </p>
<pre><code># WRONG: bad prefix because it ends with a period (".")  
PREFIX ex: &lt;http://example.com&gt; .  
SELECT * { ?s ex:testsFor ?o . }  
</code></pre><h4>Rfe11793 - Improve handling of numeric and date literal equality filters</h4><p>Improve the SPARQL 1.1 query planner's handling of numeric and date literal equality filters. In particular, AllegroGraph will now optimize queries with FILTER clauses like: </p>
<pre><code>?s ex:p1 ?o .  
FILTER( ?o = 3 ) </code></pre><p>which would previously have required a scan of all triples with predicate ex:p1. </p><h4>Rfe11787 -  Support SPARQL 1.1 UUID and STRUUID functions</h4><p>Adds support for the SPARQL 1.1 UUID() and STRUUID() functions. </p><h4>Rfe11779 - Support SPARQL 1.1 change to inline data syntax</h4><p>SPARQL 1.1 recently switched from a syntax for inline data that used <code>BINDINGS</code> to one that uses <code>VALUES</code>. The standard also made it possible to use inline data in more places. AllegroGraph now fully supports this feature and passes all of the Data Access Working Group (DAWG) tests for it. </p><p>Note that the BINDINGS syntax is still supported in this version of AllegroGraph. It will be deprecated and removed in some future release. </p><h4>Rfe11757 - Provide select-N strategy for ordered results with small limit</h4><p>Typically, a SPARQL query with an ORDER BY clause must accumulate all of the results before sorting them. If, however, the query has a small LIMIT, then it can be more efficient to retain the top LIMIT results and only sort those. </p><h4>Rfe11555 - Manage memory used to ensure unique results from CONSTRUCT and UPDATE</h4><p>The data structures AllegroGraph uses to ensure that results of a SPARQL CONSTRUCT or UPDATE are unique have been modified so that result sets can be processed correctly regardless of size (up to the amount of available disk space). </p><h4>Bug21401 - SPARQL Update must intern strings from variable bindings</h4><p>If variable bindings are used in a SPARQL Update query and these bindings are part of the template being used to insert new triples into the store, then the strings from the variable values must be added to the triple-store's string table. This was not being done which could lead to a UPI not in string table error. </p><p>This has been corrected. </p><h4>Bug21391 - Queries against in-memory-triple-stores could return incorrect results</h4><p>The Lisp SPARQL API allows for the creation of in-memory-triple-stores from CONSTRUCT and DESCRIBE queries. These suffered from a bug such that queries that specified more than two of subject, predicate, object and graph fields could return incorrect triples. As examples, a query like: </p>
<pre><code>ASK { ex:foo ex:bar ?o } </code></pre><p>would work correctly whereas a query like </p>
<pre><code>ASK { ex:foo ex:bar ex:baz } </code></pre><p>could return <code>yes</code> when it should have returned <code>no</code>. </p><p>This has been corrected. </p><h4>Bug21372 - Possible error when requesting <code>sparql-xml</code> output for Prolog <code>select</code></h4><p>An error could be signaled if the default query engine was <code>sparql-1.0</code> and a results format of <code>sparql-xml</code> was requested for a Prolog <code>select</code> query. </p><p>This has been corrected. </p><h4>Bug21371 - IF confusion with free variables</h4><p>SPARQL queries with free variables could produce incorrect results when using <code>IF</code>. For example, the following query </p>
<pre><code>SELECT ?result {  
  BIND( IF(!bound(?dataType), "first", "second") as ?result)  
} </code></pre><p>would return <code>second</code> instead of <code>first</code>. This occurred because the query engine was not correctly analyzing the free variable <code>?dataType</code> (this variable is <code>free</code> because the query provides not binding for it). </p><p>This has been corrected. </p><h4>Bug21361 - Improve SPARQL BASE URI handling</h4><p>AllegroGraph was not always correctly merging base and relative URIs. For example, a query like </p>
<pre><code>BASE &lt;http://localhost:8080/&gt;  
SELECT * { ?a ?b &lt;/&gt; } </code></pre><p>was being incorrectly run as if it was </p>
<pre><code>SELECT * { ?a ?b &lt;http://localhost:8080//&gt; } </code></pre><p>This and other similar issues have been corrected. </p><h4>Bug21357 - SPARQL blank-node parsing was too strict</h4><p>The SPARQL parser was not allowing the full range of blank node names to be used. Thus, queries like: </p>
<pre><code>SELECT * {  
  ?a ?b _:123 .  
  _:123 ?c _:fv-0 .  
} </code></pre><p>would fail to parse correctly. This has been corrected. </p><h4>Bug21354 - Update STRAFTER() and STRBEFORE() to match changes in the standard</h4><p>Recent changes to the SPARQL 1.1 standard changed the output of <code>STRAFTER()</code> and <code>STRBEFORE()</code> when no match is found. Previously, they were specified to return an empty literal with language or datatype that matched the first argument. Now they should produce an empty literal with neither language nor datatype. AllegroGraph now matches the standard. </p><h4>Bug21294 - Sparql XML results for ASK queries missing <code>head</code> clause</h4><p>The SPARQL XML generated by AllegroGraph was missing the <code>&lt;head/&gt;</code> clause. Since this clause is generally empty, only systems that validate the results against an external DTD were effected by the missing clause. </p><p>This has been corrected. </p><h4>Bug21277 - Improve cursor resource usage of SPARQL 1.1 queries</h4><p>AllegroGraph previously closed some of the cursors created while running SPARQL 1.1 queries lazily. It now closes them when the query completes which improves overall resource utilization. </p><h4>Bug21266 - Queries with only a geospatial clause could fail to gather solutions</h4><p>If a SPARQL query contained only a geospatial clause, then the SPARQL 1.1 engine could fail to add the solutions it found to the answer set. This has been corrected. </p><h4>Bug21249 - Incorrect return value of COPY GRAPH &lt;X&gt; TO GRAPH &lt;X&gt;</h4><p>A SPARQL Update statement like </p>
<pre><code>COPY DEFAULT TO DEFAULT </code></pre><p>should have no effect on the triple-store and should succeed. AllegroGraph implemented the behavior correctly but was returning failure instead of success. This has been corrected. </p><h4>Bug21239 - Concurrent queries in shared backends</h4><p>With the sparql-1.1 engine, queries running in the same shared backend concurrently had unexpected interactions that lead to various errors. This has been fixed. </p><h4>Bug21237 - Computations in aggregate expressions could fail</h4><p>If a complex expression was used inside of a SPARQL aggregation function, the value could be left unbound. A work-around was to express </p>
<pre><code>(min(2 * ?x) as ?smallestDoubled) </code></pre><p>as </p>
<pre><code>(min(?x) as ?smallest) (2*?x as ?smallestDoubled) </code></pre><p>This is now corrected and the work-around is no longer necessary. </p><h4>Bug21233 - SPIN functions could fail when used with constants</h4><p>SPARQL queries that used SPIN functions could fail if the arguments to the functions were constants not already in a triple-store's string-table. This has been corrected. </p><h4>Bug21222 - Failing SPARQL UPDATE HTTP request should error</h4><p>Previously SPARQL UPDATE requests that failed would return <code>false</code> in SPARQL/XML format. In order to be better conform with other SPARQL endpoints, AllegroGraph now returns a 412 status code (precondition failed) instead. </p><h4>Bug21163 - Add new default-dataset-behavior: rdf</h4><p>SPARQL leaves things up to the implementation when no explicit dataset is specified (i.e., when no FROM or FROM NAMED clauses are part of the query). AllegroGraph now provides three choices for dataset behavior: </p>
<ul>
<li><p><code>:all</code> - All triples will be in the FROM portion of the dataset. Triples with a non-default graph will be in that graph. Note that this means that triples with non-default graph slots will appear in the dataset twice: once in a named graph (named by their graph slot) and again in the default graph of the dataset. </p></li>
<li><p><code>:default</code> - Only triples whose graph is the default graph of the triple-store will be in the default graph of the dataset. No triples will be in the named graph portion of the dataset. </p></li>
<li><p><code>:rdf</code> - Only triples whose graph is the default graph of the triple-store will be in the default graph of the dataset. Triples with a non-default graph slots will be in the named graph portion of the dataset (each non-default graph triple will be in a graph named by the graph of that triple). </p></li></ul><p>AllegroGraph's standard behavior continues to be :all. You can change this on a per-query basis using the defaultDatasetBehavior query option: </p>
<pre><code>PREFIX franzOption_defaultDatasetBehavior: &lt;franz:rdf&gt;  
</code></pre><a name='header3-3236' id='header3-3236'></a><h3>AGWebView</h3><h4>Rfe11910 - Add HTTP handlers for materialization</h4><p>Added the materializeEntailed service. </p><p>A PUT request will materialize entailed triples based on the with, without, useTypeSubproperty, and commit query parameters. </p><p>A DELETE request will remove the materialized triples. </p><h4>Rfe11856 - WebView - new UI Beta for Graph</h4><p>In WebView next to the Documentation menu is a link to "WebView Beta" a new experimental UI for Query and Graph. A link at the top will returns to the classic WebView. </p><p>A link at the top will open the new Graph View UI. </p><p>Also Node queries have a View menu in the results to open the node in Graph view. </p><p>Administration features of WebView are not yet included within the new UI. </p><h4>Rfe11676 - Webview: in Scripts editor, use CodeMirror JavaScript</h4><p>The WebView Scripts editor now supports syntax highlighting and indentation by including the CodeMirror JavaScript mode. </p><h4>rfe11596 - WebView: new UI Beta for Query</h4><p>In WebView next to the Documentation menu is a link to <strong>WebView Beta</strong> a new experimental User Interface (UI) for Query. The new UI provides a modern style and easier navigation. A link at the top will returns to the classic WebView. </p><p>All existing features of WebView Query are implemented: </p>
<ul>
<li>select repo</li>
<li>query sparql</li>
<li>query prolog</li>
<li>free text search (pattern or expression)</li>
<li>namespaces</li>
<li>save and delete any of the above to user or repo areas</li>
<li>recent queries</li>
<li>example queries</li>
<li>click node in results goes to new query screen</li>
<li>download query results</li>
<li>sessions (and functors)</li></ul><p>Administration features of WebView are not yet included within the new UI. </p><h4>Rfe11582 - Webview: upgrade Query Editor to CodeMirror v2.32</h4><p>The query editor for SPARQL and Prolog, implemented by CodeMirror, has been upgraded from v2.24 to v2.32. </p><h4>Bug21250 - Webview: remove limit from download</h4><p>The download link for Query results no longer uses the limit parameter in the query UI. </p><a name='header3-3267' id='header3-3267'></a><h3>Changes to the Lisp API</h3><h4>Rfe11454 - <code>get-triples-list</code> (Lisp API) returns cursor only on request</h4><p>The Lisp <code>get-triples-list</code> function previously returned the cursor it created as a second value. Now, however, it returns a cursor if either one was passed in initially (using the <code>cursor</code> keyword argument) or if the new keyword argument <code>return-cursor</code> is true. </p><h4>Bug21381 - (Lisp API) SPARQL introspection functions required engine argument</h4><p>The functions <code>get-allowed-results-formats</code> and <code>get-allowed-rdf-formats</code> returned <code>nil</code> if no query engine was provided. This has been corrected. </p><h4>Bug21378 - (Lisp API) sparql-1.1 engine does not implement destination-db</h4><p>The Lisp API allows SPARQL Update commands to specify the triple-store that they modify. This feature was not included in the sparql-1.1 engine. This has been corrected. </p><a name='header3-3274' id='header3-3274'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-3276' id='header3-3276'></a><h3>Python Client</h3><h4>Rfe11911 - Add materializer calls to python client</h4><p>Added materializeEntailed and deleteMaterialized calls to RepositoryConnection. </p><a name='header3-3279' id='header3-3279'></a><h3>Java Client</h3><h4>Rfe11906 - Java support for the materializer</h4><p>With this change, the Java client now supports materialization, allowing inferences to be generated and added to a repository in a transactional fashion.  See the Javadoc for AGMaterializer#newInstance() to acquire a configurable materializer, and AGRepositoryConnection#materialize to run the materializer. </p><h4>Rfe11771 - Upgrade embedded JavaScript implementation</h4><p>Fixes several small bugs in the way uploaded JavaScript scripts are interpreted. The most visible one was that the !== operator was acting like the &lt; operator. </p><h4>Rfe11241 - Support more query/update protocol params</h4><p>With this change, the Java client now sends HTTP protocol params for update, baseURI, timeout, remove-graph-uri, insert-graph-uri, using-graph-uri, using-named-graph-uri, and logQuery. </p><a name='header2-3286' id='header2-3286'></a><h2>AllegroGraph 4.8</h2><a name='header3-3287' id='header3-3287'></a><h3>Server Changes</h3><h4>Rfe11711 - Improve cursor resource usage of Geospatial Prolog queries</h4><p>AllegroGraph previously closed cursors created while running a Prolog geospatial query lazily. It now closes them when the query completes which improves overall resource utilization. </p><h4>Rfe11653 - Rm requests can be processed out of order</h4><p>The order in which file management requests were processed caused unexpected errors under heavy load.  The bug is now fixed. </p><h4>Rfe11649 - Manage memory for ORDER BY and DISTINCT queries</h4><p>Previously AllegroGraph needed to accumulate all results in memory for queries that used DISTINCT or ORDER BY. This could greatly increase the overall memory footprint. AllegroGraph now handles large result sets in available memory. </p><h4>Rfe11631 - Improve query optimizer when inference is enabled</h4><p>One part of query optimization is reordering the triple-patterns in each BGP. This reordering is based on the statistics collected by the store and these statistics do not take inference into account. This meant that the plan produced could be quite bad. </p><p>This has been corrected by modifying the estimation code to take RDFS++ into account. </p><h4>Rfe11416 - Provide greater control of query memory usage</h4><p>Added a <code>memoryLimit</code> query option that controls how much memory a query can use. If a query needs to allocate more memory than this value, it will fail. </p><h4>Bug21235 - Resource manager sync-files effectively ignores msync errors</h4><p>If the filesystem on which a database resided filled up during a checkpoint, this fact was logged but the checkpoint process would continue running as if the error didn't happen, which would result in database corruption. This bug has been fixed. Now when a full filesystem is detected during a checkpoint, AllegroGraph stops operating in order to protect committed data. </p><h4>Bug21224 - Crashes while processing queries with DISTINCT</h4><p>Under rare circumstances, the internal data structures used while processing DISTINCT queries could get corrupted leading to segmentation faults. This bug has been fixed. </p><h4>Bug21214 - Correct scope of BINDings introduced on the LHS of union</h4><p>The binding of a variable on the left-hand side of a UNION should not influence its value on the right-hand side. For example, the following query should produce two rows with <code>?a</code> bound to 1 in one of them and left unbound in the other. </p>
<pre><code>select ?a {  
  { bind(1 as ?a) } union { bind(2 as ?b) }  
} </code></pre><p>AllegroGraph was retaining the binding on the LHS across to the RHS of the union and so was answering with two rows each of which had <code>?a</code> bound to 1. This has been corrected. </p><h4>Bug21187 - Stack exhaustion with shared cursor</h4><p>With lots of deleted triples a query could run out of stack when creating cursors. This has been fixed. </p><h4>Bug21182 - Unbound values in distinct aggregrates could lose results</h4><p>If a variable binding used in a distinct aggregate was unbound, it could cause other aggregrates in the same row to fail to update properly. For example, a query like: </p>
<pre><code>SELECT (count( distinct ?taste) as ?tasteCount ) (count(?who) as ?whoCount) {  
	   ?who &lt;http://people.example/age&gt; ?age .  
	   OPTIONAL { ?who &lt;http://people.example/taste&gt; ?taste . }  
} </code></pre><p>could lose data for the ?whoCount bindings if the ?taste binding from the OPTIONAL was unbound. This has been corrected. </p><h4>Bug21145 - agload: message corrected for insufficient buffer size</h4><p>The error message for insufficient ntriples/nquads buffer size was reporting buffer as size -1.  This message has been corrected and now reports actual buffer size in order to abate confusion about the condition. </p><p>Note: This condition is usually triggered when an ntriple of greater than 4MB is encountered while using the default dispatch strategy. </p><h4>Bug21136 - Free BGP patterns can lead to very large memory allocation requests</h4><p>Queries with free patterns (like ?s ?p ?o) in a BGP on the right-hand side of a query could lead the query size estimator to believe that it should reserve a very large space to save the putative result set. For example, a query like </p>
<pre><code>SELECT ?s WHERE {  
    { ?s ?p ?o }  
    MINUS  
    { ?other ?p ?o . ?other ?someProp ?s }  
} </code></pre><p>would lead the query engine to try and allocate 1024-Petabytes. This has been corrected. </p><h4>Bug21124 - Zero length path between non-matching constants</h4><p>AllegroGraph was incorrectly finding a path between two different constants which led to queries like the following to return a single (empty) result when they should have returned no results at all. </p>
<pre><code>select * {  
  ex:one ex:connectsTo{0} ex:two .  
} </code></pre><p>This has been corrected. Other zero-length path queries were behaving correctly. </p><h4>Bug20853 - Updated the soundex algorithm</h4><p>AllegroGraph's freetext indexing word filter was using an older variant of the Soundex algorithm that did not match the latest version (cf. http://www.archives.gov/research/census/soundex.html). The algorithm has now been updated. </p><p>Freetext indices created with the soundex word-filter should be dropped and re-built. </p><a name='header3-3327' id='header3-3327'></a><h3>HTTP Client</h3><h4>Rfe11681 - HTTP: Allow statements queries using the POST method</h4><p>Add a [store]/statements/query URL that corresponds to /statements, except that it isn't limited to the GET method, and thus can be used to do complex queries without building up overlong URLs. </p><h4>Rfe11680 - HTTP: Add /unique/[column] service</h4><p>Add a [store]/unique/[column] URL that allows clients to fetch the set of unique parts that occur in a column in the database, optionally restricting other columns. </p><a name='header3-3332' id='header3-3332'></a><h3>SPARQL</h3><h4>Rfe11682 - Improve performance of SPARQL OPTIONAL queries</h4><p>If a query has the form <code>A OPTIONAL B</code> (where A and B share variables so that it is a join) and the A part has no rows, then it is not necessary to evaluate the B part at all. </p><p>The SPARQL 1.1 query engine now recognizes this situation and skips the evaluation of the right-hand side. </p><h4>Rfe11591 - Modified the Lisp run-sparql API to better handle query failure (e.g., for when a query runs out of time or other system resources). </h4><p>Previously <code>run-sparql</code> would return (as multiple values): </p>
<ul>
<li>the results of the query (or nil if the results were streamed)</li>
<li>the verb of the query (e.g., :select or :construct)</li>
<li>the list of variables</li></ul><p>Now <code>run-sparql</code> returns four values. In normal execution, the first three values are the same and the fourth value will be nil. When a query fails, the results will be: </p>
<ul>
<li>a keyword indicating why the query failed (e.g., :timeout)</li>
<li>the verb</li>
<li>the variables</li>
<li>a property list of additional information (the properties   will vary depending on the failure). </li></ul><p>Code that requests a cursor should be prepared to handle a condition of type db.agraph.query.base:cancel-query-condition. </p><h4>Rfe11581 - handle repeated Prologues in SPARQL UPDATE queries</h4><p>SPARQL 1.1 UPDATE allows the Prologue (BASE and PREFIX definitions) to be repeated between each UPDATE command. Previously, AllegroGraph only allowed BASE and PREFIX to be used at the beginning of a SPARQL statement. This is now corrected. </p><h4>Rfe11559 - Add logQuery parameter to the HTTP SPARQL protocol</h4><p>SPARQL queries can now use the logQuery parameter in their HTTP requests. The parameter can be set to one of: </p>
<ul>
<li>false - no logging is reported</li>
<li>true  - log information is sent back in the body of the   response (using text/plain). </li>
<li>log   - log information is added to the AllegroGraph log   file. </li></ul><p>The log output can be cryptic; please contact Franz Inc. for support in interpreting the messages. </p><h4>Bug21220: SPARQL Update LOAD should require only write permission (not eval)</h4><p>A user would need to have <code>evaluate</code> permission on a triple-store in order to use SPARQL Update's LOAD command to load data from a file. This has been changed so that having <code>write</code> permission is sufficient. </p><h4>Bug21203 - SPARQL Update insert data fails to treat blank nodes correctly</h4><p>The INSERT DATA and MODIFY SPARQL Update commands failed to use the small blank node identifier in the INSERT template. This caused multiple blank nodes to be created when there should have been only one. </p><h4>Bug21192 - Upi not in string table error when mixing BIND, SPARQL Update and FTI</h4><p>SPARQL Update queries that produced new strings (e.g., using BIND) on a triple-store with free-text indexing turned would lead to UPI not in string table errors. Note that in this case a triple would have been added to the store but its strings would not be added to the string table which could cause subsequent queries to fail until the errant triple was removed. </p><p>This has been corrected. </p><h4>Bug21168 - Support SPARQL 1.1 COUNT(DISTINCT *)</h4><p>The SPARQL 1.1 query engine was not correctly handling the <code>COUNT(DISTINCT *)</code> form. This has been corrected. </p><a name='header3-3364' id='header3-3364'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-3366' id='header3-3366'></a><h3>Changes to the Lisp API</h3><p>No significant changes. </p><a name='header3-3368' id='header3-3368'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-3370' id='header3-3370'></a><h3>Python Client</h3><h4>Rfe11697 - Added RepositoryConnection.prepareUpdate</h4><p>Added RepositoryConnection.prepareUpdate for SPARQL 1.1 Update requests. The call to evaluate on the returned UpdateQuery object returns True or False. </p><a name='header3-3373' id='header3-3373'></a><h3>Java Client</h3><p>Rfe11748 - Upgrade to sesame 2.6.8 </p><p>With this change, the Java client has been upgraded to use openrdf sesame 2.6.8 jars. </p><h4>Rfe11243 - Support X.509 authentication</h4><p>With this change, the Java client now supports X.509 server and client authentication.  For set up details, see the javadoc for AGServer. </p><h4>Bug21225 - With no requestEntity, post using setRequestBody</h4><p>Previously, AGHTTPClient post method used setQueryString to pass params when there was no requestEntity provided. This burdened the server when a param became very large. Now params are passed using setRequestBody when no requestEntity has been provided. </p><a name='header2-3380' id='header2-3380'></a><h2>AllegroGraph 4.7</h2><a name='header3-3381' id='header3-3381'></a><h3>Server Changes</h3><h4>Rfe11587 - Change InstanceTimeout defaults</h4><p>The configure-agraph script now supports instance timeouts in interactive mode and via the <code>--instance-timeout</code> command line option. It defaults to one week. </p><p>Also, the default value the InstanceTimeout configuration directive (effective when there is no global or catalog level InstanceTimeout) has been changed from 0 (= disabled) to one hour. </p><h4>Rfe11536 - Transitive inference queries could be slow</h4><p>The RDFS++ reasoning for transitive queries could be slower than necessary for some datasets. The code has been reimplemented to be significantly faster. </p><h4>Rfe11285 - Improve query constraint analysis</h4><p>AllegroGraph now does a better job of applying filter constraints throughout a query. For example, previous versions of AllegroGraph would not have transformed either of the two BGPs (on either side of UNION) into range queries (which are more efficient). </p>
<pre><code>SELECT * {  
  ?a ex:d ?c .  
  { ?a ex:b ?c . } UNION { ?a ex:c ?c . }  
  FILTER (?c &gt; 2)  
} </code></pre><p>Now it will. </p><h4>Bug21114 - Instances lingering too long</h4><p>Instances with non-zero InstanceTimeout only timed out when there was activity involving the service daemon. This has been corrected. Instances with an InstanceTimeout of zero (the default) are not affected. </p><h4>Bug21094 - Queries against federations could signal UPI-not-in-string-table errors</h4><p>It was possible for queries against federated triple-stores to lead to UPI-not-in-string-table errors. This has been corrected. </p><h4>Bug21089 - agload division by 0</h4><p>Progress reporting failed with division by 0 if the operation completed within 1ms. </p><h4>Bug21077 - Expressions can be analyzed too eagerly</h4><p>It was possible for constant expressions to be analyzed to their final values too quickly which could lead to an error if the expressions were used in a BIND. For example, this query would fail: </p>
<pre><code>select * { bind(str('hello') as ?x } </code></pre><p>rather than producing a single binding of <code>?x</code> to the string <code>hello</code>. This has been corrected. </p><h4>Bug21069 - A warm-standby client now exits non-zero if error occurs during commit replay</h4><p>Replication secondary (warm-standby client) now exits non-zero if error occurs during commit replay.  This is to ensure transactional behavior in the replica. </p><h4>Bug21059 - Improve efficiency of all predicates cache when RDFS++ is enabled</h4><p>The query engine keeps track of the predicates in the triple-store to optimize queries which contain clauses where the predicate position is a variable. If RDFS++ was enabled and the cache was not already fresh, then AllegroGraph would try to find all of the store's predicates with reasoning enabled. Since new predicates cannot be inferred, this could be hugely inefficient. This has been corrected. </p><h4>Bug21057 - Fix log rotation causing crashes</h4><p>When the SIGHUP handler closes a log stream, attempts to log could fail with a 'stream closed' error potentially crashing the server. This bug has been fixed. </p><h4>Bug21040 - Turtle data import should use UTF-8 encoding</h4><p>The Turtle specification mandates that Turtle files are encoded using UTF-8. AllegroGraph was not enforcing this in all cases which could mangle Unicode data on import. This has been corrected. </p><h4>Bug21022 - Group expressions with unbound elements could be dropped</h4><p>AllegroGraph could lose rows in a aggregation query if the GROUP BY expression resulted in unbound columns. This has been corrected. </p><h4>Bug21008 - Correct XSD datatype for certain division operations</h4><p>When performing division of two xsd:integers or two xsd:decimals, AllegroGraph was emitting the result as an xsd:float rather than an xsd:decimal. This has been corrected. </p><h4>Bug21007 - Error creating a session with non-default graph for inferred triples</h4><p>The syntax for starting a reasoning session that uses a different graph for its inferred triples is </p>
<pre><code>&lt;store&gt;[rdfs++#&lt;graph&gt;] </code></pre><p>AllegroGraph was failing to parse this specification correctly and signaled an error instead. This has now been corrected. </p><a name='header3-3417' id='header3-3417'></a><h3>HTTP Client</h3><h4>Rfe11601 - HTTP and WebView: MongoDB interface config</h4><p>Added resources to HTTP protocol for MongoDB parameters: </p>
<pre><code>GET /repositories/[name]/mongoParameters  
POST /repositories/[name]/mongoParameters </code></pre><p>See <a href="mongo-interface.html">Mongo Interface</a>, <a href="http-protocol.html">The HTTP Protocol</a>, <a href="http-protocol.html#get-mongoParameters">GET mongoParameters</a>, and <a href="http-protocol.html#post-mongoParameters">POST mongoParameters</a>. </p><a name='sparqlchanges' id='sparqlchanges'></a> <h3>SPARQL</h3><h4>Rfe11558 - Add query logging support</h4><p>To add in query debugging and tuning, SPARQL queries using the 1.1 query engine can now be logged to the AllegroGraph log file. To log a query, use the prefix option notation by pre-pending this prefix to your query: </p>
<pre><code>prefix franzOption_logQuery: &lt;franz:yes&gt; </code></pre><p>The log output will go directly to the AllegroGraph log. In this release, the output is relatively cryptic. Please consult with Franz (support@franz.com) to interpret the data. </p><h4>Rfe11492 - Add support for SPARQL CSV and TSV</h4><p>Added CSV (comma separated values) and TSV (tab separated values) as native SPARQL output formats. Also corrected problems with using CSV output on result sets with unbound values. </p><h4>Rfe11486, Rfe11538 - improve SPARQL 1.1 engine geospatial integration</h4><p>The SPARQL 1.1 query engine did not implement the POINT extension for SPARQL FILTER functions so that queries like: </p>
<pre><code>SELECT * {  
   ...  
} ORDER BY geo:haversine-km(?loc,POINT(105.842328, 21.0184040)) </code></pre><p>would fail. This has been corrected. Additionally, the geospatial query analyzer has been improved so that more computations are carried out at query analysis time rather than at query execution time. This can speed up some geospatial queries tremendously. </p><h4>Bug21117 - Some SPARQL 1.1 path queries could parse incorrectly</h4><p>The SPARQL 1.1 parser could combine some combinations of alternation and sequences incorrectly. For example, this query </p>
<pre><code>SELECT ?xxx ?yyy {  
    ?xxx (dc:aaa|dc:bbb/dc:ccc) ?yyy .  
} </code></pre><p>would have been parsed as if it read (dc:aaa|dc:bbb|dc:ccc). This has been corrected. </p><h4>Bug21093 - SPARQL UPDATEs could fail to save newly created strings</h4><p>If run with chunkProcessingAllowed, a SPARQL UPDATE query that generated new strings could fail to save some of these new strings in the underlying triple-store. This has been corrected. </p><h4>Bug21082 - Optional cross-product with no bindings could fail</h4><p>If the final step of a query was a LEFT-JOIN and that LEFT-JOIN was also a cross-product (i.e., the right hand side shared no variables with the left hand side) and the right hand side produced no bindings of its own (e.g., it was all constant or its variables could be elided because they were not used anywhere else in the query), then it was possible for AllegroGraph to incorrectly remove answers. This has been corrected. </p><h4>Bug21078, bug21083 - Handle sub-query SELECT expresions and filters correctly</h4><p>SELECT expressions in sub-queries were not being handled correctly by AllegroGraph. This has been corrected so that queries like </p>
<pre><code>SELECT ?a (?a * 2 as ?b) ?c ?d {  
  BIND(1 as ?a)  
  { SELECT ?c (2* ?c as ?d) {  
    BIND(20 as ?c)  
  } }  
} </code></pre><p>now perform properly. </p><p>It was also possible for AllegroGraph to incorrectly optimize FILTER expressions in sub-queries that returned all variables (*). This too has been corrected. </p><h4>Bug21072 - unused variable check could remove variables in EXISTS filters</h4><p>The SPARQL 1.1 query planner removes variables that are not used in the query from the set of bindings maintained during query execution. Unfortunately, the check to see whether or not a variable was used could fail to properly descend into EXISTS (and NOT EXISTS) filters. For example, the following query would have failed: </p>
<pre><code>PREFIX :    &lt;http://example/&gt;  
PREFIX  rdf:    &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;  
SELECT DISTINCT (?s1 AS ?subset) (?s2 AS ?superset)  
WHERE  
{  
        ?s1 rdf:type :Set .  
        ?s2 rdf:type :Set .  
        ?s1 :member ?x .  
        FILTER ( ?s1 = ?s2 || NOT EXISTS { ?s2 :member ?x . } )  
} </code></pre><p>This has been corrected. </p><h4>Bug21064 - Unneeded graph variables with DISTINCT query could error</h4><p>If the variable in a GRAPH clause was not needed by the query (because, e.g., the query asks for DISTINCT results and the graph variable is not used anywhere else in the query), then the query planner will remove the variable from the plan. Unfortunately, the query executor could still try to assign a value to the graph variable which would lead to an error at query execution time. This has been corrected. </p><h4>Bug21046 - Multiple MINUS clauses could lead to query execution error</h4><p>A SPARQL query with multiple MINUS clauses could cause the SPARQL 1.1 query engine to incorrectly determine the variables on which to join the clauses. For example, this query would fail: </p>
<pre><code>SELECT (?s1 AS ?subset) (?s2 AS ?superset) {  
    # All pairs of sets  
    ?s2 rdf:type :Set .  
    ?s1 rdf:type :Set .  
 
    MINUS {  
        ?s1 rdf:type :Set .  
        ?s2 rdf:type :Set .  
        # Assumes ?s1 has at least one member  
        ?s1 :member ?x .  
        # If we want to exclude A as a subset of A.  
        # This is not perfect as "?s1 = ?s2" is not a  
        # contents based comparison.  
        FILTER ( ?s1 = ?s2 || NOT EXISTS { ?s2 :member ?x . } )  
    }  
    MINUS {  
        # If we don't want the empty set being a subset of itself.  
        ?s1 rdf:type :Set .  
        ?s2 rdf:type :Set .  
        # Choose the pair (empty set, empty set)  
        FILTER ( NOT EXISTS { ?s1 :member ?y . } )  
        FILTER ( NOT EXISTS { ?s2 :member ?y . } )  
    }  
} </code></pre><p>This has been corrected. </p><h4>Bug21037 - Construct queries with Turtle results format can cause string lookup error</h4><p>If a SPARQL CONSTRUCT query used expressions to create strings that were not already in the underlying triple-store and if the RDF format requested with Turtle, then a <code>UPI not in string table error</code> could be generated. This has been corrected. </p><p>Note that the other RDF formats do not exhibit this behavior. </p><h4>Bug21031 - Remove unstable optimization</h4><p>The SPARQL 1.1 query engine attempted to reduce the amount of work needed to evaluate certain joins. Unfortunately, it was possible to create queries that exposed a conflict between this optimization and other optimizations which would lead to an error at query evaluation time. This optimization has been temporarily removed. It will be added again once the conflicts it exposed have been resolved. </p><h4>Bug21023 - Correct datatype of the seconds() function</h4><p>The SPARQL 1.1 seconds() function should return a value of type xsd:decimal but AllegroGraph was returning xsd:float. This has been corrected. </p><p>The date and time functions (like month() and seconds()) were also not behaving correctly on literals of type xsd:time. This has been corrected. </p><h4>Bug21019 - Filter EXISTS with fixed triple patterns could fail</h4><p>If a SPARQL query used FILTER (NOT) EXISTS and the EXISTS clause contained fixed triple-patterns, then AllegroGraph could signal an error. For example, this query would fail: </p>
<pre><code>SELECT * {  
  ?a a ex:Fruit .  
  FILTER EXISTS { ex:apple a ex:Plant . }  
} </code></pre><p>This has been corrected. </p><h4>Bug21016 - UPDATE with blank nodes could lead to error</h4><p>A SPARQL UPDATE query that included blank nodes in the INSERT template could lead to an error. This has been corrected. </p><h4>Bug20994 - Correct (in)equality test between plain and typed literals</h4><p>Some comparisons between plain literals and typed literals could return false rather than signaling a SPARQL type error. This meant that a FILTER that tested for (in)equality could succeed where it should have failed. This has been corrected. </p><h4>Bug20840 - Improve comparisons between xsd:dates and xsd:dateTimes</h4><p>The SPARQL operator mapping table is quite strict in the sort of comparisons that are allowed. AllegroGraph was allowing inequality comparisons between xsd:dates and xsd:dateTimes even though these datatypes are not strictly comparable. These sort of comparisons will now signal a type error leading FILTER conditions to fail. I.e., a query like </p>
<pre><code>... FILTER ( ?aDate &gt; ?aDateTime ) ... </code></pre><p>will now fail (correctly) even though it may have resulted in results previously. </p><h4>Bug20736 - Federated-triple-stores can fail to find equivalent literals</h4><p>In SPARQL filters, typed-literal equality is based on the value of the literal, not its lexical form. I.e., these literals are all the same: </p>
<ul>
<li>'4'^^xsd:byte</li>
<li>'4'^^xsd:long</li>
<li>'4'^^xsd:unsignedByte</li></ul><p>To reduce the amount of work during query execution, the SPARQL engine checks to see whether any triples exist with literals of these (encoded) types. This check was being handled incorrectly for federated triple-stores which could lead to answers being left out of federated result sets. This has now been corrected. </p><h4>Bug20770, Bug21020 - improve SPARQL 1.1 aggregation support</h4><p>SPARQL 1.1. allows assignment in a GROUP BY clause. For example: </p>
<pre><code>... GROUP BY (str(?name) as  ?theName) ... </code></pre><p>AllegroGraph did not allow for this syntax and required the work-around of: </p>
<pre><code>... BIND(str(?name) as ?theName) ... } GROUP BY ?theName ... </code></pre><p>This omission has been filled. </p><p>Secondly, AllegroGraph did not allow aggregate expressions in the HAVING clause or SELECT expression involving more than one aggregate. For example, these queries would fail: </p>
<pre><code>SELECT (avg(?value) as ?avg) ((min(?value) + max(?value)) / 2 as ?half {  
  ...  
} </code></pre><p>and </p>
<pre><code>SELECT * {  
  ...  
}  
group by ?value  
having(sum(?value) &gt; 20) </code></pre><p>Both of these omissions have also been corrected. </p><h4>Bug20165 - Unnecessary variable in a BIND clause could cause error</h4><p>If the variable in a BIND clause was not needed by the query (because, e.g., the query asks for DISTINCT results and the variable is not used anywhere else), then the query planner will remove the variable from the plan. Unfortunately, the query executor could still try to assign a value to the variable which would lead to an error at query execution time. This has been corrected. </p><a name='header3-3496' id='header3-3496'></a><h3>AGWebView</h3><h4>Rfe11601 - MongoDB interface config</h4><p>Added support in WebView for setting MongoDB parameters, in the Repository Overview page. See <a href="mongo-interface.html">Mongo Interface</a>. </p><h4>Rfe11557 - WebView: serve doc files</h4><p>AllegroGraph documentation, a collection of HTML files installed with the server, is now served by WebView, and the Documentation menu in WebView links to these local files in addition to those on franz.com. </p><h4>Rfe11474 - Execute query without changing text</h4><p>In the Query editor, a query may now be executed without editing the text. </p><h4>Rfe11398 - Update query editor to CodeMirror v2.24</h4><p>The query editor for SPARQL and Prolog, implemented by CodeMirror, has been upgraded from v2.15 to v2.24, including javascript and css. </p><h4>Bug21085 - Webview: Recent queries should not add items redundantly</h4><p>WebView Recent Queries now keeps the most recently used queries. If a previous query (including the same planner and limit) is repeated, that query is moved to the top of Recent Queries, with the number remaining the same. Limit and planner are displayed on the Recent Queries page. </p><h4>Bug21062 - Recent queries in multiple browser tabs</h4><p>Using WebView in multiple tabs of a browser caused a javascript error leading to a blank screen below the menu. This has been fixed by consistently using localStorage. </p><p>Note for using multiple browser tabs/windows: the last tab to execute query will overwrite localStorage of "recent queries" that will be seen if a new browser tab is opened. </p><h4>Bug21050 - WebView: CodeMirror Query editor steals arrow keys</h4><p>When the cursor is in Query Editor, Alt-LeftArrow and Alt-RightArrow will now perform the default browser behavior instead of navigating within the editor page. </p><h4>Bug21036 - Editor empty after 40 recent queries</h4><p>WebView holds up to 40 recent queries, but incorrectly restored the text when more than 40 were made. This is fixed. </p><p>Note that logout and login will clear the list of recent queries. </p><h4>Bug20998 - Webview: failures in IE7</h4><p>Many links to navigate between WebView pages did not work in Internet Explorer 7 (IE7) due to usage of browser history. In the Query editor page, limit and planner options did not take effect in IE7. These problems have been fixed. </p><h4>Bug20982 - Query limit and planner selections ignored</h4><p>In the Query editor screen, the limit and planner selections were ignored. Now, they are both used for Execute and Download. Also, they will remain set after Execute, and following a link from the Recent Queries page will remember these settings for that query (but they are not stored for a Saved Query). </p><a name='header3-3519' id='header3-3519'></a><h3>Changes to the Lisp API</h3><h4>Bug21042, Bug21043 - standardize remote-triple-store SPARQL cursors</h4><p>The cursors returned by <a href="sparql-reference.html#run-sparql" title="description of run-sparql">run-sparql</a> for <code>remote-triple-store</code>s behaved differently from ones returned for other triple-store classes. In particular, SELECT queries could not request a results-format of :cursor and the rows returned by cursors were lists of bindings rather than arrays of bindings. </p><p>The cursors for <code>remote-triple-store</code>s are now standardized to behave in the same way as cursors in the rest of AllegroGraph. This item is repeated above under <strong><em>AllegroGraph Server: General Changes</em></strong>, where it is also pointed out this applies to Lisp clients only. </p><h4>Bug20067 - Make session ping threads more resilient</h4><p>Remote clients ping their sessions to keep them from timing out on the server. Intermittent network errors could cause the ping thread to fail. This fix makes pinging attempts continue until the session timeout passes without successful pings. </p><a name='header3-3525' id='header3-3525'></a><h3>Documentation</h3><h4>Bug21080 - Doc layout bad in IE intranet-mode</h4><p>AllegroGraph docs now use html5 doctype and style.  For Internet Explorer (IE), the highest mode available will be used because IE7 layout is not optimal. </p><a name='header3-3528' id='header3-3528'></a><h3>Python Client</h3><a name='pythonx509' id='pythonx509'></a> <h4>Rfe11244: Python Support for client X.509 certificate authentication</h4><p>To support X.509 certificate authentication with SSL, AllegroGraphServer objects now have <em>cainfo</em> and <em>sslcert</em> keyword arguments for indicating the client security information. <em>verifyhost</em> and <em>verifypeer</em> can also be used. </p><p>These arguments correspond to the pycurl.CAINFO, pycurl.SSLCERT, pycurl.SSL<em>VERIFYHOST, and pycurl.SSL</em>VERIFYPEER settings on the Curl object if you want to read about them in the pycurl documentation for more information. </p><p><em>user</em> and <em>password</em> keyword arguments can be omitted when using certificate authentication. </p><p>See src2/franz/openrdf/tests/tests.py's test_ssl for example use. </p><a name='header3-3535' id='header3-3535'></a><h3>Java Client</h3><h4>Rfe11523 - Upgrade to Sesame 2.6.5 jars</h4><p>With this change, the Java client has been updated to use the Sesame 2.6.5 jars. </p><h4>Rfe11358 - Upgrade Clojure to 1.4.0</h4><p>The Clojure client API now uses Clojure 1.4.0 and Leiningen 1.7.1. </p><h4>Bug21099: java pool holds sockets open</h4><p>Problem: the AGConnPool used one MultiThreadedHttpConnectionManager per AGRepositoryConnection, but only closed it with the pool rather than with the repo. This used multiple connections to the main AGraph port and left http socket connections open for them and a session port after the AGRepositoryConnection was closed. Session ports are not recycled by the AGraph server if SessionPorts is not specified. </p><p>Fix: use a SimpleHttpConnectionManager for each AGRepositoryConnection and close both at the same time. This minimizes socket connections and avoids the secondary pool within MultiThreadedHttpConnectionManager. </p><h4>Bug21092 - Clojure: errors in tutorial</h4><p>Enhanced repo-federation to work without rcon-args as was used in the tutorial. This fixes tutorial example16. </p><p>Enhanced value-factory to work with either Repository or RepositoryConnection. This reduces reflection warnings in the tutorial. </p><a name='header2-3546' id='header2-3546'></a><h2>AllegroGraph 4.6</h2><a name='header3-3547' id='header3-3547'></a><h3>Server Changes</h3><h4>Rfe11449 - Timeout for database instances</h4><p>Support has been added for making database instances linger for some amount of time after their last close.  This allows for reducing the likelihood that a subsequent access to an otherwise idle database will require a long startup time.  The time to linger is determined by the global and per catalog InstanceTimeout directive whose default is 0s. </p><p>InstanceTimeout is from the instant the last session or backend that has the store open closes it. </p><p>New function <a href="lisp-reference.html#ensure-not-lingering" title="description of ensure-not-lingering">ensure-not-lingering</a> of the same argument as <a href="lisp-reference.html#open-triple-store" title="description of open-triple-store">open-triple-store</a>. </p><p><a href="lisp-reference.html#close-triple-store" title="description of close-triple-store">close-triple-store</a> has a new keyword arg :ensure-not-lingering. </p><h4>Rfe11445 - Queries with large intermediate result sets could generate segfaults</h4><p>Queries with very large intermediate result sets could generate segmentation faults. This has been corrected. </p><h4>Rfe11440 - Remove trailing slash from server URL</h4><p>With this change, AGServer now removes any trailing slash from the specified server URL.  Previously, an errant trailing slash on the server URL resulted in an obscure error message about "No suitable response format available" that was difficult to diagnose. </p><h4>Rfe11418 - improve efficiency of AllegroGraph's turtle parser</h4><p>Improved the memory usage and speed of AllegroGraph's turtle parser making it more than twice as fast as previous versions. </p><h4>Rfe11404 - Optimized opening stores</h4><p>By reducing inter-process communication latency, opening triple stores has been made significantly faster. </p><h4>Rfe11177 - Agload --relax-syntax flag</h4><p><strong>agload</strong> now uses --relax-syntax flag instead of --relax-for-btc flag. This flag now allows for underscores and dashes to be used in anonymous node strings for N-Triples and N-Quads. <strong>agload</strong> is documented in <a href="agload.html">Data Loading</a>. </p><h4>Rfe11126 - SSL client certificate and CRL support</h4><p>New <strong>https-verification</strong> keyword argument to <a href="lisp-reference.html#open-triple-store" title="description of open-triple-store">open-triple-store</a> and <a href="lisp-reference.html#create-triple-store" title="description of create-triple-store">create-triple-store</a>. </p><h4>Rfe8881 - Optionally suppress duplicates at commit time</h4><p>AllegroGraph now has a switch <a href="lisp-reference.html#duplicate-suppression-strategy" title="description of duplicate-suppression-strategy">duplicate-suppression-strategy</a>, which will prevent new duplicate triples (both duplicates already in the store, and duplicates within the same commit) from being committed to the store. </p><h4>Bug20997 - Solve latency issue while starting replication.</h4><p>Fixed a bug where transaction logs (tlogs) were repeatedly (and unnecessarily) examined when performing replication. Now each tlog is examined once. This results in the time required to be O(n) instead of O(n*n) (that is, time is linear with the number of tlogs rather than increasing by the square of the number of tlogs). </p><h4>Bug20984: Turtle serializer emitted invalid blank node identifiers</h4><p>The rdf-n3 (turtle) serializer was emitting blank node identifiers without prefixing them with ":_". This has been corrected. </p><h4>Bug20981 - Exhausted cursor recycling happens too early</h4><p>Exhausted cursors were being recycled too early which could sometimes result in program crashes.  This has been fixed. </p><h4>Bug20968 - Improve string dictionary cache performance</h4><p>When heavily used, AllegroGraph's string dictionary cache could become bogged down in bookkeeping resulting in very poor performance. This change prevents this excessive bookkeeping and provides the expected near-constant cache performance. </p><h4>Bug20943 - Free text index bug under replication</h4><p>When a new free-text index was created while replication was enabled, it caused an error in the standby process. This is now fixed. </p><h4>Bug20913: Xsd date and time coercion functions could signal error</h4><p>If given invalid input, the type coercion functions for dates, times and dateTimes could signal an error other than a SPARQL type error. This would lead to a query error rather than a filter failure. For example, this query: </p>
<pre><code>prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;  
select ?ds ?d {  
  bind( '2012-12-04 is my favorite day' as ?ds )  
  bind( xsd:date(?ds) as ?d )  
} </code></pre><p>would signal an error rather than returning a single result for which the binding for <code>?d</code> is empty. </p><p>This has been corrected. </p><h4>Bug20910 - Queries with variable predicates could lose results</h4><p>If AllegroGraph finds a query pattern with variable predicates and distinct results (and certain other conditions that are data dependent are also true), then it will optimize the pattern by converting it into an iteration over all of the distinct predicates in the store. A typical query of this form is </p>
<pre><code>select distinct ?p {  
  ?s a ex:Animal .  
  ?s ?p ?o  
} </code></pre><p>Because computing all of the distinct predicates is expensive, AllegroGraph caches this information. Previously, AllegroGraph could fail to update the cache correctly when new triples were added. This could lead to queries returning too few results. </p><p>This has been corrected. </p><h4>Bug20896 - Hang when max chunks for an index reached</h4><p>As part of their operation, the automatic index optimization processes will sometimes merge some number of input chunks into a single output chunk in order to keep the total chunk count below a certain threshold.  However, under some circumstances, some indices would never undergo the optimization process so this chunk reduction would not occur.  Eventually the chunk limit would be reached and the database would hang.  This problem has been corrected. </p><h4>Bug20887 - AllegroGraph XML parsers should not follow external references</h4><p>AllegroGraph's RDF/XML and TriX parsers could try to follow external references in input files and fail. This has been corrected. </p><h4>Bug20877 - xs:date could fail on some short plain literals</h4><p>The xs:date constructor function could fail to correctly create a date if the argument passed to it was a small plain literal. E.g., constructs like </p>
<pre><code>BIND (xsd:date( concat(str(?date), '-01-01')) as ?begin_date) </code></pre><p>could pass a string whose length was less than 10 to the xs:date function and this could lead to the failure. </p><p>This has been corrected. </p><h4>Bug20833 - openFederated should handle remote stores</h4><p>AllegroGraphServer.openFederated now works on remote stores. Previously it always attempted to open supplied arguments as local stores. </p><p>The openFederated API still has some limitations. To open a federated session with all federation minilanguage features such as reasoning and graph filtering, pass a properly formatted spec string to AllegroGraphServer.openSession directly. </p><h4>Bug20822 - Cascading error can occur if database create/open fails</h4><p>Previously, if there was an error during database open/create, another error could occur during the cleanup process, obscuring the actual problem. This has been fixed. </p><h4>Bug20819 - problem with some combinations of multiple OPTIONAL clauses</h4><p>Some query patterns with OPTIONALs whose left-hand side was empty could lead to incorrect results. An example of a query that could have failed was: </p>
<pre><code>select distinct ?value ?type ?name {  
  OPTIONAL {  
    ?value &lt;http://example.com#isa&gt; ?type .  
  }  
  OPTIONAL {  
    ?value &lt;http://example.com#name&gt; ?name .  
  }  
  FILTER( REGEX(STR(?name),'Sa') &amp;&amp; BOUND(?type) )  
} </code></pre><p>This has been corrected. </p><h4>Bug20814 - Make session urls unique</h4><p>In order to avoid accidental sharing of sessions, include a unique session id in the session-url. Behind the scenes, what previously looked like <code>http://localhost:55555</code> is now something like: <code>http://localhost:55555/sessions/7e8df8cd-26b8-26e4-4e83-0015588336ea</code>. </p><h4>Bug20806 - fix loading of initfile and sitescripts</h4><p>Initfiles and sitescripts longer than 4096 characters were presented with 4096 character long blocks in reversed order. This bug is now fixed. </p><h4>Bug20799 - turtle-parser was case sensitive when parsing numbers</h4><p>AllegroGraph's turtle parser was failing to parse floating point numbers that used an upper-case <code>E</code> before the exponent. This is now corrected. </p><h4>Bug20793 - RDFS++ queries with free predicate could infer invalid triples</h4><p>If a query involving RDFS++ reasoning used an unbound predicate, the reasoner could use inverse property reasoning to infer invalid triples. This has been corrected. </p><h4>Bug20757 - Problems when starting agraph while another agraph is running</h4><p>Previously if you tried to start AllegroGraph when it was already running, the second start would fail but it would cause the already-running AllegroGraph to stop operating correctly.  This has been fixed. </p><p>It has always been acceptable to run two or more AllegroGraph servers simultaneously as long as they, at the very least, used different settings for the following parameters in their configuration files: </p>
<ul>
<li><p>Port</p></li>
<li><p>SettingsDirectory</p></li>
<li><p>GlobalShmServerDirectory (defaults to the value of SettingsDirectory)</p></li></ul><p>The operating system already enforced a unique Port setting.  This change adds enforcement of unique SettingsDirectory and GlobalShmServerDirectory settings.  Therefore some (dangerous) side-by-side AllegroGraph configurations that used to work may no longer start up.  An instructive error message will be displayed in this case. </p><h4>Bug20628 - Changes to warmstandby API</h4><p>PUT /repositories/[name]/warmstandby </p><p>If one attempts to start a replication task that already exists, an http 409 Conflict response will be returned. </p><h4>Bug20533 - Agload --rapper flag documentation</h4><p>The --rapper flag is now specified in the group "Other options". Previously it was not given a group in the command line help. <strong>agload</strong> is documented in <a href="agload.html">Data Loading</a>. </p><h4>Bug20508 - Remote triple store can't use the RDFS++ reasoner</h4><p>Added support for <a href="reasoner-tutorial.html#apply-rdfs:2B:2B-reasoner" title="description of apply-rdfs++-reasoner">apply-rdfs++-reasoner</a> on a remote client triple-store. </p><a name='header3-3627' id='header3-3627'></a><h3>HTTP Client</h3><h4>Rfe10812 - Improve http tracing</h4><p>HttpTrace is now a global configuration directive of the same meaning as the --http-trace command line option. The global directive HttpTraceOptions and the command line option --http-trace-options were added, the value of which is a comma separated list of options. Options starting with the character + turn on the corresponding log category. Those starting with - turn them off. Use the max-message-size=&lt;N&gt; option to truncate overly long messages. The default is <code>+log,max-message-size=1000</code>. </p><h4>Bug20798 - Improved http error handling</h4><p>Previously, if the client that was performing an http request died and the backend couldn't transmit the response, then the backend was killed and the request was retried on another backend that also failed because the client socket was closed which wasted resources. The new behavior is to let the backend live on (without retrying), if the error is really from the client side. </p><a name='header3-3632' id='header3-3632'></a><h3>SPARQL</h3><h4>Rfe11469: add line number to SPARQL parser error messages</h4><p>The SPARQL parser will now indicate the line at which an error is encountered. The error message has also been reformatted to make it easier to understand the parsing problem. </p><h4>Rfe11357 - enhance SPARQL 1.1 engine for changes to standard</h4><p>The SPARQL 1.1 standards committee recently made several small changes to the standard. To accommodate these, AllegroGraph's SPARQL engine has: </p>
<ul>
<li>added support for the functions STRBEFORE, STRAFTER and REPLACE</li>
<li>removed support for the function SHA224</li>
<li>relaxed the type validation for REGEX so that language tagged    literals and typed literals of type xsd:string can be searched    without resorting to the STR function. </li>
<li>returns rdf:langString as the datatype of a language tagged    literal </li>
<li>accepts solution modifiers for ASK queries</li></ul><p>There are several other changes to the standard which AllegroGraph will support in a <em>future</em> release. These include: </p>
<ul>
<li>Grammar: Backslash character escapes in prefixed names</li>
<li>Grammar: Fix: Allow ASK to take solution modifiers</li>
<li>Grammar: Fix: AdditiveExpression: '?' =&gt; '*'</li>
<li>Allow aggregates in ORDER BY clause</li></ul><p>For additional information, please see the <a href="sparql-1.1-release-notes.html">SPARQL release notes</a>. </p><h4>Bug20951 - SPARQL could fail to match plain and typed strings</h4><p>SPARQL specifies that a plain literal (like "hello") is equivalent to a literal with type xsd:string (like "hello"^^xsd:string). The SPARQL 1.1 query engine was failing to provide this entailment in some cases. This has been corrected. </p><h4>Bug20939 - CLEAR only recognized if it's the first verb</h4><p>The SPARQL 1.1 UPDATE verb <code>CLEAR</code> was only recognized correctly if it was the first verb in a SPARQL statement. This has been corrected. </p><h4>Bug20936 - OFFSET 0 and LIMIT did not mix</h4><p>If a SPARQL query used an explicit OFFSET of zero, the LIMIT would be ignored. I.e., a query like: </p>
<pre><code>SELECT * { ?a a ex:Animal . }  
LIMIT 10 OFFSET 0 </code></pre><p>would return <em>all</em> ex:Animals rather than just 10. Leaving the OFFSET off entirely would produce the correct behavior. This has been corrected so that OFFSET 0 is treated as expected. </p><h4>Bug20912 - Inequality filters could signal an error</h4><p>Inequality filters in SPARQL queries can be transformed into fast range queries. If a query used a filter like </p>
<pre><code>FILTER( ?a &lt; 0.0 ) </code></pre><p>then the SPARQL 1.1 query planner could attempt to decrement an unsigned number below zero which would lead to a segmentation fault. </p><p>This has been corrected. </p><h4>Bug20911 - SPARQL could lose precision on very small numbers</h4><p>SPARQL numeric conversion routines could treat double-floats and decimals as single-floats which would lose precision. For example, a query with a filter like </p>
<pre><code>FILTER( ?x &gt; 4.5e-45 ) </code></pre><p>would have been interpreted as </p>
<pre><code>FILTER( ?x &gt; 0 ) </code></pre><p>This has been corrected. </p><h4>Bug20898 - Complex queries could fail on federated triple-stores</h4><p>Because of the way statistics were calculated on federated triple-stores, SPARQL queries with many clauses in a basic graph pattern (BGP) could fail when the query engine attempted to reorder them.  This has been corrected. </p><h4>Bug20891 - Improve SPARQL comparator selection</h4><p>SPARQL specifies difference comparison operations depending on the type of the things being compared. The SPARQL 1.1 query engine could select the wrong operation if both the left and right hand sides were variables. This has been corrected. </p><h4>Bug20884: improve Lisp client remote-triple-store SPARQL interface</h4><p>The remote-triple-store implementation of the Lisp client was unable to execute SPARQL queries with non-trivial filter clauses. This has been fixed. (Repeated in the Lisp API section below.) </p><h4>Bug20867: REPLACE function in SPARQL 1.1 used incorrect syntax for matches</h4><p>The SPARQL 1.1 REPLACE function was implemented using a different syntax for pattern replacement than that specified by the standard. Replacements are now correctly specified using the <code>$&lt;number&gt;</code> syntax. </p><h4>Bug20863 - Some SPARQL XSD numeric computations could fail</h4><p>Depending on the datatypes of the numbers involved, it was possible for a SPARQL numeric computation to signal a type error rather than correctly returning a value. This has been corrected. </p><h4>Bug20859 - Some filter combinations could cancel each other out</h4><p>If a SPARQL query used IN (or several FILTERS like ?uri = constant) and if there were other filters on variables that overlapped with the variables in the IN construct, then it was possible for AllegroGraph to lose track of the additional filters in some circumstances. This happened due to two separate query optimizations handling the filters inconsistently. This problem has been corrected. </p><h4>Bug20852 - remote-triple-store and SPARQL UPDATE don't mix</h4><p>The Lisp remote-triple-store client could signal an error after evaluating a SPARQL UPDATE statement. The UPDATE would occur but the result would be mis-interpreted and signal an error. This has been corrected. </p><h4>Bug20851 - SPARQL FILTERs could be too strict</h4><p>Certain combinations of triple patterns in a BGP and FILTERs could cause AllegroGraph to misapply the FILTERs.  For example, depending on the underlying triple-store, this query </p>
<pre><code>SELECT ?first_film ?actor ?second_film {  
  ?first_film dbpp:starring dbpr:Jack_Black , ?actor .  
  ?second_film dbpp:starring dbpr:Joan_Cusack , ?actor .  
  FILTER ( ?actor != dbpr:Joan_Cusack )  
  FILTER ( ?second_film != ?first_film )  
  FILTER ( ?actor != dbpr:Jack_Black )  
} </code></pre><p>could have misapplied the <code>?actor</code> filter and produced fewer results than expected. </p><p>This has been corrected. </p><h4>Bug20838 - SPARQL CONSTRUCT queries could fail for large result sets</h4><p>Due to limitations in the internal mechanisms used to keep track of intermediate results, SPARQL CONSTRUCT queries that returned more than 100,000 rows would cause a segmentation fault. This has been corrected. </p><h4>Bug20830 - Some inequalities could use the wrong comparisons</h4><p>Some SPARQL 1.1 queries could select the wrong comparison code when comparing two variable clauses with either <code>&gt;=</code> or <code>&lt;=</code>. This could lead to incorrect results. This has been fixed. </p><h4>Bug20821 - EXISTS or NOT EXISTS and additional filters did not mix</h4><p>The new SPARQL 1.1 EXISTS and NOT EXISTS filters failed to parse correctly when combined with other FILTER clauses. This has been fixed. </p><h4>Bug20805 - encode<em>for</em>uri could produce incorrect results</h4><p>The SPARQL 1.1 <code>encode_for_uri</code> could produce incorrect results for some UNICODE characters. This has been corrected. </p><a name='header3-3694' id='header3-3694'></a><h3>AGWebView</h3><h4>Rfe10885 - Setting duplicate suppression from AGWebView</h4><p>Added "Suppress duplicate statements" feature to the repository overview page.  This sets the <a href="lisp-reference.html#duplicate-suppression-strategy" title="description of duplicate-suppression-strategy">duplicate-suppression-strategy</a> switch, which can be set to prevent new duplicate triples (both duplicates already in the store, and duplicates within the same commit) from being committed to the store. </p><h4>Bug20996 - Webview: js error creating a new repo</h4><p>This fixes a javascript error when creating a repository from the Catalog page. </p><h4>Bug20993 - Webview: Internet Explorer (IE) compatibility mode</h4><p>AGWebView now includes an html meta header for IE9 so that IE9 will use its documentMode instead of IE7 compatibility. Also tested with IE8. </p><p>Also using html5 doctype to get standards mode in all browsers. </p><h4>Bug20963 - Fix session url in AGWebView</h4><p>Urls for sessions are changed in Bug20814 (described under <strong>AllegroGraph Server: General Changes</strong> above). This fixes AGWebView and changes the url for its use of sessions to include the uuid. </p><h4>Bug20894 - AGWebView not working with ie9 on intranet</h4><p>When connecting to AGWebView on an intranet site IE may automatically use Compatibility Mode. A syntax error causes it to only display the "Loading" message and not continue.  Work-around is to use a full url, or otherwise not use compatibility mode.  The syntax error is now fixed so an intranet does not cause the error. </p><h4>Bug20843 - AGWebView sometimes clears the editor</h4><p>The execute button would clear the query editor (and the results area).  This happened when the same query had been executed sometime before in the same browser followed by logout/login.  The browser history mechanism had not been fully cleared.  Recent queries are cleared after logout.  This is now fixed. </p><a name='header3-3708' id='header3-3708'></a><h3>Changes to the Lisp API</h3><h4>Bug20884: improve Lisp client remote-triple-store SPARQL interface</h4><p>The remote-triple-store implementation of the Lisp client was unable to execute SPARQL queries with non-trivial filter clauses. This has been fixed. (Repeated in the SPARQL section above.) </p><h4>Bug20883: improve the Lisp client's remote-triple-store caching interface</h4><p>The Lisp client's remote-triple-store implementation did not support the <code>spogi-cache-enabled-p</code> or <code>spogi-cache-size</code> methods. This has been corrected. </p><h4>Bug20185 - Remote lisp client used wrong value for restriction reasoning</h4><p>For a remote reasoning store, this method used the wrong string internally, leading to an error when a query was made: </p>
<pre><code>(setf (restriction-reasoning-enabled-p *db*) t) </code></pre><p>For a remote reasoning store, this method enabled restriction reasoning if the key :restriction-reasoning-enabled was present regardless of the key's value.  Now respects t or nil. </p>
<pre><code>(apply-rdfs++-reasoner :restriction-reasoning-enabled nil)  
</code></pre><a name='header3-3718' id='header3-3718'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-3720' id='header3-3720'></a><h3>Python Client</h3><h4>Rfe11313 - Remove export*, use response capture</h4><p>RepositoryConnection.export and exportStatements have been deprecated. They used client side serialization of statements that was buggy and not up to spec. The functionality has been replaced with a way to capture server responses of any supported mime type. </p><p>A new context manager function on RepositoryConnection is called saveResponse, and can be used as follows: </p>
<pre><code>with open('out', 'w') as response:  
    with conn.saveResponse(response, 'application/rdf+xml'):  
        # The server response is written to response  
        conn.getStatements(None, None, None) </code></pre><p>You can reference the function test<em>save</em>response in src2/franz/openrdf/tests/tests.py for examples. </p><a name='header3-3726' id='header3-3726'></a><h3>Java Client</h3><h4>Rfe11493 - Support writing N-Quads from an AGModel</h4><p>With this change, the Jena adapter now supports writing to N-Quads via AGModel.write(out, "N-QUADS"). </p><h4>Rfe11438 - Provide N-Quads parser/writer META-INF/services in agraph.jar</h4><p>With this change, the agraph.jar now provides N-Quads implementations for org.openrdf.rio.RDFParserFactory and org.openrdf.rio.RDFWriterFactory in META-INF/services (Sesame doesn't yet provide N-Quads implementations). </p><h4>Rfe11436 - Add Sesame 2.6.2 src jar</h4><p>With this change, the <strong>openrdf-sesame-2.6.2-onejar-src.jar</strong> has been added to eclipse project classpaths (repo and distribution) for convenience. </p><h4>Rfe11397 - Support RepositoryFactory and Repository configuration</h4><p>With this change, the Java client now supports Sesame's RepositoryFactory api and Repository configuration from RDF data.  See javadoc for the new com.franz.agraph.repository.config package for details. </p><h4>Rfe11240 - Support user/role management</h4><p>With this change, AllegroGraph superusers can now dynamically manage users and roles.  See the AGServer javadoc for details. </p><h4>Rfe11230 - Support masquerading as another user</h4><p>With this change, an AllegroGraph superuser can now masquerade as another user when issuing requests.  See the javadoc for <strong>AGRepositoryConnection#setMasqueradeAsUser</strong> for details. </p><h4>Bug20946 - IE javascript error in Mold: innerHTML is null</h4><p>Work-around: the error dialog can be dismissed and the search results are still displayed. Fixed. </p><h4>Bug20811 - Allow prolog queries from javascript</h4><p>To run javascript the user must have the "execute arbitrary code" permission which should be enough to run prolog queries too. The bug that was fixed prevented the user from running prolog queries from javascript. </p><a name='header2-3743' id='header2-3743'></a><h2>AllegroGraph 4.5</h2><a name='header3-3744' id='header3-3744'></a><h3>Server Changes</h3><h4>Rfe11338 - CJK bigram tokenizer</h4><p>A new tokenizer <code>:simple-cjk</code> for Chinese/Japanese/Korean (CJK) text has been added.  It uses bigrams for consecutive CJK characters as words.  To use this tokenizer, specify :simple-cjk as the <code>tokenizer</code> option when creating or modifying a freetext index. </p><p>The bigram tokenizer can be used for CJK mixed text, but its simplicity may result in false positives.  It also tends to index a much larger number of words compared to other tokenizers. See <a href="text-index.html">Free-text Indices</a> and <a href="lisp-reference.html#create-freetext-index" title="description of create-freetext-index">create-freetext-index</a>. </p><h4>Rfe11298 - Spread access to the same triple store across shared backends</h4><p>Previously, when using shared backends, operations for a particular triple store tended to be routed to a single shared backend, even if it was busy.  Now concurrent operations for a particular triple store are routed to a shared backend that is not already processing a request for that same store.  Additional backends (up to the value of the "Backends" configuration parameter) will be started if necessary to achieve this goal.  This is expected to increase concurrency in such situations. </p><p>Dedicated sessions are unaffected by this change. </p><p>Since this change is most beneficial when there are many shared backends available, the default setting of the "Backends" configuration parameter has been changed from 3 to 10. </p><h4>Rfe11257 - Backup/restore user namespace settings</h4><p><code>agraph-backup</code> is enhanced in two ways: </p><p>The user namespace settings are now handled by the backup-all/backup-settings/restore-all subcommands. </p><p>The backup-settings subcommand can take a path to the executable of an older AllegroGraph's version of agraph-backup, and call it to archive the store data.  With this feature, archiving an entire repository from an older AllegroGraph repository becomes a single command. </p><p>See <a href="backup-and-restore.html">Backup and Restore</a>. </p><h4>Rfe11099 - Add Apache Solr support to AllegroGraph</h4><p>Now you can connect an external Solr text search engine from AllegroGraph server.  With new prolog functions you can issue a query to the Solr engine to retrieve associated document IDs. See <a href="solr-index.html">Solr Text Indices</a>. </p><h4>Bug20750 - Unused store closer holds lock too long</h4><p>The thread which closes idle triple stores in backends held an important lock while trying to acquire locks on individual stores.  If a lock on a store was being held by another thread (e.g., one running a long query), this could cause the whole backend to become unresponsive to other unrelated requests.  This has been corrected. </p><h4>Bug20736 - Federated-triple-store could mistreat xsd:strings in queries</h4><p>In some cases a federated-triple-store could fail to account for the equality of plain literals and literals with a datatype of xsd:string. This has been corrected. </p><h4>Bug20717 - Fix the UPI not in string table query issue</h4><p>Depending on the result format and the client, queries that generated new strings (e.g., using SPARQL 1.1's BIND clause) could lead to a <code>UPI not in string table</code> error. This has been corrected. </p><h4>Bug20712 - Implement xs:date and xs:time XPath constructor functions</h4><p>The constructor functions for xs:date and xs:time are now implemented. </p><h4>Bug20697 - Zero length property path with future parts</h4><p>Zero length property path patterns now correctly match future parts that are not yet in the db: </p>
<pre><code>?x :p{0} :a . </code></pre><p>Note that the same pattern with a literal worked even without this fix: </p>
<pre><code>?x :p{0} "o" . </code></pre><h4>Bug20690 - Property path results cardinality</h4><p>In the presence of cycles, property path expressions did not always return results with the right cardinality. This has been fixed. </p><h4>Bug20616 - Fix race condition in triple store termination</h4><p>AllegroGraph now waits for a triple-store's subprocesses to exit when the last connection is closed instead of killing them while they could potentially be executing a clean shutdown. </p><h4>Avoid Logging a backtrace during unclean shutdown</h4><p>Under certain circumstances (such as when 'killall agraph' was used), there was a race condition during process termination that could result in an error and backtrace being logged to agraph.log.  This has been corrected. </p><a name='header3-3778' id='header3-3778'></a><h3>HTTP Client</h3><h4>Rfe11308 - Support UPDATE via POST /repository/ID/statements</h4><p>The Sesame 2 protocol allows statements to be added to a repository by sending a POST request to /repository/ID/statements. AllegroGraph previously only supported update via POST requests to /repository/ID. </p><p>Now SPARQL update statements may be directed to either location. You can also POST an RDF document or data in the form of an application/x-rdftransaction to /repository/ID/statements. </p><h4>Rfe11213 - Allow superusers to run queries with another user's security filters</h4><p>AllegroGraph sessions belonging to superusers now allow their owners to use the X-Masquerade-As-User header in HTTP requests to activate another user's security filters. </p><h4>Bug20671 - List the Hub process in the HTTP API</h4><p>AllegroGraph now lists the Hub process in the HTTP API's process list and in WebView. The Hub process can not be killed or asked to perform a backtrace. </p><a name='header3-3786' id='header3-3786'></a><h3>SPARQL</h3><h4>Rfe11320 - Trying to use SERVICE should signal an error</h4><p>AllegroGraph's SPARQL engine does not support federated query (http://www.w3.org/TR/sparql11-federated-query/). Previously queries using the SERVICE keyword would fail silently. Now these queries will signal an error. </p><h4>Rfe11302 - Support clauses with no variables</h4><p>The SPARQL 1.1 engine now supports basic graph patterns where one or more of the clauses have no free variables. Previously, a query like </p>
<pre><code>select * {  
   :a :p1 :c .  
      :p2 ?value .  
} </code></pre><p>could produce incorrect results. This has been corrected. </p><h4>Rfe11262 - Improve SPARQL 1.1 filter transformation</h4><p>AllegroGraph's SPARQL 1.1 engine is able to move some filters out of the query processor and into the storage layer. For example, a query like </p>
<pre><code>select * {  
  ?a rdf:type ?class .  
  filter( str(?class) &gt; 'z' )  
} </code></pre><p>will move the inequality into a filter involving only the first clause. In some cases, however, the query processor could leave behind a stub filter which would unnecessarily add to total query time (without altering the results). This is now corrected. </p><p>Several other minor efficiency improvements have also been added to the query engine. </p><h4>Rfe11254 - Improve SPARQL 1.1 sub-query implemenation</h4><p>A problem in the sub-query implementation led to two failures in the DAWG test-suite. These have been corrected and additional tests have been added to the regression tests </p><h4>Rfe11245 - Optimize Queries where the right-hand side of a join is a BGP</h4><p>The SPARQL 1.1 engine now handles queries where the right-hand side of the join is a BGP more efficiently. Previously, it would compute the RHS separately and then join the two sets. Now, it merges the RHS BGP into the existing LHS set directly. This can provide some speed and memory improvements for some queries. </p><h4>Rfe11135 - Implement SPARQL 1.1 DISTINCT aggregation</h4><p>AllegroGraph's SPARQL 1.1 engine now implements DISTINCT in its aggregates. This means that a query like </p>
<pre><code>select ?gender (count(distinct ?profession) as ?pCount) {  
  ?person k:profession ?profession .  
  ?person k:sex ?gender .  
} group by ?gender order by ?pCount </code></pre><p>will now correctly return a count of the <em>distinct</em> professions for each gender rather than a count of all professions. </p><h4>Rfe11098 - Integrate Apache Solr with SPARQL 1.1 query engine</h4><p>Assuming that you have setup Apache Solr with an AllegroGraph triple-store, you can now query it using the SPARQL 1.1 query engine. See the description of using Solr in <a href="solr-index.html">Solr Text Index</a>. When used with SPARQL 1.1, there are two storage strategies: addinng a triple that associates the text with a Solr document ID and telling Solr to associate the text with the triple-id directly. Both are described in the referenced document. </p><h4>Rfe11070 - Improve performance of variable predicate queries</h4><p>AllegroGraph's SPARQL engine now recognizes queries that have variables in the predicate position and provides custom methods to optimize them. An example of such a query is: </p>
<pre><code>SELECT ... {  
   ... clauses ...  
   ?s ?p ?o . </code></pre><h4>Bug20778 - Several fixes for various SPARQL 1.1 issues</h4><p>There were numerous issues in the initial release of the SPARQL 1.1 query engine. Some of the problems were caught by customers and others by internal review. This release of AllegroGraph fixes: </p>
<ul>
<li><p>issues with several functions including: encode<em>for</em>uri,   some new mathematical functions, isLiteral, etc. </p></li>
<li><p>fixes several code paths that could lead to the UPI   is not in string dictionary error, </p></li>
<li><p>fixed some edge cases in the SPARQL parser,</p></li>
<li><p>made some conversion functions more stringent so that,   for examples, <code>10 dollars</code> would raise a SPARQL type   error rather than being treated as the number 10. </p></li></ul><p>There remain some known issues with SPARQL; please see the <a href="sparql-1.1-release-notes.html">SPARQL release notes</a> for details. </p><h4>Bug20760 - Several improvements in SPARQL aggregation.</h4>
<ul>
<li><p>Do not include unbound variables in COUNT aggregation. Previously,   AllegroGraph would include these in the count. </p></li>
<li><p>Remove bindings for SUM, AVG, etc. if any of the bindings in the   group are unbound. Previously, AllegroGraph would simply ignore the   unbound values are return the SUM of the remaining elements. </p></li>
<li><p>Allow non-numeric bindings for MIN and MAX. Previously, AllegroGraph   assumed that MIN and MAX only applied to numeric bindings. </p></li></ul><h4>Bug20756 - Multiple OPTIONAL clauses for the same variable could fail</h4><p>The SPARQL 1.1 query engine could fail to find some bindings when multiple OPTIONAL clauses referred to the same variable. For example, a query like </p>
<pre><code>SELECT ?first ?last {  
  ?s ab:lastName ?last .  
  OPTIONAL { ?s ab:nick ?first . }  
  OPTIONAL { ?s ab:firstName ?first . }  
} </code></pre><p>could fail to find bindings for ?first that come from the second OPTIONAL. This is now corrected. </p><h4>Bug20752 - Queries with both filters and property paths could fail</h4><p>If a SPARQL 1.1 property path query used FILTERs and these FILTERs were moved into the triple patterns, then it was possible for the filters to be ignored. This has been corrected. </p><h4>Bug20732 - SPARQL 1.1 property path improvements</h4><p>In some cases, SPARQL 1.1 property path queries could do too much work and return too many results. This has been corrected. </p><h4>Bug20723 - Improve handling of SPARQL filter predicates</h4><p>Some of the SPARQL 1.1 filter predicates were failing to function properly when used in some contexts because their return value was not being correctly transformed from an internal representation to an external one. This has been corrected. </p><h4>Bug20722 - SPARQL 1.1 parser treated whitespace differently</h4><p>The SPARQL 1.1 parser required whitespace after a period and before an additional SPARQL keyword. This meant that a query like </p>
<pre><code>select * { ?a ?b ?c.filter( ?c &gt; 3) } </code></pre><p>would signal a parse error. This has been corrected. </p><h4>Bug20721 - Improve handling of certain OPTIONAL edge cases</h4><p>Depending on the data in the store, the SPARQL 1.1 engine could sometimes fail to process queries like: </p>
<pre><code>select ?a ?b ?c ?d {  
  optional { ?a a ?b . }  
  { ?c &lt;urn:a:b&gt; ?d . }  
} </code></pre><p>where the OPTIONAL could lead to an empty group of bindings on the left-hand-side during query processing. This has been corrected. </p><h4>Bug20711 - Improve some date and dateTime comparison issues</h4><p>The SPARQL 1.0 and 1.1 engines behaved inconsistently with respect to one another for certain comparisons between xsd:dates and xsd:dateTimes. This could lead to differences in query behavior. These issues have been reconciled. </p><h4>Bug20695 - Problem when computing range-queries on dateTimes</h4><p>Both the SPARQL 1.0 and the SPARQL 1.1 engine could fail to correctly compare dateTime datatypes with fractional seconds. This has been corrected. </p><h4>Bug20689 - Parsing of SPARQL property path expressions where a group is followed by a + as in </h4>
<pre><code>?x (ex:p)+ ?y </code></pre><p>no longer results in a error. </p><a name='header3-3847' id='header3-3847'></a><h3>AGWebView</h3><h4>Bug20751 - Agwebview could submit queries twice in some browsers</h4><p>On some browsers AGWebView could submit queries twice. This led to unnecessary work for SPARQL or Prolog SELECT queries and to duplicate data for SPARQL UPDATE queries. This has been corrected. </p><h4>Bug20738 - AGWebView could not start remote sessions</h4><p>A recent change in AllegroGraph broke AGWebView's ability to start sessions on remote stores. This is now corrected. </p><a name='header3-3852' id='header3-3852'></a><h3>Changes to the Lisp API</h3><p>No significant changes. </p><a name='header3-3854' id='header3-3854'></a><h3>Documentation</h3><h4>Rfe11236 - Fix command line documentation of the agdebug tool</h4><p>The agdebug tool now correctly indicates a non-optional argument. </p><a name='header3-3857' id='header3-3857'></a><h3>Python Client</h3><h4>Rfe11229 - Add support for user masquerading to python client</h4><p>Added support for user masquerading to Python client by adding RepositoryConnection.runAsUser(username). </p><a name='header3-3860' id='header3-3860'></a><h3>Java Client</h3><h4>Rfe11329: AGConnPool, remove unnecessary dependency on Jena</h4><p>If using AGConnPool with Sesame API, but not Jena, the Jena libraries are no longer required. </p><h4>Rfe11310: AGConnPool should rollback when borrowing</h4><p>Pool will now always rollback when borrowing a connection. This makes the transaction catch up to the most recent. </p><p>The 'testOnBorrow' property for the pool is now redundant, so generally not recommended. </p><h4>Rfe11242: Upgrade to Sesame 2.6.2 jars</h4><p>With this change, the Java client has been updated to use the Sesame 2.6.2 jars, including support for AGUpdate and AGRepositoryConnection#prepareUpdate methods.  Java Sesame Tutorial example13 has also been updated to reflect use of prepareUpdate. </p><h4>Bug20795: AGConnPool does not close connections</h4><p>Closing the AGConnPool now closes sessions properly. </p><a name='header2-3870' id='header2-3870'></a><h2>AllegroGraph 4.4.0.1</h2><a name='header3-3871' id='header3-3871'></a><h3>Server Changes</h3><h4>Bug20667 - XSD float exponent fix</h4><p>Due to rounding issues when encoding, exponents of floats in the :sparql-xml result format were - very seldom - off by one. This has been fixed. </p><h4>Bug20615 - TrxLogRetain replication now works on secondaries</h4><p>The catalog directive: <code>TransactionLogRetain replication</code> now archives properly for replication secondaries. </p><a name='header3-3876' id='header3-3876'></a><h3>HTTP Client</h3><p>No significant changes. </p><a name='header3-3878' id='header3-3878'></a><h3>SPARQL</h3><h4>Rfe11219 - Add query option support for all SPARQL constructs</h4><p>AllegroGraph's SPARQL parser supports specifying query options as part of the query string. These take the form </p>
<pre><code>prefix franzOption_OPTIONNAME: &lt;franz:OPTIONVALUE&gt; </code></pre><p>In particular, you can tell AllegroGraph which query engine to use with the <code>queryEngine</code> parameter. For example, to use the SPARQL 1.0 engine in a query, you would add the prefix </p>
<pre><code>prefix franzOption_queryEngine: &lt;franz:sparql-1.0&gt; </code></pre><p>This extension is now supported for all SPARQL constructs: ASK, CONSTRUCT, DESCRIBE, SELECT and UPDATE. </p><h4>Rfe11218 - Improve maximum solution size handling</h4><p>Because the SPARQL 1.1 engine operates on the entire query solution simultaneously it can be more memory intensive than the SPARQL 1.0 engine for some queries. There was an internal check to warn if query solution sets were becoming too large. This check was causing some queries to fail rather than simply signaling a warning. This has been changed so that these queries will write a warning to the log rather than failing. </p><h4>Rfe11202: SPARQL Update example with batch update</h4><p>With this change, Java tutorial example 13 has been augmented to show how to evaluate SPARQL Update queries, including one that batches updates in a single request. [This item is repeated in the Java Client section.] </p><h4>Bug20768 - SPARQL 1.1 property paths could return incorrect results</h4><p>AllegroGraph was failing to filter non-matching rows for property path queries like </p>
<pre><code>select ?a {  
  ?a owl:sameAs{1} ?a .  
} </code></pre><p>meaning that it would emit results when it should not. This has been fixed. </p><h4>Bug20692 - Sparql 1.1 CONTAINS function can fail</h4><p>Corrected a problem with some instances of the SPARQL 1.1 CONTAINS function. </p><h4>Bug20676 - Geospatial datatype mappings could cause query errors</h4><p>Changes to some query optimization code in the AllegroGraph SPARQL engines (both sparql-1.0 and sparql-1.1) were incompatible with geospatial datatype mappings (geospatial predicate mappings were not effected). This could lead to parse errors during query processing. This has been fixed. </p><h4>Bug20665 - SPARQL-1.1 UNION doesn't see with-variable bindings on the RHS</h4><p>The SPARQL 1.1 engine was losing track of the variable bindings on the right-hand side of a UNION. This could cause queries like </p>
<pre><code>select ?s1 ?s2 {  
  { ?s1 a ?p . }  
  union  
  { ?s2 a ?p . }  
} </code></pre><p>(with a variable binding for ?p) to produce incorrect results. This has been corrected. </p><h4>Bug20664 - SPARQL-1.1 CONCAT function signaling errors with typed literals</h4><p>The SPARQL-1.1 CONCAT function could signal an error instead of generating the correct result when one or both of the arguments with a typed literal. This has been corrected. </p><a name='header3-3903' id='header3-3903'></a><h3>AGWebView</h3><h4>Rfe11198 - Improve WebView's bulk loading UI</h4><p>WebView no longer conflates bulk load mode with agload usage. It's now possible to use agload's multi-core optimized loading mechanism and to optionally turn bulk load mode on. Some aspects of the file loading UI in WebView have also been optimized: The format selection element is now a combo box, and is located closer to the file input field. </p><h4>Bug20662 - Reload triple count in WebView if load fails</h4><p>WebView will now display the correct triple count in a store after an import got stopped by an error (e.g. the triple license limit). </p><h4>Bug20641 - Improve restoring backups from WebView</h4><p>When restoring from a backup in the WebView catalog overview, AllegroGraph will now automatically upgrade the newly-created store to the newest version. Additionally, there is now an option to set the store up for use as a replication secondary. </p><h4>Bug20637 - Fix problem where SPARQL Update did not work with AGWebView</h4><p>Changes to SPARQL UPDATE caused some UPDATE queries to fail in AGWebView. This has been corrected. </p><a name='header3-3912' id='header3-3912'></a><h3>Changes to the Lisp API</h3><h4>Bug20640 - Fix printing of encoded-ids in remote lisp client</h4><p>AllegroGraph's remote lisp client now correctly translates encoded IDs' UPIs back into strings. It can also correctly translate variable-width encoded IDs into UPIs now. </p><a name='header3-3915' id='header3-3915'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-3917' id='header3-3917'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-3919' id='header3-3919'></a><h3>Java Client</h3><h4>Rfe11202: SPARQL Update example with batch update</h4><p>With this change, Java tutorial example 13 has been augmented to show how to evaluate SPARQL Update queries, including one that batches updates in a single request. [This item is repeated in the SPARQL section.] </p><a name='header2-3922' id='header2-3922'></a><h2>AllegroGraph 4.4</h2><a name='header3-3923' id='header3-3923'></a><h3>Server Changes</h3><h4>Rfe11082: Transactional duplicate deletion</h4><p>INCOMPATIBLE CHANGE: AllegroGraph no longer supports duplicate deletion at index optimization time. The database creation parameters indicating duplicate deletion strategy are no longer accepted. </p><p>Instead, AllegroGraph now allows deletion of duplicates using the <code>delete-duplicate-triples</code> API function, which is also accessible via the HTTP API call <code>DELETE /statements/duplicates</code>. </p><h4>Rfe11039 - Include AllegroGraph version in ps output</h4><p>AllegroGraph subprocesses modify their command line so that they can supply identifying information to programs like 'ps' and 'top'. Now, in addition to the name of the subprogram, the version of AllegroGraph is included. Also, for the AllegroGraph Service Daemon process, the port number that it is listening on is included. </p><h4>Rfe11017 - Add an agdebug command line utility</h4><p>AllegroGraph now ships with a command line utility called agdebug that will output a summary the contents of the transaction log files in a store. This is primarily useful for diagnosing problems with transactions and the database's storage system. </p><h4>Rfe10984 - Fix serialization issues with encoded IDs</h4><p>Both the turtle and the RDF/XML serializers failed to correctly handle encoded IDs. This has been corrected. </p><h4>Rfe10981 - Improve upgrading/migration process</h4><p>The agraph-backup tool has two new commands, <strong>backup-all</strong> and <strong>restore-all</strong>, to help migrating existing databases to the new version of AllegroGraph or copying all catalogs and repositories to a new location. See <a href="backup-and-restore.html">Backup and Restore</a> and <a href="upgrade-guide.html">Database Upgrade</a>. </p><h4>Rfe10948 - Log secondary index creation</h4><p>Adds log entries to the AllegroGraph log when a secondary index (also called a UPI map) is created. </p><h4>Rfe10853 - Support fti charset in Python client</h4><p>Keyword arguments innerChars, borderChars, and tokenizer have been added to createFreeTextIndex and modifyFreeTextIndex. </p><p>getFreeTextIndexConfiguration also returns these new configuration properties and values. See <strong><em>put-freetext-index</em></strong>. </p><h4>Rfe10783 - Add per triple-store control of secondary indices</h4><p>Modified the Lisp and HTTP APIs so that each triple-store can specify whether or not it should use existing secondary indices and/or create new secondardy indices during query. Since these indices must be maintained and updated when modifying the triple-store, automatic creation should be turned off until the store is quiescent. The default is to use secondary indices when they exist but not to create new ones. Use [create-secondary-indices-p[]/<strong><em>(setf create-secondary-indices-p)</em></strong>, and <strong><em>use-secondary-indices-p</em></strong>/(setf use-secondary-indicies-p)<em>*</em> to control the behavior. </p><h4>Rfe10568, Rfe11172 - Set the default query engine via agraph.cfg</h4><p>AllegroGraph supports two SPARQL query engines. The <code>algebra</code> engine has been available for several years and is well tested, stable and robust. The newer, set-based, engine, named <code>sparql-1.1</code> can be significantly faster than the <code>algebra</code> engine but may contain bugs that the <code>algebra</code> engine does not. </p><p>Out of the box, AllegroGraph uses the <code>sparql-1.1</code> engine. This can be changed by using the <code>QueryEngine</code> parameter in the configuration file. If you include </p>
<pre><code>QueryEngine algebra </code></pre><p>Then AllegroGraph will use the algebra engine. If you leave the setting off or use </p>
<pre><code>QueryEngine sparql-1.1 </code></pre><p>Then AllegroGraph will continue to use the set based query engine. </p><p>The value of this configuration is read each time a triple-store is created or opened. </p><h4>Rfe10179, Rfe10540 - SNA optimizations</h4><p>Improved the efficiency of SNA operations in several ways. All SNA generator functions are now slightly faster. SNA generators that use <code>select</code> now save the select plan and re-use it. This can make these generators hundreds of times faster than before. The SNA system will also use secondary indices (UPI-maps) when available. </p><h4>Rfe10398 - Improved speed of low-level AllegroGraph operations</h4><p>Optimized the code used to copy UPIs and parts of triples. This produces a query speedup in SPARQL queries and most Prolog select queries. Some count-only Prolog select queries can run slightly slower. </p><h4>Rfe10090, Rfe10541 - optimizations to AllegroGraph secondary indices</h4><p>Improves both the creation of secondary indices (UPI-maps) and their efficiency in use. Queries that make heavy use of secondary indices will operate more quickly. </p><h4>Rfe9786 - Make shm server global</h4><p>A new configuration directive GlobalShmServerDirectory is added to specify a directory where the global shared-memory server creates its socket. When omitted, the value of <code>SettingsDirectory</code> is used. </p><h4>Bug20619  Optionally not inherit trx log arch params during restore</h4><p>The configuration file catalog directive TransactionLogArchive is no longer inherited from a backup database during a restore.  In addition, when the --replica flag is set during agraph-backup restore, TransactionLogRetain and TransactionLogReplicationJobname are no longer inherited from the backup and must be set manually in the config file catalog section prior to restore.  This is so that a replication primary and replication secondary can have independent transaction log archiving behavior.  The flag --replica also ensures --nocommit is set and --newuuid is not set, and should be used as a replacement for --nocommit when restoring backups for replication client purposes. </p><h4>Bug20460 - Encoded IDs and reasoning triple-stores mix not</h4><p>If reasoning was used during a query, then encoded IDs were not correctly recognized which led to incorrect results. This has been corrected. </p><h4>Bug20443 - Encoded IDs did not work with the TriX serializer</h4><p>The TriX serializer was incorrectly emitting encoded IDs as if they were plain literals instead of resources. This has been corrected. </p><h4>Bug20355 - Durably save transactions on warm-standby client</h4><p>The warm-standby secondary machine now saves transaction log entries in a way that ensures they've been flushed to disk durably as soon as the entire commit has been read. </p><h4>Bug20332 - Trix parser can get confused and try to encode plain literals</h4><p>Under some circumstances, the TriX parser could attempt to encode plain literals as if they were typed literals which could cause a data import to fail. This has been corrected. </p><h4>Bug20230 - Fix deletion slowdown under replication</h4><p>The replication server used a connection to the replicated triple store that ensured it would never expunge deleted triples, slowing down operations if many deletes had occurred. Now, the replication server correctly expunges these triples and does not slow down. </p><h4>Bug19957 - Turtle parser should support type-mapping</h4><p>The turtle parser was not respecting a triple-store's type-mapping settings. This meant that triples added via turtle would not have their objects converted into encoded UPIs. This has been corrected. </p><h4>Spr38044 - Restrict possible values for TransactionLogRetain</h4><p>AllegroGraph will now signal an error when invalid values for TransactionLogRetain are encountered in the config file. </p><a name='header3-3974' id='header3-3974'></a><h3>HTTP Client</h3><p>No significant changes. </p><a name='header3-3976' id='header3-3976'></a><h3>SPARQL</h3><h4>Rfe10985 - Spin functions and magic-properties</h4><p>SPIN functions and magic-properties have been implemented. The SPIN implementation is described in <a href="spin.html">Spin</a> document. </p><h4>Rfe10737 - SPARQL 1.1 BIND support</h4><p>Add support for SPARQL 1.1's BIND language construct. In particular, queries like </p>
<pre><code>select ?title ?costPlusTax {  
?book &lt;http://purl.org/dc/elements/1.1/title&gt; ?title .  
?book &lt;http://example.org/ns#price&gt; ?cost .  
?book &lt;http://example.org/ns#tax&gt; ?tax .  
bind( ?cost * (1 + ?tax) as ?costPlusTax )  
} </code></pre><p>are now supported. </p><h4>Rfe10736, Rfe10743 - SPARQL 1.1. exists, not exists, and minus</h4><p>AllegroGraph's SPARQL engine now handles the MINUS operator of SPARQL 1.1. It also handles the new EXISTS and NOT EXISTS filter operators. </p><h4>Rfe10700 - SPARQL 1.1 assignment</h4><p>SPARQL 1.1 assignment is now implemented so that queries like </p>
<pre><code>select ?title ?cost ?discount (?cost * ?discount as ?totalCost)  
where {  
?book :title ?title .  
?book :price ?cost .  
?book :discount ?discount .  
} </code></pre><p>are now supported. </p><h4>Rfe10699 - SPARQL 1.1 UPDATE support</h4><p>The SPARQL parser and implementation now support the UPDATE specification at http://www.w3.org/TR/2011/WD-sparql11-update-20110512/. </p><p>Note: This change is incompatible with some existing uses of SPARQL UPDATE. </p><a name='header3-3992' id='header3-3992'></a><h3>AGWebView</h3><h4>Rfe11131: Allow triggering deletion in WebView</h4><p>It is now possible to invoke duplicate deletion from WebView. </p><h4>Rfe10631 - Allow loading files via agload in WebView</h4><p>WebView now has a "Bulk Load" option to speed up loading large files. Since this option uses the agload utility internally, it also allows specifying an error handling strategy other than "Cancel". </p><h4>Bug20492 - Improve code editor in WebView</h4><p>The text editor in WebView (used for e.g., queries) has been improved for browser compatibility (mainly with Internet Explorer) and functionality. It now expands automatically to fit the text contained, displays line numbers and automatically indents code. </p><a name='header3-3999' id='header3-3999'></a><h3>Changes to the Lisp API</h3><h4>Rfe11082: Transactional duplicate deletion (repeated from the General section)</h4><p>INCOMPATIBLE CHANGE: AllegroGraph no longer supports duplicate deletion at index optimization time. The database creation parameters indicating duplicate deletion strategy are no longer accepted. </p><p>Instead, AllegroGraph now allows deletion of duplicates using the <code>delete-duplicate-triples</code> API function, which is also accessible via the HTTP API call <code>DELETE /statements/duplicates</code>. </p><a name='header3-4003' id='header3-4003'></a><h3>Documentation</h3><p>No significant changes other than new features documented. </p><a name='header3-4005' id='header3-4005'></a><h3>Python Client</h3><h4>Rfe11122 - Add "delete duplicates" API function to python client</h4><p>RepositoryConnection.deleteDuplicates: </p><p>Delete all duplicates in the store. Must commit. </p><p>mode - "spog" or "spo" </p><a name='header3-4010' id='header3-4010'></a><h3>Java Client</h3><h4>Rfe11121 - Support transactional duplicate deletion</h4><p>With this change, the Java client now provides the method AGRepositoryConnection#deleteDuplicates(comparisonMode) for deleting spog and spo duplicates in a transactional manner. See the javadoc for more details. </p><p>See <a href="change-history.html" id="change-history-tab">Change History</a> for user-visible changes to earlier releases. </p><h4>Rfe11117: java api for SPIN (adds to rfe10988)</h4><p>New methods added to AGRepositoryConnection: listSpinFunctions() listSpinMagicProperties() </p><p>New classes: AGSpinFunction, AGSpinMagicProperty </p><h4>Rfe10622 - Http response handlers now have their own package</h4><p>With this change, the Java client's HTTP response handlers have been refactored and moved into a com.franz.agraph.http.handler package. </p><a name='header2-4019' id='header2-4019'></a><h2>AllegroGraph 4.3.3</h2><a name='header3-4020' id='header3-4020'></a><h3>Server Changes</h3><h4>Rfe10984 - Fix serialization issues with encoded IDs</h4><p>Both the turtle and the RDF/XML serializers failed to correctly handle encoded IDs. This has been corrected. </p><h4>Rfe10967 - Nicer CSV output option</h4><p>AllegroGraph now supports another CSV output format (MIME type application/processed-csv) that uses the UTF-8 encoding, prints literals with numeric types as numbers, and doesn't wrap string literals in quote marks. </p><h4>Bug20460 - Encoded IDs and reasoning triple-stores failure</h4><p>If reasoning was used during a query, then encoded IDs were not correctly recognized which led to incorrect results. This has been corrected. </p><h4>Bug20451 - Fix encoded ID API on remote lisp client</h4><p>The remote lisp client was missing a few functions in the encoded ID API: The functions that were missing are next-encoded-upi-for-prefix, encoded-id-prefix-registered-p and encoded-id-prefix-in-use-p. These are now implemented and available on the remote lisp client. </p><h4>Bug20443 - Encoded IDs did not work with the TriX serializer</h4><p>The TriX serializer was incorrectly emitting encoded IDs as if they were plain literals instead of resources. This has been corrected. </p><h4>Bug20416 - Use proper n-triples syntax for text/csv</h4><p>The CSV generator (when requesting MIME type text/csv) for query results will now always generate valid CSV such that the entries imported into a spreadsheet or a database are in correct n-triples part syntax. </p><a name='header3-4033' id='header3-4033'></a><h3>HTTP Client</h3><p>No significant changes. </p><a name='header3-4035' id='header3-4035'></a><h3>SPARQL</h3><p>No significant changes. </p><a name='header3-4037' id='header3-4037'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-4039' id='header3-4039'></a><h3>Changes to the Lisp API</h3><p>No significant changes. </p><a name='header3-4041' id='header3-4041'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-4043' id='header3-4043'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-4045' id='header3-4045'></a><h3>Java Client</h3><h4>Rfe10983 - Query execution with initial bindings</h4><p>With this change, the Java client's Jena adapter now supports creating query executions with initial bindings using the method: AGQueryExecutionFactory#create(query,model,initialBinding); </p><a name='header2-4048' id='header2-4048'></a><h2>AllegroGraph 4.3.2</h2><a name='header3-4049' id='header3-4049'></a><h3>Server Changes</h3><p>No significant changes. </p><a name='header3-4051' id='header3-4051'></a><h3>HTTP Client</h3><h4>Bug20424 - Disable 5-minute HTTP request timeout</h4><p>AllegroGraph now allows HTTP API requests to run (and generate results) for longer than 5 minutes. </p><a name='header3-4054' id='header3-4054'></a><h3>SPARQL</h3><p>No significant changes. </p><a name='header3-4056' id='header3-4056'></a><h3>AGWebView</h3><p>No significant changes. </p><a name='header3-4058' id='header3-4058'></a><h3>Changes to the Lisp API</h3><p>No significant changes. </p><a name='header3-4060' id='header3-4060'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-4062' id='header3-4062'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-4064' id='header3-4064'></a><h3>Java Client</h3><p>Bug20272 - NPE when no response stream is available </p><p>Previously, the Java client's HTTP response handler could throw an opaque NullPointerExeption if no response stream is available (this might occur due to a server crash).  With this change, the response handler checks for a null stream and throws an exception advising the user that no response stream is available and to inspect the server log file for possible explanations. </p><a name='header2-4067' id='header2-4067'></a><h2>AllegroGraph 4.3.1</h2><a name='header3-4068' id='header3-4068'></a><h3>Server Changes</h3><h4>Rfe10889 - Provide guaranteed duplicate removal behavior</h4><p>As long as no triples are concurrently being added, completion of a level 2 database optimization will now ensure that all duplicate triples (as defined by the current duplicate triple removal mode) are deleted. </p><h4>Rfe10850 - Ag3 plugins for TBC 3.5</h4><p>TBC 3.5 no longer provides built-in support for AG3 databases. With this change, AG3 plugins are made available to work with TBC 3.5.  The plugins are not compatible with previous versions of TBC due to conflicts with the built-in support for AG3. </p><p>AG3 plugins for TBC 3.5 will be available from this Eclipse update site: </p><p><strong>http://franz.com/ftp/pub/agraph/eclipse/tbc/3.5</strong> </p><h4>Bug20408 - Implement encoded-ids for lisp remote-triple-store</h4><p>It is now possible to register, unregister and list encoded-id prefixes when using the remote lisp client. </p><h4>Bug20397 - Load triples from files faster on remote lisp client</h4><p>The remote lisp client now can load large files into the server, and will no longer run out of memory when doing so. </p><h4>Bug20378 - Improve duplicate reduction in UPI-map based cursors</h4><p>AllegroGraph reduces the number of triples examined during SPARQL queries by skipping subsequent duplicates when iterating over a cursor. This duplicate reduction was not occuring for cursors based on secondary indices (UPI-maps) which could lead to decreased query performance. This has been corrected. </p><h4>Bug20372 - Fix part printing for literals and resources with same name</h4><p>AllegroGraph would incorrectly print literals that had the same name as a resource. This is now fixed. </p><h4>Bug20355 - Durably save transactions on warm-standby client</h4><p>The warm-standby secondary machine now saves transaction log entries in a way that ensures they've been flushed to disk durably as soon as the entire commit has been read. </p><h4>Bug20336 - Fix inconsistency on warm standby secondaries</h4><p>Replication secondary instances for AllegroGraph would sometimes query and attempt to display inconsistent data while replication was copying transactions from the primary instance. This has now been fixed: AllegroGraph ensures that only data from transactions that have been fully been replayed is used. </p><h4>Bug20230 - Fix deletion slowdown under replication</h4><p>The replication server used a connection to the replicated triple store that ensured it would never expunge deleted triples, slowing down operations if many deletes had occurred.  Now, the replication server correctly expunges these triples and does not slow down. </p><a name='header3-4089' id='header3-4089'></a><h3>HTTP Client</h3><h4>Rfe10893 - Allow "unlimited" concurrent HttpClient connections</h4><p>Previously, the Java client's <code>AGServer</code> class would default to using an HttpClient that limited the number of concurrent connections per host to 20 (up from the HttpClient's default of 2, per RFC 2616 sec 8.1.4), which could still result in unnecessary confusion and socket churn when interacting with application level connection pool management.  With this change, the <code>defaultMaxConnectionsPerHost</code> and <code>maxTotalConnections</code> are both increased to <code>Integer.MAX_VALUE</code> to avoid conflict with application level connection pool management. </p><a name='header3-4092' id='header3-4092'></a><h3>SPARQL</h3><h4>Bug20382 - Sparql queries that returned <code>*</code> could confuse remote-triple-stores</h4><p>If a SPARQL query returned all of its variables (e.g.. SELECT * ...), then the remote-triple-store could fail to determine the actual variables returned by the query. This could in turn lead to incorrect results from clients that use this information (e.g., Gruff). This is now corrected. </p><a name='header3-4095' id='header3-4095'></a><h3>AGWebView</h3><h4>Rfe10924 - Enable download of server log file from WebView</h4><p>WebView now allows viewing and downloading the agraph.log server file for diagnostic purposes. To open the log, select the <strong>logfile</strong> entry in the <strong>Admin</strong> menu. </p><a name='header3-4098' id='header3-4098'></a><h3>Changes to the Lisp API</h3><p>No significant changes. </p><a name='header3-4100' id='header3-4100'></a><h3>Documentation</h3><p>No significant changes. </p><a name='header3-4102' id='header3-4102'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-4104' id='header3-4104'></a><h3>Java Client</h3><h4>Bug19798 - Illegal resource in Jena reified statements</h4><p>Previously, the Jena adapter's <strong>createReifiedStatement</strong> method could create reified statements containing illegal blank node ids that were based on generated UUIDs, manifesting in invalid part errors from the server.  With this change, these reified statements are now created using legal resources.  <strong>AGGraphMaker</strong> instances can now be created with a specified <strong>ReificationStyle</strong> (the default style is <strong>ReificationStyle.Minimal</strong>). </p><a name='header2-4107' id='header2-4107'></a><h2>AllegroGraph 4.3</h2><a name='header3-4108' id='header3-4108'></a><h3>Server Changes</h3><h4>Rfe10790 - improve logic for finding the sort-upi-map binary</h4><p>There were cases when the Lisp client could fail to locate the path to the sort-upi-map external program. This has been corrected. </p><h4>Rfe10665 - AG4 plugins for TBC 3.5.0</h4><p>With this change, the AG4 plugins have been modified to work with TBC 3.5.0. The plugins are not backwards-compatible with previous versions of TBC due to changes in its API. </p><p>AG4 plugins for TBC 3.5 will be available from the update site: http://franz.com/ftp/pub/agraph/eclipse/tbc/3.5 </p><h4>Rfe10636, Bug20160 - signal an error if a blank node ID is too big, support for more blank nodes per store</h4><p>AllegroGraph previously supported only 2^32 blank-nodes per triple-store. This is now increased to 2^56. Furthermore, if AllegroGraph tries to create a blank-node with an ID larger than the maximum supported, it will now signal an error rather than silently reusing existing nodes. </p><h4>Rfe10632 - Enable per-user security-filtering of stores.</h4><p>AllegroGraph now has a new class, security-filtered-triple-store, which allows specifying criteria that triples must fulfill in order to be accessible in that store. </p><p>AllegroGraph also automatically filters stores for users of a remote-triple-store if these users (or any of their roles) have security-filters defined. </p><h4>Rfe10090, Rfe10541 - Optimizations to AllegroGraph secondary indices</h4><p>Improves both the creation of secondary indices (UPI-maps) and their efficiency in use. Queries that make heavy use of secondary indices will operate more quickly. </p><h4>Rfe10508 - Japanese full text search</h4><p>An alternative text indexer for Japanese is provided.  From the Lisp client, it is available by supplying :japanese as the :tokenizer keyword argument to <a href="lisp-reference.html#create-freetext-index" title="description of create-freetext-index">create-freetext-index</a>.  When you use the Japanese tokenizer, we recommend you set :minimum-word-size to 2 or even 1 (the default is 3, but there are many Japanese words that consist of 2 characters). </p><p>The following is an example configuration for indexing Japanese text in literals of the object part of triples whose predicate is !&lt;&lt;description&gt;. </p>
<pre><code>(create-text-index "ja" :predicates '(!&lt;description&gt;)  
                        :stop-words nil  
                        :index-fields '(:object)  
                        :tokenizer :japanese  
                        :minimum-word-size 2)  
</code></pre><h4>Rfe10020 - add support for owl:SymmetricProperty</h4><p>AllegroGraph's RDFS++ reasoner now supports owl:SymmetricProperty so that it will make inferences like: </p>
<pre><code>P rdf:type owl:SymmetricProperty  
a P b  
===&gt; b P a </code></pre><p>In the process of implementing this addition, several other small efficiency improvements were made so that the reasoner is now usually faster even though it is doing more work. For example, the time to run all 14 LUBM-50 queries went from 10.04 seconds down to 9.44 seconds. </p><h4>Rfe8278 - Add ability to customize the tokenizer used by freetext indexing</h4><p>The Lisp API create-freetext-index takes two additional keyword arguments, border-chars and inner-chars, to fine-tune the word tokenization behavior. Each argument takes a freetext-charset object, specifying a set of characters that can appear at the borders of a word, or inside a word. A freetext-charset object can be created by a new API freetext-charset. </p><p>The following example creates a freetext index in which only alphanumeric characters and a hyphen #\- consists a word; that is, #. and #_ breaks words. </p>
<pre><code>(create-freetext-index "custom" :predicates '(!&lt;description&gt;)  
                       :inner-chars (freetext-charset '(:alphanumeric #\-))) </code></pre><h4>Bug20289 - Do not allow stored procedures to enter the debugger</h4><p>If a stored-procedure written in lisp calls the function error with a non-error condition, the AllegroGraph backend process running the stored procedure would enter the debugger. This resulted in an unresponsive backend. </p><p>Now, the backend will catch invocations of the debugger, report the failure, and continue running. </p><h4>Bug20273 - Suboptimal index queries broken</h4><p>Under certain circumstances, suboptimal index queries could return triples that did not match the query pattern.  This has been fixed. </p><h4>Bug20160, Rfe10636 - signal an error if a blank node ID is too big, support for more blank nodes per store</h4><p>AllegroGraph previously supported only 2^32 blank-nodes per triple-store. This is now increased to 2^56. Furthermore, if AllegroGraph tries to create a blank-node with an ID larger than the maximum supported, it will now signal an error rather than silently reusing existing nodes. </p><h4>Bug20133 - Select queries should create filtered triple-stores only as needed</h4><p>Prolog select queries were sometimes creating temporary graph-filtered triple-stores unnecessarily which wasted resources and time.  This is now corrected: graph-filtered triple-stores are created only when necessary. </p><h4>Bug19834 - Resource manager connection management bugs</h4><p>Previously, global variables were used to maintain connection information between Lisp clients and one of the AllegroGraph subprocesses.  This could cause problems if a single Lisp client made connections to two separate AllegroGraph servers or if an AllegroGraph server was stopped and restarted.  This has been fixed. </p><h4>Bug20037 - allow trailing slash on Server URL in AG4 dialogs</h4><p>Previously, putting a trailing slash on the Server URL in AG4 dialogs would result in an error message that was hard to debug. With this change, dialogs are now robust to trailing slashes. </p><a name='header3-4146' id='header3-4146'></a><h3>HTTP Client</h3><h4>Rfe10839 - Freetext index charsets and tokenizer in HTTP API</h4><p>The HTTP API for freetext index management now supports the optional arguments "tokenizer" as well as "borderChars" and "innerChars", which specify the tokenizer and character sets for word boundaries. </p><h4>Bug20250 - Fix federated remote stores in HTTP API</h4><p>The /session resource didn't correctly create sessions when specified using the &lt;http://example.com/repositories/test&gt; syntax. Now, POSTing to /session correctly opens a session on a remote triple store. </p><a name='header3-4151' id='header3-4151'></a><h3>SPARQL</h3><h4>Bug20305 - Encoded IDs were incompatible with  SPARQL CONSTRUCT queries</h4><p>SPARQL CONSTRUCT queries will not produce triples whose subject or predicate are literals. The check for this was incorrectly excluding triples with encoded IDs in the subject (or predicate) because these IDs have a different UPI type-code that the one used for resources. This has been corrected. </p><h4>Bug20288 - Encoded IDs don't work with SPARQL/XML and SPARQL/JSON output</h4><p>The SPARQL/XML results format would crash when used with encoded IDs; The SPARQL/JSON results format generated output but emitted encoded IDs as typed literals rather than as resources. Both of these problems are corrected. </p><a name='header3-4156' id='header3-4156'></a><h3>AGWebView</h3><h4>Rfe10728 - Improve WebView store overview user interface</h4><p>The AllegroGraph WebView store overview page now is better structured and allows easier access to commonly-used functions. </p><h4>Bug20304 - Fix codemirror for Internet Explorer 9</h4><p>Internet Explorer 9 users can now use WebView's text editor with syntax highlighting. </p><h4>Bug20302 - Fix loading more results in Internet Explorer</h4><p>WebView can now load more than 100 results (using the [more] link) in Internet Explorer. </p><h4>Bug20296 - Fix query result downloads in Firefox 3.</h4><p>Fix a JavaScript incompatibility that caused downloading query results from WebView to fail in Firefox version 3. </p><h4>Bug20203 - Fix WebView for newer Internet Explorer versions.</h4><p>Internet Explorer 8 and 9 support a new history tracking mechanism, and deprecated features that WebView used to keep track of history before. Now, WebView makes use of this new mechanism when it's available. This allows Internet Explorer to correctly run AllegroGraph WebView again. </p><h4>Bug20069 - Uploading file into a context from WebView is broken</h4><p>The error " is not a valid part" would always appear. This is now fixed. </p><a name='header3-4169' id='header3-4169'></a><h3>Changes to the Lisp API</h3><h4>Bug20146 - Export UPI hash-table functions from db.agraph.user</h4><p>In the transition from AllegroGraph 3 to AllegroGraph 4, the UPI hash-table functions ceased being exported from db.agraph.user. This is now corrected. </p><h4>Bug20145 - (Lisp API only) loading AllegroGraph should <code>provide</code> module :agraph4.</h4><p>AllegroGraph previously only provided the module :agraph which meant that using </p>
<pre><code>(require :agraph4) </code></pre><p>could load agraph4.fasl unnecessarily. This is fixed. <strong>AllegroGraph 5.0 note: the module to require is :agraph5 and the file is agraph5.fasl starting in version 5.0.</strong> </p><h4>Bug20144 - Fix interference from remote-triple-store ping</h4><p>To ensure that a remote-triple-store remains opened, AllegroGraph's lisp API sends a ping message in the background in regular intervals. Previously, it would use the same session object to record responses from the server as a user's requests. This would cause errors when a ping message interrupts a long-running request. </p><p>Now, AllegroGraph uses a separate session object on the client's side to send these ping messages. </p><a name='header3-4179' id='header3-4179'></a><h3>Documentation</h3><h4>Bug20149 - Correct documentation of datatype and predicate mappings (Lisp)</h4><p>The Lisp reference manual had several typos in its discussion of datatype and predicate mappings. These have been fixed. </p><a name='header3-4182' id='header3-4182'></a><h3>Python Client</h3><p>No significant changes. </p><a name='header3-4184' id='header3-4184'></a><h3>Java Client</h3><h4>Rfe10135 - Improve javadocs</h4><p>Added overview pages, more docs for classes and methods, and links to AllegroGraph documentation for introduction, catalog, federation, etc. </p><h4>Rfe10745 - Add Jena text indexing code example</h4><p>With this change, a Jena text indexing code example is now available in the distribution in JenaTutorialExamples.java as example 12; this will eventually also be written up in the Jena tutorial document, but the focus here is on making the code example available as it is useful on its own. </p><h4>Rfe10624 - AGQuery limit and offset modifiers</h4><p>With this change, the Sesame and Jena AGQuery classes now allow limit and offset to be specified by the query object, outside of any limit or offset specified in the query string, making it easier for apps to override these modifiers. </p><h4>Rfe10623 - Jena AGQueryExecution count methods</h4><p>With this change, the Jena api now supports counts queries via the AGQueryExecution#countSelect() and countConstruct() methods. Solutions are counted server-side and only the count is returned to the client. </p><h4>Rfe10492 and Rfe10493 - javadoc for AGRepositoryConnection</h4><p>Add javadoc that points to SessionPorts for relevant methods. Add javadoc for type mappings, linking to http and lisp docs. </p><h4>Rfe10452 - support N-Quads responses in the Java client</h4><p>With this change, the Java client now supports N-Quads responses from the server.  The property -Dcom.franz.agraph.http.defaultRDFFormat=NQUADS can now be used to configure the client to request N-Quads format by default for RDF statement responses; when this property is not present, the default format is TriX.  The method AGHttpRepoClient#setPreferredRDFFormat() can also be used to override the default RDFFormat on a per connection basis. </p><h4>Rfe10450 - Jena Prolog and transaction code examples</h4><p>With this change, Jena Prolog and transaction examples are now available in the distribution in JenaTutorialExamples.java as examples 17, 18, and 22; they will eventually also be written up in the Jena tutorial document, but the focus here is on making the code examples available as they are useful on their own. </p><h4>Rfe10447 - add AGGraphQuery#count() method</h4><p>With this change, the java client now supports counting for graph queries (e.g CONSTRUCT and DESCRIBE) with the AGGraphQuery#count() method.  Also added javadoc for the AGTupleQuery#count() method. </p><h4>Rfe10446 - add count() examples to the Java tutorial</h4><p>With this change, the Java tutorial shows how to use the AGTupleQuery#count() and AGGraphQuery#count() methods to to obtain query result counts without returning results (counting is done server-side, only the count is returned). </p><h4>Rfe10445 - add example/test getting triple ids via prolog</h4><p>With this change, example17 in TutorialExamples.java shows how to get triple ids via Prolog.  TripleIdTests has also been augmented to get triple ids via Prolog. </p><h4>Rfe10411 - Streaming large query results</h4><p>When AGTupleQuery.evaluate() is used for sparql and prolog queries, the results are returned by the server in sparql/xml format.  This is parsed by the Sesame library using a SAX XML parser and the results are collected in an ArrayList before the TupleQueryResult is returned.  For very large result sets, this will cause  an OutOfMemoryError. </p><p>Alternatively, AGTupleQuery.evaluate(handler) can be used where the handler methods are called as results are parsed.  This can handle any length results without a memory error, but the API is less convenient.  A new example has been added to the tutorial to demonstrate this: TutorialExamples.example3a() </p><p>A new class AGStreamTupleQuery can be used to wrap an AGTupleQuery so the TupleQueryResult will be streamed back.  This provides the familiar iteration API rather than a handler, but the http response is only parsed as the iterator is advanced.  The usage of this API is explained further in the javadocs: AGTupleQuery query = conn.prepareTupleQuery(QueryLanguage.SPARQL, "SELECT ..."); query = new AGStreamTupleQuery(query); TupleQueryResult results = query.evaluate(); </p><p>There is also a new method in AGRepositoryConnection that will cause the connection to automatically wrap all tuple queries to use streaming: AGRepositoryConnection.setStreamResults(boolean streamResults) </p><p>Instead of SAX, the AGStreamTupleQuery uses an XMLStreamReader for parsing.  Initial performance results suggest that in addition to being resistant to OutOfMemoryError this uses less overall memory than the SAX parser for small and medium result sets (10-500). </p><p>This approach of streaming results has not yet been applied to getStatements(). </p><h4>Rfe9445 - Upgrade slf4j, funnel through jcl, and add source jars</h4><p>With this change, the java client now uses slf4j-api-1.6.1, and uses slf4j-jcl-1.6.1 to funnel sesame and jena logging through commons-logging-1.1.1 (used by httpclient-3.1).  Source jars are also included for javadoc and to faciliate debugging. </p><a name='header2-4214' id='header2-4214'></a><h2>AllegroGraph 4.2.1c</h2><a name='header3-4215' id='header3-4215'></a><h3>Server Changes</h3><h4>Clarify what retain for replication means</h4><p>If the TransactionLogRetain is set to replication then all transaction logs will be saved until replication starts at which point those log files no longer needed will be archived. This behavior may be further modified in a future release. </p><h4>Bug20257 - fix convertdb for some rare cases</h4><p>The convertdb utility failed to upgrade some stores that had transaction logs with a certain size. Now it can correctly upgrade these stores. </p><h4>Bug20236 - Fix startup when HTTPProxy is specified in config</h4><p>AllegroGraph now starts up correctly when a HTTP proxy specification is present in the configuration file. </p><h4>Bug20223 - Fix agload for Turtle files</h4><p>A change in agload broke loading Turtle-formatted files with agload. Now, agload can correctly load the Turtle format again. </p><a name='header3-4224' id='header3-4224'></a><h3>HTTP Client</h3><p>No user-visible changes. </p><a name='header3-4226' id='header3-4226'></a><h3>SPARQL</h3><p>No user-visible changes. </p><a name='header3-4228' id='header3-4228'></a><h3>AGWebView</h3><p>No user-visible changes. </p><h4>Bug20200 - Clarify format support in import forms in WebView.</h4><p>AllegroGraph now supports loading .gz-compressed files (and autodetecting their file format) from the server's local file system. The file import dialogues in WebView also have a note about the file name format for autodetection. </p><a name='header3-4232' id='header3-4232'></a><h3>Changes to the Lisp API</h3><h4>Rfe10790 - improve logic for finding the sort-upi-map binary</h4><p>There were cases when the Lisp client could fail to locate the path to the sort-upi-map external program. This has been corrected. </p><a name='header3-4235' id='header3-4235'></a><h3>Documentation</h3><p>No user-visible changes. </p><a name='header3-4237' id='header3-4237'></a><h3>Python Client</h3><p>No user-visible changes. </p><a name='header3-4239' id='header3-4239'></a><h3>Java Client</h3><p>No user-visible changes. </p><a name='header2-4241' id='header2-4241'></a><h2>AllegroGraph 4.2.1a</h2><a name='header3-4242' id='header3-4242'></a><h3>Server Changes</h3><h4>Rfe10689 - Increase unique string limit to ~4B</h4><p>The limit on the number of unique strings in the string table was previously 1,431,655,765.  This limit has been increased to 4,294,967,295 entries. </p><h4>Rfe10562 - Change encoded-id marker to @@ (from @#)</h4><p>The marker used to indicate that a URI represents an encoded-ID has been changed from @# to @@. </p><h4>Rfe10532 - Return encoded ids in ascending order</h4><p>The .../encodedIds?prefix=""&amp;amount=# http request was returning the ids in reverse order. This has been fixed to return them in ascending sequential order. </p><h4>Rfe10521 - Deleted hash table management based on generation</h4><p>Deleted hash tables are now cleaned up as soon as they are no longer needed, preventing the store from accumulating unnecessary files. </p><h4>Rfe10200 - Regulate speed of mergers</h4><p>Triple index mergers now regulate their speed based on the number of triples to be merged and the rate at which triples are added after a merge has started. </p><a name='header2-4253' id='header2-4253'></a><h2>AllegroGraph 4.2.1.</h2><a name='header3-4254' id='header3-4254'></a><h3>Server Changes</h3><h4>Rfe10483, Rfe10528, Bug20012 - Inadequate transaction log durability</h4><p>When using the default <code>TlogSyncMethod</code> of "odirect", the durability of transaction log files was not correctly ensured. This release fixes that issue by preallocating transaction log files and fsyncing them before using them.  Additional transaction log files are created as needed.  In addition, transaction log files that are no longer needed are now recycled instead of deleted. </p><p>This change will have an impact on database creation time due to the initial preallocation.  To compensate for this, the default TransactionLogSize parameter has been changed from 1 gigabyte to 256 megabytes. </p><p>There is a new configuration parameter <code>DesiredTlogFiles</code> which specifies the number of transaction log files which should be preallocated at database creation time.  The default value is 2. Specifying a larger value helps lower the probability of additional transaction log files being created during commits. This parameter is documented in <a href="daemon-config.html">Server Configuration</a>. </p><h4>Rfe10475 - Improve I/O behavior under memory pressure</h4><p>When under memory pressure, Linux can sometimes generate far more I/O than expected when minor page faults occur during accesses to memory mapped files.  This can result in very poor performance, especially when the I/O device is already congested.  This change instructs the operating system not to perform these extra I/Os. </p><h4>Rfe10439 - RDSF++ reasoner now does not create duplicate inferred triples</h4><p>In some cases, the RDFS++ reasoner could follow multiple owl:sameAs paths and generate many duplicate inferred triples. This increased AllegroGraph's memory footprint and decreased RdFS++ reasoning performance. </p><p>The reasoner now generates only a single inferred triple for each owl:sameAs path when searching for sameAs statements with a fixed subject and predicate <em>or</em> for ones with a fixed predicated and object. </p><h4>Rfe10434 - Rename Lisp API function to duplicate-deletion-strategy</h4><p>The Lisp API function <code>duplicate-deletion-strategy</code> alters the way AllegroGraph manages duplicate triples during index optimization operations. It can be one of: </p>
<ul>
<li><p><code>t</code> - the same as <code>:spog</code> (see below).</p></li>
<li><p><code>nil</code> - do nothing to duplicates.</p></li>
<li><p><code>:spo</code> - ensure that no more than one triple with a given Subject,   Predicate and Object exists after index optimization operations are   complete. A triple may be deleted if it differs from another only in   its graph. </p></li>
<li><p><code>:spog</code> - ensure that no more than one triple with a given   Subject, Predicate, Object and Graph exists after index optimization   operations are complete. </p></li></ul><p>Previously, this function was called <code>delete-duplicates-during-merge-p</code>. </p><p>This setting is also available via the HTTP interface. </p><h4>Rfe10413 - Add check for 64-bit Linux</h4><p>Added a check to <code>install-agraph</code> and <code>configure-agraph</code> scripts to ensure that they're running on a 64-bit Linux. This should reduce confusion in the case where AllegroGraph Server was accidentally installed on a 32-bit Linux host. </p><h4>Rfe10400 - Minor cursor implementation changes</h4><p>Some changes were made to enhance AllegroGraph's cursor mechanisms. These do not alter existing cursor behavior but help pave the way for future improvements. </p><h4>Rfe10399 - Verify lisp client and server version match</h4><p>As the lisp client is very sensitive to changes in the backend API exposed by the AllegroGraph server, it now checks that it is connecting to the correct version of the server. </p><h4>Rfe10363 - Improved error message when a file cannot be found</h4><p>The error message generated when a database file is not found has been improved to make it more clear what is causing the problem. </p><h4>Rfe10354 - Redesigned --quiesce feature of agtestclient</h4><p>The quiesce functionality in agtestclient was unnecessarily complicated and inefficient.  The feature has been redesigned to require running on the host of the secondary server in question and also require the expected count and a timeout.  This is sufficient for the purposes for which the quiesce function is used.  Expected count must either be queried from the primary or the triple-count must be known beforehand. </p><p>A bug was also fixed with the order of the arguments in the delete function.  (They had been reversed.)  Also, help documentation was created, which can be accessed by running agtestclient with no arguments.  Finally, the --add argument was renamed to the more appropriate --add-random. </p><h4>Rfe10345 - Don't log warnings when opening NFS triple-stores.</h4><p>Opening a triple-store on NFS caused unnecessary warnings to be issued. These warnings are no longer logged. </p><h4>Rfe10342 - Command line wrapper for the lubm-generator Lisp module</h4><p><strong>Note</strong>: lubmgen can easily contaminate or erase a production database if used without clear understanding of its purpose. </p><h4>Rfe10337 - Improve cursor resource management</h4><p>Improve the management of the cursors AllegroGraph uses internally for triple counting and triple deletion. </p><h4>Rfe10335 - Improve logging of (adjusted) store parameters</h4><p>AllegroGraph will now log human-readable configuration values when opening a store if a human-readable presentation is available. (The system determines whether a value has a human-readable presentation or not. That is not under user control. Values which do not have a human-readable presentation are also logged but not in a human-readable way.) </p><h4>Rfe10308 - AllegroGraph can use UPI-maps to run queries in more cases</h4><p>Increased the number of times when AllegroGraph can use UPI-maps (secondary indices) to run queries. This improves the enhancements made in Rfe10141 and Rfe10142. </p><h4>Rfe10243 - opening database should honor existing merge mode as default</h4><p>It may have been possible that the duplicate removal mode is rolled back accidentally by reopening the database.  The problem is fixed. </p><h4>Rfe10184 - Improve custom hash table efficiency</h4><p>Improve the way AllegroGraph handles some internal hash table computations. This will provide some very small performance improvements to general AllegroGraph operations. Note that none of these operations occur in inner loops so the performance gains will not be markedly noticeable. </p><h4>Rfe10114 - Change default for TransactionLogRetain to "recovery"</h4><p>In prior releases, the default value for the TransactionLogRetain setting was "all", which meant that, unless configured otherwise, all transaction log files since the the database was created would be saved.  This release changes the default to "recovery", which means that only the transaction log files required for instance crash recovery are retained. See <a href="transaction-log-archiving.html">Transaction Log Archiving</a>. </p><h4>Rfe9338 - Improved error message due to session port connection failure</h4><p>When using methods that start a session (setAutoCommit, addRules, and registerSNAGenerator), if there is a connection error, the error message points to the documentation about SessionPorts. </p><h4>Bug20122 - Handle disk full on transaction log writing</h4><p>Previously, encountering a full filesystem while writing to a transaction log would result in a crash.  Now, AllegroGraph will (if possible) log a message to the logfile and to stderr noting the problem and will periodically retry the write operation until it succeeds. </p><h4>Bug20118 - graph type-mapping could lead to incorrect data</h4><p>If a triple was added with a graph field that was mapped to an encoded UPI (for example, a geospatial point or a typed literal) and the object field was not mapped (for example, a plain literal or a resource), then AllegroGraph would fail to correctly store the triple's object. This has been fixed. </p><h4>Bug20089 - encoded-ids not working in non-object fields for clients</h4><p>AllegroGraph was failing to translate encoded-IDs in fields other than the object field for any non-direct Lisp client. This has been fixed. </p><h4>Bug20050 - Improve speed of bulk load mode in agload</h4><p><code>agload</code> was incorrectly handling the --bulk parameter which caused it to perform significantly more slowly when bulk mode was turned on. With this change, bulk mode is 6 to 7 times faster than it was before. </p><h4>Bug20031 - agraph-backup backs up the same file twice</h4><p>Previously, agraph-backup was backing up one of the database files twice.  Though this did not result in a corrupt backup, it was wasting time and space.  This problem has been fixed. </p><h4>Bug19996 - Repair durability guarantees for NFS stores.</h4><p>The change to implement rfe10216 in AllegroGraph 4.2 accidentally broke durability guarantees on NFS stores: Transaction logs on NFS were opened in an asynchronous write mode, which could lead to commits getting lost in the case of a crash. </p><h4>Bug19969 - Correct problem printing times with fractional seconds</h4><p>If a fractional second had a value less than 0.001, then AllegroGraph would incorrectly print the time (or dateTime) using scientific notation.  It now prints these values correctly. E.g., it now prints 16:46:40.000133 rather than 16:46:40.1.33e-4. </p><h4>Bug19954 - Commit/rollback could sometimes result in crash</h4><p>Fixed a programming error which could potentially cause a commit or rollback to result in a program crash. </p><h4>Bug19950 - Handling of tranaction log files corrected</h4><p>In this release the 'recovery' and 'archive' values for the TransactionLogRetain catalog parameter function correctly. Previously these two values were treated as if 'all' were specified. </p><h4>Bug19933 - Made agload recognize "nq" file format (nquads).</h4><p>Previously, agload would reject files with extension .nq. Now they are correctly identified as nquad files and loaded. </p><h4>Bug19916 - Improve :terse output</h4><p>Modified the heuristic for the :terse output so that it will not emit empty strings. Previously, a URI like 'http://www.foo.com/bar/' would have a terse representation of ''; now it will use 'bar/'. </p><h4>Bug19836 - Date and datetime with negative year</h4><p>XSD requires BCE dates, for example, these are now accepted: </p>
<pre><code>(value-&gt;upi "-0002-04-12" :date)  
(value-&gt;upi "-0002-04-12T12:23:00Z" :date-time) </code></pre><h4>Bug19682 - Federated-triple-stores error for type-mappings</h4><p>Type mappings can now be used with federated stores where all component stores have the same type mapping, for example in methods such as collect-all-type-mappings and get-triples. Function collect-all-type-mappings returns the intersection of mappings for all component stores. </p><p>Mappings can still only be set on component stores, not a federated store. </p><h4>Bug19116 - Datatype-mappings are not applied to graph</h4><p>When adding a triple, if the graph is a literal with a datatype that can be mapped like object, it will be.  Subjects and predicates are not mapped at all. </p><p>At most 3 triples can be added, which is the same as before: </p>
<ol>
<li>with object and graph mapped by datatype </li>
<li>with object mapped by predicate-mapping and graph by datatype    if this results in a different triple than #1 </li>
<li>with no mappings if :preserve-strings is t </li></ol><a name='header3-4335' id='header3-4335'></a><h3>HTTP Client</h3><h4>Rfe10360 - Better HTTP error messages for encoded-id errors.</h4><p>Stack traces are no longer logged for too-wide encoded-id formats or bad re-registration of such ids. </p><h4>Bug20124 - Make number of initial HTTP workers configurable.</h4><p>The number of initial HTTP workers started by the AllegroGraph server used to be exactly the number of backends. However, that doesn't take into account any frontend sessions like WebView. This would cause long-running requests on startup (like opening a triple store) to cause shorter-lived requests to wait until the longer-running request was finished. </p><p>AllegroGraph now has a new top-level configuration parameter HTTPWorkers (defaulting to 50), which lets administrators specify how many HTTP worker threads to launch on startup. </p><h4>Bug20022 - Add location-rewriting to the AG reverse-proxy.</h4><p>The HTTP reverse-proxy that dispatched requests to server back-ends did not handle redirect responses with Location headers in any special ways. This could sometimes lead to clients being redirected to a backend URL, which did not work. The proxy now properly rewrites the Location header to point at the front-end URL. </p><h4>Bug20013 - Requests to back-ends with Expect: headers fail</h4><p>Due to a bug in the HTTP system, sending a request with a body an Expect: header (which CURL does by default) would cause a deadlock in the intra-server communication, and thus a timeout. This has been fixed. </p><h4>Bug19948 - Allow full HTTP delete-duplicates control</h4><p>The HTTP API used to expose deleteDuplicates as a boolean value, but there are actually three states: off, delete by SPO, and delete by SPOG. The strings "spo" and "spog" (as well as the existing booleans) can now be used in the HTTP API when inspecting or setting duplicate deletion. </p><a name='header3-4347' id='header3-4347'></a><h3>SPARQL</h3><h4>Rfe10486 - SPARQL query planning should not require the PSOGI index</h4><p>When a query involves filtering on potentially encoded triples (e.g., numeric or date ranges), then the SPARQL algebra query engine checks to see if certain ranges of triples exist during its planning phase. The checks that SPARQL makes requires the POSGI index and are inordinately slow if that index is not available. Previously, AllegroGraph would make the checks regardless. Now, it will now skip these checks if the index is not there. </p><h4>Rfe10374 - Improve efficiency of some SPARQL queries</h4><p>SPARQL's notion of equality requires AllegroGraph to examine several variants of some IRIs. For example, the literal "4" should be equivalent to the literal "4"^^xsd:string. </p><p>This change improves the efficiency of AllegroGraph's SPARQL equality computations. The performance improvement will depend on the query. </p><h4>Rfe10371 - Improve SPARQL's handling of DISTINCT LIMIT queries</h4><p>Improve SPARQL's performance for queries with a LIMIT whose solutions must be DISTINCT. </p><h4>Rfe10348 - Iri= for subject and predicates (generalize SPARQL constraints)</h4><p>Extended IRI= constraints for subjects and predicates. This allows queries like: </p>
<pre><code>select * where { ?s ?p ?o . filter( ?s = ex:foo ) } </code></pre><p>to operate as if they were written: </p>
<pre><code>select * where { ex:foo ?p ?o . } </code></pre><p>If multiple constraints are simultaneously operative, then only one will be used for a given pattern. Currently, these will be selected in the order: subject, object, predicate. </p><p>Queries for which this optimization is relevant will see greatly increased speed. </p><h4>Rfe10344 - Improve SPARQL statistical BGP reordering logic</h4><p>The statistical BGP reordering function could produce sub-optimal results if a SPARQL query had multiple levels of nested UNIONs or OPTIONALs. This could cause queries to take much longer than necessary. </p><h4>Rfe10312 - Optimize IRI= for object fields in SPARQL queries</h4><p>This optimization converts IRI= constraints for object fields in SPARQL queries into the equivalent storage level get-triples calls. Previously, a query like </p>
<pre><code>SELECT ?article  
WHERE { ?article rdf:type ?type .  
        ?article swrc:pages ?value  
        FILTER (?type = bench:Article ) } </code></pre><p>would fetch all of the rdf:type triples and then filter for those whose object field was bench:Article. Now the query will be executed as if it had been written as </p>
<pre><code>SELECT ?article  
WHERE { ?article rdf:type bench:Article .  
        ?article swrc:pages ?value  
 }  
</code></pre><h4>Rfe10118 - Added interface to SPARQL query analysis to Python client</h4><p>After calling RepositoryConnection.prepareTupleQuery() on a SPARQL select query, one can call analyze() on the resulting query object to get a string returned with information about which indices would be used to satisfy the query. </p><p>Currently, the query object's method is: </p><p>def analyze(self, analysisTechnique=None, analysisTimeout=None): </p>
<pre><code>Analysis is only available for SPARQL queries.  
 
analysisTechnique defaults to "executed", which executes  
the query to perform dynamic analysis. "static" analysis is  
the other option.  
 
For analysisTimeout, pass a float for the maximum number of  
seconds to run the query if executed. </code></pre><h4>Rfe9507 - Add initial support for SPARQL subqueries</h4><p>SPARQL subquery support includes ORDER BY, LIMIT, and DISTINCT. An example query would be: </p>
<pre><code>PREFIX fn:    &lt;http://www.w3.org/2005/xpath-functions#&gt;  
PREFIX boat:  &lt;http://example/boats/vocab/&gt;  
PREFIX boats: &lt;http://example/boats/&gt;  
SELECT ?boat ?boatName  
FROM boats:boats1  
FROM boats:boats2  
WHERE {  
  # Select the 2 boats with the shortest names.  
  { SELECT ?boat WHERE {  
    ?boat boat:placed ?position ;  
          boat:name ?name .  
    } ORDER BY asc(fn:string-length(?name)) LIMIT 3 }  
 
  # Select their crew and the boat's name.  
  ?boat boat:name ?boatName .  
}  
ORDER BY desc(fn:string-length(?boatName)) desc(?boatName) </code></pre><p>Note that subqueries are a pre-release SPARQL 1.1 feature; documentation and conformance tests are not yet available from the W3C, semantics are subject to change, and the implementation might be incomplete in a manner that is visible to user code. Please contact Franz support if you suspect that you have found a discrepancy. </p><h4>Bug20070 - fix problem with geospatial encoded UPIs and some output formats</h4><p>If a SPARQL query returned geospatial encoded UPIs and used the SPARQL-XML result format, then an error would occur. The same error could occur when serializing geospatial UPIs in the turtle format. </p><p>There was also a problem correctly serializing geospatial output using the SPARQL-JSON format: incorrect latitude and longitude values were sometimes generated. </p><p>All of these problems are corrected. </p><h4>Bug20047 - Can't download query results with missing values as CSV</h4><p>Taking a SPARQL query that produced unbound variables (say, with OPTIONAL) and asking for a comma-separated value return format would return an error. This has been fixed. </p><h4>Bug19989 - Sparql CONSTRUCT could generate invalid blank nodes</h4><p>SPARQL CONSTRUCT using the N-Triples format could generate invalid blank nodes. </p><h4>Bug19832 - Correct bug in low level SPARQL equality code</h4><p>Correct a bug in some rarely executed SPARQL equality code. The bug would have caused some queries in some datasets to fail to run. </p><a name='header3-4388' id='header3-4388'></a><h3>AGWebView</h3><h4>Rfe10370 - Use only relative URLs in WebView</h4><p>This makes it possible to set up a reverse-proxy that proxies, for example, host:80/allegrograph/ to host:10035/, without breaking WebView. </p><h4>Bug20051 - Downloading query results from WebView was broken</h4><p>After recent patch (bug20022), trying to download query results from WebView always resulted in a 404 response. This fixes that. </p><h4>Bug20016 - Fix horizontal scrolling in WebView for Firefox</h4><p>A bad CSS rule was preventing Firefox from ever displaying a horizontal scrollbar for WebView. This made it hard to inspect, for example, query result tables that were wider than the window. This is now fixed. </p><h4>Bug20009 - 4.2 WebView can't handle some data saved by 4.1</h4><p>Saved queries saved in 4.1 would cause an error when used in 4.2, because of a change in the way the client-side code is handling JSON data. This change fixes that, by falling back to the old parsing method if the new one fails. </p><h4>Bug19972 - Webview breaks when it doesn't find JSON support</h4><p>On older browsers without a JavaScript JSON object, WebView's detection of that object was failing, causing the whole script to abort. It now properly detects, the functionality, replacing it when not present. </p><a name='header3-4399' id='header3-4399'></a><h3>Changes to the Lisp API</h3><h4>Rfe10420 - Add lisp client function optimize-indices</h4><p>AllegroGraph's Lisp client now has a function <a href="lisp-reference.html#optimize-indices" title="description of optimize-indices">optimize-indices</a> that will cause the server to rearrange the indices for optimal query performance. This optimization pass can take a long time and cause a lot of I/O operations to be performed on large stores. </p><h4>Rfe10066 - Add option to use rapper for load-turtle</h4><p>The lisp API load-turtle now has a :use-rapper-p keyword parameter. See load-rdf/xml documentation for argument usage details. </p><h4>Rfe9715 - Lisp client package now includes Lisp tutorial examples</h4><p>The subdirectory <em>tutorial</em> now holds the Lisp and data example files discussed in the documentation. </p><h4>Bug19672 - Triple-store-exists-p leaks server information</h4><p>The Lisp client's successful return value from triple-store-exists-p sometimes provided the store's path on the server's filesystem. </p><p>The API has been fixed to return only the values nil or t. </p><h4>Bug19133 - get-triple now applies geospatial mappings</h4><p><a href="lisp-reference.html#get-triple" title="description of get-triple">get-triple</a> now correctly applies geospatial mappings to the triple returned. Also, the <a href="lisp-reference.html#get-triple" title="description of get-triple">get-triple</a> now returns a fresh triple (rather than one which might be reused by internal mechanisms). </p><a name='header3-4411' id='header3-4411'></a><h3>Documentation</h3><h4>New JavaScript document for programming the server</h4><p>See <a href="javascript.html">JavaScript</a>. </p><h4>New Security document describing data security</h4><h4>Rfe10341 - Improve documentation search</h4><p>Added basic documentation searching to the AllegroGraph documentation. </p><a name='header3-4417' id='header3-4417'></a><h3>Python Client</h3><h4>Rfe10505 - use session to get new blankNodeIds</h4><p>AGValueFactory was using the main repository url to get blank node ids.  Use connection session instead if available. Using the session can reduce load on the primary server. </p><p>If the ValueFactory was created by Repository instead of RepositoryConnection, the old behavior remains. </p><h4>Rfe10418 - Call indices/optimize from Python</h4><p>Added an optimizeIndices(level, wait) method to RepositoryConnection for exposing the http indices/optimize POST request to Python client. </p><h4>Rfe10326 - Support deleteDuplicates setting from Python client</h4><p>The Catalog.createRepository function now has a deleteDuplicates keyword argument for setting the store's deleteDuplicates behavior on creation. If unspecified, the behavior is the server's default setting. </p><p>The store's deleteDuplicates setting is also available from a Repository object instance either as a property variable (delete_duplicates) or as setDeleteDuplicates and getDeleteDuplicates methods. This is a per-store setting. </p><p>See the <a href="http-protocol.html">HTTP Protocol - SPARQL Endpoint</a> documention for setting values and behaviors (text search for deleteDuplicates). </p><h4>Rfe10325 - Added evalJavaScript to Python client</h4><p>Added an evalJavaScript function to the RepositoryConnection class for evaluating server-side JavaScript code. </p><p>See the server's <a href="javascript.html">JavaScript</a> documentation for details on programming the server in JavaScript. </p><a name='header3-4430' id='header3-4430'></a><h3>Java Client</h3><h4>Rfe10389 - Upgrade to sesame 2.3.2</h4><p>With this change, the java client distribution has been upgraded to use openrdf sesame 2.3.2, a minor upgrade from 2.3.1. </p><h4>Rfe10373 - Support deleteDuplicates mode in java</h4><p>With this change, the Java Client supports setting a repository's policy for deleting duplicates using methods AGRepository#setDeleteDuplicatesMode and AGRepository#getDeleteDuplicatesMode. </p><h4>Rfe10372 - Support periodic commit during add/load</h4><p>With this change, the java client now supports the /statements commit parameter for periodic commits during add/load via the AGRepositoryConnection's setUploadCommitPeriod and getUploadCommitPeriod methods. </p><h4>Rfe10257 - Support script loading in sessions</h4><p>Added method to AGRepositoryConnection: addSessionLoadScript(String scriptName) </p><p>When a dedicated session is created, the named scripts on the AllegroGraph Server will be loaded. </p><h4>Rfe10256 - Support loadInitFile switch in java</h4><p>Added method to AGRepositoryConnection: setSessionLoadInitFile(boolean loadInitFile) </p><p>When a dedicated session is created, the initFile on the AllegroGraph Server will be loaded if this param is true. </p><p>Javadocs on AGRepositoryConnection reorganized to describe sessions. </p><h4>Rfe10201 - Support adding N-Quads from java</h4><p>With this change, the java client now supports adding N-Quads data from Sesame and Jena using the RDFFormat AGRDFFormat.NQUADS and the language "NQUADS", respectively. </p><h4>Rfe10177 - Support getting statements by id</h4><p>With this change, the java client now supports getting statements by triple id using the AGRepositoryConnection getStatements(String... ids) method.  Note that there is currently no method for obtaining a statement's id in the java client, so this api is for experimental use by developers and subject to change. </p><h4>Rfe10174 - Support adding Turtle from Sesame and Jena</h4><p>With this change, <a href="http://www.w3.org/TR/turtle/" class="external" target="_blank">Turtle formatted</a> data can now be added to a repository using the <a href="http://rdf4j.org/" class="external" target="_blank">RDF4J</a> and Jena APIs. </p><h4>Rfe10059 - SPOGI triple cache management</h4><p>With this change, the SPOGI-cache can now be managed from the java client using AGRepositoryConnection methods enableTripleCache(size), getTripleCacheSize(), and disableTripleCache(). </p><h4>Rfe9436 - Session lifetime management</h4><p>With this change the lifetime (maximum idle time) of a session can be set using the AGRepositoryConnection#setSessionLifetime method. The default session lifetime (in effect when not set with the method above) can be set with the AGHttpRepoClient.setDefaultSessionLifetime method.  When none of these are set, the default session lifetime is 1 hour. </p><h4>Rfe8362 - Allow geospatial queries against graph/context field</h4><p>A boolean useContext parameter can be given to /geo/box, /geo/circle, /geo/haversine, and /geo/polygon, to make them query the context field, rather than the object field of the triples. </p><h4>Bug19906 - Writing a JavaScript NaN value as JSON loops forever</h4><p>When running, for example, the JavaScript program 'NaN', and asking for a JSON response, the server would never respond, because the float-printing code didn't handle 'special' float values. We now convert NaN and Infinity to strings in JSON output. </p><h4>Bug19342 - Java LUBM Prolog and SPARQL queries</h4><p>With this change, Java LUBM Prolog and SPARQL queries are updated to use distinct in appropriate places and located in the test.lubm package as AGLubmProlog and AGLubmSparql; ant targets lubm-prolog and lubm-sparql have been added to facilitate running the queries from the command line. </p><a name='header2-4460' id='header2-4460'></a><h2>AllegroGraph 4.2</h2><p>The new (in 4.2) document <a href="release-notes.html">Release Notes</a> has information about the 4.2 release. The document you are reading simply lists, for the current and for previous releases, user-visible changes (new features, bug fixes, and other modifications) in an abbreviated format. All the 4.2 changes listed here are also listed in the Release Notes but that document does not list changes in earlier releases. We suggest that users start with that document and refer to this one only if they need information about earlier releases. </p><p>Welcome to AllegroGraph 4.2. See <a href="release-notes.html">Release Notes</a> for general release information. The following, organized by category, are user-visible changes in AllegroGraph 4.2. </p><a name='header3-4463' id='header3-4463'></a><h3>Server Changes</h3><h4>Rfe10293 - Warn against using ReiserFS.</h4><p>As ReiserFS causes long delays on checkpoints, AllegroGraph now warns (in the server log file) if a store resides on ReiserFS. To ease debugging, it also logs the file system types of every store directory now. </p><h4>Rfe10267 - Do not request duplicate removal if there are no duplicates detected</h4><p>Internal handling of duplicate removal process is slightly improved. This fix also eliminates excessive "Dupes deleted: 0" messages from the agraph.log file. </p><h4>Rfe10255 - Allow minimum text-index word size of 1</h4><p>It is now possible to create freetext indices with a minimum word size of 1 character (the minimum used to be 2). </p><h4>Rfe10216 - Support alternative tlog synchronization methods.</h4><p>AllegroGraph now supports a new per-catalog configuration option, TlogSyncMethod, which allows users to specify one of three synchronized writing methods for transaction logs: ODIRECT, SYNC, and fsync. </p><p>As before, ODIRECT is the default and the recommended choice on ext3 file systems. For catalogs residing on non-ext3 file systems, the other choices may yield performance benefits. </p><h4>Rfe10191 - Have install-agraph pass its arguments to configure-agraph</h4><p>You can now do './install-agraph /dir/ --non-interactive ...' to install and configure agraph in a single command. </p><h4>Rfe10182 - Improve efficiency when waiting for an in-memory chunk</h4><p>Previously, when waiting for an in-memory chunk to become available, a commit operation would poll once per second.  The polling has been replaced with a wait on a semaphore which will result in immediate notification when an in-memory chunk becomes available.  This results in lower average times for commits that must wait for in-memory chunks. </p><h4>Rfe10173 - Upgrade plugins to support TBC 3.4.0-Beta1</h4><p>Previously the AllegroGraph plugins were only supported on TBC 3.3.x; with this change, the plugins can also be used with TBC 3.4.0-Beta1. </p><h4>Rfe10167 - Log euid and runas information at daemon startup.</h4><p>AllegroGraph now logs which user started the AllegroGraph service daemon, which user it was meant to switch to once running, and the currently effective user ID. </p><h4>Rfe10162 - Perform a clean shutdown on agraph-control stop</h4><p>Previously, running the agraph script with the stop argument would not verify that open databases were shut down correctly, leading to a forced recovery from transaction logs upon next startup. </p><p>Now, running the agraph script with the stop argument will wait for up to 60 seconds for open triple-stores to shut down cleanly. </p><p>To get the quicker shutdown behavior, use force-stop argument or kill the Service Daemon process with the QUIT signal. </p><h4>Rfe10156, Rfe10157 - Improve lock acquisition and store creation on NFS.</h4><p>Previously, creating a triple-store left open a very narrow window in which another process could clobber the store parameters. Now, the triple-store is locked immediately on creation. Additionally, newly-created triple-stores can now be cleaned up correctly when created on NFS. </p><h4>Rfe10149 - Support setting a graph for inferred triples in HTTP sessions</h4><p>Using the syntax &lt;store&gt;[rdfs++#<urn:mygraph>] it is now possible to specify which graph should be used for the inferred statements in a reasoning store created as an HTTP session. </p><h4>Rfe10147 - Export 'custom-service' macro from the db.agraph package</h4><p>This macro was crudely inserted directly into db.agraph.user before. It is now imported there from db.agraph, like all other AllegroGraph functionality. </p><h4>Rfe10143 - support bulkMode in connections</h4><p>With this change, connections can now be put into bulkMode. When in bulkMode, data can be added/loaded more quickly, but there is no guarantee of durability in the event of a crash. Added method AGRepositoryConnection#setBulkMode to set the connection's bulkMode (defaults to false), and added method AGRepositoryConnection#isBulkMode to check the mode. </p><h4>Rfe10141, Rfe10142 - Use UPI-maps more often inProlog queries</h4><p>Improved the Prolog query optimizer to use UPI-maps in more cases. Also added a new function, <code>qm</code>, that will use a UPI-map whenever possible. The optimizer changes will help existing queries run more quickly; the new functor will allow more hand-tuned query optimizations. </p><h4>Rfe10117 - implement run-time (dynamic) query index analysis</h4><p>Query index analysis now comes in two flavors: the existing :static flavor (from rfe10075) and the new :executed flavor. The later provides an accurate account of the index usage because it actually runs the query while monitoring which indices are touched. Because the query is run, this flavor of analysis can be much more time consuming. </p><p>Note that the default analysis technique is to use the new :executed flavor. You can use a different technique by using the queryAnalysisTechnique query parameter. You can also specify a timeout using the queryAnalysisTimeout parameter. See <a href="query-analysis.html">Query Analysis</a>. </p><h4>Rfe10069 - AllegroGraph v4.0.6 introduced a dependency on a patch to update message digest functions. Now, loading the AllegroGraph client will fail early if this patch is missing, and will report an actionable error. </h4><p>In addition to the check for the SHA1 patch, AG will now report missing patch names to the user, and offer to install these patches specifically. </p><h4>Rfe10021 - Support Soundex freetext indices</h4><p>This adds a supported freetext wordfilter 'soundex', which will reduce words to their Soundex equivalent when indexing or searching. Soundex is described in <a href="http://en.wikipedia.org/wiki/Soundex" title="Soundex" class="external" target="_blank">this Wikipedia article</a>. </p><h4>Rfe9877 - Lazier collection of FTI results</h4><p>The triple-ids matching a free-text query will no longer all be accumulated at the start of the query, but (as far as possible) lazily, while triples are being fetched. This should improve performance of limited queries with lots of results. </p><h4>Rfe9861 - Improve method of sending an x-rdftransaction</h4><p>Previously, sending an application/x-rdftransaction request required escaping to the client's http layer.  With this change, the method AGRepositoryConnection#sendRDFTransaction can now be used; this method is useful for bundling add/remove operations into a single request and minimizing round trips to the server.  Changes are committed iff the connection is in autoCommit mode.  For increased throughput when sending multiple rdftransaction requests, consider using autoCommit false and committing less frequently. </p><h4>Rfe9746 - Various improvements to agload</h4>
<ul>
<li>Added the --rapper command line option to tell agload to   use the external rapper program when parsing RDF/XML. </li>
<li>Added :trix to the list of supported input formats</li>
<li>Added :save as an error strategy to write errors to   the file agload.log and continue. </li>
<li>Added --recursive to process source directories recursively.</li></ul><h4>Rfe9657 - Unattended execution of configuration script</h4><p>The configure-agraph script now has --non-interactive mode, where all its parameters are specified on the command line, so that it can be called from a script without human intervention. </p><h4>Rfe9631, Rfe10028 - db-get-triples improvements, UPI map usage</h4><p>Improved the performance of AllegroGraph's internal get-triples functors and extended them to use secondary indices (UPI maps) when they are available. </p><p>This greatly improves the performance of many standard queries for both SPARQL and Prolog select. For example, the SP2 benchmark for 10,000 authors goes from a total time of 112.58 seconds to 37.91 seconds. </p><h4>Rfe9622 - support getting the server's version information</h4><p>With this change, the client can now get the server's version, build date, and revision information using the AGServer methods getVersion(), getBuildDate(), and getRevision(), respectively. </p><h4>Rfe9517 - Unify AServe and AGraph messages in the AGraph log</h4><p>Our HTTP server used to output log messages in its own format. We now route these through the AGraph logging system, causing them to follow a unified format. </p><h4>Rfe9515 - Drop deleted triples from text index during merge.</h4><p>The freetext index used to never un-index anything it had indexed. It now leaves out triples that have been deleted when merging index chunks, which will prevent unbounded index growth in stores where lots of triples are being deleted. </p><h4>Rfe9470 - Reduce madvise calls during compressed index lookup</h4><p>Small performance improvement during load and query. </p><h4>Rfe9296 - Transactionally safe duplicate triple elimination</h4><p>There are improvements in the functionality to remove duplicate triples. Removal is done more eagerly and more robustly.  When opening a database, you can pass one of the following values as the :delete-duplicates-during-merge argument: </p>
<ul>
<li>nil     - do not remove duplicates (default)</li>
<li>:spog   - duplicate triples with the same s, p, o and g are deleted.</li>
<li>:spo    - duplicate triples with the same s, p, o are deleted</li>
<li>t       - same as :spog, for backward compatibility.</li></ul><h4>Rfe8414 - Add encoded-ids to AllegroGraph</h4><p>Adds support to register and query encoded-ids and to use these to generate sequences of UPIs in a triple-store. </p><h4>Bug19910: agraph-recover now returns 0 when successful, 1 otherwise</h4><p>Agraph-recover now correctly returns 0 to shell when successful. (see <a href="point-in-time-recovery.html">Point-in-Time Recovery</a>). </p><h4>Bug19897 - SHM hangs if socket creation fails</h4><p>Previously, if a socket creation failure occured in the SHM server (which is a critical subprocesses associated with every database instance), database startup would hang.  Now the error is immediately reported, allowing AllegroGraph server to otherwise continue operating. </p><h4>Bug19891 - Fix log level test for log-backtrace and when-debugging.</h4><p>Error logging no longer ignores the preferred log level for certain messages. </p><h4>Bug19888 - Prevent logging gratuitous errors on forced shutdown.</h4><p>AllegroGraph no longer leaves error messages in the server log file when force-terminated with the killall command. (Trying to write such log messages could result in the service daemon trying to communicate with dead processes. </p><h4>Bug19864 - Some cursors could fail to correctly free resources</h4><p>There were situations in SPARQL querying where a cursor could fail to correctly release its resources even when it was correctly discarded. This could lead to resource starvation. This is now fixed. </p><h4>Bug19848 -- Improve behavior of <code>qm</code> when UPI-maps are not available</h4><p>The <code>qm</code> functor now gracefully drops back to the behavior of the <a href="lisp-reference.html#q" title="description of q">q</a> functor when UPI-maps are not available. Previously, it would signal an error. </p><h4>Bug19842 - Error message server-pid-and-client-pid-must-match-error</h4><p>Fix error message when server is running as agraph and client is running as root. </p><h4>Bug19813 - Fix store parameter merging for configured values.</h4><p>Opening a triple-store by passing configuration parameters to open-triple-store now correctly overrides those values that are already present in the store's parameters configuration file. </p><h4>Bug19816 - FTI Merger sometimes produces corrupt chunks</h4><p>In a database with deleted triples, it was possible for the text-index merger to output a chunk that could not be read, which would bring down the whole FTI subsystem. </p><h4>Bug19800 - support empty enumerations in owl:oneOf</h4><p>AllegroGraph's RDFS++ reasoner signaled an error when an owl:oneOf claimed that some class X was one of the empty set. Now it works correctly for this case too. </p><h4>Bug19791 - Fix checkdb's --port argument.</h4><p>Previously, the checkdb utility could check triple-stores only if they were served on the default port, 10035. Now, it uses the value from its --port argument to determine the port to connect to. </p><h4>Bug19786 - Checkdb now exits with 0 on success.</h4><p>The checkdb utility now follows the unix convention of returning 0 if no problems were detected. </p><h4>Bug19785 - Convertdb now exits with 0 on success.</h4><p>The convertdb program now follows the unix convention of returning the status code 0 if there were no errors. </p><h4>Bug19777 - Replication to multiple secondaries improved</h4><p>The speed of replication will no longer be determined by the slowest secondary.  Each replication job will now proceed as fast as each secondary database can process the data </p><h4>Bug19766 - Sub-optimal index selection</h4><p>Previously, in certain circumstances (such as when a range query was being used and one or more of the standard index flavors were not available) the index flavor selection code would exclude some index flavors that it could have used to satisfy a query more efficiently. This has been fixed. </p><h4>Bug19773 - Dropping an index is not crash recovery proof</h4><p>Fixed a bug where dropping an index followed by uncleanly shutting down a database would result in an error during restart recovery. </p><h4>Bug19765 - Detect more cases of string table corruption.</h4><p>The checkdb program can now detect many more inconsistencies in string tables. </p><h4>Bug19764 - N-Quad output was incorrect</h4><p>The output of AllegroGraph's N-Quad serializer when printing single triples was incorrect. </p><p>This is now fixed. </p><h4>Bug19697 - improve performance of part printing</h4><p>Increased the speed and memory efficiency of part printing. </p><h4>Bug19657 - Fix race-condition in text-index merger</h4><p>The merger could sometimes pick the chunks it was to merge from an outdated set of chunks, resulting in chunks being merged multiple times. This would cause duplicate triples to show up in FTI search results. </p><h4>Bug19600 - direct-upi wire format does not handle nil values</h4><p>The wire format used to communicate query results to a remote-triple-store broke when given a nil value, though the result of SPARQL queries with an OPTIONAL part may return them. This is now fixed. </p><h4>Bug19587 - Suboptimal encoding of some characters in shm-queue.</h4><p>Some characters were being encoded with an extra unnecessary byte. This problem has been corrected. </p><h4>Bug19578 - Clearnamespaces XMLTransaction tag is broken</h4><p>There was a bug in the XMLTransaction parser that causes requests containing a &lt;clearNamespaces/&gt; tag to fail. This has been rectified. </p><h4>Bug19550 - Fix reification in rdf/xml parser</h4><p>Fixed a bug in which certain statements imported from RDF/XML files would not be reified correctly. </p><h4>Bug19549 - RDF/XML parser loses the trailing /</h4><p>When importing from RDF/XML sources, AllegroGraph used to rewrite URIs that came without a path, but with a trailing slash and import them without the trailing slash (e.g., "http://franz.com/" would be imported as "http://franz.com"). Now, it imports all URIs verbatim. </p><h4>Bug19530 - Fix off-by-one error in text-index code.</h4><p>Adding a 255-character (the maximum) word to a text index would cause searching and merging of index chunks to break, because a too-small buffer was allocated when traversing the index. This is now fixed. </p><h4>Bug19522 - Prevent spurious warning in some Prolog select queries</h4><p>If both :limit and :count-only were specified in a Prolog select query, AllegroGraph would signal a spurious warning. This is now corrected. </p><h4>Bug19517 - improve Lisp API for remote-triple-stores</h4><p>Previously, if a <code>:url</code> parameter was used, AllegroGraph would ignore other parameters to <code>create-triple-store</code> like :user and :port that may be inconsistent with :url value.  AllegroGraph now ensures that the <code>:url</code> and any other parameters agree and merges parameters into the <code>:url</code> if necessary. This means that you can now use constructs like: </p>
<pre><code>(create-triple-store "foo"  
                     :triple-store-class 'remote-triple-store  
                     :url "http://blade4.franz.com"  
                     :catalog "java-tutorial"  
                     :user "test" :password "xyzzy"  
                     :port 11101) </code></pre><h4>Bug19515 - Correct precision loss in printing of RDF time and dateTimes</h4><p>Certain RDF time and dateTime values with fractional seconds could fail to print all of the digits stored for the value. This patch corrects this problem. </p><h4>Bug19508 - Prevent text-index from leaking files on crashes</h4><p>When processes crashed 'hard' (hang, or kill -9), the text index would sometimes leave files around that it never cleaned up. It now takes care to (at some point) delete every file it creates. </p><a name='header3-4594' id='header3-4594'></a><h3>HTTP Client</h3><h4>Rfe10278 - Alphabetize store and catalog lists in HTTP responses</h4><p>The lists of repositories and catalogs returned through the HTTP API were ordered more or less randomly. This made finding a repository in a long list in WebView cumbersome. They are now sorted by name. </p><h4>Rfe10234 - Inefficient limited Prolog queries over HTTP</h4><p>The HTTP server used to fetch all results, then throw away the extra ones, when executing a Prolog query with a limit argument. It now only fetches needed results. </p><h4>Rfe10230 - Accept application/x-turtle as a synonym for text/turtle</h4><p>Some systems are still using the pre-standard MIME type for Turtle documents. The AllegroGraph HTTP server now accepts that as a content-type when uploading triples. </p><h4>Rfe10220 - Provide an HTTP interface for controlling bulk mode</h4><p>It used to be only possible to turn on bulk-load mode per load request. This was slow when using many small requests. In a session, it is now possible to persistently turn bulk mode on and off through requests to /session/bulkMode. </p><h4>Rfe10210 - Don't backtrace on unsupported-db-version error</h4><p>The HTTP server no longer logs a backtrace and returns a server-error code when trying to open a store with the wrong version. Instead, it returns a PRECONDITION FAILED error. </p><h4>Rfe10165 - Expose turtle loading over HTTP.</h4><p>The /statements HTTP service now accepts request bodies in Turtle format, using a Content-Type header of text/turtle. Such files can now also be loaded from WebView. </p><h4>Rfe10078 - Make HTTP protocol no longer hide inaccessible repositories.</h4><p>It used to be that HTTP services /repositories and /catalogs hid all repositories and catalogs not accessible by the current user. This was unnecessarily confusing. Now all present objects are returned, with readable and writable flags indicating whether the current user has access to them. </p><h4>Rfe10009 - Implement Turtle loading</h4><p>Loading of files in the Turtle (Terse RDF Triple Language) format is now supported. </p><h4>Rfe9986 - Support Sesame 2.2-style XML transactions</h4><p>The Sesame project, which is the origin of the XML transaction format our HTTP server supports, have slightly changed the format to be simpler and more flexible. We now support this update, while remaining compatible with the old-style transactions. </p><h4>Rfe9912 - Remove SharedMemSize parameter from HTTP protocol and HTTP docs</h4><p>The SharedMemSize parameter was still mentioned in the HTTP protocol docs, and understood by some HTTP services, even though it is no longer used. </p><h4>Rfe9910 - Reuse sockets for backend-frontend communication</h4><p>Use HTTP keep-alive to reuse the sockets that the front-end uses to talk to the back-end. </p><h4>Rfe9838 - Use HTTP keep-alive in the remote Lisp client.</h4><p>Lisp remote-triple-stores now re-use their sockets when making HTTP requests. </p><h4>Bug19909 - Inter-server HTTP communication should use local addresses</h4><p>When the server tried to address itself over HTTP, it would often use the URL provided in the HTTP request that trigerred this communication. If that came from outside the local network, the address in this URL might not be useable. It now uses a local address. </p><h4>Bug19871 - HTTP server does not unescape \u in resources</h4><p>In resources passed to the HTTP server either through HTTP parameters, or through JSON data, N-Triples backslash escape sequences were left in the literals, rather than being unescaped. The server now properly handles these. </p><h4>Bug19846 - Ensure the HTTP client explicitly frees SPARQL cursors</h4><p>SPARQL queries from the HTTP client did not explicitly discard the cursor they created. This could cause resource exhaustion in situations where many, many queries were operating simultaneously. This is now fixed. </p><h4>Bug19801 - HTTP character encoding should not depend on system locale</h4><p>The system's default character encoding was accidentally being used when writing HTTP responses. This worked fine on systems with a UTF-8 locale, but caused the server to return inconsistently encoded responses on other locales. </p><h4>Bug19661 - HTTP JSON output for query results truncates row on first unbound result.</h4><p>The code that wrote out SELECT query results in application/json format would stop writing a row at the first null it encountered, leaving that null and any values after it out of the result. </p><h4>Bug19616 - Allow multiple contexts to be specified in HTTP /size</h4><p>Contrary to the Sesame docs, we only accepted a single context argument to our /size HTTP service. This has now been fixed -- you can pass multiple context parameters, and the returned value will be the sum of their sizes. </p><a name='header3-4631' id='header3-4631'></a><h3>SPARQL</h3><h4>Rfe10207 - Efficiency improvement for some SPARQL graph queries</h4><p>Improve the way the SPARQL engine handles simple GRAPH clauses with a variable graph argument that does <em>not</em> appear within the rest of the clause. For example: </p>
<pre><code>select ?someGraph ?o  
where {  
 ex:a ex:inGraph ?someGraph .  
 graph ?g { ex:a a ?o . }  
} </code></pre><p>SPARQL semantics dictate that the query act <em>as if</em> the graph clause is checked for every graph in the dataset. In this case, however, it is clear that the value of <code>?g</code> cannot alter the behavior of the inner query and that the intent is to determine the graph slots of any of the selected triples. </p><p>Note that this optimization is currently very conservative and only occurs when the graph clause is a simple BGP. Future work will extend the behavior to more complex queries. </p><h4>Rfe10061, Bug19663 - Improve SPARQL negation-as-failure parsing</h4><p>Nested instances of the SPARQL negation-as-failure idiom were not being parsed correctly leading to incorrect query results. This fix corrects the problem. </p><h4>Rfe10030 - Share statistical planner between Prolog and SPARQL</h4><p>Use the foundations of the Prolog select statistical planner in SPARQL queries to reorder BGPs. This improves the speed of many SPARQL queries. Note that this planner requires the POSGI index. If this index is not available, then the <em>coverage</em> planner is used instead. </p><p>Because the planner is statistical in nature, it will <em>not</em> always choose the best plan. In general, performance is improved (for example, the 10,000-triple SP2 benchmark queries almost double in speed (from 56-seconds down to 33-seconds) but some queries go slightly slower using the new planner.  We will continue to enhance the statistics used and the planner's capabilities in future releases. </p><p>If your queries are running more slowly than expected, you can tell SPARQL to use the older coverage-based heuristic planner or tne identity planner (i.e., the planner that does no clause rearranging. Planner selection varies by client. See the client SPARQL documentation for more details. </p><h4>Bug19809 - fti:matchExpression is sometimes treated like fti:match</h4><p>There was a bug in the SPARQL code that sometimes caused S-espression-style text queries (as per fti:matchExpression) to be parsed as textual queries (fti:match). </p><h4>Bug19681 - fix SPARQL problem in queries using both FROM and FROM NAMED</h4><p>A SPARQL query that used FROM and FROM NAMED together to create the dataset could incorrectly omit some of the the graphs mentioned in the FROM clause. This could cause the query to produce the wrong results. </p><p>This problem has been corrected. </p><h4>Rfe10061, Bug19663 - Improve SPARQL negation-as-failure parsing (repeated from Rfe10061 listing)</h4><p>Nested instances of the SPARQL negation-as-failure idiom were not being parsed correctly leading to incorrect query results. This fix corrects the problem. </p><a name='header3-4650' id='header3-4650'></a><h3>AGWebView</h3><h4>Rfe10300 - Allow optimizing of stores from WebView</h4><p>There is now an <strong>optimize store</strong> control in the store overview in WebView. This can be used to optimize a store for querying after a bunch of data has been added. </p><h4>Rfe10280 - Expose scripting in WebView</h4><p>There is now a 'Scripts' link in the navigation bar, where one can run JavaScript and (with the right permissions) Lisp scripts interactively, as well as store and edit server-side user script files. </p><h4>Rfe10277 - Improve help text for WebView part input</h4><p>The examples given now demonstrate that both backslash-escapes (\n, \uHHHH) and unicode characters are allowed. </p><h4>Rfe10244 - Add JavaScript server-scripting support</h4><p>It is now possible to send an /eval request with content-type "text/javascript", and have the body be evaluated as JavaScript. Custom services can also be written in JavaScript. </p><h4>Rfe10236 - Disable query planner selector in WebView for Prolog queries</h4><p>To make it clear that the query planner dropdown doesn't apply to Prolog queries, it is now greyed out when selecting a non-SPARQL language. </p><h4>Rfe10185 - Allow the user to specify a limit for queries in WebView</h4><p>For heavy queries, the default limit (200) imposed by WebView might be too big. There is now a dropdown above the query input that allows one to choose the amount of results that should be retrieved. </p><h4>Rfe10181 - Leave WebView widgets in the default browser style</h4><p>This removes the custom CSS styles for WebView inputboxes and buttons, making the the application look a little more native in modern browsers. </p><h4>Rfe10155 - Allow a query planner to be selected in WebView</h4><p>Adds a drop-down menu to the WebView query input page where one can select which planner to use. </p><h4>Rfe10128 - Rework WebView namespace management</h4><p>Both the store's default namespaces and the user's namespaces are now managed in the same place. This to reduce confusion---people assumed they could use the namespaces they defined for the store in their queries, without first selecting them. </p><h4>Rfe10126 - Show PIDs in WebView's process list</h4><p>Under #processes, the Unix PID of each of the processes is now listed after the process name. The /processes HTTP service now returns   tuples instead of just names. </p><h4>Rfe10116 - Show running sessions in WebView</h4><p>Once you navigated away, the browser history used to be the only way to get back to a session through WebView. There is now a list of active sessions (if any) in the catalog overview page. </p><h4>Rfe10039 - Support backup and restore through WebView.</h4><p>There is now (for superusers) the option to create stores from backups, and to back up existing stores, through the WebView interface. (This is not recommended for large stores.) </p><h4>Bug19880: Resizing the query input field in WebView is broken</h4><p>You could drag the resize corner widget, but when you released it nothing happened. This is now fixed. </p><h4>Bug19868 - Webview tries to write to the installation dir</h4><p>The server would try to cache gzipped JavaScript files in its installation directory, which fails when it is running under a user that doesn't have write access to that directory. It now uses the settings directory (called the <em>Directory to store data and settings</em> by the configuration program, with default name .../data/) for the cache. </p><h4>Bug19858 - AGWebView accidentally shows Turtle as export format</h4><p>We don't currently support exporting to Turtle, so this shouldn't be selectable. </p><h4>Bug19762 - Fix problem in process page in WebView</h4><p>A bug had snuck into the WebView code that prevented the #processes page from coming up when in a catalog view. </p><h4>Bug19741 - Add example to context input field help in AGWebView import</h4><p>It used to say only that it accepted 'N-Triples' syntax. </p><h4>Bug19523 - Fix several bugs in WebView's query result display.</h4><p>Prolog queries returning the default graph now display properly. Prolog queries returning non-flat-lists (such as (?x (?y ?z))) now produce an error message rather than no feedback at all. Literals ending in a backslash are now parsed properly, rather than treated as invalid. </p><a name='header3-4687' id='header3-4687'></a><h3>Changes to the Lisp API</h3><h4>Rfe10296 - Check minimum build id on client startup.</h4><p>The AllegroGraph lisp client will now check if the lisp has all the required runtime patches installed, and will present an error and resolution options if that is not the case. </p><h4>Rfe7148 - Optimize away keyword scanning in get-triples</h4><p><a href="lisp-reference.html#function.get-triples">db.agraph:get-triples</a> now uses a compiler macro to optimize the calls so no runtime CPU time is spent keyword scanning. </p><p>In Lisp if you want to trace <strong>get-triples</strong> calls, you should declare the function notinline. Alternatively, you can trace <strong>db.agraph::get-triples-positional</strong>, the non-exported internal function, which the compiler macro uses. </p><h4>Bug19890 - load-rdf/xml-from-string (Lisp API) could cause memory error</h4><p>If called with a very long string and no explicit base-uri, load-rdf/xml-from-string tried to create a base-uri by querying the file system with the string. In some situations, this could cause a buffer overflow which would lead to abnormal client termination. This commit fixes the base-uri resolution algorithm so that it handles strings without querying the file system. The underlying buffer problem has also been corrected. </p><h4>Bug19678 - serialize-rdf-n3 fails with encoded UPIs</h4><p>The Lisp API function <a href="lisp-reference.html#function.serialize-turtle">serialize-rdf-n3</a> would fail if it was asked to serialize triples with any encoded UPIs. This is now corrected. </p><h4>Bug19069 - improve error handling of N-Triples parser</h4><p>The continue-on-errorp function to load-ntriples can now specify how to behave when an error occurs more precisely. It can return one of </p>
<dl><dt>:continue (the default) </dt>
<dd>to ignore an error and continue</dd><dt>:stop-parsing </dt>
<dd>to ignore the erorr and  stop parsing the rest of the current source</dd><dt>:error </dt>
<dd>to signal the error in any case</dd></dl><a name='header3-4705' id='header3-4705'></a><h3>Documentation</h3><h4>Rfe9657 - server-installation.html document changed to describe non-interactive running of configure-allegrograph.</h4><a name='header3-4707' id='header3-4707'></a><h3>Python Client</h3><h4>Rfe10221 - BulkMode support added to Python client</h4><p>Bulk Mode is a repository-wide setting that affects all connected clients. </p><p>Use the bulk_mode property on a repository object to set and get the bulk_mode state. Here are some examples. </p><p>repository.bulk_mode = True print "The bulk mode state is ", repository.bulk_mode </p><p>If you only have a connection object, you can access the property with conn.repository.bulk_mode. </p><p>Any commits while repository.bulk_mode is true are done so using BulkMode on the server. </p><a name='header3-4714' id='header3-4714'></a><h3>Java Client</h3><h4>Rfe10303 - Support revised bulk-load mode interface</h4><p>With this change, the Java client now supports the revised bulk-load mode interface.  Bulk mode is now persistent (sticks even after closing and reopening the store), and is controlled with the AGRepository#setBulkMode and AGRepository#isBulkMode methods, rather than per session. </p><p>Bulk-load mode can now only be controlled through a store-wide toggle (/bulkMode over HTTP), since it is a store-wide setting, and turning it on and off a lot is very slow. </p><h4>Rfe10197 - Support for encodable-ids and generated URIs</h4><p>With this change, a namespace (viewed as a set of URIs) can now be registered as encodable. URIs in the namespace have local parts that follow a declared format, allowing for efficient encoding and in some cases generation of unique URIs in the namespace.  Once registered, a conformant URI in the namespace is auto-encoded when added to the store, resulting in a smaller string table and faster query speed. (This is a Java client version of the encoded-ids feature, see <a href="encoded-ids.html">Encoded IDs</a> for more information.) </p><h4>Rfe10189 - Java Interface for Stored Procedures</h4><p>The stored proc feature and API are experimental, and subject to change in a future release. For this reason, the new methods are marked as deprecated. </p><p>The AllegroGraph server defines a new API for defining Stored Procedures and they are installed like Custom Services. </p><p>The primary API is: </p>
<pre><code>AGRepositoryConnection.callStoredProc(functionName, moduleName, args) </code></pre><p>A low-level API is also exposed: </p>
<pre><code>AGHttpRepoClient.callStoredProcEncoded()  
AGSerializer.serializeAndEncode()  
AGDeserializer.decodeAndDeserialize()  
</code></pre><h4>Rfe10119 - Add analyze() method to provide query analysis</h4><p>Sesame AGQuery subclasses can now call the analyze() method to obtain a query analysis for the query rather than evaluating it. </p><h4>Rfe9971 - JAVA API for HTTP protocol checkVariables</h4><p>Related to bug19157: SPARQL error if ORDER variable isn't in query </p><p>Add method setCheckVariables(boolean) to both query classes: com.franz.agraph.jena.AGQuery com.franz.agraph.repository.AGQuery </p><h4>Rfe9858 - Support ResultSet nextSolution() method</h4><p>Previously, the legacy ResultSet API method nextSolution() would throw an UnsupportedOperationException; with this change the method is now supported. </p><h4>Rfe9846 - JENA graph unions and graph-scoped reasoning</h4><p>With this change, the method AGGraphMaker#createUnion can be used to create a union of named graphs.  AGInfModels can now be created over models backed by a union graph, and reasoning will be properly scoped to just the union graph; this change allows sound reasoning over a proper subset of data in the store. </p><h4>Rfe9534 - Add source jar to the client download</h4><p>With this change, an agraph-[version]-src.jar file is now included in agraph-[version]-client-java.tar.gz downloads. The download's Eclipse project's .classpath is modified to attach the source jar to the agraph-[version].jar to facilitate browsing and debugging. </p><a name='header2-4738' id='header2-4738'></a><h2>AllegroGraph 4.1.1</h2><p>Welcome to AllegroGraph 4.1.1.  This release of AllegroGraph provides overall product stability and efficiency improvements, with special attention to improvements in AGWebView and documentation.<br />
</p><a name='header3-4740' id='header3-4740'></a><h3>Server Changes</h3> <h4>Rfe9796 - Make tlog-write-checkpoint-indicator use :allocate-temporary</h4><p>The checkpoint indicator file, which records the location of the last checkpoint record that has been written to the transaction log file, is now written using the new internal API for creating temporary files. This ensures atomic updates on disk. </p><h4>Rfe8994 - Change behavior when a filesystem is full</h4><p>A change has been made to the AllegroGraph server that makes the database server block if one of the file systems is found to be full during a write operation. Operations automatically continue once space has been made available by the system administrator. </p><h4>Rfe9319 - Freetext index configuration and search support</h4><p>With this change a free text index can be created by specifying its configuration, and free text performed can be performed w.r.t particular freetext indices. </p><h4>Rfe9534 - Add sources for jena, arq, and json jars</h4><p>Previously the source code for these 3rd party libs had to be obtained separately; this change includes them as a debugging convenience in the git repository, and sets up the .classpath to reference them in Eclipse. </p> <h4>Rfe9969 - Update clojure api</h4><p>AGraph Clojure API updated for agraph v4, clojure 1.2. Build support for leiningen 1.3.1, as well as ant. </p><p>Clojure and Java source are in the Git repository: http://github.com/franzinc/agraph-java-client Added README.md for use and development instructions. </p><p>Clojure and Java jars are available in the Clojars Maven repository: http://clojars.org/groups/com.franz agraph-java-client and openrdf-sesame-onejar When AGraph v4.1 is released, these will be updated and agraph-clj-4.1.jar added. </p><p>Changed license to EPL, same as the java code. </p><p>Removed agclj.sh in preference for 'lein repl' or 'lein swank'. </p><h4>Rfe9999 - Auto-adjust MinMergeChunks</h4><p>If MergeThreshold is configured to a value lower than MinMergeChunks, the value of latter is now automatically adjusted to the value of the former. This ensures that a merge will actually be done when the threshold is reached. </p><h4>Rfe10119 - Add analyze() method to provide query analysis</h4><p>Sesame AGQuery subclasses can now call the analyze() method to obtain a query analysis for the query rather than evaluating it. </p><h4>Bug19658 - Agload needs bin directory symlink</h4><p>The symbolic link for the agload program was not being created in the 'bin' directory by install-agraph and the RPM installation. This has been fixed. </p><h4>Bug19674 - After-the-fact index creation should mind the amount of files it opens</h4><p>Fixed a bug that caused "too many open files" error and terminating the server when large number of chunks had to be merged. </p><h4>Bug19698 - Changes to prepareGraphQuery and prepareBooleanQuery</h4><p>prepareGraphQuery and prepareBooleanQuery now also accept the string "SPARQL" or "PROLOG" as a query language parameter. Previously, only prepareTupleQuery allowed the string values as a convenience in place of the QueryLanguage.SPARQL or QueryLanguage.PROLOG objects. </p><h4>Bug19720 - Fix "don't attach as root" check</h4><p>The check which ensures that you don't attach to a triple store as "root" was checking the real uid, not the effective uid, preventing it from working properly under su/sudo. This has been fixed. </p><h4>Bug19739 - Compressed index files not unmapped when closed</h4><p>Triple index files which were mapped during queries were not being properly unmapped when they became obsolete. This problem has been fixed. </p><a name='header3-4771' id='header3-4771'></a><h3>HTTP Client</h3><h4>Rfe9756 - Return 400, not 500, when trying to delete an open store over HTTP.</h4><p>The HTTP server was returning (and logging) an internal server error when it tried to delete a store that was still being held open (through a DELETE or PUT request to the store's URL). It now returns a 400 (bad request) response. </p><h4>Rfe9971 - Java api for http protocol checkVariables</h4><p>Related to bug19157: SPARQL error if ORDER variable isn't in query </p><p>Added method setCheckVariables(boolean) to both query classes: com.franz.agraph.jena.AGQuery and com.franz.agraph.repository.AGQuery. </p><h4>Rfe10120 - Make sure custom-service exists in agraph4.fasl</h4><p>This adds the HTTP backend code to the agraph fasl, so that it is possible to compile custom services in an image that has this fasl loaded. <strong>AllegroGraph 5.0 note: the file is agraph5.fasl starting in version 5.0.</strong> </p><a name='header3-4779' id='header3-4779'></a><h3>SPARQL</h3><h4>Bug19157 - SPARQL error if ORDER variable isn't in query</h4><p>When the order by clause has a var not known from the query, ignore it (the default), or identify it in an error message (when <em>sparql-check-variable-errors-p</em> or checkVariables in the http protocol is true). </p><h4>Bug19618 - Properly escape strings in SPARQL/JSON output.</h4><p>Newlines and other special characters are now escaped according to JSON rules in SPARQL/JSON results returned by the SPARQL engine. </p><h4>Bug19619 - Fix typed literal writing in SPARQL/JSON output.</h4><p>The SPARQL engine was not writing out typed literals in SPARQL/JSON documents properly. Those in UPI form got a wrong type property ("literal" rather than "literal-typed"), those in future-part form were written out as XML. </p><a name='header3-4786' id='header3-4786'></a><h3>AGWebView</h3><h4>Rfe9492 - Add export to AGWebview</h4><p>Adds the possibility to download repositories and query result sets through AGWebView. Several output formats are supported, depending on whether triple data (n-triples, n-quads, rdf/xml, trix) or select results (sparql+xml, csv) is downloaded. </p><h4>Rfe9587 - Show progress indication in WebView uploads</h4><p>Rather than just seeing a spinner animation, users doing an upload in WebView now see how much data has been uploaded already. </p><h4>Rfe9898 - Add drop-down menus to WebView's navigation bar.</h4><p>To make it possible to link more functionality from the navigation bar without running out of space, groups of links are now put into drop-down menus. </p><h4>Rfe9900 - Optimize loading of WebView scripts and style-sheets.</h4><p>Serves the JavaScript and CSS files used by WebView in concatenated form, allowing gzipped responses. This causes the base webview page to go from 25 files totalling over a quarter megabyte to 2 files and 68 kilobyte. </p><h4>Rfe9950 - Provide a way to start exploring a store in WebView</h4><p>This adds a paragraph to a repository overview containing links to some simple queries that can help the user explore the store. </p><h4>Rfe9951 - In WebView user management, show drop-downs for stores.</h4><p>When granting permissions on a store, the user no longer has to type the names, but can select them from a drop-down menu. </p><h4>Rfe9964 - Ask confirmation before letting user un-superuser himself in WebView</h4><p>Once your user loses its superuser flag, it can no longer manage users, so one wrong click here could lock yourself out. There is now a confirmation dialog to ensure you intended to do this. </p><h4>Rfe9990 - Do not display \uHHHH character escapes in WebView</h4><p>For non-ASCII characters, WebView showed the N-triples escape sequence instead of the character itself, even when 'short' part display was turned on. This is now fixed. </p><h4>Rfe10025 - More robust recent-query saving in WebView</h4><p>On modern browsers, you'll now be able to list your recent queries even after navigating away from WebView and back. On top of that, the list of recent queries is no longer tied to a specific repository. </p><h4>Rfe10026 - WebView now shows a spinning animation when loading a file</h4><p>Before, there was no proper feedback indicating that something was happening during a dataset upload. </p><h4>Rfe10027 - In WebView's graph view, fix nodes after dragging</h4><p>Nodes can be rearranged by dragging in the graph view. A node now stays fixed after having been dragged, making it much easier to lay out the graph. </p><h4>Rfe10050 - Make specifying a graph when adding from WebView easier.</h4><p>The graph input field in the add-triple dialog is now always visible. WebView will try to retrieve a list of graphs that are used in this store, and allow you to choose them from a drop-down. </p><h4>Rfe10051 - Allow a graph/context to be specified when importing in WebView.</h4><p>This extends the import file and import URL dialogs with a context field, which is used to specify a graph to import into. </p><h4>Rfe10052 - Add a general delete-triples UI to WebView</h4><p>This adds a 'delete statments' control to the repository overview page, from which you can delete triples, by wildcard. Also includes the existing-graph select control from rfe10050, to make it easy to drop a graph. </p><h4>Rfe10127 - Allow init files to be loaded in sessions created from WebView</h4><p>There is now a checkbox 'load initfile' in the widget that creates new sessions from a catalog view in WebView. </p><h4>Bug19581 - Newly registered users in WebView don't get enough access</h4><p>When user-registration is turned on, new users were supposed to get the same access permissions as the anonymous user, but due to a bug they did not get any access. This is now fixed. </p><h4>Bug19536 - In WebView's graph view, clicking on a node was broken.</h4><p>Clicking on a node in the graph did not actually take you to that node's overview page, but raised a script error instead. This is now fixed. </p><h4>Bug19552 - Can't start a session from catalog page in WebView</h4><p>There was a bug that would prevent users from starting a session from a (non-root) catalog page in WebView. This has been fixed. </p><a name='header3-4823' id='header3-4823'></a><h3>Documentation</h3><h4>Rfe9574 - Lisp client documentation</h4><p>The AllegroGraph Lisp Client Quick-Start guide has been expanded to include explicit Lisp Client set-up instructions and an explanation of local vs. remote triple-store connections. </p><h4>Rfe9750 - Improve document navigation</h4><p>The navigation panel (to the right side of most documentation pages) and the document map page have been revised and extended to provide more organized and thorough access to the many documents and web pages that describe AllegroGraph. </p><h4>Rfe9883 - Javadoc included in the distribution</h4><p>Javadocs for com.franz.agraph are in the javadoc folder in the distribution file, and they link to external javadocs for java, jena, and sesame. </p><h4>Rfe9929 - User manual for 4.1.1 AGWebView</h4><p>The AllegroGraph documentation has been extended to include a User's Guide for WebView. This document presents task-oriented guidance on using the WebView interface for managing users and repositories. </p><h4>Rfe9936 - Document TopBraid Composer plugin</h4><p>In this release the TopBraid Composer (TBC) plugin installation notes got an upgrade with numerous screen-shot illustrations and further notes on how to integrate TBC with the AllegroGraph Virtual Machine. </p><h4>Rfe10046 - AllegroGraph Text Indices</h4><p>There is a new, high-level document describing AllegroGraph's free-text indexing features. </p><h4>Rfe10077 - Add user-selected triple indices to tutorials</h4><p>The Python, Java, and Jena tutorials have an augmented example1() showing how to add and remove triple indices for greater efficiency. </p><h4>Rfe10108 - AllegroGraph Triple Indices</h4><p>There is a new, high-level document describing AllegroGraph's system of triple indices and how to manage them. </p><h4>Rfe10139 - Emphasize "agraph" user vs. AG superuser</h4><p>The server-installation document now emphasizes the differences between the "agraph" operating system account and the AllegroGraph superuser account. Users sometimes confused the two accounts, which caused connection issues. </p><h4>Rfe10159 - Rapper documentation</h4><p>There is a new document describing the use of the Rapper command-line utility for pre-processing incoming data files to make them load more quickly in AllegroGraph. </p><h4>Bug19620 - Fix typos in documentation of create-freetext-index</h4><p>The description of the index-fields argument was a jumble of a sentence. </p><a name='header2-4846' id='header2-4846'></a><h2>AllegroGraph 4.1</h2><p>Welcome to AllegroGraph 4.1.  This release of AllegroGraph provides overall product stability and efficiency improvements, with special attention to backup/restore, point-in-time recovery, and warm standby features.<br />
</p><h4>Rfe9535 - Use managed files throughout the storage layer</h4><p>The storage layer has been changed so that all files are allocated through the central resource manager mechanism. This makes all files eligible for placement through FilePlacementRule parameters in the database configuration. Previously, some files could not be placed using such rules. </p><h4>Rfe9772 - More advanced server scripting</h4><p>This introduces server-side script files, which can be loaded into sessions, and a convenient way to define custom HTTP services from such files. See the HTTP protocol documentation for details. </p><h4>Rfe9784 - Keep track of which pages of deleted bitmap have been touched</h4><p>In order to speed up backup operations, the AllegroGraph server now keeps track of which pages in the deleted bitmap file are used. </p><h4>Rfe9785 - Revise backup and restore</h4><p>AllegroGraph now uses a new, single-file archive format for storing backups. The new backup and restore functionality is described in the server documentation. </p><h4>Rfe9789 - Support callback parameter when writing JSON output</h4><p>Requests returning JSON data can now specify a callback=[x] HTTP parameter, which will cause the response to be wrapped in [x]([response]), so that the resulting document can be loaded as a JavaScript program (which is useful for working around cross-domain restrictions in browsers). </p><h4>Rfe9798 - Allow relative directories in config files</h4><p>In the AllegroGraph server configuration file, relative pathnames can now be specified for file and directory parameters. Such pathnames are considered relative to the directory where the server configuration file is located. </p><h4>Rfe9805 - Point in time recovery</h4><p>The point in time recovery facilty allows the a database backup to be restored to its state at a particular point in time. </p><h4>Rfe9835 - Use stream API to allocate blocks in sparse deleted bitmap</h4><p>The database server code has been updated to explicitly allocate blocks in the deleted bitmap file using file system calls. That way, full filesystem conditions will be handled in a graceful manner. </p><h4>Rfe9840 - Improve "disk full" behavior in agraph-backup</h4><p>When agraph-backup detects a "disk full" condition, it now performs an interactive recovery if it was started from a terminal. When started non-interatively (i.e. from cron), no recovery is performed and an error message is generated. </p><p>The exit code of agraph-backup is now always 0 if the operation succeeded, 1 if it failed. </p><p>Progress reporting in agraph-backup has been improved. </p><h4>Rfe9842 - Agraph-backup: merge parameters.dat while restoring</h4><p>When restoring a database from a backup, the parameters established in the parameters.dat file stored in the backup database are copied to the restored database. File placement related parameters are skipped in this process. </p><h4>Rfe9888 - Do not log backtrace for HTTP proxy pipe errors.</h4><p>When a back-end crashed, this often caused two back-traces to be logged, one for the back-end and one for the front-end. The second one was just noise, so it is now suppressed. </p><h4>Rfe9889 - Allow resource manager to forget a file</h4><p>A new internal API function has been added to the resource manager library to support the archival of transaction log files. </p><h4>Rfe10055 - Properly expose the no-commit flag</h4><p>The no-commit mode, used primarily by the warm standby replication process, is now something that can be explicitly turned on and off. </p><h4>Rfe10056 - Require authentication for warm-standby connections.</h4><p>The socket on which a warm-standby server listens used to be accessible by anyone. It now requires a valid username and password when initiating a connection. </p><h4>Bug19391 - Agraph-install no longer outputs paths with double slashes</h4><p>The helper script agraph-install would output paths with double slashes when given a path with a trailing slash as argument. This was mostly harmless, and is now fixed. </p><h4>Bug19420 - Chunk writers leak disk space when db crashes</h4><p>A problem has been corrected that could lead to stray files being left on disk when a database was brought down uncleanly. </p><h4>Bug19446 - Catalog parsing problem - confusing error message</h4><p>The error message that the configuration file parser generates when overlapping directories are specified in the configuration file has been improved. </p><h4>Bug19487 - Solve ':void external-format' errors in logs.</h4><p>The AG log files occasionally showed unexpected errors of 'Attempt to translate characters using a :void external-format'. These were harmless, but they are now handled properly, and no longer logged. </p><h4>Bug19526 - Back up tlog file only up to backup checkpoint</h4><p>The backup code has been changed so that transactions which executed while the backup was running are not included in the backup. </p><h4>Bug19684 - Include the triple-id index in the standard indices</h4><p>If specific indices are not requested when a store is created, then it will have the standard set of seven: :ospgi, :posgi, :spogi, :gospi, :gposi, :gspoi, and :i. </p><p>Prior to this change, the :i index was not included in this standard set. </p><a name='header3-4891' id='header3-4891'></a><h3>Lisp Client</h3><h4>Bug19442 - Make sure remote-triple-store accepts :server argument.</h4><p>The :server argument to the remote-triple-store class was being incorrectly rejected, making it impossible to open stores on other machines. </p><a name='header3-4894' id='header3-4894'></a><h3>SPARQL</h3><h4>Bug19474 - Improve SPARQL describe queries</h4>
<ul>
<li><p>excess variables are no longer included in the output of DESCRIBE</p></li>
<li><p>CBD (Concise Bounded Description) logic is now implemented so that we correctly handle blank nodes </p></li>
<li><p>Many general efficiency improvements</p></li></ul><h4>Bug19499 - Fix SPARQL XML and JSON output of geospatial values</h4><p>Retrieving SPARQL SELECT results containing geospatial values as SPARQL+XML or SPARQL+JSON was broken because an internals change hadn't been propagated to the SPARQL engine. This is now fixed. </p><a name='header3-4901' id='header3-4901'></a><h3>AGWebView</h3><h4>Rfe9815 - Fix accept-encoding issue for WebView in Internet Explorer 7</h4><p>This fixes a problem where Internet Explorer 7 would display "Internet Explorer cannot display the webpage" when opening WebView (or any other page served by AG). Internet Explorer fails to handle deflated content, so we now serve it gzipped responses instead. </p><h4>Rfe9899 - Fix typo and wrong word choice in WebView.</h4><p>When adding a notable node, 'Desription' was corrected to 'Description'. When looking at a text index that indexes all predicates, it used to say 'None' under predicates, now it says 'All'. </p><h4>Bug19500 - Fix problem with displaying geospatial results in WebView</h4><p>When a query result contained geospatial data, a bug in WebView was triggered that caused the result to fail to display. This bug has been fixed. </p><h4>Bug19525 - Fix failure when opening a federated session in WebView.</h4><p>Trying to create a federated session in WebView resulted in a PRECONDITION FAILED error. This was caused by a bug in the way session data was being returned by the server, causing WebView to believe it was not on a federated store. The problem has been fixed. </p><a name='header3-4910' id='header3-4910'></a><h3>Documentation</h3><h4>Spr37148 - Question about connecting using java</h4><p>Two lines of code were inconsistent between the Java tutorial HTML file and the tutorial examples code. The tutorial has been edited to correct this issue. </p><h4>Rfe9783 - AllegroGraph's isolation model</h4><p>The AllegroGraph Overview document has been augmented with a new section on AllegroGraph's ACID-compliant isolation model. </p><h4>Rfe9806 - Enhance SPARQL examples in tutorials</h4><p>In the Python, Java and Jena tutorials, example13() now uses the SPARQL "contruct" to create has-grandchild triples, and then "describes" a grandparent and a grandchild. </p><h4>Rfe9821 - Make SPARQL examples more robust</h4><p>Example10() of the Python/Java tutorials has been extended to show examples of SPARQL's FROM, FROM DEFAULT, and FROM NAMED operators, and an example of the UNION operator. </p><h4>Rfe9831 - Python/Java tutorials, illustrate use of conn.size() with contexts.</h4><p>Example10() of the Python and Java tutorials has been extended to show examples of the conn.size() method returning the number of triples found in specific subgraphs. </p><h4>Rfe9915 - Java and Python tutorials demonstrate SPARQL and RDFS++</h4><p>Example19() of the Java and Python tutorials has been augmented to demonstrate how to use a SPARQL query with RDFS++ reasoning. </p><h4>Rfe10104 - Point-in-time recovery document</h4><p>There is a new document describing AllegroGraph's point-in-time recovery feature. </p><h4>Rfe10105 - Replication and warm-standby document</h4><p>A new document on triple store replication and warm stand-by has been added to the document set. </p><h4>Rfe10106 - Update backup/restore document</h4><p>The backup/restore document has been updated to reflect the new features available in AllegroGraph 4.1. </p><h4>Rfe10107 - Transaction Log Archiving document</h4><p>Transaction logs increase without limit unless archived.  A new document describes the transaction log archiving feature of AllegroGraph. </p><h4>Bug19454 - Python tutorial explains how "int" becomes "long"</h4><p>In example15() of the Python tutorial we show registerDatatypeMapping() requesting a nativetype "int" and AllegroGraph responding with XMLSchema.LONG. This is correct, and the text now explains why. </p><h4>Document MinimumCheckpointInterval and MaxRecoveryTime parameters</h4><p>The meaning of these parameters have been documented in the daemon configuration documentation. </p><a name='header2-4935' id='header2-4935'></a><h2>AllegroGraph 4.0.6a</h2><p>Welcome to AllegroGraph 4.0.6a.  This release of AllegroGraph v4.0 provides overall product stability and efficiency improvements.<br />
</p><a name='header3-4937' id='header3-4937'></a><h3>Server Changes</h3><h4>Rfe9837 - Avoid log warning when opening an existing repo</h4><p>Added method AGCatalog.hasRepository(id) which tests for existance. Added AGCatalog.openRepository(id) which will open but not create. Added AGCatalog.createRepository(id,strict) where the strict option will throw an exception if the repository already exists. </p><h4>Rfe9980 - getCatalog now works with the root catalog</h4><p>Added AGCatalog.isRootId(id) to identify id's for the root catalog. Enhanced AGServer.getCatalog(id) to accept root catalog identifiers. Also added AGServer.getCatalog() to return the root catalog. </p><h4>Rfe10041 - Implement owl:oneOf</h4><p>AllegroGraph's RDFS++ reasoner now includes the following inference: </p>
<pre><code>if the class X is owl:oneOf A, B and C  
then each of A, B and C are of type X. </code></pre><h4>Rfe10075 - Implement query index use analyzer, version 1</h4><p>If analyzeIndicesUsed=true is added to a SPARQL HTTP query string, then AllegroGraph will analyze the query to determine which indices it will use. The results are returned as plain text and written to the AllegroGraph log. They will look like </p>
<pre><code>(desired spogi optimal 1 actual spogi optimal 1)  
(desired posgi optimal 6 actual ospgi suboptimal 4) </code></pre><p>Where each line refers to one of the indices required by the query. The line indicates which index flavor the query really wants and which index the query used based on what is available to the store. The additional information indicates whether or not the index choice was optimal, suboptimal or required a full scan. The numbers indicate whether or not additional filtering was required and can be ignored for now. </p><h4>Bug19650 - Fix problem federating repositories from the root catalog</h4><p>Previously an exception was thrown when attempting to federate repos from the root catalog; this change addresses that. </p><a name='header2-4951' id='header2-4951'></a><h2>AllegroGraph 4.0.6</h2><p>Welcome to AllegroGraph 4.0.6.  This release of AllegroGraph v4.0 provides overall product stability and efficiency improvements.<br />
</p><a name='header3-4953' id='header3-4953'></a><h3>Server Changes</h3><h4>Rfe9535 - Use managed files throughout the storage layer</h4><p>The storage layer has been changed so that all files are allocated through the central resource manager mechanism. This makes all files eligible for placement through FilePlacementRule parameters in the database configuration. Previously, some files could not be placed using such rules. </p><h4>Rfe9620 - Increase limit on number of index chunks</h4><p>Previously, the maximum number of index chunks was based on the limit on the number of file descriptors (RLIMIT<em>NOFILE) which, in a default Linux configuration, resulted in a limit of 100 chunks. Now the maximum is based on the limit on the number of memory mappings (determined by reading /proc/sys/vm/max</em>map_count), which usually results in a much higher limit. </p><p>If the limit on the number of index chunks is reached, further commit activity will be blocked. Therefore this higher chunk limit will reduce the likelihood of blocked commits. </p><h4>Rfe9731 - Change transaction log aligment calculation</h4><p>An internal change was made to the way the alignment for transaction log records is calculated so that opening transaction log files can be defered until records are written. </p><h4>Rfe9762 - Add someValuesFrom and allValuesFrom restriction reasoning</h4><p>AllegroGraph's hasValue reasoning has been renamed restriction-reasoning and now covers owl:hasValue, owl:someValuesFrom and owl:allValuesFrom. In particular, AllegroGraph will now infer: </p>
<pre><code>C owl:onProperty P  
C owl:hasValue v  
a rdf:type C  
==&gt; a P v  
 
C owl:onProperty P  
C owl:hasValue c  
a P c  
==&gt; a rdf:type C  
 
C owl:onProperty P  
C owl:someValuesFrom D  
a P b  
a P x  
b rdf:type D  
(and will not infer x rdf:type D)  
==&gt; a rdf:type C  
 
C owl:onProperty P  
C owl:allValuesFrom D  
a type C  
b P x  
==&gt; x type D </code></pre><p>Because the reasoner now implements more than owl:hasValue, it has been renamed the restriction-reasoner. The accessor function has-value-reasoning-enabled has been deprecated and the new accessor is restriction-reasoning-enabled. </p><p>The HTTP protocol changes to use <em>restriction</em> instead of <em>hasvalue</em> as the name of the reasoner that supports hasValue reasoning (and the other restrictions). </p><h4>Rfe9769 - Log merge statistics</h4><p>In addition to logging how long a merge took, the following additional information is logged: Number of triples read, number of triples written, number of deleted triples expunged, and number of duplicate triples dropped. </p><h4>Rfe9772 - More advanced server scripting</h4><p>This introduces server-side script files, which can be loaded into sessions, and a convenient way to define custom HTTP services from such files. See the HTTP protocol documentation for details. </p><h4>Rfe9776 - Standardize blank node serialization</h4><p>Use the same blank node syntax in all of AllegroGraph's serializers (N-Triples, RDF/XML, TriX, etc.). </p><h4>Rfe9789 - Support callback parameter when writing JSON output</h4><p>Requests returning JSON data can now specify a callback=[x] HTTP parameter, which will cause the response to be wrapped in [x]([response]), so that the resulting document can be loaded as a JavaScript program (which is useful for working around cross-domain restrictions in browsers). </p><h4>Rfe9803 - Bulk loading support</h4><p>AllegroGraph now supports a bulk loading mode that allows changing the triple-store without updating the transaction log. Both the HTTP statements service (used to load data into a store) and the agload bulk loader have been enhanced to use this new feature. </p><p>Use the bulkMode parameter to specify that you want bulk loading on in the HTTP service </p><p>Use the --bulk option to specify that you want bulk loading on when using agload. </p><p>Depending on hardware and the actual data, loading with the transaction log turned off is between 10 and 33% faster than loading with it on. </p><h4>Rfe9812 - Add client API for triple-store index manipulation</h4><p>Add the following new functions to the Lisp API: </p>
<ul>
<li>add-index - add a new index to a store</li>
<li>drop-index - remove an index from a store</li>
<li>triple-store-indices - return a list of current indices for a store</li>
<li>valid-index-flavors - return a list of all valid index flavors</li></ul><p>Note that changes made by 'add-index' and 'drop-index' are not made until 'commit-triple-store' is called. </p><h4>Rfe9889 - Allow resource manager to forget a file</h4><p>A new internal API function has been added to the resource manager library to support the archival of transaction log files. </p><h4>Rfe9907 - Add with-indices support to agload</h4><p>agload now supports custom index selection using the --with-indices command-line option. </p><h4>Rfe9913 - Improve single-float printing</h4><p>AllegroGraph could lose precision when printing single float values. For example, 0.0018333651 would print as 1.833365E-3 rather that 1.8333651E-3. This has been corrected. </p><h4>Rfe9930 - Support adding, dropping, listing repository indices</h4><p>Added methods addIndex, dropIndex, listIndices, and listValidIndices to AGRepositoryConnection to support managing repository indices. </p><h4>Rfe9953 - Share transaction log buffer across attachees</h4><p>Each process (backend) that attached to a store used to allocate its own in-memory buffer for writing to the transaction log. </p><p>A single buffer is now allocated in shared memory and used across all backends, saving valuable RAM. </p><h4>Rfe9966 - Front-end server-socket backlog parameter is too low</h4><p>The kernel will only save a certain amount of pending connection attempts. If the server doesn't accept them quickly enough, they get discarded. The default backlog size was too small. It is now set to use the maximum the operating system allows, making the chance of discarded connections much, much lower. </p><h4>Rfe9970 - Upgrade path for configurable indices</h4><p>Code has been added to convert pre-v4.0.6 databases to be useable with v4.0.6 in terms of configurable indices. </p><h4>Rfe9972 - Updates to database upgrade code</h4><p>The internal API for database upgrades has been improved to make more information about the upgraded database available to the code that performs (part of) the upgrade. </p><h4>Rfe9992 - Backup/restore improvements</h4><p>agraph-backup now accepts a --catalog command line parameter. Also, agraph-backup now only backs up the used portions of the string table files, resulting in faster backup and restore times. </p><h4>Rfe10012 - Consistency checker for sstab</h4><p>A utility has been added to the AllegroGraph distribution that validates the contents of the on-disk string table data structures. </p><p>To validate the integrity of a database, the new "checkdb" utility should be used. </p><h4>Rfe10019 - Setup automatic datatype-mapping for triple-ids</h4><p>There is now an automatic datatype mapping between triple-id UPIs and the datatype &lt;http://franz.com/ns/allegrograph/4.0/triple-id&gt;. This means that these UPIs will be be read and written in this format. For example, the triple </p>
<pre><code>ex:test rdf:refersTo "18"^^&lt;http://franz.com/ns/allegrograph/4.0/triple-id&gt; . </code></pre><p>will be imported such that its object is an encoded UPI that refers to triple ID 18 using the AllegroGraph specific triple-ID reification. </p><h4>Bug19171 - Importing RDF files with long text literals is much faster.</h4><p>AllegroGraph now uses a string output stream to collect characters in text literals instead of string+'ing them together. This speeds up importing long literals with many XML escapes. Files that previously took 4 hours to import now take ~2 seconds. </p><h4>Bug19181 - Correct newline parsing for n-triple imports</h4><p>Previously, the AllegroGraph n-triple format parser would count newline and carriage return characters as white space, allowing incorrectly-formatted triples to be imported. Now AllegroGraph allows a triple to be specified on one line only. </p><p>Due to this change, the AllegroGraph n-triple parser now reports the correct line number when a parse error occurs. This line number can now be used in a text editor to jump to the location of the problem. </p><h4>Bug19253 - Accept resources for :base-uri in load-rdf/xml.</h4><p>Previously, the RDF parser disregarded resources used as :base-uri in the RDF import. Now, it accepts all resources and other future-parts and uses their value to determine the base URI for the import. </p><h4>Bug19266 - Correct cursor re-use problem</h4><p>AllegroGraph was aggressively re-using storage layer cursors which could lead clients to point at cursors that were no longer valid. This could lead to incorrect query results. </p><h4>Bug19391 - Agraph-install no longer outputs paths with double slashes</h4><p>The helper script agraph-install would output paths with double slashes when given a path with a trailing slash as argument. This was mostly harmless, and is now fixed. </p><h4>Bug19407 - Allow the direct Lisp client to log to the server log file</h4><p>The direct client (which is used internally in the HTTP server) can now write to the server log file directly. </p><h4>Bug19420 - Chunk writers leak disk space when db crashes</h4><p>A problem has been corrected that could lead to stray files being left on disk when a database was brought down uncleanly. </p><h4>Bug19442 - Make sure remote-triple-store accepts :server argument.</h4><p>The :server argument to the remote-triple-store class was being incorrectly rejected, making it impossible to open stores on other machines. </p><h4>Bug19446 - Catalog parsing problem - confusing error message</h4><p>The error message that the configuration file parser generates when overlapping directories are specified in the configuration file has been improved. </p><h4>Bug19460 - Issue installing agraph 4.0.5 over 4.0.4</h4><p>A bug has been fixed that resulted in errors when trying to open a database that was created with AllegroGraph v4.0.4. This problem has been resolved. </p><h4>Bug19569 - Java client now helps delete orphaned saved queries</h4><p>Preparing a Sesame AGQuery currently has the side effect of saving the prepared query on the server in memory for the duration of the session. A client app that prepares many queries during a session thus uses up server memory. If an AGQuery instance goes out of scope, the saved query is no longer needed on the server and is currently only deleted when the session expires. With this change, the client library no longer uses the saved query service during a prepare query, pending further cost-benefit analysis of the saved query service. Client code can explicitly request that a query be saved using an experimental AGQuery.setSaveName() method. The client library also tries to help delete orphaned saved queries sooner by tracking when AGQuery instances are garbage collected on the client and issuing delete requests for the orphaned saved queries in subsequent query requests. </p><h4>Bug19474 - Improve SPARQL describe queries</h4>
<ul>
<li><p>Excess variables are no longer included in the output of DESCRIBE</p></li>
<li><p>CBD (Concise Bounded Description) logic is now implemented so that we correctly handle blank nodes </p></li>
<li><p>Many general efficiency improvements</p></li></ul><h4>Bug19487 - Solve ':void external-format' errors in logs.</h4><p>The AG log files occasionally showed unexpected errors of 'Attempt to translate characters using a :void external-format'. These were harmless, but they are now handled properly, and no longer logged. </p><h4>Bug19489 - Directory where pidfile resides is chown'd to agraph user</h4><p>In prior releases, when running as root, the agraph-control script would chown the directory where the pidfile resides to the agraph user. This was okay when the recommended pidfile path of /var/run/agraph/agraph.pid was used, but if another path that was shared with non-agraph files was used, the chown was undesirable. This problem has been fixed. </p><h4>Bug19497 - Fix convertdb</h4><p>As AllegroGraph v4.0.6 changes the on-disk database format, existing databases need to be converted. The conversion process is performed by the "convertdb" utility, which has been brought up to date with respect to recent storage layer changes. </p><h4>Bug19499 - Fix SPARQL XML and JSON output of geospatial values</h4><p>Retrieving SPARQL SELECT results containing geospatial values as SPARQL+XML or SPARQL+JSON was broken because an internals change hadn't been propagated to the SPARQL engine. This is now fixed. </p><h4>Bug19509 - Agload could load inconsistently on virtual machines</h4><p>Some virtual machines could reveal a fault in agload that caused inconsistent triple loading. This could result in agload reporting a negative triples-per-second load rate and in different amounts of triples being loaded on different runs. This patch corrects the problem. </p><h4>Bug19539 - Support dynamic catalogs</h4><p>Support for dynamic catalogs as documented in the AllegroGraph manual has been restored. </p><h4>Bug19548 - Correctly import default namespaces in rdf/xml literals.</h4><p>Previously, when importing XML literals that had a default namespace set, the RDF/XML import in AllegroGraph would silently drop the default namespace. Now, the correct xmlns clause is set for these xml literals. </p><h4>Bug19551 - Fix handling of blank nodes in RDF/XML parser.</h4><p>Previously, the RDF/XML parser failed to import empty xml elements like &lt;foo x="y"/&gt; by creating references to empty string literals instead of blank nodes like the RDF/XML syntax specification mandates. Now, the RDF/XML parser correctly creates blank nodes. </p><h4>Bug19560 - Provide sstab upsizing upgrade path</h4><p>v4.0.5b increased the sizes of the string table files without changing the database version number. Databases created with v4.0.5a or earlier must be upgraded using the convertdb utility to have this problem corrected. </p><h4>Bug19562 - Improve error message when AllegroGraph loaded on an unsupported platform</h4><p>AllegroGraph is currently only supported on linux-64 but the error message produced when trying to load agraph4.fasl on a non-supported platform was nonsensical. This patch improves the error message to make it clear what has gone wrong and what remedies to take. <strong>AllegroGraph 5.0 note: the module to require is :agraph5 and the file is agraph5.fasl starting in version 5.0.</strong> </p><h4>Bug19565 - Crash can occur when file descriptor limit is large</h4><p>When running as a user with a large file descriptor limit (larger than 1024), it was possible for AllegroGraph to crash under certain circumstances. This problem has been corrected. </p><h4>Bug19567 - Log handles remain open after SIGHUP</h4><p>Due to a mistake in the way the daemon detached from the terminal, the initial log file would never be closed, even when a HUP signal was sent to the daemon. This is now fixed. </p><h4>Bug19595 - Repair createGraph() for anonymous graphs</h4><p>Previously createGraph() in the no-arg case was trying to use an illegal blank node id based on a Jena-internal AnonID; this fixes that problem. </p><h4>Bug19602 - String table fails to recover short strings from transaction log</h4><p>An error has been corrected that could have resulted in the loss of string table data if a database was uncleanly shut down. </p><h4>Bug19614 - Bus error during prolog query</h4><p>Some queries that returned AllegroGraph specific UPI types (e.g., for reified triple-ids or default-graphs) could cause a bus error rather than signaling the correct message that these types cannot be serialized using RDF/XML. Corrected. </p><h4>Bug19632 - N-Quads serializer was emitting the default-graph incorrectly</h4><p>The N-Quads serializer was needlessly including the graph even for triples in the default-graph of the triple-store. Furthermore, it was emitting these graphs using invalid syntax. Both of these issues are fixed. </p><a name='header3-5071' id='header3-5071'></a><h3>HTTP Interface</h3><h4>Rfe9885 - Fix HTTP connection keep-alive for 204 responses.</h4><p>HTTP requests that caused a 204 (no content) response incorrectly had their connection closed by the server, even when they requested keep-alive. This meant the client had to create a new socket for their next request, causing unnecessary overhead. </p><h4>Rfe9888 - Do not log backtrace for HTTP proxy pipe errors.</h4><p>When a back-end crashed, this often caused two back-traces to be logged, one for the back-end and one for the front-end. The second one was just noise, so it is now suppressed. </p><h4>Rfe9906 - Support index inspection and manipulation over HTTP.</h4><p>Under /indices, a triple store's indices can now be inspected, created, and dropped over HTTP. Adds an index argument to store-creation requests, to set the indices at creation time. </p><h4>Bug19506 - Make HTTP server more cautious about closing stores</h4><p>It was possible for the HTTP server to close a triple store that it was still reading from. This would cause the reading request to fail. The server now waits until pending requests have finished when closing one of its stores. </p><a name='header3-5080' id='header3-5080'></a><h3>Documentation</h3><h4>Rfe9936 - User document for Top Braid Composer and AG</h4><p>Added an installation page for the AllegroGraph TopBraid Composer plugin. </p><a name='header3-5083' id='header3-5083'></a><h3>Lisp Client</h3><h4>Bug19452 - Race condition in lisp client startup</h4><p>While connecting to a database, the Lisp client could sometimes crash with the following error message: </p>
<pre><code>The value of db.agraph.spawn::hub is nil,  
which is not of type db.agraph.spawn::hub </code></pre><p>A fix has been developed to prevent that problem from occuring. </p><a name='header3-5088' id='header3-5088'></a><h3>Python Client</h3><h4>Rfe9906 - Add support for index changes to the Python client</h4><p>A connection object in the Python client now has listIndices, addIndex, and dropIndex methods for inspecting and manipulating the indices on a triple store. </p><h4>Rfe9965 - Python miniclient now supports retry on ECONNRESET</h4><p>The python miniclient now retries on connection failures with errno ECONNRESET. Previously it would just fail the request. </p><a name='header3-5093' id='header3-5093'></a><h3>Java Client</h3><h4>Rfe9845 - Support owl:Restriction reasoning in the Java client</h4><p>The Java client now supports hasValue, someValuesFrom, and allValuesFrom reasoning. In the Sesame AGQuery API one can now specify which entailment regime to use when including inferences in query results; the new Restriction regime is now available as an option, while RDFS++ remains the default. Similarly, using the Jena AGReasoner API, one can set up AGInfModels with either a Restriction reasoner or the default RDFS++ reasoner. </p><a name='header3-5096' id='header3-5096'></a><h3>SPARQL</h3><h4>Bug19474 - Improve SPARQL describe queries</h4>
<ul>
<li><p>Excess variables are no longer included in the output of DESCRIBE</p></li>
<li><p>CBD (Concise Bounded Description) logic is now implemented so that we correctly handle blank nodes </p></li>
<li><p>Many general efficiency improvements</p></li></ul><h4>Bug19499 - Fix SPARQL XML and JSON output of geospatial values</h4><p>Retrieving SPARQL SELECT results containing geospatial values as SPARQL+XML or SPARQL+JSON was broken because an internals change hadn't been propagated to the SPARQL engine. This is now fixed. </p><a name='header3-5103' id='header3-5103'></a><h3>WebView</h3><h4>Rfe9815 - Fix accept-encoding issue for WebView in Internet Explorer 7</h4><p>This fixes a problem where Internet Explorer 7 would display "Internet Explorer cannot display the webpage" when opening WebView (or any other page served by AG). Internet Explorer fails to handle deflated content, so we now serve it gzipped responses instead. </p><h4>Bug19500 - Fix problem with displaying geospatial results in WebView</h4><p>When a query result contained geospatial data, a bug in WebView was triggered that caused the result to fail to display. This bug has been fixed. </p><h4>Bug19525 - Fix failure when opening a federated session in WebView.</h4><p>Trying to create a federated session in WebView resulted in a PRECONDITION FAILED error. This was caused by a bug in the way session data was being returned by the server, causing WebView to believe it was not on a federated store. The problem has been fixed. </p><a name='header2-5110' id='header2-5110'></a><h2>AllegroGraph 4.0.5d</h2><p>Welcome to AllegroGraph 4.0.5d.  This release of AllegroGraph v4.0 provides overall product stability and efficiency improvements. </p><a name='header3-5112' id='header3-5112'></a><h3>Server Changes</h3><h4>Rfe9966 - Front-end server-socket backlog parameter is too low</h4><p>The kernel will only save a certain amount of pending connection attempts. If the server doesn't accept them quickly enough, they get discarded. The default backlog size was too small. It is now set to use the maximum the operating system allows, making the chance of discarded connections much, much lower. </p><a name='header2-5115' id='header2-5115'></a><h2>AllegroGraph 4.0.5c</h2><p>Welcome to AllegroGraph 4.0.5c.  This release of AllegroGraph v4.0 provides efficiency improvements in the area of reasoning. </p><a name='header3-5117' id='header3-5117'></a><h3>Server Changes</h3><h4>Rfe9887 - Exclude inferences from Sesame queries by default</h4><p>Sesame queries (Tuple, Graph, and Boolean) will now be set to exclude inferences by default (this applies when the setIncludeInferred method has not been called on the query instance). </p><h4>Bug19484 - Jena always uses reasoning</h4><p>Fixed so reasoning is off by default and is enabled when InfModel is used. </p><h4>Bug19485 - setAutoCommit(true) causes exception</h4><p>True is the default, but calling this would raise an exception, so this has been fixed. </p><h4>Bug19491 - Jena reasoning not on full graph</h4><p>In the Jena API, AGInfModel, reasoning was previously done on graphs (default or named), and is now done on the full repository. Reasoning on scoped graphs will be included in a future release. </p><a name='header2-5126' id='header2-5126'></a><h2>AllegroGraph 4.0.5b</h2><p>Welcome to AllegroGraph 4.0.5b.  This release of AllegroGraph v4.0 provides overall product stability and efficiency improvements. </p><a name='header3-5128' id='header3-5128'></a><h3>Server Changes</h3><h4>Rfe9866 - Increase limit on string file sizes</h4><p>Previously, the files that held string data were limited to 32GB each. This release expands that limit to 512GB each. </p><h4>Bug19503 - Reclaim cursor resources more aggressively</h4><p>Certain SPARQL operations could acquire cursor resources and not release them immediately. Depending on garbage collection and server load, this could eventaully hang the server. </p><p>This patch ensures that SPARQL releases cursors immediately during triple-existence checks which prevents the resource issues from arising. </p><a name='header2-5134' id='header2-5134'></a><h2>AllegroGraph 4.0.5</h2><p>Welcome to AllegroGraph 4.0.5.  This release of AllegroGraph v4.0 provides overall product stability and efficiency improvements. </p><a name='header3-5136' id='header3-5136'></a><h3>Server Changes</h3><h4>Rfe9334 - License support for agraph with triple-limit and expiration</h4><p>AG now requires a license code which includes a limit on the number of triples and an expiration date, both of which may be unlimited. </p><p>If the license code is missing, invalid, or expired, it defaults to Free version, 5 million triples with no expiration. </p><h4>Rfe9348 - Added offset keyword argument to getStatements/evalFreeTextSearch</h4><p>The getStatements and evalFreeTextSearch methods on RepositoryConnection objects now support an optional offset keyword argument for skipping a number of results before returning values from the result set. </p><h4>Rfe9471 - Limit maximum checkpoint frequency by configuration variable</h4><p>A new configuration variable, MinimumCheckpointInterval, has been added that can be set to modify the frequency at which checkpoints are written by AllegroGraph. It defaults to the the CheckpointInterval period or five minutes if interval based checkpointing is not used. </p><p>The SkipPostMergeCheckpoint configuration variable has been removed. </p><h4>Rfe9564 - Alternate mode for checkpoint triggering</h4><p>In addition to triggering checkpoints in regular time interval, AllegroGraph now offers an alternate mode for triggering checkpoints based on the expected recovery time. It is enabled by the MaxRecoveryTime catalog/database parameters and needs to be set to the maximum number of milliseconds that AllegroGraph should spend recovering transactions from the transaction logfile during recovery. When AllegroGraph detects that the established maximum recovery time would be exceeded, a checkpoint is written. Note that the maximum recovery time period does not include the flat startup fee for a database that is independent of the number of transaction to recover from the transaction log file. </p><h4>Rfe9604 - Suppress unnecessary checkpoints</h4><p>In previous releases, AllegroGraph automatically created checkpoints when a database was started, stopped or a certain time interval had elapsed. This has been changed so that checkpoints are only written in these situations if there had been any commits since the last checkpoint has been created. </p><h4>Rfe9608 - Have HTTP /eval service handle multiple returned values</h4><p>Extra values returned by evaluated forms used to be discarded. The server now attempts to return them as a list of values, if the Accept format supports such a thing. </p><h4>Rfe9691 - Remove race condition in internal API</h4><p>In order to support a new use case, a race condition has been removed from the internal resource manager API. </p><h4>Rfe9709 - Improved automated test for database recovery</h4><p>Automated test coverage for database recovery has been improved. </p><h4>Rfe9713 - Document <code>load-nquads</code></h4><p>Added the documentation for <code>load-nquads</code> and <code>load-nquads-from-string</code> to the Lisp Reference Guide. </p><h4>Rfe9726 - Minor agload improvements</h4>
<ul>
<li>improve agload output so that it is easier to understand,</li>
<li>correct agload failure to load the TriX format,</li>
<li>expose support for N-Quad format, and</li>
<li>other minor internal improvements</li></ul><h4>Rfe9729: Make it possible to disable interval based checkpointing</h4><p>Interval based checkpointing can now be disabled by setting the CheckpointInterval database parameter to zero. </p><h4>Rfe9732 - Disable interval based checkpointing when recovery time based checkpointing is enabled</h4><p>When recovery time based checkpointing is enabled, AG now switches off interval based checkpointing by default. </p><h4>Rfe9766 - Ensure that the AllegroGraph server and the Lisp client use the same UID</h4><p>Because the Lisp client must have full read/write access to a database's files and shared memory data structures, it must run under the same UID as the AllegroGraph server. This change enforces this requirement to avoid potentially confusing errors. </p><h4>Bug19101 - with-variables-&gt;bindings-array is too strict</h4><p>AllegroGraph's SPARQL engine raises an error when imposed bindings (the :with-variables keyword argument to run-sparql) are not a subset of the variables mentioned in the body of the query. </p><p>This error checking failed to include variables mentioned in a CONSTRUCT template or DESCRIBE variable list, which meant that query invocations which imposed bindings for variables mentioned in the CONSTRUCT template alone would raise an error. </p><p>This is now corrected. </p><h4>Bug19168, Bug19332 - Ensure that user functions are compiled correctly</h4><p>This patch improves the way that functions generated at run-time are compiled. This includes SNA generators and <code>select</code> query plans. These should all perform slightly better with this change. </p><h4>Bug19209 - Fix bug with reasoner and rollback</h4><p>In certain situations, the RDFS reasoner could become confused and fail to update its data caches after the triple-store was rolled-back. This is corrected. </p><h4>Bug19339 - Update UPI serialization</h4><p>There was a printer escape problem in the N-Triple serializer such that only one backslash was output when two should have been. I.e., \a instead of \a. This prevented serialized triples from being re-imported into AllegroGraph. This problem has been corrected. </p><h4>Bug19429 - Problems with catalog option FilePlacementRule in agraph.cfg</h4><p>A defect has been fixed that resulted in an error when a database created from a catalog that specified a FilePlacementRule was opened. </p><h4>Bug19431 - Wrong parameters logged during database startup</h4><p>A defect has been fixed that made the AllegroGraph server potentially log wrong parameters to the server log file during database startup. </p><a name='header3-5182' id='header3-5182'></a><h3>Changes to the Lisp API</h3><h4>Rfe9643 - Remove <em>synchronize-automatically</em> from the Lisp API</h4><p>In AllegroGraph 3, <em>synchronize-automatically</em> controlled whether or not a triple-store was immediately synchronized after the addition of new triples. Because this level of control is unnecessary in AllegroGraph 4, the variable is being removed. </p><h4>Bug19188 - [Lisp API] create-triple-store :if-exists :error problem</h4><p>The Lisp API function create-triple-store behaved incorrectly if the :if-exists keyword argument was :error. An error would occur whether or not the triple-store already existed. Fixed. </p><a name='header3-5187' id='header3-5187'></a><h3>Documentation</h3><h4>Rfe9475 - Document catalog parameters vs database parameters</h4><p>The AllegroGraph server configuration documentation has been updated to include information on how existing databases can be reconfigured. </p><h4>Rfe9721 - Restore Lisp freetext tutorial</h4><p>Adds a tutorial that describes the way freetext indexing works in version 4 of AllegroGraph. </p><h4>Bug19411 - Configuration and performance documentation updated</h4><p>The server documentation has been updated to reflect the removal of the 'Aux' catalog directive and the addition of the StringTableDir and FilePlacementRule directives. </p>    <a name='header3-5198' id='header3-5198'></a><h3>Java Client</h3><h4>Rfe9743 - Upgrade to Sesame 2.3.1</h4><p>Previously the Java client was using Sesame 2.2.4; this upgrades the client to the latest version of Sesame 2. </p><a name='header3-5201' id='header3-5201'></a><h3>Jena Client</h3><h4>Rfe9744 - Upgrade to Jena 2.6.2</h4><p>Previously the Java client was using Jena 2.6.0; this change upgrades the client to the latest version of Jena. </p><a name='header2-5204' id='header2-5204'></a><h2>AllegroGraph 4.0.4</h2><p>Welcome to AllegroGraph 4.0.4.  This release of AllegroGraph v4.0 provides overall product stability and efficiency improvements. </p><a name='header3-5206' id='header3-5206'></a><h3>Server Changes</h3><h4>Rfe8792 - Clean up partially created triple stores</h4><p>When creating a triple store fails, the AllegroGraph server now deletes any files and directories that it may have created up to the point where the error occured. This makes it easier to retry creating the triple store once the condition that made creation fail has been removed. </p><h4>Rfe9123 - Extend test functions to start and stop db server</h4><p>The AllegroGraph server can now be stopped by providing the --stop-server switch to the agraph executable. The --config or --pid-file parameters must be present on the command line. </p><h4>Rfe9292 - AllegroGraph Loader</h4><p>Added the AllegroGraph Loader tool for parallel loading of large files. </p><h4>Rfe9367 - AllegroGraph log should include the config file</h4><p>A change has been made to AllegroGraph so that configuration file directives are written to the server log file at "info" log level during configuration file parsing. </p><h4>Rfe9451 - Pause text-index merges during checkpoints</h4><p>We make sure the text-index merger is paused when a checkpoint is taking place, to prevent resource contention from making the checkpoint take long, which would make other subsystems wait. </p><h4>Rfe9497 - Ensure that select queries release temporary indices</h4><p>Previously, <code>select</code> queries that used temporary indices (UPI maps) would not free them when the query completed. This could result in poor memory management and eventual poor system responsiveness. This is now corrected because queries release their temporary indices when they complete. </p><h4>Rfe9508 - Add configuration options for manual control of file placement</h4><p>Two new configuration options, StringTableDir and FilePlacementRule, have been added to the catalog and database configuration. They can be used to control the placement of individual database files. </p><h4>Rfe9518 - SHM server handles client failures</h4><p>Increased robustness of the background shared memory server so that it won't crash when a client shuts down prematurely while communicating with the server. </p><h4>Rfe9579 - Include catalog name in conditions signaled by the storage layer</h4><p>Error messages generated by the storage layer now include the catalog name in addition to the name of the database that was being acted upon when the error occured. </p><h4>Rfe9580 - Use less strict permissions on UPI map and transaction log files</h4><p>In prior releases, UPI map and transaction log files were created with mode 0600, which prevented them from being read by other users. This made is difficult to share databases. Now, UPI map and transaction log files are created with mode 0666 and the umask is used to determine the final file permissions. This keeps the permissions on these two types of files in line with the other database files. </p><h4>Rfe9602 - Optimize various UPI coercion functions</h4><p>Optimized some of the code paths that AllegroGraph uses to convert strings and future-parts into UPIs. This will provide a small performance benefit (1-2%) in some aspects of triple-store loading and querying. </p><h4>Rfe9642 - Transaction logging adjustments</h4><p>The recovery code has been adjusted so that automatic recovery after a machine crash is possible if the crash happened while a record was written to the transaction log. </p><h4>Rfe9642 - Transaction logging adjustments for warm standby</h4><p>The transaction log now includes marker records for the beginning of a commit that is used by the warm standby mechanism. Existing databases must be upgraded to accomodate for the new transaction log format. </p><h4>Rfe9654 - Remove Aux configuration parameter</h4><p>The Aux configuration parameter that was used in previous versions of Allegrograph to make a database use multiple disks for its files has been removed. In order to make use of multiple disks, the TransactionLogDir, StringTableDir and FilePlacementRule should now be used. </p><h4>Rfe9710 - Make warning about uploading big files through WebView clearer.</h4><p>Since browsers aren't very good at uploading multi-gigabyte files, WebView makes it clear that there are better alternatives for doing that. </p><h4>Bug19199 - Lock database directories</h4><p>When an Allegrograph server opens a database, it will now lock the database directory so that if a second server is configured to use the same directory, it cannot open the database. This protects the database from corruption which would be the result of two servers opening it at the same time. </p><h4>Bug19203 - Restore the :use-planner option of the <code>select</code> query planner</h4><p>The :use-planner option of the <code>select</code> query planner was being ignored. It now functions correctly. </p><h4>Bug19221 - Durability issue related to file deletion</h4><p>A problem has been identified that could result in database files to be wrongly deleted during checkpoint processing, resulting in database corruption. The problem has been fixed. </p><h4>Bug19251 - Spurious warning message about nonexistent file ctl0</h4><p>During database creation, the server logged a spurious warning message about a file "ctl0" that could not be deleted. This has been fixed. </p><h4>Bug19256 - Database recovery fails with partially written checkpoint</h4><p>A problem was identified that could cause database recovery to fail when the transaction log contained an incomplete checkpoint record. This problem has been corrected. </p><h4>Bug19263 - Server log contains cut-off lines</h4><p>Due to a programming error, it could happen that lines in the server log file were garbled or cut off. This program has been corrected. </p><h4>Bug19264 - Opening databases is slower than it needs to be</h4><p>A bug has been found that caused opening databases to be much slower than needed. The reason was that the "df" command was invoked by the database server for every file instead of once per directory. This has been corrected. </p><h4>Bug19279 - Deleted triple data structure maintenance only happens once</h4><p>After each merge (but only if 15 minutes has elapsed), a task runs which performs maintenance on the data structures which track deleted triples. Due to a logic bug, this operation was only happening once, even if subsequent merges occurred. This has been corrected. </p><h4>Bug19282 - Improve parsing of XSD single and double floats</h4><p>AllegroGraph was parsing XSD doubles using a single float parser which led to some values being incorrectly converted to infinity. AllegroGraph was also treating numbers outside the range of IEEE floating point representations inconsistently. It now always converts numbers smaller than the minimum representable value for a float to zero and numbers larger than the representable value for a float to positive or negative infinity (as appropriate). </p><h4>Bug19303 - Improve algorithm used to find sort-upi-map program</h4><p>In some cases, AllegroGraph was unable to find an external program needed for UPI map creation. This patch fixes the problem. </p><h4>Bug19308 - Make namespaces available to code evaluated server-side.</h4><p>Code run through the eval-in-server service is now given access to the namespaces that the user defined. It used to run in an environment without namespaces. </p><h4>Bug19328 - Make remote stores raise an error when created while open</h4><p>It is now an error to call create-triple-store on a store that is still being held open as a remote-triple-store (in Lisp). </p><a name='header3-5261' id='header3-5261'></a><h3>Changes to the Lisp API</h3><h4>Bug19298 - Improve the printing of future-parts</h4><p>(Lisp only) Future-parts were not printing properly when <em>print-circle</em> was bound to true. In addition, future-parts like !&lt;foo&gt; were not printing correctly (the angle brackets were left off). This patch corrects both of these problems. </p><a name='header3-5264' id='header3-5264'></a><h3>Documentation</h3><h4>Rfe9339 - Improve 3-to-4 code conversion document</h4><p>The Java and Jena sections of the 3.x to 4.x code conversion document have been greatly expanded. </p><h4>Rfe9549 - Many improvements in the Lisp documentation</h4><p>Improved and clarified many minor issues in the Lisp reference guide. </p><h4>Rfe9690 - Documentation for AllegroGraph Loader</h4><p>A documentation page for the AllegroGraph Loader has been added to AllegroGraph 4.0.4. </p><h4>Rfe9711 - More detail in Java client installation instructions</h4><p>The instructions for importing the AllegroGraph Java client into Eclipse have been augmented with more detail to make the process easier for new users. </p><h4>WWW495 - Add LUBM Benchmarks to documentation navigation list</h4><p>A link to the web page on AllegroGraph's performance on the Lehigh University benchmark (LUBM) has been added to the navigation bar of the Franz documentation pages. </p><a name='header3-5275' id='header3-5275'></a><h3>Text Indexing</h3><h4>Rfe8932 - Allow sorting of freetext-searches by relevance.</h4><p>freetext-get-triples and the HTTP /freetext service now support an argument that will cause the results to come back in sorted order of relevance, using a simple weighting scheme that takes into account word frequencies in the document and commonness of words across documents. </p><h4>Rfe9356 - Add fuzzy text-index searching.</h4><p>Freetext search expressions can now contain fuzzy terms, written as (fuzzy "term" [max-distance]) in s-expression queries, and term~ or term~2 in textual queries, which will match anything with a Levenshtein distance less than max-distance (or 1/5 word length when no explicit distance is given). </p><a name='header3-5280' id='header3-5280'></a><h3>WebView</h3><h4>Rfe9504 - Improve handling of WebView file uploads to use less memory.</h4><p>File uploads through WebView went through a few too many memory buffers, causing them to fail on systems without a lot of free memory. They are now directly streamed, and never stored in memory in their entirety. </p><a name='header2-5283' id='header2-5283'></a><h2>AllegroGraph 4.0.3</h2><p>Welcome to AllegroGraph 4.0.3.  This release of AllegroGraph v4.0 provides overall product stability and efficiency improvements. </p><a name='header3-5285' id='header3-5285'></a><h3>Server Changes</h3><h4>Rfe8999 - Use full blank-node IDs in RDF/XML output.</h4><p>The nodeID properties found in RDF/XML documents created by AllegroGraph can now be sent back to the server to identify the blank node they refer to. They used to be shorter IDs, which were meaningless outside of the document. </p><h4>Rfe9363 - Revise use of fsync and fdatasync and move to checkpoint time</h4><p>In previous versions, AllegroGraph used the fsync() system call in various places to synchronize the on-disk state of database files. This could result in unexpected I/O activity when databases resided on ext3 file systems, as fsync() on ext3 always synchronizes all files, not just the file that has been requested to be synchronized.  To improve this, AllegroGraph now syncs files only at checkpoint time. </p><h4>Rfe9490 - increase application's initial heap size</h4><p>Increase AllegroGraph's initial heap size to reduce garbage collection frequency and thereby improve application performance. </p><h4>Rfe9505 - Improve efficiency of string dictionary lookup</h4><p>Increased the efficiency of string lookup by roughly 20%. </p><h4>Rfe9541 - Server installation script avoids writing double-slashes to agraph.cfg</h4><p>Previously in configure-agraph, if the user gave a directory name with a trailing slash, the cfg file would be written with double-slashes in various dir names. </p><p>Now, the trailing slash is removed to avoid double-slashes. A double-slash is legal in Unix, but is visually unappealing. </p><h4>Rfe9560 - Truncated cursors free resources more aggressively</h4><p>Truncated cursors now clean up their environment more quickly which improves general AllegroGraph resource management. </p><h4>Rfe9567 - Don't print a backtrace on socket timeout errors.</h4><p>The server no longer logs a backtrace when a socket timeout is raised. </p><h4>Rfe9586 - Prevent unneeded file reads in metadata-rollback</h4><p>This provides an increase in efficiency when rolling back a triple store. The metadata system was re-reading its status file on rollback, even when it didn't have to. </p><h4>Rfe9593 - Optimize string-dictionary</h4><p>Optimized and stream-lined AllegroGraph's string-dictionary code. This provides a 5 to 6-percent speed increase in many string related operations. </p><h4>Rfe9598 - Improve efficiency of string table intern operations.</h4><p>Previously when strings were interned, more work than necessary was being performed if an entry already existed for a string. This extra work is now avoided. </p><h4>Rfe9665 - Adjusted merge invocation algorithm</h4><p>Changes have been made to the algorithm which determines when index merges should occur. These changes should make merge behavior more predictable and efficient. </p><h4>Rfe9673 - Make sort-upi-map operation more verbose</h4><p>In order to aid in tracking down a hard-to-reproduce bug, the sort-upi-map program now logs information about which files it is manipulating. </p><h4>Bug19041 - Delete-triple-store only deletes files from the main directory (not the aux)</h4><p>Previously, if a database used Main and Aux directories and was deleted using delete-triple-store, the files in the Aux directories were not deleted.  This has been corrected. </p><h4>Bug19085 - Fixed race condition in delete-list.dat handling</h4><p>A file named "delete-list.dat" is used to maintain a list of which files should deleted at the next checkpoint. There was a race condition in the handling of this file which could result in it being deleted at an inopportune time. This problem has been corrected. </p><h4>Bug19178 - Fix race condition in metadata system</h4><p>In some circumstances, opening a store or rolling back could cause the system to try to read a non-existent file. This is now solved. </p><h4>Bug19182 - Performance regression with concurrent writes.</h4><p>A performance problem has been identified in the mechanism that Allegrograph uses to translate from internally-used logical file names to real on-disk path names.  Previously, such lookups were made by a centralized process using a remote procedure call.  Now, lookups are solely made within the requesting process without requiring an inter-process exchange. </p><h4>Bug19192 - Merger may not notice that the database is shutting down</h4><p>Previously, under certain circumstances, the merger may fail to shut down in an orderly manner during an otherwise normal database shutdown.  This problem has been fixed. </p><h4>Bug19189 - Prevent HTTP back-ends from holding their lock too long</h4><p>This bug was most visible when using cursors in remote-triple-stores -- the client had to read out the whole cursor before it could make other requests. This is now fixed. </p><h4>Bug19201 - Catch and log errors raised in the process-services thread.</h4><p>Errors raised within the per-process thread that managed, for example, back-trace requests were not properly logged, but caused the debugger to be entered. This is now fixed. </p><h4>Bug19206 - Unrecoverable database due to checkpoint file id reuse</h4><p>A problem has been identified that could result in an unrecoverable database in situations where there have been unclean shutdowns during recovery.  This problem has been fixed. </p><h4>Bug19222 - Do not fsync temporary files during checkpoint processing</h4><p>Previously, AllegroGraph called fsync for all files, including temporary files, that make up a database. This has been changed so that temporary files are not fsynced. </p><h4>Bug19223 - Recovery hangs</h4><p>A problem has been identified that could cause AllegroGraph to hang during database recovery afer an unclean shutdown. This problem has been fixed by starting the merger processes earlier so that they are available during the recovery process. </p><h4>Bug19236, Bug19237 - improve geospatial subtype mapping support</h4><p>The geospatial sub-type mapping code was occasionally being called incorrectly which could lead to spurious errors during query. In addition, the error message reported when a geospaital subtype was not found was being displayed incorrectly. Both of these problems are now corrected. </p><h4>Bug19244 - Delete old deleted-shmem-files</h4><p>It has been discovered that the deleted-shmem-files, which are used by the triple deletion functionality, have never been deleted when they became obsolete. This wasted disk space with stale data. The problem has been fixed. </p><h4>Bug19257 - Deleted hash file deleted at the wrong point in time</h4><p>A problem has been identified that could lead to the deletion of a deleted hash table file while it was still being referenced. This has been fixed. </p><h4>Bug19276 - Possible unnecessary post-merge full scan of indices</h4><p>After an index merge, a task sometimes runs to perform maintenance of the data structures used to track deleted triples. This operation requires a full scan of indices. Previously, this full scan was performed even if it was unnecessary. This has been fixed. </p><a name='header3-5339' id='header3-5339'></a><h3>Changes to the Lisp API</h3><h4>Rfe9595 - Reduce unnecessary type-checking from Lisp API functions</h4><p>The exported Lisp API functions (like get-triples or add-triple) were performing unnecessary type checks. This commit removes these checks and thereby increases the speed of code that uses this API. </p><p>This change also means that the Lisp API no longer supports using triple-store names to designate stores. That is, functions now require a triple-store instance and will no longer accept a triple-store name. </p><h4>Bug19173 - Corrected bug in Lisp API for remote-triple-stores</h4><p>Previously, cursors for remote-triple-stores could produce an error when a query returned too many unique strings. This error will no longer occur. </p><h4>Bug19177 - Fix broken interpretation of namespaces in Sesame transaction documents</h4><p>The 'name' and 'prefix' attributes of the addNamespace and removeNamespace tags were interpreted the wrong way. ('name' should hold the URL, and 'prefix' the short name). </p><a name='header3-5347' id='header3-5347'></a><h3>Documentation</h3><h4>Rfe9339 - 3.x to 4.x code conversion document added</h4><p>At the request of users, we have provided a document that lists the changes in the AllegroGraph Lisp, Python, and Java APIs in the upgrade from AllegroGraph 3.x to AllegroGraph 4.x versions. </p><h4>Rfe9432 - Updates to Python API document</h4><p>There were several updates to the Python API documnent to better delineate the distinction between public and private methods in 4.0.3. </p><h4>Rfe9504 - Document TempDir configuration directive</h4><p>The location where the server creates temporary files can now be controlled by specifying a TempDir option in a configuration file. This option is now described in the Daemon Configuration web page. </p><h4>Rfe9540 - Audited the Python API doc for currency</h4><p>The Python API document has been updated to reflect recent changes in the Python API. </p><h4>Rfe9599 - Update Java section of 3-to-4 conversion document.</h4><p>The v3-to-v4 code conversion document, convert3to4.html, has been updated to enlarge on the information about the new AllegroGraph Java Client. [5.0 note: the convert3to4.html document is no longer part of the documentation set.] </p><h4>Bug19320 - Include links to upgrading information in documentation</h4><p>Added links from the navigation section of each document to the "converting from AllegroGraph 3 to 4" documentation. </p><a name='header3-5360' id='header3-5360'></a><h3>SPARQL</h3><h4>Rfe9561 - Improvement in SPARQL recycling of storage-layer cursors.</h4><p>The SPARQL query engine now more aggressively discards and recycles cursors over on-disk indices. This improves the behavior of the system under load. </p><a name='header3-5363' id='header3-5363'></a><h3>Gruff</h3><h4>New overview/scroller panes</h4><p>The View menu has three new commands for using an overview/scroller pane. </p><h4>New submenu File | Export Displayed Data As ...</h4><p>A new "Export" child menu on the File menu allows exporting the currently-displayed triples or nodes to a file in one of several standard formats. </p><h4>Child menu names are now included in the documentation.</h4><p>Until now, a menu command that's on a cascading child menu, such as "Drawing Options | Derived Node Labels | Capitalize First Word", appeared in the docs as simply "Drawing Options | Capitalize First Word", which could make it hard to find on the menus.  The docs now include the full path. </p><h4>New freetext command "Add | Edit the Set of Registered Predicates".</h4><p>There are new commands for registering some or all predicates for freetext queries at one time, and for unregistering some in agraph4. </p><h4>Rfe9090 - Initial port to the agraph4 freetext API</h4><p>The freetext commands now work on agraph 4. </p><h4>Export commands failed when bridge lines were present</h4><p>The new File | Export commands failed when bridge lines are present. This is now fixed. </p><a name='header2-5376' id='header2-5376'></a><h2>AllegroGraph 4.0.2</h2><p>Welcome to AllegroGraph 4.0.2.  This release of AllegroGraph v4.0 provides overall product stability and efficiency improvements. </p><a name='header3-5378' id='header3-5378'></a><h3>Server Changes</h3><h4>Rfe9084 - Return Prolog parse errors as bad requests, not internal server errors.</h4><p>When issuing a Prolog with a syntax error, the response no longer indicates an internal server error, but is returned as a bad request error, tagged "MALFORMED QUERY". </p><h4>Rfe9313, Bug18592 - Improved clause reordering in <code>select</code> queries</h4><p>Modified the clause size estimation code to make it work better with AllegroGraph 4.0. The change greatly increases the speed of some Prolog-based <code>select</code> queries. </p><h4>Rfe9345 - Ensure that distribution does not contain extra debug scaffolding</h4><p>We now ensure and test that certain developer tools and debugging aids are not part of the distributed AllegoGraph. Removing these from the released code will have a small performance gain in some parts of the system. </p><h4>Rfe9351 - Don't write deleted hash table if no triples have been deleted</h4><p>Previously, the shared memory hash table that is used to track deleted triples was written to a file at every checkpoint.  With this change, the table is only written when deletion of triple actually has happened. This speeds up trivial checkpoints as well as database open and close operations by about 35%. </p><h4>Rfe9404 - Improve error message when bulk loading N-Triple data</h4><p>The error signaled when loading invalid N-Triple data has been made clearer. </p><h4>Rfe9435 - Support offset argument to geospatial query services</h4><p>For consistency, all services that support a limit argument now also have an offset argument, which allows results to be skipped. </p><h4>Rfe9440 - Improve cursor code efficiency in some situations</h4><p>Improved some low-level cursor implementation details that provide a small but measurable speed and space boost for some queries. </p><h4>Rfe9447 - Improve detection of SPARQL Negation-As-Failure idiom.</h4><p>This change allows for SPARQL's idiom for Negation-As-Failure to be detected more reliably, and thus executed more optimally. </p><p>In particular, this allows for the <code>OPTIONAL</code> component to contain <code>FILTER</code>s, so long as they refer only to variables bound within the <code>OPTIONAL</code> itself. </p><p>One such query might be: </p>
<pre><code>PREFIX foo: &lt;http://www.example.com/foo/foo_model#&gt;  
PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;  
SELECT ?foo ?type  
WHERE {  
   ?foo a foo:Bar .  
   ?foo a ?type .  
   OPTIONAL {  
    ?subType rdfs:subClassOf ?type .  
    FILTER(?subType != ?type)  
   }  
   FILTER(!BOUND(?subType))  
} </code></pre><h4>Rfe9448 - Add upi&lt; and upi&lt;= functors to prolog select</h4><p>Added additional functors to the Prolog-based select language to make some operations easier to use. </p><h4>Rfe9462 - Improved database shutdown process</h4><p>The shutdown process that AllegroGraph uses when a database is closed has been improved to be more orderly and reliable. </p><h4>Rfe9464 - Support adding and removing of namespaces from Sesame XML transactions</h4><p>A client program that uses the &lt;setNamespace&gt; and &lt;removeNamespace&gt; tags has been shown to exist (TopBraid), so they have been implemented. </p><h4>Rfe9493 - Added mixed workload to events test</h4><p>A -m parameter was added to the events test to run a Phase 6 mixed workload after the normal phases complete. This runs a mixture of queries, adds, and deletes until it is interrupted. </p><h4>Bug19070 - /etc/init.d/agraph 'status' doesn't work</h4><p>Previously, running "/etc/init.d/agraph" resulted in an error message instead of reporting the status on the agraph service.  This has been fixed. </p><h4>Bug19078 - Improve error message for invalid use of create or open-triple-store</h4><p>The error message signaled when creating (or opening) a triple-store with incorrect parameters has been improved. The documentation of both functions is also clearer. </p><h4>Bug19089 - Make sure daemon doesn't hang when it encounters an error</h4><p>Turns off a debugging switch that was, unintentially, switched on by default, causing the service daemon to enter the debugger when encountering an error. </p><h4>Bug19090 - Improve handling of graph-filtered-stores</h4><p>Graph filtered triple-stores are used in various places in AllegroGraph's query engine. Prior to this fix, they did not implement some of the necessary API and could generate an error. </p><h4>Bug19091 - Prevent server shutdown from locking up when a session is open.</h4><p>The server would lock up when sent a sigterm if an HTTP session was still open. This is now fixed. </p><h4>Bug19101 - Error detection for with-variables and CONSTRUCT queries.</h4><p>AllegroGraph's SPARQL engine raises an error when imposed bindings (the :with-variables keyword argument to run-sparql) are not a subset of the variables mentioned in the body of the query. </p><p>This error checking failed to include variables mentioned in a CONSTRUCT template or DESCRIBE variable list, which meant that query invocations which imposed bindings for variables mentioned in the CONSTRUCT template alone would raise an error. </p><p>The resolution for this bug corrects the issue. </p><h4>Bug19121 - Fix bug in namespace caching for HTTP back-ends.</h4><p>Occasionally (depending on the system clock rolling over to the next second at the wrong moment) a newly defined (or deleted) namespace wasn't being seen by a back-end, causing 'unknown namespace' errors. This is now fixed. </p><h4>Bug19123 - Allow reasoning-triple-stores to create new-blank-nodes</h4><p>Reasoning-triple-stores (and other encapsulated-triple-store classes) were unable to mint new blank IDs. This prevented them from loading any RDF data that contained blank nodes. This fixes the problem. </p><h4>Bug19145 - sendfd library does not handle "out of file descriptors" condition gracefully</h4><p>When a client process experienced file descriptor shortage while connected to an Allegrograph store, memory corruption could occur. This has been corrected. </p><h4>Bug19151 - Refcounts on open indices not updated aggressively</h4><p>Previously, if regular query operations were performed against a database that was continually growing, file handle exhaustion could occur due to incorrect reference counts on indices.  This problem has been fixed. </p><h4>Bug19155 - Correct printing of invalid-characters-in-name condition</h4><p>This fixes a syntax error in the formatting of the condition used to signal an invalid triple-store name or catalog. Previously, the error message produced was difficult to interpret; now it is clearer. </p><a name='header3-5430' id='header3-5430'></a><h3>AllegroGraph Server: HTTP Interface</h3><h4>Rfe9227: Allow an HTTP proxy to be configured for the server</h4><p>The HTTPProxy configuration directive can now be used when the server has to use an HTTP proxy to connect to the internet (for example, to load data from a URL). </p><h4>Rfe9318 - Remove persistent federations from the HTTP protocol</h4><p>Accessing federations of stores is now done by opening a session for such a federation, not by creating a persistent federated store and opening that. </p><h4>Rfe9450 - Allow committing and rolling back through HTTP headers</h4><p>As a performance optimization, it is now possible to have commit or rollback commands piggyback on other HTTP requests, using the x-commit and x-rollback HTTP headers. </p><h4>Rfe9458 - Expose a full-featured textual free-text query language over HTTP</h4><p>The 'pattern' argument to the /freetext service now understands strings like 'foo | bar' (foo OR bar), 'foo*' (everything starting with foo), '"foo bar"' (matching the exact string "foo bar") and even 'quux (foo | bar)' (quux AND (foo OR bar)). </p><h4>Rfe9458 - Tweak free-text query expression format</h4><p>When searching from the Lisp API, a phrase search is now done with '(phrase "foo bar") rather than "\"foo bar\"", and a wildcard match is done with '(match "wild<em>") rather than just "wild</em>". </p><h4>Rfe9483: Add continueOnError parameter to HTTP statement loading</h4><p>For N-Triples and N-Quads data, this argument can be used to make the load continue when malformed data is encountered, skipping the broken triples. </p><h4>Rfe9496 - Support clearNamespaces tag in Sesame XML transaction documents</h4><p>This tag was overlooked in the original implementation. It is now supported. </p><h4>Rfe9499 - Support prepared queries in the HTTP protocol</h4><p>It is now possible to 'prepare' SPARQL queries, either as a side-effect of executing them, or as a separate action. The requests for executing the prepared query will be more lightweight, since they don't have to pass in the query itself and most of its arguments, and skip the query-parsing stage. </p><h4>Bug19088 - Allow a default namespace to be defined over HTTP</h4><p>Due to the server stripping off trailing slashes from URLs and redirecting, the PUT request to ../namespaces/, which is required to create a namespace without a name, was redirected to ../namespaces, and didn't work. The redirecting behaviour is now turned off for this URL. </p><a name='header3-5449' id='header3-5449'></a><h3>Changes to the Lisp API</h3><h4>close-triple-store has new 'commit' keyword</h4><p>close-triple-store has a new 'commit' keyword argument.If true, then the <a href="lisp-reference.html#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> will be called before the store is closed. </p><h4>user-reasoner keyword removed</h4><p>The deprecated <code>use-reasoner</code> keyword argument has been removed from make-tutorial-store; use apply-reasoner-p instead. </p><h4>sync-triple-store has been removed</h4><p>The deprecated <code>sync-triple-store</code> has been removed; use <a href="lisp-reference.html#commit-triple-store" title="description of commit-triple-store">commit-triple-store</a> instead. </p><h4>Rfe9576 - :expected-size argument to open-triple-store and create-triple-store no longer supported</h4><p>To specify the expected size of a new database, edit the catalog configuration file before creating the database.  To change the expected size of an existing database, change the ExpectedStoreSize parameter in the parameters.dat file of the database. </p><h4>Bug19046 - Fix error generated by future-part printer</h4><p>If a namespace mapping did not exist, then the future-part printer could signal an error instead of correcty printing the part. [Lisp API] </p><h4>Bug19081 - Change return type of ego-group-layers from vector to list</h4><p>The <code>ego-group-layers</code> function was incorrectly returning a vector of results instead of a list. Its behavior now matches the documentation: it returns a list of lists where each sublist contains nodes discovered at that level. [Lisp API] </p><a name='header3-5462' id='header3-5462'></a><h3>Documentation</h3><h4>Improved Lisp reference manual documentation</h4><p>Made several minor formatting changes and added documentation for the <code>upi&lt;=</code> function and functor. </p><h4>Document new free-text index HTTP API.</h4><p>The creation and configuration of multiple text indices over HTTP is now described in the protocol document. </p><h4>Rfe9169 - Add links to Javadocs from AllegroGraph documentation</h4><p>Added links from the navigation bar of each AllegroGraph documentation webpage to the Javadocs. </p><h4>Rfe9314 - Update Lisp API docs to reflect changes in freetext-indexing API</h4><p>Indexing is no longer managed by keeping a list of predicates, but by creating one or more indices, each with multiple configurable parameters. </p><h4>Rfe9318 - Update the HTTP protocol documentation for changed federation API</h4><p>The services for creating and deleting persistent federations are gone, a more flexible way to open sessions, which also allows federation of stores, has been added. </p><h4>Rfe9377 - Update free-text indexing example in Python tutorial</h4><p>The 12th example in the Python tutorial now shows how to create multiple indices and search for both text literals and URIs. The example introduces these new methods: </p>
<pre><code>createFreeTextIndex  
getFreeTextIndexConfiguration()  
evalFreeTextSearch() </code></pre><h4>Rfe9378 - Update Python documentation to reflect new federation API</h4><p>The Python tutorial has been updated to reflect recent changes in the Python API for creating federated sessions. </p><h4>Rfe9383 - Document new-style federation in the java client</h4><p>The 16th examples in the Java tutorial has been updated to reflect the new API for creating a federated repository. </p><h4>Rfe9500 - Update free-text-index entries in Python API html doc.</h4><p>The connection object methods for free-text indexing have  been updated to reflect recent changes in the API. </p><a name='header3-5482' id='header3-5482'></a><h3>Java Client</h3><h4>Rfe9318 - Support session-based (rather than persistent) federation</h4><p>The methods in AGServer for creating and deleting federations have been replaced by a single method, federate, which takes any number of repository objects, and returns a 'virtual' repository that federates all of them. </p><h4>Rfe9392 - Use accept-encoding gzip to get back compressed results</h4><p>Get and Post requests now use the Accept-Encoding: gzip header to request that responses be compressed, to improve performance when results are large. </p><p>Modified both tutorial examples files to call closeAll prior to deleteRepository in exampele1, as not doing so can result in orphaned sessions on the toClose list. </p><h4>Rfe9436 - Make session lifetime configurable</h4><p>Session lifetimes can now be configured for each connection, and should be set prior to making a method call that initiates a dedicated session. The default session lifetime is 1 hour.  Tutorial example 22 sets the session lifetime to 120 seconds to demonstrate. </p><h4>Rfe9442 - Add basic information to the jar manifest</h4><p>The Java client jar manifest now includes information about the current implementation, including name, version, vendor name, vender URL, time of creation, etc. </p><h4>Rfe9499 - Support query preparation</h4><p>Calls to prepareTupleQuery, prepareGraphQuery, and prepareBooleanQuery now return query objects that will, during the next call to evaluate(), request that the server save the query for future reuse (in dedicated sessions only), eliminating some parsing and other overhead in subsequent calls to evaluate(). Tutorial example 14 has been modified to use non-autocommit mode so that it demonstrates query preparation in a dedicated session and multiple calls to evaluate() with different variable bindings. </p><h4>Bug19086 - JenaTutorialExamples now uses Graph#getName()</h4><p>The tutorial examples now use Graph#getName() to get the graph's name, rather than using Graph#toString(), which now prints out additional human readable information about the graph. </p><h4>Bug19092 - Jena ResultSet and PrefixMapping compliance</h4><p>AGPrefixMapping now supports methods qnameFor, removeNsPrefix, samePrefixMappingAs, setNsPrefixes, shortForm, expandPrefix, lock, and withDefaultMappings.  The toString method now returns human readable information about the prefix mapping. </p><p>AGResultSet now supports methods getResourceModel, getResultVars, and remove. </p><p>AGQuerySolution now supports methods contains, get, getLiteral, getResource, and varNames. </p><a name='header3-5500' id='header3-5500'></a><h3>Python Client</h3><h4>Rfe8610 - Help finding pairs of UPIs</h4><p>The 23rd example in the Python tutorial has been extended to demonstrate how to use inequalities to reduce the number of permutation matches in SPARQL and Prolog queries. </p><h4>Rfe9311 - Expose revised FTI API in the Python client</h4><p>Text-indexing is no longer configured by adding predicates, but by creating (and updating or deleting) multiple separate indices. </p><h4>Rfe9318 - Move to session-based federation API.</h4><p>To federate stores, one now calls AllegroGraphServer.openFederated, which opens a session that federates the given stores, rather than creating a persistent federated store and opening that. </p><h4>Rfe9357 - Support wordFilter option to text-indices in Python client</h4><p>The createFreeTextIndex and modifyFreeTextIndex methods of a connection now allow a wordFilters argument to be specified, which allows accent removal and word stemming to be configured. </p><a name='header3-5509' id='header3-5509'></a><h3>Text Indexing</h3><h4>Rfe8775 - Support multiple text-indices per repository, add configuration parameters.</h4><p>Multiple free-text indices can now be active in a repository, and there is an API to create, query, modify, and delete them. New parameters supported are: stop words, minimum word length, whether to index resources, which literals to index, indexing non-object parts, and the possibility to index all triples, regardless of predicate. </p><h4>Rfe8775 - Add triples to free-text index as soon as they are added.</h4><p>A commit used to be necessary to be able to find newly added triples through the free-text index. They can now be queried (by the current transaction) as soon as they are added. </p><h4>Rfe9357 - Add word-filters to text-index configuration (accent removal, stemming)</h4><p>It is now possible (both in the Lisp API and over HTTP) to specify a list of word filters when defining a freetext index. These are operations that are performed on every word that is indexed, and every word that is queried, allowing various 'normalisations' of words. Currently allows two filters, "drop-accents" to remove accents from letters, and "stem.english" to apply basic, English-language word stemming. </p><a name='header3-5516' id='header3-5516'></a><h3>Changes to WebView</h3><h4>Rfe8775 - Allow free-text reconfiguration through WebView.</h4><p>WebView now allows the creation, modification, and deletion of free-text indices, exposing a UI for all the new configuration parameters. </p><h4>Rfe9408 - Expose free-form sessions in WebView</h4><p>There is now, for users with the "session" permission flag, a control on the main WebView page for starting and entering a session over a federated, reasoning, filtered, and/or remote store. </p><h4>Rfe9438 - Show server version in WebView</h4><p>WebView now shows the exact version of the server in its header. </p><h4>Rfe9453 - Support bulk-adding of namespaces in WebView</h4><p>Clicking 'bulk input' when adding a namespace now pops up a new input dialog, where a set of namespaces can be typed or pasted all at once. </p><h4>Bug19105 - Restore Safari-compatibility for WebView</h4><p>WebView was broken on recent versions of the Safari browser. This has now been remedied. </p><a name='header2-5527' id='header2-5527'></a><h2>AllegroGraph 4.0.1</h2><p>Welcome to AllegroGraph 4.0.1.  This version of AllegroGraph contains updates to the AllegroGraph 4.0 release, including: </p>
<ul>
<li>Cursor optimizations for increased performance</li>
<li>Improved caching of RDFS++ reasoning results</li>
<li>Improved SPARQL range-query efficiency</li>
<li>Heuristic optimization of negation as failure in SPARQL queries</li>
<li>SPARQL query performance tuning documentation added</li>
<li>Hardware Profiles added to Performance-Tuning Guide</li></ul><p>This release of AllegroGraph v4.0 provides overall product stability and efficiency improvements. </p><a name='header3-5536' id='header3-5536'></a><h3>Server Changes</h3><h4>Rfe9137: Heuristic optimization for negation as failure in SPARQL queries.</h4><p>SPARQL queries which use the common OPTIONAL/FILTER (!bound(?foo)) idiom to express negation as failure are now handled more efficiently, computing fewer unnecessary intermediate results. </p><p>This optimization can be disabled by setting the non-exported variable sparql.algebra::<em>rewrite-naf-p</em> to <code>nil</code>. </p><h4>Rfe9320: Improved caching of RDFS++ reasoning results</h4><p>Improved RDFS++ reasoner efficiency by selectively caching intermediate results. This makes many queries involving the reasoner between 2 and 10 times faster. </p><h4>Rfe9352, Bug19067, Bug19068: Improve internal cursor operations</h4><p>Optimizing how AllegroGraph treats empty cursors (i.e., cursors known to return no results) so that operations with them are faster. </p><h4>Rfe9374: Improved SPARQL range-query efficiency in some cases</h4><p>Improved the detection of range queries that will return no results which allows SPARQL to optimize other cursor operations. </p><h4>Bug18978: Optimizing cursor creation and filtering</h4><p>Improved the way AllegroGraph internally manages cursor creation and triple-filtering to increase performance. </p><a name='header3-5548' id='header3-5548'></a><h3>Documentation</h3><h4>Hardware Profiles added to Performance-Tuning Guide.</h4><p>The performance-tuning guide has a new section describing the kind of hardware Franz recommends for users who will be deploying applications on the scale of 3-4 billion triples. </p><h4>Rfe9374: SPARQL query performance tuning documentation added.</h4><p>The performance tuning guide has been extended to describe possible approaches to handling typed literals to improve SPARQL query performance for numeric and date FILTERs. </p><a name='header2-5553' id='header2-5553'></a><h2>AllegroGraph 4.0</h2><p>Welcome to the new AllegroGraph v4.0.  This latest version of AllegroGraph is designed take full advantage of symmetric multi-processing hardware and brings enterprise database features to the world of Semantics and RDF. AllegroGraph, now incorporates: </p>
<ul>
<li>Full ACID database compliance.</li>
<li>Full Recoverability.</li>
<li>Online backup and restore.</li>
<li>Automatic Indexing.</li>
<li>HTTP-based client/server libraries supporting: Java, Sesame, Jena and Python.</li></ul><p>This release of AllegroGraph v4.0 is focused on enhancements to database backup and restore, Java Jena client library compliance, and overall product stability improvements. </p><a name='header3-5561' id='header3-5561'></a><h3>Server Changes</h3><h4>Add a Lisp function to list the catalogs on a server.</h4><p>The function #'catalogs, exported from the db.agraph package, can now be used to find out which catalogs a server provides. </p><h4>Added ego-group-layers function</h4><p>ego-group-layers returns a nodes ego-group organized by the depth at which each node was found. [Lisp API] </p><p>Documentation: ego-group-layers (node depth generator) </p><p>Return a list of lists of the nodes in <code>node</code>s <em>ego group</em>. </p><p>Each element of the result is a list of the nodes discovered at that list's depth. </p><p>These are the nodes in the graph that can be reached by following paths of at most length <code>depth</code> starting at <code>node</code>. The paths are determined using the <code>generator</code> to select neighbors of each node in the ego-group. See the description of SNA generators for additional details. </p><h4>Added support for <code>auto-commit</code> to the bulk load functions</h4><p>The commit parameter to <code>load-ntriples</code>, <code>load-rdf/xml</code> and <code>load-trix</code> can be one of </p>
<ul>
<li><code>nil</code> - do not commit</li>
<li><code>t</code> - commit at the end of the load</li>
<li>a number N - commit every N-triples</li></ul><h4>Changed behavior of breadth-first-path-search when maximum-depth is given.</h4><p>Previously, when the breadth-first-path-search functions were given a maximum depth, AllegroGraph would return the shortest path or paths found that were no longer than that depth. Now, AllegroGraph returns all paths found that are no longer than maximum depth. </p><p>This can be very expensive for graphs with high connectivity. To return only the shortest path, use a maximum depth of nil. [Lisp API]. </p><p>Since the Prolog SNA functors use the underlying SNA functions, their behavior has also changed. </p><h4>Change the keyword value used to identify typed literals</h4><p>Previously, AllegroGraph used :typed-literal to specify a typed literal. To make things more consistent with :literal :literal-language, this has been changed to :literal-typed. [Lisp API] </p><h4>Define an error type to signal failures to connect to the AllegroGraph server.</h4><p>Any operation (opening, creating, deleting, probing) that has to talk to the server will now raise a condition of type db.agraph:could-not-connect-to-server-error if it fails to find a server on the specified port. </p><h4>Fix mistake in instance-subprocess communication protocol.</h4><p>This would cause the instance to go into an infinite loop and become unresponsive when one of its children died. </p><h4>Make delete-duplicates-on-merge setting persistent.</h4><p>The flag was not properly restored when opening a triple store. </p><h4>Rfe7381 - Add a db keyword argument to several API commands Added the db argument to the following commands </h4>
<ul>
<li>part-&gt;string</li>
<li>part-&gt;value</li>
<li>part-&gt;ntriples</li>
<li>part-&gt;long</li>
<li>part-&gt;concise</li>
<li>part-&gt;terse</li>
<li>print-triple</li></ul><p>[Lisp API] </p><h4>Rfe8765 - Improved Prolog query performance</h4><p>Many Prolog queries execute more than 30% more quickly. </p><h4>Rfe8860 - Geospatial functions now accept strings</h4><p>The geospatial functions in AllegroGraph previously required a subtype object. They now accept strings which name a subtype object. This makes them easier to use. [Lisp API] </p><h4>Rfe9146 - Allow 'merging' of store metadata on concurrent change.</h4><p>Before, two sessions both adding a type-mapping and then committing would cause a conflict error. The metadata system is now clever enough to merge such changes. </p><h4>Rfe9209 - Don't log process termination messages before cleanup.</h4><p>Both instance processes and their children used to output '... terminated' before they cleaned up, which in some cases led to them hanging or crashing <em>after</em> they claimed to have terminated. </p><h4>Rfe9212 - Periodically clean up deleted triple data structures</h4><p>Previously, the data structures which track deleted triples could grow without bounds.  Now, they are periodically examined and obsolete portions are purged. </p><h4>Rfe9291 - Use XSD instead of internal type-codes for /mappings</h4><p>The /mapping protocol now returns lists of </p>
<pre><code>mapping-kind datatype/predicate XSD-type </code></pre><p>rather than </p>
<pre><code>mapping-kind datatype/predicate numeric-type-code </code></pre><p>This makes both debugging and general use of the mappings much simpler for clients. </p><h4>Rfe9294 - Added SNA path functors to bind only the first matching path</h4><p>Added breadth-first-search-path and bidirectional-search-path functors to correspond with the existing depth-first-search-path functor. These all run SNA path finding algorithms and stop after finding the first matching path. </p><h4>Rfe9315 - Do early probe to see if file system supports &gt;4GB file offsets</h4><p>Allegrograph requires that the underlying file systems support offsets longer than 32 bits.  Some file systems (i.e. NFSv2) do not support long offsets, which caused file system related failures in varying situations.  Allegrograph now probes each of the file systems specified in a configuration to make sure that long file offsets are supported. </p><h4>Rfe9322 - Changes in encoded date and time UPIs.</h4><p>Corrected a problem where the fractional seconds stored in an encoded UPI could be lost. The update fixes the stored representation and invalidates existing triple-stores that have any time, date or date-time encoded UPIs. </p><h4>Rfe9329 - Improved loading of a required shared library.</h4><p>Previously, AllegroGraph required loading of a particular shared library (librt) that did not always exist by the same name on all Linux distributions.  This problem has been corrected. </p><h4>Rfe9330: Set up selinux security context on shared library during installation</h4><p>Previously, on systems with SELinux enabled, the agraph server would not start up properly unless the operator issued the following command first: </p>
<pre><code>chcon -t textrel_shlib_t &lt;agraph lib dir&gt;/libacl*.so </code></pre><p>Now, this command is automatically performed during RPM package install or when using the install-agraph script that comes with the tarball package. </p><h4>Rfe9340 - Disallow overlapping catalog directories.</h4><p>Having, for example, one catalog in /tmp/foo, and another in /tmp/foo/bar, or two catalogs in the exact same directory, is no longer allowed, since this is bound to cause stores to be corrupted. </p><h4>Rfe9362: Output a log message when deleting a triple-store.</h4><p>Deleting a store wasn't visible in the log before. It now notes which store was deleted. </p><h4>Spr36556 - Reduce number of duplicate rdf:type inferences</h4><p>AllegroGraph's type inference was returning a triple for each possible inference path rather than filtering out the duplicates. I.e., if <code>a rdf:type B</code> could be inferred two ways, then the reasoner would return two triples. This no longer happens. </p><h4>Spr 36565 - Standardize the printing of encoded types</h4><p>AllegroGraph would sometimes print typed literals non-syntactically. This no longer occurs. </p><h4>Bug18679 - Made part-&gt;value function more consistent</h4><p>The part-&gt;value function now returns type-codes for both UPIs and future-parts. Previously, it returned a type-code for UPIs and a keyword (like :literal or :anon) for future-parts. [Lisp API]. </p><h4>Bug18679 - Removed the deprecated part-value</h4><p>The deprecated part-value function has been removed. Use part-&gt;value in its place. [Lisp API] </p><h4>Bug18738 - Make query-planner work on remote-triple-stores</h4><p>Previously, select queries that needed to reorder their clauses would instead signal an error on remote-triple-stores. This patch corrects this problem and lets remote-triple-stores work correctly with the query-planner. [Lisp API] </p><h4>Bug18840, Bug19003 - Inconsistent state after duplicate purging</h4><p>Total triple counts were wrong after duplicate purging. By default, AllegroGraph purges duplicate triples from the index during merge operations. Previously, when duplicate triples were purged, the total count of triples in the store was not updated.  Also, in most cases, one of the seven triple indices would not be purged of duplicates, resulting in wasted storage and potentially inconsistent query results. These problems have been corrected. </p><h4>Bug18879 - Corrected add-triple so that it could accept large strings</h4><p>Unlike the bulk loaders, the add-triple function was unable to accept strings longer than 8092 characters and would signal an error. Now add-triple can accept strings of arbitrary size. </p><h4>Bug18800 - Unbound prolog variables could pollute <code>select</code> query results</h4><p>Queries like </p>
<pre><code>(select (?s ?t)  
 (q ?s !&lt;http://franz.com/sna#marriage&gt;  
!&lt;http://franz.com/sna#peruzzi&gt;)  
 (optional (q ?s !rdf:type ?t))) </code></pre><p>could return unbound expessions like `{Unbound 14a170c9}` instead of `nil`. Now these queries correctly return `nil`. </p><h4>Bug18880 - Corrected serialization of RDF/XML</h4><p>The serializer sometimes added extra angle brackets around typed literals. Now it correctly outputs them as, e.g., </p>
<pre><code>"42"^^&lt;http://www.w3.org/2001/XMLSchema#int&gt; </code></pre><h4>Bug18947 - Make service daemon responsible for deleting stores</h4><p>delete-triple-store used to only check whether the store was open in the current image, and thus deleted stores even if another process had them open. This moves the responsibility for deleting stores to the service-daemon, which actually knows whether anyone has the store open. </p><h4>Bug18949 - Fix geospatial type mapping in federated stores</h4><p>AllegoGraph was not handling geospatial type-mappings in federated-triple-stores and could fail to return all of the triples from every leaf store. This is corrected. </p><h4>Bug18972 - Correct printing of times with fractional seconds</h4><p>When a time or dateTime with fractional seconds had leading zeros in the fractional seconds part, AllegroGraph could fail to print it. I.e., a time like 10:31:55.028192 might print as 10:31:55.281900. This printing problem has been corrected. </p><h4>Bug19010 - Fix 'store in use' bug when accessing store over HTTP.</h4><p>Fixes a bug where a store accessed over HTTP could not be deleted or replaced through the direct Lisp API until its handle had timed out. </p><h4>Bug19018 - Make sure instance processes are cleaned up when breaking</h4><p>Fixes a few cases where unexpected errors would cause the daemon to get confused about the stores it had open (instance crash, client dying while opening or creating). </p><h4>Bug19024 - Show catalog name in store-status error messages</h4><p>Errors like 'store exists' and 'store not found' used to only contain the store name, now they also have the catalog. Trying to perform an operation on a non-existent catalog now raises an error that clearly indicates the catalog doesn't exist. </p><h4>Bug19045 - Use . as the fractional seconds separator in times and dateTimes</h4><p>Previously AllegroGraph used the comma (,) as the separator in its printed representation of XSD times and dateTimes. This is acceptable ISO 8601 notation but not acceptable XSD notation. This bug fixes the problem so that fractional seconds are separated from whole seconds by a period (.). </p><h4>Bug19055: Fix potential hang when committing</h4><p>Under certain circumstances, commits could hang indefinitely while waiting for chunk merging to complete, but chunk merging would never commence due to a counter having an invalid value.  This problem has been corrected. </p><h4>Bug19061: upi-&gt;String table race condition fix</h4><p>Previously, under high load conditions, errors could occur during string table operations.  This problem has been fixed. </p><a name='header3-5667' id='header3-5667'></a><h3>AllegroGraph Server: HTTP Interface</h3><h4>Allow nested lists in JSON-shaped Prolog-query output.</h4><p>application/json results for Prolog queries can now contain nested arrays of results, to make it easier to use some of our SNA functionality. </p><h4>Allow the creation of sessions with federated, graph-filtered, or reasoning stores.</h4><p>It is now possible to spawn HTTP sessions on a store built up by applying an arbitrary combination reasoning, federation, and graph-filtering to concrete triples. </p><h4>Cause output of --http-trace switch to actually get flushed to the file.</h4><p>Before, it was buffered, and would only be visible after a large amount was written, or the server was shut down. </p><h4>Clean up namespaces when a repository is deleted.</h4><p>Before, deleting and re-creating a repository would leave the old namespaces intact. </p><h4>Enable streaming of XML bodies when loading statements.</h4><p>A problem in our SAX parser made this difficult before, but that has since been fixed. This makes it possible to load large files with less overhead. </p><h4>Fix a bug that prevented session permissions to show up in WebView user-contol UI.</h4><p>(No further text.) </p><h4>Fix a bug with namespace caching.</h4><p>Sometimes, back-ends wouldn't notice a user's namespaces had changed when they were updated twice within the same second. </p><h4>Fix bug in remote geospatial queries.</h4><p>There was a problem that broke remote-triple-stores when more than one geospatial subtype occurred in a query response. This is now fixed. </p><h4>Fix user-access bug in HTTP protocol.</h4><p>Fix a bug that prevented users with access to a store in the root catalog, but not the whole catalog, from accessing this store over HTTP. </p><h4>Make user-access-configuration interface in WebView more obvious</h4><p>It was easy to mistake the widget for adding access for an indication that access had already been granted. </p><h4>Support changing user passwords through the HTTP interface</h4><p>There is now /users/[NAME]/password, to which one can POST a new password. </p><h4>Support resetting namespaces to the defaults.</h4><p>There is now a reset argument to the namespace clearing interface, which, when true, will cause the default namespaces to be restored. </p><h4>Rfe9131 - Add defaultGraphName parameter to SPARQL query interface</h4><p>This is used to provide a way to refer to the default graph inside a SPARQL query using a URI. </p><h4>Rfe8999 - Use a unified format for serializing blank nodes.</h4><p>Before, each component had its own format. This moves the HTTP server to the unified format. </p><h4>Rfe9183 - Silence AServe's socket-reset warnings</h4><p>The log is no longer polluted with spurious connection-reset messages. </p><h4>Rfe9185 - Support delete-duplicates-during-merge remotely</h4><p>Remote-triple-stores now support the :delete-duplicates-during-merge initarg, and the db-delete-duplicates-during-merge accessor. </p><h4>Rfe9217 - Add more help text to the WebView interface.</h4><p>Potentially confusing input fields in WebView (such as those where resources or literals are entered) now have a question-mark icon that pops up an explanation. </p><h4>Rfe9236 - Support SPARQL/Update over HTTP.</h4><p>POST requests to a repository can now issue a SPARQL/Update query, if the user has write access to the store. </p><h4>Rfe9247 - Expose server processes in HTTP interface</h4><p>It is now possible to list, inspect, and kill the server's processes through the HTTP interface. Additionally, one can start up telnet servers in the processes, in order to directly debug them. </p><h4>Rfe9247(2) - Allow process control from WebView</h4><p>Superusers can now view the server processes, and open telnet servers in them, through the WebView UI. (See the 'Processes' link in the navigation bar at the top-level page.) </p><h4>Rfe9295 - Add a commit argument to PUT/POST /statements.</h4><p>This supports auto-committing every X triples, to make uploading huge files viable. </p><h4>Rfe9310 - The PUT /repository/[name] now overwrites by default.</h4><p>The PUT /repository/[name] service in the HTTP protocol now overwrites existing repositories by that name unless override=false is passed. </p><h4>Bug19002 - Fix bug in HTTP protocol namespace caching.</h4><p>Fix a bug that caused problems with namespaces after deleting and re-creating (over HTTP) a store that had namespaces defined. </p><h4>Bug19005 - Corrected problem in client lookups of individual datatype mappings.</h4><p>Previously, a request for an individual datatype mapping would return nil regardless of how the mapping was defined. Now it returns the correct value. </p><a name='header3-5716' id='header3-5716'></a><h3>Documentation</h3><h4>Server Installation Page Updated to be Ubuntu-Friendly</h4><p>The server-installation instructions have been updated to make them more friendly to people who don't know how to install Python, python-pycurl, and python-cjson packages.  This included some specific suggestions for Ubuntu users for RPM installation and Python client installation. </p><h4>Rfe9322 - Added client tutorials to the documentation</h4><p>The documentation now contains tutorials on how to use the Python and Java clients.  Please see the links off of the main web pages. </p><a name='header3-5721' id='header3-5721'></a><h3>Java Client</h3><h4>Expanded Coverage of Literal Values in Java Tutorial.</h4><p>The Java tutorial has been revised and expanded to document the behavior of literal typed values (in example5()). This includes the default behavior of untyped literals, as well as their use in getStatements queries as well as filtered and direct SPARQL queries.   The section covers strings, floats, ints, untyped values, dates and times. </p><h4>Java Tutorial Describes Managing User Accounts</h4><p>The Java tutorial has a new section on "Creating AllegroGraph Users with WebView." It describes how to create a manage new AllegroGraph user accounts. </p><h4>Rfe8812 - Jena compliance improvements</h4><p>Added compliance tests for Jena GraphMaker and Model interfaces and corrected several non-compliances. </p><p>Properly handle the case of getting a namespace uri for a prefix that does not exist, and add support for expanding a QName. </p><p>Add GraphMaker support for creating anonymous graphs, listing graphs, checking existence of a graph, and returning existing graph objects rather than creating new ones when possible. </p><p>Throw AlreadyExistsException when attempting to create an existing graph in strict mode, and throw a DoesNotExist exception when attempting to remove or open a non-existent graph in strict mode. </p><h4>Rfe8812 - Jena Graph compliance improvements</h4><p>Added compliance tests for the Jena Graph interface and corrected several non-compliances. </p><p>AGBulkUpdateHandler's removeAll method properly clears a graph. </p><p>Added a custom AGCapabilities class declaring handlesLiteralTyping to be false, as AGGraph does not currently support D-entailment. </p><p>Add support for the executeInTransaction method in AGTransactionHandler, though using begin/commit/rollback explicitly is preferred. </p><p>AGTripleIterators are now tied to AGGraphs, calling remove on the iterator will delete from the graph. </p><h4>Rfe9359 - Jena Prolog support.</h4><p>Added support for Prolog select queries over a Jena model. Queries must be written to select for variables that are bound to RDF parts, rather than to arbitrary Lisp objects. </p><a name='header3-5739' id='header3-5739'></a><h3>Python Client</h3><h4>Removed Common Logic</h4><p>Removed the experimental and undocumented client side Common Logic query language. Please contact support@franz.com for information if you were using this language. </p><h4>Removed JDBC result sets</h4><p>Removed the ability to get JDBC result sets.  Please contact support@franz.com if you need ways to get the result data without instantiating the corresponding Literal, URI, or BNode objects. </p><h4>Namespace implementation is now server-side</h4><p>Removed the client-side namespace implementation in favor of a server-side namespace management. </p><h4>"Duplicate Triples" added to Python Tutorial.</h4><p>The Python Tutorial has a new section on "Duplicate Triples", based on example23(). It describes the sources of duplicate triples and repetitive query results, and prescribes techniques for bringing them under control. </p><h4>Python Tutorial Describes Managing User Accounts.</h4><p>The Python tutorial has a new section on "Creating AllegroGraph Users with WebView." It describes how to create a manage new AllegroGraph user accounts. </p><h4>Expanded Coverage of Literal Values in Python Tutorial.</h4><p>The Python tutorial has been revised and expanded to document the behavior of literal typed values (in example5()). This includes the default behavior of untyped literals, as well as their use in getStatements queries as well as filtered and direct SPARQL queries. The section covers strings, floats, ints, untyped values, dates and times. </p><h4>Python Examples from Command Line</h4><p>The Python tutorial example file (tutorial<em>examples</em>40.py) can now be run from the command line. </p>
<pre><code>$ python tutorial_examples_40.py  runs all tests.  
$ python tutorial_examples_40.py all  runs all tests.  
$ python tutorial_examples_40.py 1 5 22   runs tests 1, 5, and 22 </code></pre><h4>Rfe9295 - Changes addStatements and addFile</h4><p>addStatements and addFile can now auto-commit triples based on a count for large loads of triples. Set the add commit size to a positive integer by calling setAddCommitSize or setting the add<em>commit</em>size property on the RepositoryConnection for size-based commits, or set to None or 0 for regular commit semantic on the add methods. </p><p>Using this feature can decrease the server's memory usage during loading. </p><h4>Rfe9316 - RepositoryConnection.setRuleLanguage removed</h4><p>RepositoryConnection.setRuleLanguage has been removed. Both addRules and loadRules already take an language parameter which defaults to QueryLanguage.PROLOG as the only language currently supported for rules. </p><h4>Bug19001 - Changes to RepositoryConnection.clearNamespaces API</h4><p>RepositoryConnect.clearNamespaces now supports a reset parameter (which defaults to True). clearNamespaces deletes all namespaces in the repository for the current user. If the <code>reset</code> argument is <code>True</code>, the user's namespaces are reset to the default set of namespaces, otherwise all namespaces are cleared. </p><h4>Bug19004 - Make sure Python clients ping their session.</h4><p>Previously, the thread to keep a dedicated session alive was created but not started, making it possible for Python clients to have their session time out on them. </p><a name='header2-5764' id='header2-5764'></a><h2>AllegroGraph 4.0m2</h2><a name='header3-5765' id='header3-5765'></a><h3>General</h3><p>The M2a release includes the following major functionality: </p>
<ul>
<li><p>Full database backups and restores.</p></li>
<li><p>Text Indexer Enhancement for databases with more than 1 Billion text elements and strings with international characters.</p></li>
<li><p>Infiniband testing and performance document.</p></li>
<li><p>Deleted Triples Data structure improvement that removes the previous hard-coded limit on the number of triples that can be deleted per transaction.</p></li>
<li><p>Cluster Manager Design Document.</p></li>
<li><p>Jena functionality that was outlined as being highest priority.</p></li>
<li><p>Federation of AllegroGraph 4 databases</p></li>
<li><p>Support for Social Network Analysis</p></li>
<li><p>Support for two dimensional geospatial analysis.</p></li>
<li><p>Support for 48-bit triple IDs.</p></li>
<li><p>User definable placement of the transaction log.</p></li></ul><p>There were many minor enhancements and bug fixes. </p><p>Note that AllegroGraph databases created with release m1 or m2 will have to be converted to a new format before use with version m2a.  See the <a href="upgrade-guide.html">Upgrade Guide</a>. </p><h4>Performance and Robustness</h4>
<ul>
<li><p>Improve logging by making some messages more concise and adding additional messages to improve diagnostics.</p></li>
<li><p>Improve and make string tables more robust</p>
<ul>
<li><p>better consistency checks</p></li>
<li><p>compress large strings (&gt;= 256 chars) in the string table</p></li></ul></li>
<li><p>Added conversion tools for moving m1 triple-stores to m2</p></li>
<li><p>Support SIGUSR1-based reload in agraph-control script</p></li>
<li><p>After merging UPI tables, schedule a checkpoint to delete files which are no longer needed.</p></li>
<li><p>Safer file deletion for UPI tables to prevent problems with untunded databases. </p></li>
<li><p>Optimize UPI table merging, do not merge table portions that can't have common entries. </p></li>
<li><p>Improve client handling of instance process death</p></li>
<li><p>Improve upgrade checkpoint handling</p></li>
<li><p>Improved database versioning framework</p></li>
<li><p>Reference count indices so that they do not disappear out from under cursors</p></li>
<li><p>Rmprove transaction log upgrade handling</p></li>
<li><p>Writes to transaction log files are now aligned to the filesystem block size to allow for optimal performance when used with certain storage subsystems. </p></li>
<li><p>Control placement of transaction log (with TransactionLogDir)</p></li>
<li><p>The maximum number of triples that can be added to a triple store is now 2^48 (formerly 2^32). </p></li>
<li><p>Added TransactionLogDir config file parameter.  This specifies where transaction log files should go.  If not specified, defaults to the value of Main. </p></li>
<li><p>The agraph server process now responds to SIGUSR1 by reloading the server configuration file.  The agraph-control script and /etc/init.d/agraph scripts now accept the 'reload' command and will send SIGUSR1 to the agraph server process. </p></li>
<li><p>Enhanced in-the-field debugging support.  When requested by Franz tech support, you can send SIGUSR2 an AllegroGraph subprocess to get a backtrace for all threads. </p></li></ul><h4>Other Enhancements</h4>
<ul>
<li><p>configure-agraph now turns off terminal echo before prompting for the super user password.  Also, since the password is no longer echoed, configure-agraph prompts for the password twice to make sure it has been entered properly. </p></li>
<li><p>support fractional seconds in time and dateTime</p></li>
<li><p>improve support for duplicate deletion during merge operations</p></li>
<li><p>improve and unify the printing of blank nodes</p></li>
<li><p>make the opening and re-opening of federated-triple-stores more robust</p></li>
<li><p>document group centrality</p></li>
<li><p>add API to auto-commit (on a per store basis)</p></li>
<li><p>add depth-first-search-path functor</p></li>
<li><p>add :plain encoding</p></li>
<li><p>improve handling of polygons in the geospatial sub-system</p></li>
<li><p>cleanup part printing</p></li>
<li><p>Remove line breaks in server log files to make automated processing and filtering easier. </p></li>
<li><p>Crash instance process if one of its helper processes crashes.</p></li>
<li><p>Detect death of instance process in client.  Generate clear error message instead of hanging the client. </p></li>
<li><p>Add database versioning framework.  Implement stepwise upgrade paths for databases that have been created with different software versions. </p></li></ul><h4>Fixed bugs and other corrections</h4>
<ul>
<li><p>Fix for bug18831: Agraph.cfg "overwrite" option appends to previous file instead of overwriting it as it should. </p></li>
<li><p>Fixed bug18774:  Running "agraph-control start" twice would overwrite a valid pid file.  This has been fixed. </p></li></ul><a name='header3-5820' id='header3-5820'></a><h3>SPARQL</h3>
<ul>
<li><p>Significant SPARQL performance improvements throughout, particularly in Left Joins (OPTIONAL), DISTINCT and REDUCED, and certain numeric FILTERs.</p></li>
<li><p>Massive performance increase for queries with both ORDER BY and a small LIMIT.</p></li>
<li><p>Imposed bindings (:with-variables) now apply to the output portion of SPARQL CONSTRUCT and DESCRIBE queries.</p></li>
<li><p>Some queries that use the SPOGI cache as an optimization could return duplicates. Fixed.</p></li>
<li><p>Similarly, the free-text index now returns distinct results in all cases, which avoids some unnecessary duplicate results.</p></li>
<li><p>Add the ability to use a graph URI, on both input and output, as a signifier for the default graph UPI of the current store.</p></li>
<li><p>Complete xsd:string/simple literal entailment. This allows you to seamlessly switch between using xsd:strings and plain literals without query changes. Plain literals are more efficient for the storage layer, and encouraged in all circumstances.</p></li>
<li><p>Improvements (in both efficiency and correctness) for SPARQL comparisons and XQuery functions when handling encoded values.</p></li>
<li><p>RDF/XML serializer can now handle on-the-fly namespace abbreviation, at the cost of more verbose output.</p></li>
<li><p>SPARQL extensions (e.g., geospatial forms) are now permitted by default.</p></li>
<li><p>URIs can now be used to specify geospatial subtypes, as well as the more verbose and less portable UUID form.</p></li></ul><a name='header3-5832' id='header3-5832'></a><h3>Java Client</h3>
<ul>
<li><p>Added Social Network Analysis capability.</p></li>
<li><p>Updated the Java Tutorial and tutorial examples to include Social Network Analysis.</p></li>
<li><p>Added Geospatial analysis capability.</p></li>
<li><p>Updated the Java Tutorial and tutorial examples to include Geospatial Analysis.</p></li>
<li><p>Established a Jena semantic framework API.</p></li>
<li><p>Created the Jean Tutorial, and a file of Jena tutorial examples.</p></li></ul><a name='header3-5839' id='header3-5839'></a><h3>Python Client</h3>
<ul>
<li><p>Added back support for SPOGI cache enabling/disabling</p></li>
<li><p>Enabled returning SPARQL-results+json or SPARQL-results+xml result from a query rather than a binding set</p></li>
<li><p>Introduced a boolean argument to openSession and session API for whether or not to load the initfile in the process handling the session</p></li>
<li><p>Federation support.</p></li>
<li><p>Introduced several options and better command-line option parsing for the load stress script</p></li>
<li><p>Minor updates to Python Tutorial and examples.</p></li></ul><a name='header2-5846' id='header2-5846'></a><h2>Changes to earlier releases</h2><p>Significant changes in AllegroGraph 4.0 compared to earlier releases makes changes to earlier releases irrelevant to release 4.0 and later. Contact allegrograph-support@franz.com if you have questions about releases prior to 4.0. </p></div>  <p><script> $.each($("#agmenu ul li a"), function(ignore, link) {   var anchor = $(link);   anchor.parent().on("click", function () { window.location = anchor.prop("href"); }); }); $("#agmenu").css("display", "block") </script> </p> 
</body>
</html>
