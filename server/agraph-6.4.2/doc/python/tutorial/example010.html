
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Example 10: Graphs in SPARQL &#8212; AllegroGraph Python client 100.2.0.dev0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '100.2.0.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example 11: Namespaces" href="example011.html" />
    <link rel="prev" title="Example 9: Exporting query results" href="example009.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
    <div class="nav-links nav-links-header">
        &laquo;<a href="example009.html" title="previous chapter">Example 9: Exporting query results</a>
      <a href="example011.html" title="next chapter">Example 11: Namespaces</a> 
      &raquo;
    </div>
  
    
  <div class="section" id="example-10-graphs-in-sparql">
<span id="example10"></span><h1>Example 10: Graphs in SPARQL<a class="headerlink" href="#example-10-graphs-in-sparql" title="Permalink to this headline">¶</a></h1>
<p>In <a class="reference internal" href="example006.html#example6"><span class="std std-ref">Example 6: Importing triples</span></a> and <a class="reference internal" href="example007.html#example7"><span class="std std-ref">Example 7: Querying multiple contexts</span></a> we’ve seen how to import data
to a non-default context and run queries against such data. In this
example we’ll explore facilities for handling multiple contexts
provided by SPARQL and the AllegroGraph Python client.</p>
<p>We’ll start by opening a connection:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">franz.openrdf.connect</span> <span class="kn">import</span> <span class="n">ag_connect</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">ag_connect</span><span class="p">(</span><span class="s1">&#39;python-tutorial&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we will create two URIs that will represent named contexts.</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">context1</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createURI</span><span class="p">(</span><span class="s2">&quot;ex://context1&quot;</span><span class="p">)</span>
<span class="n">context2</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createURI</span><span class="p">(</span><span class="s2">&quot;ex://context2&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The first context will be filled using the <a class="reference internal" href="../_gen/franz.openrdf.repository.html#franz.openrdf.repository.repositoryconnection.RepositoryConnection.addData" title="franz.openrdf.repository.repositoryconnection.RepositoryConnection.addData"><code class="xref py py-meth docutils literal"><span class="pre">addData()</span></code></a> method:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">addData</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="w"></span>
<span class="w">    </span><span class="k">@prefix</span><span class="w"> </span><span class="nn">:</span><span class="w"> </span><span class="nv">&lt;ex://&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nn">:</span><span class="nt">alice</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">:</span><span class="nt">person</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">           </span><span class="nn">:</span><span class="nt">name</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="w"> </span><span class="p">.</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">context</span><span class="o">=</span><span class="n">context1</span><span class="p">)</span>
</pre></div>
</div>
<p>The second context will be filled using <a class="reference internal" href="../_gen/franz.openrdf.repository.html#franz.openrdf.repository.repositoryconnection.RepositoryConnection.addTriple" title="franz.openrdf.repository.repositoryconnection.RepositoryConnection.addTriple"><code class="xref py py-meth docutils literal"><span class="pre">addTriple()</span></code></a>. Notice how
we use a constant defined in the <code class="docutils literal"><span class="pre">RDF</span></code> class to obtain the URI of
the <code class="docutils literal"><span class="pre">type</span></code> predicate:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">franz.openrdf.vocabulary.rdf</span> <span class="kn">import</span> <span class="n">RDF</span>

<span class="n">bob</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createURI</span><span class="p">(</span><span class="s1">&#39;ex://bob&#39;</span><span class="p">)</span>
<span class="n">bob_name</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createLiteral</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createURI</span><span class="p">(</span><span class="s1">&#39;ex://person&#39;</span><span class="p">)</span>
<span class="n">person</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createURI</span><span class="p">(</span><span class="s1">&#39;ex://person&#39;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">addTriple</span><span class="p">(</span><span class="n">bob</span><span class="p">,</span> <span class="n">RDF</span><span class="o">.</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span>
               <span class="n">contexts</span><span class="o">=</span><span class="p">[</span><span class="n">context2</span><span class="p">])</span>
<span class="n">conn</span><span class="o">.</span><span class="n">addTriple</span><span class="p">(</span><span class="n">bob</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bob_name</span><span class="p">,</span>
               <span class="n">contexts</span><span class="o">=</span><span class="p">[</span><span class="n">context2</span><span class="p">])</span>
</pre></div>
</div>
<p>Finally we’ll add two triples to the default context using
<a class="reference internal" href="../_gen/franz.openrdf.repository.html#franz.openrdf.repository.repositoryconnection.RepositoryConnection.addStatement" title="franz.openrdf.repository.repositoryconnection.RepositoryConnection.addStatement"><code class="xref py py-meth docutils literal"><span class="pre">addStatement()</span></code></a>:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">franz.openrdf.model</span> <span class="kn">import</span> <span class="n">Statement</span>

<span class="n">ted</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createURI</span><span class="p">(</span><span class="s1">&#39;ex://ted&#39;</span><span class="p">)</span>
<span class="n">ted_name</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createLiteral</span><span class="p">(</span><span class="s1">&#39;Ted&#39;</span><span class="p">)</span>
<span class="n">stmt1</span> <span class="o">=</span> <span class="n">Statement</span><span class="p">(</span><span class="n">ted</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ted_name</span><span class="p">)</span>
<span class="n">stmt2</span> <span class="o">=</span> <span class="n">Statement</span><span class="p">(</span><span class="n">ted</span><span class="p">,</span> <span class="n">RDF</span><span class="o">.</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">person</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">addStatement</span><span class="p">(</span><span class="n">stmt1</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">addStatement</span><span class="p">(</span><span class="n">stmt2</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <a class="reference internal" href="../_gen/franz.openrdf.model.html#franz.openrdf.model.Statement" title="franz.openrdf.model.Statement"><code class="xref py py-class docutils literal"><span class="pre">Statement</span></code></a> object contains a <cite>context</cite> field.
This field is <em>ignored</em> by <a class="reference internal" href="../_gen/franz.openrdf.repository.html#franz.openrdf.repository.repositoryconnection.RepositoryConnection.addStatement" title="franz.openrdf.repository.repositoryconnection.RepositoryConnection.addStatement"><code class="xref py py-meth docutils literal"><span class="pre">addStatement()</span></code></a>. If you
wish to add a statement object to a specific context, use
the <code class="docutils literal"><span class="pre">contexts</span></code> parameter.</p>
</div>
<p>As we’ve seen already in <a class="reference internal" href="example007.html#example7"><span class="std std-ref">Example 7: Querying multiple contexts</span></a>, a call to
<a class="reference internal" href="../_gen/franz.openrdf.repository.html#franz.openrdf.repository.repositoryconnection.RepositoryConnection.getStatements" title="franz.openrdf.repository.repositoryconnection.RepositoryConnection.getStatements"><code class="xref py py-meth docutils literal"><span class="pre">getStatements()</span></code></a> will return triples from all contexts:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">getStatements</span><span class="p">()</span> <span class="k">as</span> <span class="n">result</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;getStatements(): {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;size(): {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_gen/franz.openrdf.repository.html#franz.openrdf.repository.repositoryconnection.RepositoryConnection.size" title="franz.openrdf.repository.repositoryconnection.RepositoryConnection.size"><code class="xref py py-meth docutils literal"><span class="pre">size()</span></code></a> will also process all contexts by default.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>getStatements(): 6
size(): 6
</pre></div>
</div>
<p>Both <a class="reference internal" href="../_gen/franz.openrdf.repository.html#franz.openrdf.repository.repositoryconnection.RepositoryConnection.getStatements" title="franz.openrdf.repository.repositoryconnection.RepositoryConnection.getStatements"><code class="xref py py-meth docutils literal"><span class="pre">getStatements()</span></code></a> and <a class="reference internal" href="../_gen/franz.openrdf.repository.html#franz.openrdf.repository.repositoryconnection.RepositoryConnection.size" title="franz.openrdf.repository.repositoryconnection.RepositoryConnection.size"><code class="xref py py-meth docutils literal"><span class="pre">size()</span></code></a> accept a <code class="docutils literal"><span class="pre">contexts</span></code>
parameter that can be used to limit processing to a specified list of
graphs:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">contexts</span> <span class="o">=</span> <span class="p">[</span><span class="n">context1</span><span class="p">,</span> <span class="n">context2</span><span class="p">]</span>
<span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">getStatements</span><span class="p">(</span><span class="n">contexts</span><span class="o">=</span><span class="n">contexts</span><span class="p">)</span> <span class="k">as</span> <span class="n">result</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;getStatements(): {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;size(): {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">contexts</span><span class="o">=</span><span class="n">contexts</span><span class="p">)))</span>
</pre></div>
</div>
<p>As expected, triples from the default context are not processed:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>getStatements(): 4
size(): 4
</pre></div>
</div>
<p>To include the default graph when using the <code class="docutils literal"><span class="pre">contexts</span></code> parameter use
<code class="docutils literal"><span class="pre">None</span></code> as a graph URI:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">contexts</span> <span class="o">=</span> <span class="p">[</span><span class="n">context1</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
<span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">getStatements</span><span class="p">(</span><span class="n">contexts</span><span class="o">=</span><span class="n">contexts</span><span class="p">)</span> <span class="k">as</span> <span class="n">result</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;getStatements(): {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;size(): {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">contexts</span><span class="o">=</span><span class="n">contexts</span><span class="p">)))</span>
</pre></div>
</div>
<p>Now triples from the default context and from one of our named
contexts are processed:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>getStatements(): 4
size(): 4
</pre></div>
</div>
<div class="section" id="sparql-using-from-from-default-and-from-named">
<h2>SPARQL using <code class="docutils literal"><span class="pre">FROM</span></code>, <code class="docutils literal"><span class="pre">FROM</span> <span class="pre">DEFAULT</span></code>, and <code class="docutils literal"><span class="pre">FROM</span> <span class="pre">NAMED</span></code><a class="headerlink" href="#sparql-using-from-from-default-and-from-named" title="Permalink to this headline">¶</a></h2>
<p>In many of our examples we have used a simple SPARQL query to retrieve
triples from AllegroGraph’s default graph. This has been very
convenient but it is also misleading. As soon as we tell SPARQL to
search a specific graph, we lose the ability to search AllegroGraph’s
default graph! Triples from the null graph vanish from the search
results. Why is that?</p>
<p>It is important to understand that AllegroGraph and SPARQL use the
phrase “default graph” to identify two very different
things.</p>
<blockquote>
<div><ul class="simple">
<li>AllegroGraph’s default graph, or null context, is simply the set
of all triples that have <cite>null</cite> in the fourth field of the
“triple.” The <em>default graph</em> is an unnamed subgraph of the
AllegroGraph triple store.</li>
<li>SPARQL uses <em>default graph</em> to describe something that is very
different. In SPARQL, the <em>default graph</em> is a temporary pool of
triples imported from one or more <em>named</em> graphs. SPARQL’s
<em>default graph</em> is constructed and discarded in the service of a
single query.  Standard SPARQL was designed for named graphs
only, and has no syntax to identify a truly unnamed
graph. AllegroGraph’s SPARQL, however, has been extended to allow
the unnamed graph to participate in multi-graph queries.</li>
</ul>
</div></blockquote>
<p>We can use AllegroGraph’s SPARQL to search specific subgraphs in three
ways.</p>
<blockquote>
<div><ul class="simple">
<li>We can create a temporary <em>default graph</em> using the <code class="docutils literal"><span class="pre">FROM</span></code>
operator.</li>
<li>We can put AllegroGraph’s unnamed graph into SPARQL’s default
graph using <code class="docutils literal"><span class="pre">FROM</span> <span class="pre">DEFAULT</span></code>.</li>
<li>Or we can target specific named graphs using the <code class="docutils literal"><span class="pre">FROM</span> <span class="pre">NAMED</span></code>
operator.</li>
</ul>
</div></blockquote>
<p>Here’s an example of a query that accesses the unnamed graph explicitly:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">prepareTupleQuery</span><span class="p">(</span><span class="na">query</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="nv">?s</span> <span class="k">FROM</span> <span class="k">DEFAULT</span> <span class="p">{</span>
        <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span>
    <span class="p">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This will not process any of the triples in named contexts:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>------------
| s        |
============
| ex://ted |
------------
</pre></div>
</div>
<p>Here’s an example of a query that uses <code class="docutils literal"><span class="pre">FROM</span></code>. It instructs SPARQL
to regard <code class="docutils literal"><span class="pre">context1</span></code> as the default graph for the purposes of this
query.</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">prepareTupleQuery</span><span class="p">(</span><span class="na">query</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="nv">?s</span> <span class="k">FROM</span> <span class="nl">&lt;ex://context1&gt;</span> <span class="p">{</span>
        <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span>
    <span class="p">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now only one context is processed:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>--------------
| s          |
==============
| ex://alice |
--------------
</pre></div>
</div>
<p>The next example changes <code class="docutils literal"><span class="pre">FROM</span></code> to <code class="docutils literal"><span class="pre">FROM</span> <span class="pre">NAMED</span></code> in the same query:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">prepareTupleQuery</span><span class="p">(</span><span class="na">query</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="nv">?s</span> <span class="k">FROM NAMED</span> <span class="nl">&lt;ex://context1&gt;</span> <span class="p">{</span>
        <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span>
    <span class="p">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>There are no matches now! The pattern <code class="docutils literal"><span class="pre">{</span> <span class="pre">?s</span> <span class="pre">?p</span> <span class="pre">?o</span> <span class="pre">.</span> <span class="pre">}</span></code> only matches
the SPARQL default graph. We declared <code class="docutils literal"><span class="pre">context1</span></code> to be a <em>named</em>
graph, so it is no longer the default graph.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>-----
| s |
=====
-----
</pre></div>
</div>
<p>To match triples in named graphs, SPARQL requires a <code class="docutils literal"><span class="pre">GRAPH</span></code> pattern:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">prepareTupleQuery</span><span class="p">(</span><span class="na">query</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="nv">?s</span> <span class="nv">?g</span> <span class="k">FROM NAMED</span> <span class="nl">&lt;ex://context1&gt;</span> <span class="p">{</span>
        <span class="k">GRAPH</span> <span class="nv">?g</span> <span class="p">{</span> <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span> <span class="p">}</span>
    <span class="p">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This time we’ll also print the graph:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>------------------------------
| s          | g             |
==============================
| ex://alice | ex://context1 |
------------------------------
</pre></div>
</div>
<p>We can also combine all the forms presented above:</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">prepareTupleQuery</span><span class="p">(</span><span class="na">query</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="nv">?s</span> <span class="nv">?g</span>
    <span class="k">FROM</span> <span class="k">DEFAULT</span>
    <span class="k">FROM</span> <span class="nl">&lt;ex://context1&gt;</span>
    <span class="k">FROM NAMED</span> <span class="nl">&lt;ex://context2&gt;</span> <span class="p">{</span>
        <span class="p">{</span> <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span> <span class="p">}</span> <span class="k">UNION</span> <span class="p">{</span> <span class="k">GRAPH</span> <span class="nv">?g</span> <span class="p">{</span> <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This query puts AllegroGraph’s unnamed graph and the <code class="docutils literal"><span class="pre">context1</span></code>
graph into SPARQL’s default graph, where the triples can be found by
using a simple <code class="docutils literal"><span class="pre">{?s</span> <span class="pre">?p</span> <span class="pre">?o</span> <span class="pre">.</span> <span class="pre">}</span></code> query.  Then it identifies
<code class="docutils literal"><span class="pre">context2</span></code> as a named graph, which can be searched using a <code class="docutils literal"><span class="pre">GRAPH</span></code>
pattern.  In the final line, we used a <code class="docutils literal"><span class="pre">UNION</span></code> operator to combine
the matches of the simple and <code class="docutils literal"><span class="pre">GRAPH</span></code> patterns.</p>
<p>This query should find all three subjects:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>------------------------------
| s          | g             |
==============================
| ex://alice | ---           |
| ex://ted   | ---           |
| ex://bob   | ex://context2 |
------------------------------
</pre></div>
</div>
</div>
<div class="section" id="sparql-with-dataset-object">
<h2>SPARQL with <a class="reference internal" href="../_gen/franz.openrdf.query.html#franz.openrdf.query.dataset.Dataset" title="franz.openrdf.query.dataset.Dataset"><code class="xref py py-class docutils literal"><span class="pre">Dataset</span></code></a> object<a class="headerlink" href="#sparql-with-dataset-object" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="../_gen/franz.openrdf.query.html#franz.openrdf.query.dataset.Dataset" title="franz.openrdf.query.dataset.Dataset"><code class="xref py py-class docutils literal"><span class="pre">Dataset</span></code></a> object is a construct that contains two lists of
named graphs. There is one list of graphs that will become the SPARQL
default graph, just like using <code class="docutils literal"><span class="pre">FROM</span></code> in the query. There is a
second list of graphs that will be <em>named graphs</em> in the query, just
like using FROM NAMED. To use the dataset, we put the graph URIs into
the dataset object, and then add the dataset to the query object. When
we evaluate the query, the results will be confined to the graphs
listed in the dataset.</p>
<div class="highlight-python_rdf"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">franz.openrdf.query.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">()</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">addDefaultGraph</span><span class="p">(</span><span class="n">context1</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">addNamedGraph</span><span class="p">(</span><span class="n">context2</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">prepareTupleQuery</span><span class="p">(</span><span class="na">query</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="nv">?s</span> <span class="nv">?g</span> <span class="p">{</span>
      <span class="p">{</span> <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span> <span class="p">}</span> <span class="k">UNION</span> <span class="p">{</span> <span class="k">GRAPH</span> <span class="nv">?g</span> <span class="p">{</span> <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="hll"><span class="n">query</span><span class="o">.</span><span class="n">setDataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span><span class="n">query</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that, since we’re explicitly specifying graphs (through a dataset
object), we need a <code class="docutils literal"><span class="pre">GRAPH</span></code> pattern to match triples from the named
graphs. Triples from the unnamed graph are not matched at all, since
that graph is not a part of the dataset.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>------------------------------
| s          | g             |
==============================
| ex://alice | ---           |
| ex://bob   | ex://context2 |
------------------------------
</pre></div>
</div>
</div>
</div>


  
    <div class="nav-links nav-links-footer">
        &laquo;<a href="example009.html" title="previous chapter">Example 9: Exporting query results</a>
      <a href="example011.html" title="next chapter">Example 11: Namespaces</a> 
      &raquo;
    </div>
  

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">AllegroGraph Python client</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=franzinc&repo=agraph-python&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#setting-the-environment-for-the-tutorial">Setting the environment for the tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#terminology">Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#creating-users-with-webview">Creating Users with WebView</a></li>
<li class="toctree-l2"><a class="reference internal" href="example001.html">Example 1: Creating a repository and triple indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="example002.html">Example 2: Asserting and retracting triples</a></li>
<li class="toctree-l2"><a class="reference internal" href="example003.html">Example 3: A SPARQL query</a></li>
<li class="toctree-l2"><a class="reference internal" href="example004.html">Example 4: Statement matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="example005.html">Example 5: Literal values</a></li>
<li class="toctree-l2"><a class="reference internal" href="example006.html">Example 6: Importing triples</a></li>
<li class="toctree-l2"><a class="reference internal" href="example007.html">Example 7: Querying multiple contexts</a></li>
<li class="toctree-l2"><a class="reference internal" href="example008.html">Example 8: Exporting triples</a></li>
<li class="toctree-l2"><a class="reference internal" href="example009.html">Example 9: Exporting query results</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Example 10: Graphs in SPARQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="example011.html">Example 11: Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="example012.html">Example 12: Free Text indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="example013.html">Example 13: SPARQL query forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="example014.html">Example 14: Parametric queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="example015.html">Example 15: Range queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="example016.html">Example 16: Federated repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="example017.html">Example 17: Triple attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="example018.html">Example 18: Pandas support</a></li>
<li class="toctree-l2"><a class="reference internal" href="fedex.html">Running AG on AWS EC2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">AllegroGraph Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Release notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorial.html">Tutorial</a><ul>
      <li>Previous: <a href="example009.html" title="previous chapter">Example 9: Exporting query results</a></li>
      <li>Next: <a href="example011.html" title="next chapter">Example 11: Namespaces</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Franz Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/tutorial/example010.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>